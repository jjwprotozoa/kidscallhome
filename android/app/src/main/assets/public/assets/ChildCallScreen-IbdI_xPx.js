import{a6 as j,u as C,r as a,j as t}from"./vendor-react-mDIoga_b.js";import{V as v}from"./useWebRTC-DpOhSsm3.js";import{u as N}from"./useCallEngine-C7F9nffZ.js";import{u as I,C as u,B as f,s as b}from"./index-BdmHsoQZ.js";import"./vendor-radix-BQCqNqg0.js";import"./vendor-other-BA4qpukX.js";import"./vendor-capacitor-DSxgEnoB.js";import"./vendor-supabase-DQP4RkUL.js";const M=()=>{const{parentId:s}=j(),l=C(),{toast:g}=I(),[i,x]=a.useState(null),[n,h]=a.useState("Parent"),c=a.useRef(null),r=a.useRef(null);a.useEffect(()=>{(async()=>{const d=localStorage.getItem("childSession");if(!d){l("/child/login");return}const p=JSON.parse(d);if(x(p.id),s){const{data:m}=await b.from("parents").select("name").eq("id",s).single();m?.name&&h(m.name)}})()},[s,l]);const e=N({role:"child",localProfileId:i||"",remoteProfileId:s||"",localVideoRef:c,remoteVideoRef:r});return a.useEffect(()=>{e.state==="idle"&&i&&s&&e.startOutgoingCall(s).catch(o=>{console.error("Failed to start call:",o),g({title:"Call Failed",description:"Failed to start call",variant:"destructive"})})},[e.state,i,s,e]),a.useEffect(()=>{e.state},[e.state]),!i||!s?t.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:t.jsx("div",{children:"Loading..."})}):e.state==="calling"?t.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:t.jsx(u,{className:"p-8",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsxs("h2",{className:"text-2xl font-semibold",children:["Calling ",n,"..."]}),t.jsx("p",{className:"text-muted-foreground",children:"Waiting for answer"})]})})}):e.state==="incoming"?t.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:t.jsx(u,{className:"p-8",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("h2",{className:"text-2xl font-semibold",children:"Incoming Call"}),t.jsxs("p",{className:"text-muted-foreground",children:["From ",n]}),t.jsxs("div",{className:"flex gap-4 justify-center",children:[t.jsx(f,{onClick:()=>e.callId&&e.acceptIncomingCall(e.callId),children:"Accept"}),t.jsx(f,{variant:"destructive",onClick:()=>e.callId&&e.rejectIncomingCall(e.callId),children:"Reject"})]})]})})}):t.jsx(v,{localVideoRef:c,remoteVideoRef:r,remoteStream:e.remoteStream,isConnecting:e.state==="calling"||e.state==="connecting",isMuted:e.isMuted,isVideoOff:e.isVideoOff,onToggleMute:e.toggleMute,onToggleVideo:e.toggleVideo,onEndCall:e.endCall})};export{M as default};

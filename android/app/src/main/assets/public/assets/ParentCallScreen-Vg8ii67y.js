import{a7 as j,u as C,r as s,j as t}from"./vendor-react-LQlp3yIU.js";import{V as v}from"./useWebRTC-CDrKA3k0.js";import{u as N}from"./useCallEngine-BysCX0DH.js";import{u as I,C as m,B as u,s as f}from"./index-4JrybDns.js";import"./vendor-radix-BQCqNqg0.js";import"./vendor-other-DUaz7rji.js";import"./vendor-capacitor-DSxgEnoB.js";import"./vendor-supabase-Bq0a3XdW.js";const M=()=>{const{childId:a}=j(),l=C(),{toast:g}=I(),[i,h]=s.useState(null),[x,p]=s.useState(""),n=s.useRef(null),c=s.useRef(null);s.useEffect(()=>{(async()=>{const{data:{user:o}}=await f.auth.getUser();if(!o){l("/parent/auth");return}if(h(o.id),a){const{data:d}=await f.from("children").select("name").eq("id",a).single();d&&p(d.name)}})()},[a,l]);const e=N({role:"parent",localProfileId:i||"",remoteProfileId:a||"",localVideoRef:n,remoteVideoRef:c});return s.useEffect(()=>{e.state==="idle"&&i&&a&&e.startOutgoingCall(a).catch(r=>{console.error("Failed to start call:",r),g({title:"Call Failed",description:"Failed to start call",variant:"destructive"})})},[e.state,i,a,e]),s.useEffect(()=>{e.state},[e.state]),!i||!a?t.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:t.jsx("div",{children:"Loading..."})}):e.state==="calling"?t.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:t.jsx(m,{className:"p-8",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsxs("h2",{className:"text-2xl font-semibold",children:["Calling ",x,"..."]}),t.jsx("p",{className:"text-muted-foreground",children:"Waiting for answer"})]})})}):e.state==="incoming"?t.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:t.jsx(m,{className:"p-8",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("h2",{className:"text-2xl font-semibold",children:"Incoming Call"}),t.jsxs("div",{className:"flex gap-4 justify-center",children:[t.jsx(u,{onClick:()=>e.callId&&e.acceptIncomingCall(e.callId),children:"Accept"}),t.jsx(u,{variant:"destructive",onClick:()=>e.callId&&e.rejectIncomingCall(e.callId),children:"Reject"})]})]})})}):t.jsx(v,{localVideoRef:n,remoteVideoRef:c,remoteStream:e.remoteStream,isConnecting:e.state==="calling"||e.state==="connecting",isMuted:e.isMuted,isVideoOff:e.isVideoOff,onToggleMute:e.toggleMute,onToggleVideo:e.toggleVideo,onEndCall:e.endCall})};export{M as default};

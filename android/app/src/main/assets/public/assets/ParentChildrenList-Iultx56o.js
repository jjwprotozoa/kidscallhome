import{r as n,u as b,j as e,a4 as u,o as C,M as y}from"./vendor-react-mDIoga_b.js";import{u as k,C as x,B as c,s as p,f as A}from"./index-BdmHsoQZ.js";import{N as f}from"./Navigation-CglVk_ff.js";import{S}from"./StatusIndicator-BZUItRQn.js";import{u as _,A as M}from"./useChildrenPresence-D51CVWNq.js";import{O as E,H as P}from"./OnboardingTour-BCKJLloU.js";import"./vendor-radix-BQCqNqg0.js";import"./vendor-other-BA4qpukX.js";import"./vendor-capacitor-DSxgEnoB.js";import"./vendor-supabase-DQP4RkUL.js";import"./input-UTyCM2Df.js";import"./dialog-D8RTy2fV.js";import"./deviceTracking-lBUE_lfK.js";const B=({child:a,onCall:o,onChat:m,isOnline:d,"data-tour":r})=>{const l=A(a.id);return e.jsx(x,{className:"p-6","data-tour":r,children:e.jsxs("div",{className:"flex items-start justify-between flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:"aspect-square w-12 rounded-full flex items-center justify-center text-white font-bold text-lg leading-none select-none flex-shrink-0",style:{backgroundColor:a.avatar_color||"#6366f1"},children:e.jsx("span",{className:"leading-none",children:a.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:a.name}),e.jsx(S,{isOnline:d,size:"md",showPulse:d})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Code: ",a.login_code]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(c,{onClick:()=>o(a.id),variant:"secondary",className:"flex-1 sm:flex-none relative","data-tour":r?"parent-children-list-call":void 0,children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Call"]}),e.jsxs(c,{onClick:()=>m(a.id),className:"flex-1 sm:flex-none relative bg-chat-accent text-chat-accent-foreground hover:bg-chat-accent/90","data-tour":r?"parent-children-list-message":void 0,children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Message",e.jsx("span",{className:`ml-2 bg-destructive text-destructive-foreground text-xs font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1 ${l===0?"invisible":""}`,children:l>99?"99+":l})]})]})]})})},R=()=>{const[a,o]=n.useState([]),[m,d]=n.useState(!0),[r,l]=n.useState(!1),i=b(),{toast:g}=k(),j=n.useMemo(()=>a.map(s=>s.id),[a]),{isChildOnline:N}=_({childIds:j,enabled:a.length>0});n.useEffect(()=>{(async()=>{const{data:{session:t}}=await p.auth.getSession();if(!t){i("/parent/auth");return}h()})()},[i]);const h=async()=>{try{const{data:s,error:t}=await p.from("children").select("*").order("created_at",{ascending:!1});if(t)throw t;o(s||[])}catch(s){const t=s instanceof Error?s.message:"Unknown error occurred";g({title:"Error loading children",description:t,variant:"destructive"})}finally{d(!1)}},v=s=>{i(`/call/${s}`)},w=s=>{i(`/chat/${s}`)};return m?e.jsxs("div",{className:"min-h-[100dvh] bg-background",children:[e.jsx(f,{}),e.jsx("div",{className:"p-4",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8 mt-8",children:[e.jsx("div",{className:"h-9 w-48 bg-muted rounded animate-pulse mb-2"}),e.jsx("div",{className:"h-6 w-64 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"grid gap-4",children:[1,2,3].map(s=>e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted animate-pulse flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-6 w-32 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx("div",{className:"h-10 w-20 bg-muted rounded animate-pulse flex-1 sm:flex-none"}),e.jsx("div",{className:"h-10 w-24 bg-muted rounded animate-pulse flex-1 sm:flex-none"})]})]})},s))})]})})]}):e.jsxs("div",{className:"min-h-[100dvh] bg-background",children:[e.jsx(f,{}),e.jsx(E,{role:"parent",pageKey:"parent_children_list"}),e.jsx(P,{role:"parent",pageKey:"parent_children_list"}),e.jsx("div",{className:"p-4",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8 mt-8 flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Your Children"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"View and call your children"})]}),e.jsxs(c,{onClick:()=>l(!0),className:"flex-shrink-0",size:"lg","data-tour":"parent-children-list-add-child",children:[e.jsx(u,{className:"mr-2 h-5 w-5"}),"Add Child"]})]}),a.length===0?e.jsxs(x,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4 text-lg",children:"No children added yet."}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:'Click "Add Child" above to create a profile and login code for your child.'}),e.jsxs(c,{onClick:()=>l(!0),size:"lg",className:"mx-auto",children:[e.jsx(u,{className:"mr-2 h-5 w-5"}),"Add Your First Child"]})]}):e.jsx("div",{className:"grid gap-4",children:a.map((s,t)=>e.jsx(B,{child:s,onCall:v,onChat:w,isOnline:N(s.id),"data-tour":t===0?"parent-children-list-card":void 0},s.id))})]})}),e.jsx(M,{open:r,onOpenChange:l,onChildAdded:h})]})};export{R as default};

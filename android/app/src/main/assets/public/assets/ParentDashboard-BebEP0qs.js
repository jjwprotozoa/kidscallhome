const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/acknowledgeMissedCalls-Cm4rBsYb.js","assets/index-BdmHsoQZ.js","assets/vendor-react-mDIoga_b.js","assets/vendor-radix-BQCqNqg0.js","assets/vendor-other-BA4qpukX.js","assets/vendor-capacitor-DSxgEnoB.js","assets/vendor-supabase-DQP4RkUL.js","assets/index-DOEvG4-O.css"])))=>i.map(i=>d[i]);
import{_ as ne}from"./vendor-capacitor-DSxgEnoB.js";import{j as e,Z as we,M as ve,_ as Ne,$ as V,a0 as re,a1 as Q,a2 as be,a3 as ye,X as B,o as ke,u as le,r as n,n as _e,a4 as Ae,a5 as Se}from"./vendor-react-mDIoga_b.js";import{u as Ee,A as Ie}from"./useChildrenPresence-D51CVWNq.js";import{e as Re,B as j,f as Me,C as R,A as M,g as $,h as P,i as D,j as T,k as q,l as O,m as G,s as w,n as oe,o as $e,u as Pe,p as De,q as Te,r as qe}from"./index-BdmHsoQZ.js";import{S as Oe}from"./StatusIndicator-BZUItRQn.js";import{N as Le}from"./Navigation-CglVk_ff.js";import{O as Ue,H as Be}from"./OnboardingTour-BCKJLloU.js";import{i as te}from"./platformDetection-DMTH-XIz.js";import"./vendor-radix-BQCqNqg0.js";import"./vendor-other-BA4qpukX.js";import"./input-UTyCM2Df.js";import"./dialog-D8RTy2fV.js";import"./vendor-supabase-DQP4RkUL.js";import"./deviceTracking-lBUE_lfK.js";const Fe=({childId:a,onCall:c})=>{const l=Re(a);return e.jsxs(j,{onClick:c,className:"flex-1 relative",variant:"secondary","data-tour":"parent-call-button",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Call",e.jsx("span",{className:`ml-2 bg-destructive text-destructive-foreground text-xs font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1 ${l===0?"invisible":""}`,children:l>99?"99+":l})]})},ze=({childId:a,onChat:c})=>{const l=Me(a);return e.jsxs(j,{onClick:c,className:"flex-1 relative bg-chat-accent text-chat-accent-foreground hover:bg-chat-accent/90",variant:"default","data-tour":"parent-messages",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Chat",e.jsx("span",{className:`ml-2 bg-destructive text-destructive-foreground text-xs font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1 ${l===0?"invisible":""}`,children:l>99?"99+":l})]})},He=({child:a,index:c,isOnline:l,fullLoginCode:v,onEditCode:N,onCopyCode:i,onCopyMagicLink:o,onPrintCode:g,onViewQR:m,onCall:f,onChat:p,onDelete:x})=>e.jsxs(R,{className:"p-6 space-y-4 min-h-[220px]",style:{borderLeft:`4px solid ${a.avatar_color}`},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2","data-tour":c===0?"parent-child-name-status":void 0,children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-bold",children:a.name}),e.jsx(Oe,{isOnline:l,size:"md",showPulse:l})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg relative","data-tour":c===0?"parent-login-code":void 0,children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Login Code"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-xl sm:text-2xl font-mono font-bold tracking-wider flex-1",children:v}),e.jsx(j,{onClick:N,variant:"ghost",size:"icon",className:"h-8 w-8",title:"Generate new login code",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(j,{onClick:i,variant:"outline",size:"sm",className:"flex-1","data-tour":c===0?"parent-copy-code":void 0,children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Copy Code"]}),e.jsxs(j,{onClick:o,variant:"outline",size:"sm",className:"flex-1","data-tour":c===0?"parent-copy-link":void 0,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Copy Link"]}),e.jsxs(j,{onClick:g,variant:"outline",size:"sm",className:"flex-1","data-tour":c===0?"parent-print-code":void 0,children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Print"]}),e.jsxs(j,{onClick:m,variant:"outline",size:"sm",className:"flex-1","data-tour":c===0?"parent-view-qr":void 0,children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"View QR"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Fe,{childId:a.id,onCall:f}),e.jsx(ze,{childId:a.id,onChat:p}),e.jsx(j,{onClick:x,variant:"destructive",size:"icon","data-tour":c===0?"parent-delete-child":void 0,children:e.jsx(ye,{className:"h-4 w-4"})})]})]}),Qe=({showCodeDialog:a,onCloseCodeDialog:c,getFullLoginCode:l,onCopyCode:v,onCopyMagicLink:N,onPrintCode:i,childToEditCode:o,onCloseEditCode:g,onUpdateLoginCode:m,isUpdatingCode:f,childToDelete:p,onCloseDelete:x,onDeleteChild:h,printViewChild:C,onClosePrintView:y,onPrintFromModal:k})=>e.jsxs(e.Fragment,{children:[a&&e.jsx(M,{open:!!a,onOpenChange:b=>!b&&c(),children:e.jsxs($,{className:"max-w-[calc(100vw-2rem)] sm:max-w-md",children:[e.jsxs("button",{onClick:c,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),e.jsxs(P,{children:[e.jsxs(D,{className:"text-lg sm:text-xl",children:[a.child.name,"'s Login Code"]}),e.jsx(T,{className:"text-sm",children:"Share this code or QR code with your child to log in"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-muted p-3 sm:p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Login Code"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-mono font-bold break-all",children:l(a.child)})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(`${window.location.origin}/child/login?code=${encodeURIComponent(l(a.child))}`)}`,alt:"QR Code",className:"border-2 border-muted rounded-lg w-[200px] h-[200px] sm:w-[250px] sm:h-[250px] object-contain"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(j,{onClick:()=>v(l(a.child)),variant:"outline",className:"flex-1 w-full sm:w-auto",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Copy Code"]}),e.jsxs(j,{onClick:()=>N(a.child),variant:"outline",className:"flex-1 w-full sm:w-auto",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Copy Link"]}),e.jsxs(j,{onClick:()=>i(a.child),variant:"outline",className:"flex-1 w-full sm:w-auto",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Print"]})]})]}),e.jsx(q,{children:e.jsx(O,{children:"Close"})})]})}),e.jsx(M,{open:!!o,onOpenChange:b=>!b&&g(),children:e.jsxs($,{children:[e.jsxs("button",{onClick:g,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",disabled:f,children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),e.jsxs(P,{children:[e.jsx(D,{children:"Generate New Login Code"}),e.jsxs(T,{children:["Are you sure you want to generate a new login code for"," ",o?.name,"? The current code (",o?.login_code,") will no longer work. Make sure to share the new code with your child."]})]}),e.jsxs(q,{children:[e.jsx(O,{disabled:f,children:"Cancel"}),e.jsx(G,{onClick:m,disabled:f,children:f?"Generating...":"Generate New Code"})]})]})}),e.jsx(M,{open:!!p,onOpenChange:b=>!b&&x(),children:e.jsxs($,{children:[e.jsxs("button",{onClick:x,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),e.jsxs(P,{children:[e.jsx(D,{children:"Remove Child"}),e.jsxs(T,{children:["Are you sure you want to remove ",p?.name,"? This action cannot be undone and will delete all associated data including messages and call history."]})]}),e.jsxs(q,{children:[e.jsx(O,{children:"Cancel"}),e.jsx(G,{onClick:h,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})}),C&&e.jsx(M,{open:!!C,onOpenChange:b=>!b&&y(),children:e.jsxs($,{className:"max-w-[calc(100vw-2rem)] sm:max-w-md print:hidden",children:[e.jsxs("button",{onClick:y,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none print:hidden",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),e.jsxs(P,{children:[e.jsxs(D,{className:"text-lg sm:text-xl",children:[C.name,"'s Login Code"]}),e.jsx(T,{className:"text-sm",children:"Print or share this code with your child"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-muted p-3 sm:p-4 rounded-lg text-center print:border-2 print:border-gray-800",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2 print:text-gray-600",children:"Login Code"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-mono font-bold break-all print:text-3xl",children:l(C)})]}),e.jsx("div",{className:"flex justify-center print:my-4",children:e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(`${window.location.origin}/child/login?code=${encodeURIComponent(l(C))}`)}`,alt:"QR Code",className:"border-2 border-muted rounded-lg w-[250px] h-[250px] sm:w-[300px] sm:h-[300px] object-contain print:border-gray-800"})}),e.jsxs("div",{className:"instructions print:mt-4 print:text-sm print:text-gray-600",children:[e.jsx("p",{children:"Scan the QR code or use the code above to log in"}),e.jsxs("p",{children:["Visit: ",window.location.origin,"/child/login"]})]})]}),e.jsxs(q,{className:"print:hidden",children:[e.jsxs(j,{onClick:k,variant:"default",className:"flex-1",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Print"]}),e.jsx(O,{children:"Close"})]})]})})]}),Ge=({incomingCall:a,isAnsweringRef:c,onAnswer:l,onDecline:v,onOpenChange:N})=>{const i=o=>{!o&&a&&!c.current&&v(),N(o)};return e.jsx(M,{open:!!a,onOpenChange:i,children:e.jsxs($,{className:"sm:max-w-md",children:[e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold text-white",style:{backgroundColor:a?.child_avatar_color||"#3B82F6"},children:a?.child_name[0]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-xl",children:"Incoming Call"}),e.jsxs("p",{className:"text-base font-normal text-muted-foreground",children:[a?.child_name," is calling..."]})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsxs(T,{className:"sr-only",children:["Incoming call from ",a?.child_name]}),e.jsx("div",{className:"flex items-center justify-center gap-2 text-4xl animate-pulse",children:e.jsx(ke,{className:"h-12 w-12"})})]})]}),e.jsxs(q,{className:"sm:justify-center gap-2",children:[e.jsx(O,{onClick:v,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Decline"}),e.jsx(G,{onClick:l,className:"bg-green-600 hover:bg-green-700",children:"Answer"})]})]})})},Ve=()=>{const a=le(),[c,l]=n.useState(null),[v,N]=n.useState(null),[i,o]=n.useState(null),[g,m]=n.useState(!0),f=n.useCallback(async()=>{const{data:{session:x}}=await w.auth.getSession();if(!x){a("/parent/auth");return}const{data:h,error:C}=await w.from("parents").select("name, family_code, allowed_children").eq("id",x.user.id).maybeSingle();C&&(C.code==="42703"||C.message?.includes("does not exist")?(console.error("âŒ [PARENT DASHBOARD] Migration not run. Family code column doesn't exist."),console.error("Please run: supabase/migrations/20250121000000_add_family_code.sql")):console.error("Error fetching parent data:",C)),h&&(l(h?.name||null),N(h?.family_code||null),o(h?.allowed_children||1));try{const{data:y}=await w.rpc("can_add_child",{p_parent_id:x.user.id});m(y===!0)}catch(y){console.warn("Subscription check function not available:",y),m(!0)}},[a]),p=n.useCallback(async()=>{const{data:{user:x}}=await w.auth.getUser();if(x)try{const{data:h}=await w.rpc("can_add_child",{p_parent_id:x.id});m(h===!0)}catch(h){console.warn("Subscription check function not available:",h)}},[]);return{parentName:c,familyCode:v,allowedChildren:i,canAddMoreChildren:g,checkAuth:f,refreshCanAddMoreChildren:p}},We=({onIncomingCall:a,onCallCleared:c,currentIncomingCall:l,enabled:v=!0})=>{const N=_e(),i=n.useRef(null),{handleIncomingCall:o}=oe({enabled:!0,volume:.7}),g=n.useRef(o),m=n.useRef(null),f=n.useRef(null),p=n.useRef(a),x=n.useRef(c);n.useEffect(()=>{g.current=o},[o]),n.useEffect(()=>{f.current=l},[l]),n.useEffect(()=>{p.current=a},[a]),n.useEffect(()=>{x.current=c},[c]),n.useEffect(()=>{if(!v)return;let h=null;return(async()=>{const{data:{session:y}}=await w.auth.getSession();if(!y?.user?.id)return;const k=y.user.id,b=async d=>{if(d.id===m.current||N.pathname.startsWith("/call/"))return;m.current=d.id;const{data:t}=await w.from("children").select("name, avatar_color").eq("id",d.child_id).single();if(t){const u={id:d.id,child_id:d.child_id,child_name:t.name,child_avatar_color:t.avatar_color};p.current(u),g.current({callId:d.id,callerName:t.name,callerId:d.child_id,url:`/call/${d.child_id}?callId=${d.id}`})}else console.error("Failed to fetch child data for call")},L=async()=>{const d=new Date(Date.now()-12e4).toISOString(),{data:t}=await w.from("calls").select("*").eq("parent_id",k).eq("caller_type","child").eq("status","ringing").gte("created_at",d).order("created_at",{ascending:!1}).limit(1);if(t&&t.length>0){const u=t[0];u.id!==m.current&&await b(u)}},A=async()=>{const d=new Date(Date.now()-6e4).toISOString(),{data:t,error:u}=await w.from("calls").select("*").eq("parent_id",k).eq("caller_type","child").eq("status","ringing").gte("created_at",d).order("created_at",{ascending:!1}).limit(1);if(u){console.error("âŒ [PARENT DASHBOARD] Polling error:",u);return}if(t&&t.length>0){const S=t[0];S.id!==m.current&&await b(S)}};await L(),h=setInterval(A,6e4),i.current=w.channel("parent-incoming-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:`parent_id=eq.${k}`},async d=>{const t=d.new;t.caller_type==="child"&&t.parent_id===k&&t.status==="ringing"&&await b(t)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`parent_id=eq.${k}`},async d=>{const t=d.new,u=d.old;t.caller_type!=="parent"&&(N.pathname.startsWith("/call/")||(f.current&&f.current.id===t.id&&(t.status==="active"||t.status==="ended")&&x.current(t.id),t.caller_type==="child"&&t.parent_id===k&&t.status==="ringing"&&u.status!=="ringing"&&await b(t)))}).subscribe((d,t)=>{t&&console.error("âŒ [PARENT DASHBOARD] Realtime subscription error:",t)})})(),()=>{i.current&&w.removeChannel(i.current),h&&clearInterval(h)}},[v,N.pathname])},Ye=async a=>{const{acknowledgeMissedCalls:c}=await ne(async()=>{const{acknowledgeMissedCalls:i}=await import("./acknowledgeMissedCalls-Cm4rBsYb.js");return{acknowledgeMissedCalls:i}},__vite__mapDeps([0,1,2,3,4,5,6,7])),l=$e.getState();let v=0,N=0;for(const i of a){if((l.unreadMessagesByChild[i]??0)>0)try{const{data:m,error:f}=await w.from("messages").select("id").eq("child_id",i).eq("sender_type","child").is("read_at",null);if(!f&&m&&m.length>0){const p=m.map(C=>C.id),x=new Date().toISOString(),{error:h}=await w.from("messages").update({read_at:x}).in("id",p);h?console.error(`Error marking messages as read for child ${i}:`,h):(v+=p.length,console.log(`âœ… Marked ${p.length} messages as read for child ${i}`))}l.clearUnreadForChild(i)}catch(m){console.error(`Error processing messages for child ${i}:`,m),l.clearUnreadForChild(i)}const g=l.missedCallsByChild[i]??0;if(g>0){l.clearMissedForChild(i),N+=g;try{await c(i,"child")}catch(m){console.error(`Error acknowledging missed calls for child ${i}:`,m)}}}return{clearedMessageCount:v,clearedCallCount:N}},ds=()=>{const[a,c]=n.useState([]),[l,v]=n.useState(!0),[N,i]=n.useState(!1),[o,g]=n.useState(null),[m,f]=n.useState(null),[p,x]=n.useState(null),[h,C]=n.useState(null),[y,k]=n.useState(!1),[b,L]=n.useState(null),A=n.useRef(null),d=n.useRef(!1),t=le(),{toast:u}=Pe(),{stopIncomingCall:S}=oe({enabled:!0,volume:.7}),{parentName:W,familyCode:E,allowedChildren:Y,canAddMoreChildren:ie,checkAuth:K,refreshCanAddMoreChildren:X}=Ve(),F=n.useMemo(()=>a.map(s=>s.id),[a]),{isChildOnline:ce}=Ee({childIds:F,enabled:a.length>0}),Z=De(),J=Te(),z=Z>0||J>0,I=n.useCallback(async()=>{try{const{data:s,error:r}=await w.from("children").select("*").order("created_at",{ascending:!1});if(r)throw r;c(s||[]),X().catch(_=>{console.warn("Failed to refresh subscription check:",_)})}catch(s){const r=s instanceof Error?s.message:"Unknown error occurred";u({title:"Error loading children",description:r,variant:"destructive"})}finally{v(!1)}},[u,X]);n.useEffect(()=>{localStorage.getItem("childSession")&&(console.log("ðŸ§¹ [PARENT DASHBOARD] Clearing childSession for parent user"),localStorage.removeItem("childSession")),K().catch(r=>{console.error("Error checking auth:",r)}),I().catch(r=>{console.error("Error fetching children:",r)})},[K,I]);const de=n.useCallback(s=>{g(s),A.current=s},[]),ue=n.useCallback(()=>{g(null),A.current=null},[]);We({onIncomingCall:de,onCallCleared:ue,currentIncomingCall:o,enabled:!0}),n.useEffect(()=>{A.current=o},[o]),n.useEffect(()=>{!o&&A.current&&S(A.current.id)},[o,S]);const me=s=>{t(`/chat/${s}`)},ee=s=>{navigator.clipboard.writeText(s),u({title:"Copied!",description:"Login code copied to clipboard"})},U=s=>{const r=s.login_code.split("-");return r.length===3&&E?s.login_code:r.length===2&&E?`${E}-${s.login_code}`:s.login_code},se=s=>{const r=U(s),_=encodeURIComponent(r),H=`${window.location.origin}/child/login?code=${_}`;navigator.clipboard.writeText(H),u({title:"Copied!",description:"Magic link copied to clipboard"})},ae=s=>{L(s)},he=()=>{b&&window.print()},xe=async s=>{try{const{acknowledgeMissedCalls:r}=await ne(async()=>{const{acknowledgeMissedCalls:_}=await import("./acknowledgeMissedCalls-Cm4rBsYb.js");return{acknowledgeMissedCalls:_}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await r(s,"child")}catch(r){console.error("Error acknowledging missed calls:",r)}t(`/call/${s}`)},pe=n.useCallback(async()=>{if(z)try{const s=await Ye(F),r=s.clearedMessageCount>0?`${s.clearedMessageCount} unread message${s.clearedMessageCount!==1?"s":""}`:"",_=s.clearedCallCount>0?`${s.clearedCallCount} missed call${s.clearedCallCount!==1?"s":""}`:"",H=[r,_].filter(Boolean).join(" and ");u({title:"Notifications cleared",description:H||"All notifications cleared."})}catch(s){console.error("Error clearing notifications:",s),u({title:"Error",description:"Failed to clear some notifications. Please try again.",variant:"destructive"})}},[z,F,u]),ge=async()=>{if(p)try{const{error:s}=await w.from("children").delete().eq("id",p.id);if(s)throw s;u({title:"Child removed",description:`${p.name} has been removed.`}),x(null),I()}catch(s){const r=s instanceof Error?s.message:"Unknown error occurred";u({title:"Error removing child",description:r,variant:"destructive"})}},fe=async()=>{if(h){k(!0);try{const{data:s,error:r}=await w.rpc("generate_unique_login_code");if(r)throw r;if(!s)throw new Error("Failed to generate new code");const{error:_}=await w.from("children").update({login_code:s}).eq("id",h.id);if(_)throw _;u({title:"Login code updated",description:`${h.name}'s new login code is: ${s}`}),C(null),I()}catch(s){const r=s instanceof Error?s.message:"Unknown error occurred";u({title:"Error updating login code",description:r,variant:"destructive"})}finally{k(!1)}}},Ce=()=>{if(o){S(o.id),d.current=!0;const s=o.child_id,r=o.id;g(null),t(`/call/${s}?callId=${r}`),setTimeout(()=>{d.current=!1},2e3)}},je=async()=>{if(o){if(d.current)return;try{await qe({callId:o.id,by:"parent",reason:"declined"})}catch(s){console.error("âŒ [USER ACTION] Error declining call:",s);const r=s instanceof Error?s.message:"Unknown error";u({title:"Error",description:"Failed to decline call: "+r,variant:"destructive"})}S(o.id),g(null)}};return e.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[e.jsx(Le,{}),e.jsx(Ue,{role:"parent",pageKey:"parent_dashboard"}),e.jsx(Be,{role:"parent",pageKey:"parent_dashboard"}),e.jsx("div",{className:"px-4 pb-4",style:{paddingTop:"calc(0.5rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Welcome back",W?`, ${W}`:"","!"]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"mt-2 flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"My Children"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage your children's profiles, login codes, and settings"})]}),te()&&e.jsx(j,{variant:"outline",onClick:()=>t("/parent/upgrade"),className:"flex-shrink-0","data-tour":"parent-upgrade-plan",children:"Upgrade Plan"})]}),E&&e.jsx(R,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Your Family Code"}),e.jsx("p",{className:"text-2xl font-mono font-bold text-blue-700 dark:text-blue-300",children:E}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:"Share this code with your children for login"})]}),e.jsxs(j,{onClick:()=>{navigator.clipboard.writeText(E),u({title:"Copied!",description:"Family code copied to clipboard"})},variant:"outline",size:"sm",className:"flex-shrink-0",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Copy"]})]})}),!ie&&e.jsx(R,{className:"p-4 bg-yellow-50 dark:bg-yellow-950 border-yellow-200 dark:border-yellow-800 mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-yellow-900 dark:text-yellow-100",children:[e.jsx("strong",{children:"Subscription Limit Reached:"})," You have"," ",a.length," /"," ",Y===999?"âˆž":Y||1," ","children."]}),te()?e.jsx(j,{onClick:()=>t("/parent/upgrade"),variant:"default",size:"sm",className:"w-full sm:w-auto","data-tour":"parent-upgrade-limit",children:"Upgrade Your Plan"}):e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"Please upgrade through your app store to add more children."})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{onClick:()=>i(!0),className:"flex-1",size:"lg",children:[e.jsx(Ae,{className:"mr-2 h-5 w-5"}),"Add Child"]}),z&&e.jsxs(j,{onClick:pe,variant:"outline",size:"lg",className:"flex-shrink-0",title:`Clear all notifications (${Z} messages, ${J} missed calls)`,children:[e.jsx(Se,{className:"mr-2 h-5 w-5"}),"Clear All"]})]}),l?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:[1,2].map(s=>e.jsxs(R,{className:"p-6 space-y-4 min-h-[220px]",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-6 w-32 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-10 flex-1 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-10 flex-1 bg-muted rounded animate-pulse"})]})]},s))}):a.length===0?e.jsxs(R,{className:"p-12 text-center min-h-[220px]",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"You haven't added any children yet."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Click "Add Child" above to create a profile and login code.'})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:a.map((s,r)=>e.jsx(He,{child:s,index:r,isOnline:ce(s.id),fullLoginCode:U(s),onEditCode:()=>C(s),onCopyCode:()=>ee(U(s)),onCopyMagicLink:()=>se(s),onPrintCode:()=>ae(s),onViewQR:()=>f({child:s}),onCall:()=>xe(s.id),onChat:()=>me(s.id),onDelete:()=>x(s)},s.id))})]}),e.jsx(Ie,{open:N,onOpenChange:i,onChildAdded:I}),e.jsx(Qe,{showCodeDialog:m,onCloseCodeDialog:()=>f(null),getFullLoginCode:U,onCopyCode:ee,onCopyMagicLink:se,onPrintCode:ae,childToEditCode:h,onCloseEditCode:()=>C(null),onUpdateLoginCode:fe,isUpdatingCode:y,childToDelete:p,onCloseDelete:()=>x(null),onDeleteChild:ge,printViewChild:b,onClosePrintView:()=>L(null),onPrintFromModal:he}),e.jsx(Ge,{incomingCall:o,isAnsweringRef:d,onAnswer:Ce,onDecline:je,onOpenChange:()=>{}})]})]})};export{ds as default};

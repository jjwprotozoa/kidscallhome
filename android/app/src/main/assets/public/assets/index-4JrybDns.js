const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WidgetDataPlugin-DwiTLMeD.js","assets/vendor-capacitor-DSxgEnoB.js","assets/ParentAuth-BEj7PDIV.js","assets/vendor-react-LQlp3yIU.js","assets/vendor-radix-BQCqNqg0.js","assets/vendor-other-DUaz7rji.js","assets/input-BR9I4F-8.js","assets/label-BSSj5-oS.js","assets/vendor-supabase-Bq0a3XdW.js","assets/ParentDashboard-CrNVSxOv.js","assets/useChildrenPresence-CgM3BIn7.js","assets/dialog-DmMNuzq2.js","assets/StatusIndicator-B5uOwO2H.js","assets/Navigation-oN70GkMP.js","assets/OnboardingTour-DCxLRID0.js","assets/deviceTracking-lBUE_lfK.js","assets/platformDetection-DMTH-XIz.js","assets/ParentHome-cxnauCkF.js","assets/ParentChildrenList-BahljVNJ.js","assets/ParentCallScreen-Vg8ii67y.js","assets/useWebRTC-CDrKA3k0.js","assets/useCallEngine-BysCX0DH.js","assets/DeviceManagement-CerkDBAc.js","assets/ipGeolocation-Cm-ayuRY.js","assets/vendor-date-5vrp8xtd.js","assets/Upgrade-E9IgA6Sn.js","assets/AccountSettings-DUObl8tO.js","assets/ChildLogin-_kT1U6Va.js","assets/ChildDashboard-D8DSUR4u.js","assets/useParentPresence-CJK56jc9.js","assets/ChildHome-CWPV2_da.js","assets/ChildParentsList-CLsnsmid.js","assets/ChildCallScreen-e_hhfgid.js","assets/VideoCall-CeuMi1xq.js","assets/Chat-E_Uq9AdG.js","assets/Info-TbeWtPVH.js"])))=>i.map(i=>d[i]);
import{r as l,j as t,V as me,a as fe,A as ge,C as he,X as pe,T as xe,D as ye,P as Ye,b as ve,c as Qe,S as Ze,d as Xe,e as et,u as L,O as we,f as tt,g as be,h as Ce,i as _e,k as Ne,l as Se,m as st,n as se,o as at,M as Ee,p as nt,q as rt,s as re,U as it,t as J,w as ot,H as ae,x as lt,y as ee,W as ie,z as ct,Q as dt,B as ut,E as mt,F as D,G as ft}from"./vendor-react-LQlp3yIU.js";import{P,A as oe,C as je,L as Ie,_ as k,H as gt,I as ht}from"./vendor-capacitor-DSxgEnoB.js";import{H as pt,I as xt,J as Ae,K as yt,$ as vt,Q as wt}from"./vendor-other-DUaz7rji.js";import{c as bt}from"./vendor-supabase-Bq0a3XdW.js";import"./vendor-radix-BQCqNqg0.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();const Ct=1,_t=1e6;let K=0;function Nt(){return K=(K+1)%Number.MAX_SAFE_INTEGER,K.toString()}const Y=new Map,le=e=>{if(Y.has(e))return;const s=setTimeout(()=>{Y.delete(e),V({type:"REMOVE_TOAST",toastId:e})},_t);Y.set(e,s)},St=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,Ct)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(a=>a.id===s.toast.id?{...a,...s.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?le(a):e.toasts.forEach(r=>{le(r.id)}),{...e,toasts:e.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return s.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(a=>a.id!==s.toastId)}}},F=[];let H={toasts:[]};function V(e){H=St(H,e),F.forEach(s=>{s(H)})}function Et({...e}){const s=Nt(),a=o=>V({type:"UPDATE_TOAST",toast:{...o,id:s}}),r=()=>V({type:"DISMISS_TOAST",toastId:s});return V({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:o=>{o||r()}}}),{id:s,dismiss:r,update:a}}function Te(){const[e,s]=l.useState(H);return l.useEffect(()=>(F.push(s),()=>{const a=F.indexOf(s);a>-1&&F.splice(a,1)}),[e]),{...e,toast:Et,dismiss:a=>V({type:"DISMISS_TOAST",toastId:a})}}function T(...e){return pt(xt(e))}const jt=Ye,De=l.forwardRef(({className:e,...s},a)=>t.jsx(me,{ref:a,className:T("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...s}));De.displayName=me.displayName;const It=Ae("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground",message:"border-primary bg-primary text-primary-foreground shadow-lg ring-2 ring-primary/30",success:"border-green-500 bg-green-50 dark:bg-green-950 text-green-900 dark:text-green-100 shadow-lg ring-2 ring-green-500/30"}},defaultVariants:{variant:"default"}}),Re=l.forwardRef(({className:e,variant:s,swipeDirection:a,...r},o)=>t.jsx(fe,{ref:o,className:T(It({variant:s}),e),...r}));Re.displayName=fe.displayName;const At=l.forwardRef(({className:e,...s},a)=>t.jsx(ge,{ref:a,className:T("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...s}));At.displayName=ge.displayName;const ke=l.forwardRef(({className:e,...s},a)=>t.jsx(he,{ref:a,className:T("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...s,children:t.jsx(pe,{className:"h-4 w-4"})}));ke.displayName=he.displayName;const Oe=l.forwardRef(({className:e,...s},a)=>t.jsx(xe,{ref:a,className:T("text-sm font-semibold group-[.custom-child-color]:text-white group-[.custom-parent-color]:text-white",e),...s}));Oe.displayName=xe.displayName;const Le=l.forwardRef(({className:e,...s},a)=>t.jsx(ye,{ref:a,className:T("text-sm opacity-90 group-[.message]:opacity-100 group-[.message]:text-primary-foreground group-[.custom-child-color]:opacity-100 group-[.custom-child-color]:text-white group-[.custom-parent-color]:opacity-100 group-[.custom-parent-color]:text-white",e),...s}));Le.displayName=ye.displayName;function Tt(){const{toasts:e}=Te();return t.jsxs(jt,{swipeDirection:"right",duration:5e3,children:[e.map(function({id:s,title:a,description:r,action:o,swipeDirection:n,...i}){return t.jsxs(Re,{...i,children:[t.jsxs("div",{className:"grid gap-1",children:[a&&t.jsx(Oe,{children:a}),r&&t.jsx(Le,{children:r})]}),o,t.jsx(ke,{})]},s)}),t.jsx(De,{})]})}const Dt=({...e})=>{const{theme:s="system"}=yt();return t.jsx(vt,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},Rt=Qe,kt=l.forwardRef(({className:e,sideOffset:s=4,...a},r)=>t.jsx(ve,{ref:r,sideOffset:s,className:T("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));kt.displayName=ve.displayName;const Ot=({children:e,className:s,withTopInset:a=!0,withBottomInset:r=!0})=>t.jsx("div",{className:T("safe-area-layout min-h-[100dvh] w-full overflow-x-hidden",{"safe-area-top":a,"safe-area-bottom":r},s),children:e}),Lt=["password","Password","PASSWORD","passwd","pwd","secret","Secret","SECRET","token","Token","TOKEN","apiKey","api_key","apikey","accessToken","access_token","refreshToken","refresh_token","authToken","auth_token","sessionToken","session_token","privateKey","private_key","privatekey","secretKey","secret_key","secretkey","authorization","Authorization","AUTHORIZATION","cookie","Cookie","COOKIE","session","Session","SESSION","credential","credentials","Credential","Credentials","CREDENTIALS","email","Email","EMAIL","userId","user_id","userId","ip","IP","ipAddress","ip_address","userAgent","user_agent","UserAgent"],Pt=[/password/i,/passwd/i,/secret/i,/token/i,/key/i,/credential/i,/auth/i,/session/i,/cookie/i,/email/i,/userid/i,/user_id/i,/ip/i,/useragent/i,/user_agent/i];function W(e,s={}){const{maskValue:a=!0,removeField:r=!1}=s;if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map(n=>W(n,s));if(e instanceof Date)return e;if(e instanceof Error)return{name:e.name,message:e.message,stack:"[REDACTED]"};const o={};for(const[n,i]of Object.entries(e))if(Lt.includes(n)||Pt.some(c=>c.test(n))){if(r)continue;a&&(o[n]="[REDACTED]")}else i&&typeof i=="object"?o[n]=W(i,s):o[n]=i;return o}const A={log:(...e)=>{},error:(...e)=>{},warn:(...e)=>{},debug:(...e)=>{}};function $s(e){return e instanceof Error?{name:e.name,message:e.message,stack:void 0,...e.code&&{code:e.code},...e.details&&{details:W(e.details)}}:typeof e=="object"&&e!==null?{message:"Unknown error",...W(e)}:{message:String(e)}}const Bt="https://itmhojbjfacocrpmslmt.supabase.co",Mt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0bWhvamJqZmFjb2NycG1zbG10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODExMDIsImV4cCI6MjA3NDQ1NzEwMn0.i8cdSYaeY7u4YaDqGI_92KmMwEpyEYt3ZZ9GuKxXVPk",m=bt(Bt,Mt,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1},realtime:{params:{eventsPerSecond:10}},global:{headers:{"x-client-info":"kidscallhome-web"}}});m.auth.onAuthStateChange((e,s)=>{});typeof window<"u"&&window.addEventListener("unhandledrejection",e=>{const s=e.reason;(s?.message?.includes("Invalid Refresh Token")||s?.message?.includes("Refresh Token Not Found"))&&(Object.keys(localStorage).filter(r=>r.startsWith("sb-")&&r.includes("auth-token")).forEach(r=>localStorage.removeItem(r)),e.preventDefault(),m.auth.signOut({scope:"local"}).catch(()=>{}))});const ne=Ae("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-base font-semibold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),R=l.forwardRef(({className:e,variant:s,size:a,asChild:r=!1,...o},n)=>{const i=r?Ze:"button";return t.jsx(i,{className:T(ne({variant:s,size:a,className:e})),ref:n,...o})});R.displayName="Button";const U=l.forwardRef(({className:e,...s},a)=>t.jsx("div",{ref:a,className:T("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));U.displayName="Card";const Ut=l.forwardRef(({className:e,...s},a)=>t.jsx("div",{ref:a,className:T("flex flex-col space-y-1.5 p-6",e),...s}));Ut.displayName="CardHeader";const qt=l.forwardRef(({className:e,...s},a)=>t.jsx("h3",{ref:a,className:T("text-2xl font-semibold leading-none tracking-tight",e),...s}));qt.displayName="CardTitle";const Vt=l.forwardRef(({className:e,...s},a)=>t.jsx("p",{ref:a,className:T("text-sm text-muted-foreground",e),...s}));Vt.displayName="CardDescription";const zt=l.forwardRef(({className:e,...s},a)=>t.jsx("div",{ref:a,className:T("p-6 pt-0",e),...s}));zt.displayName="CardContent";const Gt=l.forwardRef(({className:e,...s},a)=>t.jsx("div",{ref:a,className:T("flex items-center p-6 pt-0",e),...s}));Gt.displayName="CardFooter";class Ft extends l.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,a){console.error("‚ùå [ERROR BOUNDARY] Caught error:",s,a),this.setState({error:s,errorInfo:a})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const s=this.state.error?.message?.includes("VITE_SUPABASE")||this.state.error?.message?.includes("environment variable");return t.jsx("div",{className:"min-h-[100dvh] flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-secondary/5 p-4",children:t.jsxs(U,{className:"max-w-2xl w-full p-8 space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(Xe,{className:"h-12 w-12 text-destructive"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Something went wrong"}),t.jsx("p",{className:"text-muted-foreground mt-1",children:s?"Missing required configuration":"An unexpected error occurred"})]})]}),s?t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"The app is missing required environment variables. Please check:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 text-sm text-muted-foreground ml-4",children:[t.jsx("li",{children:"VITE_SUPABASE_URL"}),t.jsx("li",{children:"VITE_SUPABASE_PUBLISHABLE_KEY"})]}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Set these in your Vercel project settings (Settings ‚Üí Environment Variables) or in a .env file for local development."})]}):t.jsx("div",{className:"space-y-4",children:this.state.error&&t.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[t.jsx("p",{className:"font-mono text-sm text-destructive break-all",children:this.state.error.toString()}),this.state.errorInfo&&t.jsxs("details",{className:"mt-4",children:[t.jsx("summary",{className:"cursor-pointer text-sm text-muted-foreground",children:"Stack trace"}),t.jsx("pre",{className:"mt-2 text-xs text-muted-foreground overflow-auto max-h-48",children:this.state.errorInfo.componentStack})]})]})}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx(R,{onClick:this.handleReset,className:"flex-1",children:"Reload Page"}),t.jsx(R,{variant:"outline",onClick:()=>window.location.href="/",className:"flex-1",children:"Go Home"})]})]})})}return this.props.children}}const $="kidscallhome_badge_state",Pe=1;function z(){try{const e=localStorage.getItem($);if(!e)return{unreadMessagesByChild:{},missedCallsByChild:{},lastClearedTimestamps:{messages:{},calls:{}}};const s=JSON.parse(e);return s.version!==Pe?(console.log("‚ö†Ô∏è [BADGE STORAGE] Version mismatch, clearing old data"),localStorage.removeItem($),{unreadMessagesByChild:{},missedCallsByChild:{},lastClearedTimestamps:{messages:{},calls:{}}}):{unreadMessagesByChild:s.unreadMessagesByChild||{},missedCallsByChild:s.missedCallsByChild||{},lastClearedTimestamps:s.lastClearedTimestamps||{messages:{},calls:{}}}}catch(e){return console.error("‚ùå [BADGE STORAGE] Error loading badge state:",e),{unreadMessagesByChild:{},missedCallsByChild:{},lastClearedTimestamps:{messages:{},calls:{}}}}}function O(e,s,a){try{const r=z(),o=a||r.lastClearedTimestamps,n={version:Pe,unreadMessagesByChild:e,missedCallsByChild:s,lastUpdated:new Date().toISOString(),lastClearedTimestamps:o};localStorage.setItem($,JSON.stringify(n))}catch(r){console.error("‚ùå [BADGE STORAGE] Error saving badge state:",r)}}function ce(e,s){try{const a=z(),r=new Date().toISOString(),o={...a.lastClearedTimestamps};(s==="messages"||s==="both")&&(o.messages[e]=r),(s==="calls"||s==="both")&&(o.calls[e]=r),O(a.unreadMessagesByChild,a.missedCallsByChild,o),console.log(`‚úÖ [BADGE STORAGE] Marked ${s} badges as cleared for child ${e} at ${r}`)}catch(a){console.error("‚ùå [BADGE STORAGE] Error marking badges as cleared:",a)}}function M(e,s){try{return z().lastClearedTimestamps[s][e]||null}catch(a){return console.error("‚ùå [BADGE STORAGE] Error getting last cleared timestamp:",a),null}}function Ht(){try{localStorage.removeItem($)}catch(e){console.error("‚ùå [BADGE STORAGE] Error clearing badge state:",e)}}const de=z(),I=et((e,s)=>({unreadMessagesByChild:de.unreadMessagesByChild,missedCallsByChild:de.missedCallsByChild,setInitialUnread:a=>{e({unreadMessagesByChild:a}),O(s().unreadMessagesByChild,s().missedCallsByChild)},setInitialMissed:a=>{e({missedCallsByChild:a}),O(s().unreadMessagesByChild,s().missedCallsByChild)},incrementUnread:a=>e(r=>{const o={unreadMessagesByChild:{...r.unreadMessagesByChild,[a]:(r.unreadMessagesByChild[a]??0)+1}};return O(o.unreadMessagesByChild,r.missedCallsByChild),o}),decrementUnread:(a,r=1)=>e(o=>{const n={unreadMessagesByChild:{...o.unreadMessagesByChild,[a]:Math.max(0,(o.unreadMessagesByChild[a]??0)-r)}};return O(n.unreadMessagesByChild,o.missedCallsByChild),n}),clearUnreadForChild:a=>e(r=>{const o={unreadMessagesByChild:{...r.unreadMessagesByChild,[a]:0}};return O(o.unreadMessagesByChild,r.missedCallsByChild),ce(a,"messages"),o}),incrementMissed:a=>e(r=>{const o={missedCallsByChild:{...r.missedCallsByChild,[a]:(r.missedCallsByChild[a]??0)+1}};return O(r.unreadMessagesByChild,o.missedCallsByChild),o}),decrementMissed:(a,r=1)=>e(o=>{const n={missedCallsByChild:{...o.missedCallsByChild,[a]:Math.max(0,(o.missedCallsByChild[a]??0)-r)}};return O(o.unreadMessagesByChild,n.missedCallsByChild),n}),clearMissedForChild:a=>e(r=>{const o={missedCallsByChild:{...r.missedCallsByChild,[a]:0}};return O(r.unreadMessagesByChild,o.missedCallsByChild),ce(a,"calls"),o}),reset:()=>{e({unreadMessagesByChild:{},missedCallsByChild:{}}),Ht()}}));function Js(){const e=I(s=>s.unreadMessagesByChild);return Object.values(e).reduce((s,a)=>s+a,0)}function Ks(){const e=I(s=>s.missedCallsByChild);return Object.values(e).reduce((s,a)=>s+a,0)}function Ys(e){return I(s=>e?s.unreadMessagesByChild[e]??0:0)}function Qs(e){return I(s=>e?s.missedCallsByChild[e]??0:0)}function Wt(){l.useEffect(()=>{let e=!0;return(async()=>{try{const a=z();e&&(Object.keys(a.unreadMessagesByChild).length>0||Object.keys(a.missedCallsByChild).length>0)&&(console.log("üì¶ [BADGE INIT] Loading cached badge state from local storage"),I.getState().setInitialUnread(a.unreadMessagesByChild),I.getState().setInitialMissed(a.missedCallsByChild));const r=localStorage.getItem("childSession");if(!!r){const i=JSON.parse(r).id,u=M(i,"messages"),c=M(i,"calls");let f=m.from("messages").select("child_id, created_at").eq("child_id",i).eq("sender_type","parent").is("read_at",null);u&&(f=f.gt("created_at",u));const{data:p,error:_}=await f;if(_)throw _;let y=m.from("calls").select("child_id, created_at").eq("child_id",i).eq("caller_type","parent").eq("missed_call",!0).is("missed_call_read_at",null);c&&(y=y.gt("created_at",c));const{data:E,error:S}=await y;if(S)throw S;if(e){const j=p?.length??0,d=E?.length??0;console.log(`üì¶ [BADGE INIT] Child ${i}: ${j} new unread messages, ${d} new missed calls`,{lastClearedMessages:u,lastClearedCalls:c}),I.getState().setInitialUnread({[i]:j}),I.getState().setInitialMissed({[i]:d})}}else{const{data:{user:n}}=await m.auth.getUser();if(!n)return;const{data:i,error:u}=await m.from("children").select("id").eq("parent_id",n.id);if(u)throw u;if(!i||i.length===0)return;const c=i.map(_=>_.id),f={},p={};for(const _ of c){const y=M(_,"messages"),E=M(_,"calls");let S=m.from("messages").select("child_id, created_at").eq("child_id",_).eq("sender_type","child").is("read_at",null);y&&(S=S.gt("created_at",y));const{data:j}=await S;f[_]=j?.length??0;let d=m.from("calls").select("child_id, created_at").eq("child_id",_).eq("caller_type","child").eq("missed_call",!0).is("missed_call_read_at",null);E&&(d=d.gt("created_at",E));const{data:b}=await d;p[_]=b?.length??0}e&&(console.log(`üì¶ [BADGE INIT] Parent: loaded badge counts for ${c.length} children`,{unreadByChild:f,missedByChild:p}),I.getState().setInitialUnread(f),I.getState().setInitialMissed(p))}}catch(a){console.error("Error fetching initial badge counts:",a)}})(),()=>{e=!1}},[])}function $t(){const e=l.useRef(null),s=l.useRef(null);return l.useEffect(()=>{const r=!!localStorage.getItem("childSession");return e.current=m.channel("badge-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},o=>{const n=o.new,i=M(n.child_id,"messages");i&&n.created_at<=i||(r?n.sender_type==="parent"&&!n.read_at&&I.getState().incrementUnread(n.child_id):n.sender_type==="child"&&!n.read_at&&I.getState().incrementUnread(n.child_id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},o=>{const n=o.old,i=o.new,u=!n.read_at,c=!!i.read_at;u&&c&&(r?n.sender_type==="parent"&&I.getState().decrementUnread(n.child_id):n.sender_type==="child"&&I.getState().decrementUnread(n.child_id))}).subscribe((o,n)=>{n?(n instanceof Error?n.message:String(n)).includes("mismatch between server and client bindings")||console.error("‚ùå [BADGE REALTIME] Messages subscription error:",n):o==="TIMED_OUT"||o==="CHANNEL_ERROR"&&((n instanceof Error?n.message:String(n||"")).includes("mismatch between server and client bindings")||console.error("‚ùå [BADGE REALTIME] Messages subscription failed:",o))}),s.current=m.channel("badge-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls"},o=>{const n=o.new,i=M(n.child_id,"calls");i&&n.created_at<=i||n.missed_call&&!n.missed_call_read_at&&(r?n.caller_type==="parent"&&I.getState().incrementMissed(n.child_id):n.caller_type==="child"&&I.getState().incrementMissed(n.child_id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls"},o=>{const n=o.old,i=o.new,u=!n.missed_call_read_at,c=!!i.missed_call_read_at;u&&c&&n.missed_call&&(r?n.caller_type==="parent"&&I.getState().decrementMissed(n.child_id):n.caller_type==="child"&&I.getState().decrementMissed(n.child_id)),i.status==="active"&&n.status!=="active"&&(console.log("‚úÖ [BADGE REALTIME] Call became active - clearing missed call badge",{childId:i.child_id,callerType:i.caller_type}),r?i.caller_type==="parent"&&I.getState().clearMissedForChild(i.child_id):i.caller_type==="child"&&I.getState().clearMissedForChild(i.child_id)),!n.missed_call&&i.missed_call&&!i.missed_call_read_at&&(r?i.caller_type==="parent"&&I.getState().incrementMissed(i.child_id):i.caller_type==="child"&&I.getState().incrementMissed(i.child_id))}).subscribe((o,n)=>{n?(n instanceof Error?n.message:String(n)).includes("mismatch between server and client bindings")||console.error("‚ùå [BADGE REALTIME] Calls subscription error:",n):o==="TIMED_OUT"||o==="CHANNEL_ERROR"&&((n instanceof Error?n.message:String(n||"")).includes("mismatch between server and client bindings")||console.error("‚ùå [BADGE REALTIME] Calls subscription failed:",o))}),()=>{e.current&&m.removeChannel(e.current),s.current&&m.removeChannel(s.current)}},[]),null}const Jt=()=>{const[e,s]=l.useState(!document.hidden),[a,r]=l.useState(!document.hidden);return l.useEffect(()=>{const o=()=>{const u=!document.hidden;s(u),u&&r(!0)};s(!document.hidden),r(!document.hidden),document.addEventListener("visibilitychange",o);const n=()=>{s(!0),r(!0)},i=()=>{s(!1)};return window.addEventListener("focus",n),window.addEventListener("blur",i),()=>{document.removeEventListener("visibilitychange",o),window.removeEventListener("focus",n),window.removeEventListener("blur",i)}},[]),{isVisible:e,hasBeenVisible:a,isHidden:!e}},Kt=()=>{const e=l.useRef(null),s=l.useRef(null);l.useEffect(()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.js").then(i=>{console.log("‚úÖ [PUSH] Service Worker registered:",i),e.current=i,i.addEventListener("updatefound",()=>{console.log("üîÑ [PUSH] Service Worker update found");const u=i.installing;u&&u.addEventListener("statechange",()=>{u.state==="installed"&&navigator.serviceWorker.controller&&console.log("üîÑ [PUSH] New service worker installed, reload to activate")})})}).catch(i=>{console.error("‚ùå [PUSH] Service Worker registration failed:",i)}),navigator.serviceWorker.addEventListener("message",i=>{if(console.log("üì® [PUSH] Message from service worker:",i.data),i.data&&i.data.type==="NOTIFICATION_CLICKED"){const{callId:u,url:c}=i.data;s.current&&s.current({callId:u,url:c})}}))},[]);const a=l.useCallback(async()=>{if(!("Notification"in window))return console.warn("‚ö†Ô∏è [PUSH] This browser does not support notifications"),"denied";if(Notification.permission==="granted")return"granted";if(Notification.permission==="denied")return console.warn("‚ö†Ô∏è [PUSH] Notification permission denied"),"denied";const i=await Notification.requestPermission();return console.log("üîî [PUSH] Notification permission:",i),i},[]),r=l.useCallback(async i=>{if(!("Notification"in window)){console.warn("‚ö†Ô∏è [PUSH] Notifications not supported");return}if(await a()!=="granted"){console.warn("‚ö†Ô∏è [PUSH] Notification permission not granted");return}if(e.current)try{await e.current.showNotification(i.title,{body:i.body,icon:i.icon||"/icon-192x192.png",badge:i.badge||"/icon-96x96.png",tag:i.tag||"notification",requireInteraction:i.requireInteraction??!0,vibrate:i.vibrate||[200,100,200],data:i.data||{},actions:i.actions||[]}),console.log("‚úÖ [PUSH] Notification sent via service worker")}catch(c){console.error("‚ùå [PUSH] Failed to send notification:",c)}else try{new Notification(i.title,{body:i.body,icon:i.icon||"/icon-192x192.png",tag:i.tag||"notification",requireInteraction:i.requireInteraction??!0,data:i.data||{}}),console.log("‚úÖ [PUSH] Notification sent via Notification API")}catch(c){console.error("‚ùå [PUSH] Failed to send notification:",c)}},[a]),o=l.useCallback(async i=>{e.current&&(await e.current.getNotifications({tag:i})).forEach(c=>c.close())},[]),n=l.useCallback(i=>{s.current=i},[]);return{requestPermission:a,sendNotification:r,closeNotification:o,onNotificationClick:n,hasPermission:"Notification"in window&&Notification.permission==="granted",permission:"Notification"in window?Notification.permission:"default"}},Be=(e={})=>{const{enabled:s=!0,volume:a=.7}=e,r=l.useRef(null),o=l.useRef(null),n=l.useRef(null),i=l.useRef({}),u=l.useRef([]);l.useEffect(()=>()=>{i.current.ringtone&&(i.current.ringtone=!1),o.current&&(clearInterval(o.current),o.current=null);const d=n.current!==null;if(n.current&&(clearInterval(n.current),n.current=null),d&&"vibrate"in navigator)try{navigator.vibrate(0)}catch{}u.current.forEach(({event:b,handler:x})=>{document.removeEventListener(b,x)}),u.current=[],r.current&&(r.current.close().catch(b=>A.error("Error:",b)),r.current=null)},[]);const c=l.useCallback(async()=>{if(!s)return null;if(!r.current)try{const d=window.AudioContext||window.webkitAudioContext;r.current=new d,A.log("üîä [AUDIO] AudioContext created (lazy init), initial state:",r.current.state);const b=async()=>{if(r.current&&r.current.state==="suspended")try{await r.current.resume(),A.log("üîä [AUDIO] AudioContext resumed via user interaction")}catch(g){A.error("‚ùå [AUDIO] Failed to resume AudioContext:",g)}};["click","touchstart","keydown","mousedown"].forEach(g=>{document.addEventListener(g,b,{passive:!0}),u.current.push({event:g,handler:b})})}catch{return null}if(r.current.state==="suspended")try{A.log("üîä [AUDIO] AudioContext is suspended, attempting to resume..."),await r.current.resume(),A.log("üîä [AUDIO] AudioContext resumed successfully, state:",r.current.state)}catch{try{await new Promise(b=>setTimeout(b,100)),r.current&&r.current.state==="suspended"&&(await r.current.resume(),A.log("üîä [AUDIO] AudioContext resumed on retry, state:",r.current.state))}catch{return null}}return r.current},[s]),f=l.useCallback(()=>{if(!(!s||!("vibrate"in navigator)))try{const d=()=>{if(i.current.ringtone&&"vibrate"in navigator)try{navigator.vibrate([200,100,200])}catch{}};d(),n.current=setInterval(()=>{i.current.ringtone&&d()},2e3),A.log("üì≥ [AUDIO] Vibration started")}catch{}},[s]),p=l.useCallback(async()=>{if(!s||i.current.ringtone)return;const d=await c();if(d)try{i.current.ringtone=!0,A.log("üîî [AUDIO] Ringtone started, AudioContext state:",d.state);const b=()=>{if(!(!i.current.ringtone||!r.current))try{const x=r.current.createOscillator(),g=r.current.createGain();x.connect(g),g.connect(r.current.destination),x.frequency.value=800,x.type="sine";const h=r.current.currentTime;g.gain.setValueAtTime(0,h),g.gain.linearRampToValueAtTime(a*.4,h+.05),g.gain.linearRampToValueAtTime(a*.4,h+.2),g.gain.linearRampToValueAtTime(0,h+.25),x.start(h),x.stop(h+.25)}catch(x){A.error("‚ùå [AUDIO] Error playing tone:",x)}};b(),f(),o.current=setInterval(()=>{i.current.ringtone&&(b(),setTimeout(()=>{i.current.ringtone&&b()},250))},2e3)}catch{i.current.ringtone=!1}},[s,a,c,f]),_=l.useCallback(()=>{if(n.current&&(clearInterval(n.current),n.current=null),"vibrate"in navigator)try{navigator.vibrate(0)}catch{}},[]),y=l.useCallback(()=>{i.current.ringtone&&(i.current.ringtone=!1,o.current&&(clearInterval(o.current),o.current=null),_())},[_]),E=l.useCallback(async()=>{if(!s)return;const d=await c();if(d)try{const b=d.createOscillator(),x=d.createGain();b.connect(x),x.connect(d.destination),b.frequency.value=400,b.type="sine";const g=d.currentTime;x.gain.setValueAtTime(0,g),x.gain.linearRampToValueAtTime(a*.3,g+.05),x.gain.linearRampToValueAtTime(0,g+.2),b.start(g),b.stop(g+.2),A.log("üîî [AUDIO] Call ended sound played")}catch{}},[s,a,c]),S=l.useCallback(async()=>{if(!s)return;const d=await c();if(d)try{[600,800].forEach((b,x)=>{const g=d.createOscillator(),h=d.createGain();g.connect(h),h.connect(d.destination),g.frequency.value=b,g.type="sine";const v=d.currentTime+x*.1;h.gain.setValueAtTime(0,v),h.gain.linearRampToValueAtTime(a*.4,v+.05),h.gain.linearRampToValueAtTime(0,v+.15),g.start(v),g.stop(v+.15)}),A.log("üîî [AUDIO] Call answered sound played")}catch{}},[s,a,c]),j=l.useCallback(d=>{d==="ringtone"&&y()},[y]);return{playRingtone:p,stopRingtone:y,startVibration:f,stopVibration:_,playCallEnded:E,playCallAnswered:S,stopSound:j,isPlaying:i.current}},Yt=(e={})=>{const{enabled:s=!0,volume:a=.7}=e,r=L(),{isVisible:o,hasBeenVisible:n}=Jt(),{sendNotification:i,closeNotification:u,onNotificationClick:c,hasPermission:f}=Kt(),{playRingtone:p,stopRingtone:_}=Be({enabled:s,volume:a}),y=l.useRef(null),E=l.useRef(!1);l.useEffect(()=>{c(d=>{console.log("üîî [CALL NOTIFICATIONS] Notification clicked, starting ringtone",d),u("incoming-call"),d.url&&r(d.url),d.callId===y.current&&p().catch(b=>{console.error("‚ùå [CALL NOTIFICATIONS] Failed to play ringtone after notification click:",b)})})},[c,u,r,p]);const S=l.useCallback(async d=>{s&&(y.current=d.callId,E.current=!1,console.log("üìû [CALL NOTIFICATIONS] Handling incoming call:",{callId:d.callId,isVisible:o,hasBeenVisible:n}),o&&n?(console.log("üîî [CALL NOTIFICATIONS] Tab is active, playing ringtone immediately"),p().catch(b=>{console.error("‚ùå [CALL NOTIFICATIONS] Failed to play ringtone:",b)})):(console.log("üîî [CALL NOTIFICATIONS] Tab is not active, showing push notification"),await i({title:"Incoming Call",body:d.callerName?`${d.callerName} is calling...`:"You have an incoming call",icon:"/icon-192x192.png",badge:"/icon-96x96.png",tag:"incoming-call",requireInteraction:!0,vibrate:[200,100,200,100,200],data:{callId:d.callId,callerName:d.callerName,callerId:d.callerId,url:d.url}}),E.current=!0))},[s,o,n,f,i,p]);l.useEffect(()=>{o&&y.current&&n&&E.current&&(console.log("üîî [CALL NOTIFICATIONS] Tab became visible, starting ringtone"),p().catch(d=>{console.error("‚ùå [CALL NOTIFICATIONS] Failed to play ringtone when tab became visible:",d)}))},[o,n,p]);const j=l.useCallback(async d=>{y.current===d&&(console.log("üîá [CALL NOTIFICATIONS] Stopping incoming call notifications:",d),_(),await u("incoming-call"),y.current=null,E.current=!1)},[_,u]);return l.useEffect(()=>()=>{y.current&&j(y.current)},[j]),{handleIncomingCall:S,stopIncomingCall:j,hasActiveCall:y.current!==null,activeCallId:y.current}};async function Qt({callId:e,by:s,reason:a="hangup"}){A.log("üõë [CALL LIFECYCLE] End requested",{callId:e,by:s,reason:a,timestamp:new Date().toISOString()});let r=null;try{const{data:f,error:p}=await m.from("calls").select("id, status, ended_at").eq("id",e).maybeSingle();p?A.warn("‚ö†Ô∏è [CALL LIFECYCLE] Error checking call status (will continue):",p):r=f}catch{}if(r&&(r.status==="ended"||r.ended_at))return A.log("‚úÖ [CALL LIFECYCLE] Call already ended (idempotent)",{callId:e,status:r.status,ended_at:r.ended_at}),r;let o=null,n=null;const i={status:"ended",ended_at:new Date().toISOString(),ended_by:s,end_reason:a},{data:u,error:c}=await m.from("calls").update(i).eq("id",e).select("id, status, ended_at, ended_by, end_reason").single();if(o=u,n=c,n&&(n.code==="PGRST204"||n.code==="406"||n.message?.includes("end_reason")||n.message?.includes("ended_by")||n.message?.includes("ended_at")||n.message?.includes("Not Acceptable"))){A.warn("‚ö†Ô∏è [CALL LIFECYCLE] Update failed (possibly schema issue), trying fallback",{callId:e,errorCode:n.code,errorMessage:n.message});let f=null;try{const{error:p}=await m.rpc("ensure_call_ending_columns");f=p}catch{f={message:"RPC function not available"}}if(!f){const{data:p,error:_}=await m.from("calls").update({status:"ended",ended_at:new Date().toISOString(),ended_by:s,end_reason:a}).eq("id",e).select("id, status, ended_at, ended_by, end_reason").single();_?n=_:(o=p,n=null)}if(n){const{data:p,error:_}=await m.from("calls").update({status:"ended"}).eq("id",e).select("id, status").single();if(!_)o={...p,ended_at:null},n=null;else{const{data:y}=await m.from("calls").select("id, status").eq("id",e).maybeSingle();if(y?.status==="ended")o={...y,ended_at:null},n=null;else return A.warn("‚ö†Ô∏è [CALL LIFECYCLE] Fallback update failed, but continuing",{callId:e,error:_,currentStatus:y?.status}),null}}}if(!n&&o)try{await m.rpc("increment_call_version",{call_id:e})}catch{}if(n){if(n.code==="PGRST116"||n.message?.includes("No rows")){const{data:f}=await m.from("calls").select("id, status, ended_at").eq("id",e).maybeSingle();return f}if(n.code==="406"||n.message?.includes("Not Acceptable")){const{data:f,error:p}=await m.from("calls").update({status:"ended"}).eq("id",e).select("id, status").single();if(!p&&f)return{...f,ended_at:null}}return null}return o&&A.log("‚úÖ [CALL LIFECYCLE] Call ended successfully",{callId:o.id,status:o.status,ended_at:o.ended_at,ended_by:o.ended_by,end_reason:o.end_reason}),o}function Zs(e){return e.status==="ended"||!!e.ended_at}function q(){return je.getPlatform()==="android"}function G(){return je.isNativePlatform()}async function Me(e=[200,100,200,100,200]){if(q())try{for(let s=0;s<e.length;s+=2)await gt.impact({style:ht.Heavy}),e[s+1]&&await new Promise(a=>setTimeout(a,e[s+1]))}catch(s){console.warn("Vibration pattern not available:",s)}}async function Ue(){if(!G())return!1;try{return(await P.requestPermissions()).receive==="granted"}catch(e){return console.error("Failed to request push notification permission:",e),!1}}async function Zt(e,s,a,r,o){if(G())try{if(!await Ue()){console.warn("Push notification permission not granted");return}P.addListener("registration",i=>{A.log("Push registration success, token: [REDACTED]")}),P.addListener("registrationError",i=>{console.error("Push registration error:",i)}),P.addListener("pushNotificationActionPerformed",i=>{const u=i.notification.data;u?.action==="accept"?r():u?.action==="decline"&&o()}),await Ie.schedule({notifications:[{title:"Incoming Call",body:`${s} is calling...`,id:parseInt(e.slice(0,8),16)||Date.now(),sound:"default",attachments:void 0,actionTypeId:"INCOMING_CALL",extra:{callId:e,callerName:s,callerId:a,action:"incoming_call"},schedule:{at:new Date(Date.now()+100)}}]}),await Me([200,100,200,100,200])}catch(n){console.error("Failed to show incoming call notification:",n)}}async function Xt(e){if(G())try{const s=parseInt(e.slice(0,8),16)||Date.now();await Ie.cancel({notifications:[{id:s}]})}catch(s){console.error("Failed to cancel notification:",s)}}async function es(){if(G())try{P.addListener("registration",e=>{A.log("üì± Push registration success, token: [REDACTED]")}),P.addListener("registrationError",e=>{console.error("‚ùå Push registration error:",e)}),P.addListener("pushNotificationReceived",e=>{console.log("üì¨ Push notification received:",e)}),P.addListener("pushNotificationActionPerformed",e=>{console.log("üì¨ Push notification action performed:",e),e.notification.data?.url}),oe.addListener("appStateChange",({isActive:e})=>{console.log("App state changed. Is active?",e)}),oe.addListener("appUrlOpen",e=>{console.log("üì± App opened from URL/intent:",e),ts(e)}),await Ue()}catch(e){console.error("Failed to initialize native Android features:",e)}}function ts(e){if(G())try{const s=new URL(e.url),a=s.searchParams.get("fromWidget")==="true",r=s.searchParams.get("widgetAction"),o=s.searchParams.get("childId");a&&r==="quick_call"&&(console.log("üì± Widget quick call action triggered",{childId:o}),window.dispatchEvent(new CustomEvent("widgetQuickCall",{detail:{action:r,childId:o}}))),s.pathname&&(console.log("üì± Deep link path:",s.pathname),window.location.href=s.pathname+s.search)}catch(s){console.error("Failed to handle app intent:",s)}}async function ss(e){if(q())try{const s={...e,updatedAt:new Date().toISOString()};localStorage.setItem("widget_data",JSON.stringify(s));const{WidgetDataPlugin:a}=await k(async()=>{const{WidgetDataPlugin:r}=await import("./WidgetDataPlugin-DwiTLMeD.js");return{WidgetDataPlugin:r}},__vite__mapDeps([0,1]));await a.syncWidgetData(e),console.log("‚úÖ Widget data synced to native Android")}catch(s){console.error("Failed to sync widget data to native:",s)}}function as({callId:e,callerName:s,callerId:a,onAccept:r,onDecline:o,isActive:n}){const i=l.useRef(null),{playRingtone:u,stopRingtone:c}=Be({enabled:!0,volume:.8});return l.useEffect(()=>!q()||!n?void 0:(Zt(e,s,a,r,o).catch(p=>{console.error("Failed to show native call notification:",p)}),(async()=>{for(;n;)await Me([200,100,200,100,200]),await new Promise(p=>setTimeout(p,2e3))})(),u().catch(p=>{console.error("Failed to play ringtone:",p)}),()=>{i.current&&clearInterval(i.current),c(),Xt(e).catch(()=>{})}),[e,s,a,n,r,o,u,c]),null}const ns=st,rs=tt,qe=l.forwardRef(({className:e,...s},a)=>t.jsx(we,{className:T("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:a}));qe.displayName=we.displayName;const Ve=l.forwardRef(({className:e,...s},a)=>t.jsxs(rs,{children:[t.jsx(qe,{}),t.jsx(be,{ref:a,className:T("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));Ve.displayName=be.displayName;const ze=({className:e,...s})=>t.jsx("div",{className:T("flex flex-col space-y-2 text-center sm:text-left",e),...s});ze.displayName="AlertDialogHeader";const Ge=({className:e,...s})=>t.jsx("div",{className:T("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});Ge.displayName="AlertDialogFooter";const Fe=l.forwardRef(({className:e,...s},a)=>t.jsx(Ce,{ref:a,className:T("text-lg font-semibold",e),...s}));Fe.displayName=Ce.displayName;const He=l.forwardRef(({className:e,...s},a)=>t.jsx(_e,{ref:a,className:T("text-sm text-muted-foreground",e),...s}));He.displayName=_e.displayName;const We=l.forwardRef(({className:e,...s},a)=>t.jsx(Ne,{ref:a,className:T(ne(),e),...s}));We.displayName=Ne.displayName;const $e=l.forwardRef(({className:e,...s},a)=>t.jsx(Se,{ref:a,className:T(ne({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));$e.displayName=Se.displayName;const is=()=>{const[e,s]=l.useState(null),a=l.useRef(null),r=l.useRef(null),o=l.useRef(!1),n=L(),i=se(),{handleIncomingCall:u,stopIncomingCall:c}=Yt({enabled:!0,volume:.7}),f=l.useRef(u);l.useEffect(()=>{a.current=e},[e]),l.useEffect(()=>{f.current=u},[u]),l.useEffect(()=>{let y=null,E=null,S=null;(async()=>{const{data:{session:d}}=await m.auth.getSession(),b=localStorage.getItem("childSession"),x=!d&&!!b;if(!d&&!b)return;!x&&d?.user?.id&&(S=d.user.id);const g=async C=>{if(C.id!==y&&!i.pathname.startsWith("/call/"))if(y=C.id,x){const{data:N}=await m.from("parents").select("name").eq("id",C.parent_id).maybeSingle();s({id:C.id,parent_id:C.parent_id,parent_name:N?.name||"Parent"}),f.current({callId:C.id,callerName:N?.name||"Parent",callerId:C.parent_id,url:`/call/${C.child_id}?callId=${C.id}`})}else{const{data:N}=await m.from("children").select("name, avatar_color").eq("id",C.child_id).single();N&&(s({id:C.id,child_id:C.child_id,child_name:N.name,child_avatar_color:N.avatar_color}),f.current({callId:C.id,callerName:N.name,callerId:C.child_id,url:`/call/${C.child_id}?callId=${C.id}`}))}},h=async()=>{const C=new Date(Date.now()-12e4).toISOString();if(x){const N=JSON.parse(b),{data:w}=await m.from("calls").select("*").eq("child_id",N.id).eq("caller_type","parent").eq("status","ringing").gte("created_at",C).order("created_at",{ascending:!1}).limit(1);if(w&&w.length>0){const B=w[0];B.id!==y&&await g(B)}}else{if(!S){const{data:{session:w}}=await m.auth.getSession();if(!w?.user?.id)return;S=w.user.id}const{data:N}=await m.from("calls").select("*").eq("parent_id",S).eq("caller_type","child").eq("status","ringing").gte("created_at",C).order("created_at",{ascending:!1}).limit(1);if(N&&N.length>0){const w=N[0];w.id!==y&&await g(w)}}},v=async()=>{const C=new Date(Date.now()-6e4).toISOString();if(x){const N=JSON.parse(b),{data:w}=await m.from("calls").select("*").eq("child_id",N.id).eq("caller_type","parent").eq("status","ringing").gte("created_at",C).order("created_at",{ascending:!1}).limit(1);if(w&&w.length>0){const B=w[0];B.id!==y&&await g(B)}}else{if(!S){const{data:{session:w}}=await m.auth.getSession();if(!w?.user?.id)return;S=w.user.id}const{data:N}=await m.from("calls").select("*").eq("parent_id",S).eq("caller_type","child").eq("status","ringing").gte("created_at",C).order("created_at",{ascending:!1}).limit(1);if(N&&N.length>0){const w=N[0];w.id!==y&&await g(w)}}};if(await h(),E=setInterval(v,6e4),x){const C=JSON.parse(b);r.current=m.channel("global-child-incoming-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:`child_id=eq.${C.id}`},async N=>{const w=N.new;w.caller_type==="parent"&&w.child_id===C.id&&w.status==="ringing"&&await g(w)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`child_id=eq.${C.id}`},async N=>{const w=N.new,B=N.old;w.caller_type!=="child"&&(a.current&&a.current.id===w.id&&(w.status==="active"||w.status==="ended")&&(s(null),a.current=null),w.caller_type==="parent"&&w.child_id===C.id&&w.status==="ringing"&&B.status!=="ringing"&&await g(w))}).subscribe()}else{if(!S){const{data:{session:C}}=await m.auth.getSession();if(!C?.user?.id)return;S=C.user.id}r.current=m.channel("global-parent-incoming-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:`parent_id=eq.${S}`},async C=>{const N=C.new;N.caller_type==="child"&&N.parent_id===S&&N.status==="ringing"&&await g(N)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`parent_id=eq.${S}`},async C=>{const N=C.new,w=C.old;N.caller_type!=="parent"&&(a.current&&a.current.id===N.id&&(N.status==="active"||N.status==="ended")&&(s(null),a.current=null),N.caller_type==="child"&&N.parent_id===S&&N.status==="ringing"&&w.status!=="ringing"&&await g(N))}).subscribe()}return()=>{r.current&&m.removeChannel(r.current),E&&clearInterval(E)}})()},[i.pathname]);const p=()=>{if(e){c(e.id),o.current=!0;const y=e.id;if(e.child_id)n(`/call/${e.child_id}?callId=${y}`);else if(e.parent_id){const E=localStorage.getItem("childSession");if(E){const S=JSON.parse(E);n(`/call/${S.id}?callId=${y}`)}}s(null),setTimeout(()=>{o.current=!1},2e3)}},_=async()=>{if(e){const{data:{session:y}}=await m.auth.getSession(),E=localStorage.getItem("childSession"),j=!y&&!!E?"child":"parent";try{await Qt({callId:e.id,by:j,reason:"declined"})}catch(d){console.error("Error declining call:",d)}c(e.id),s(null)}};return l.useEffect(()=>{!e&&a.current&&c(a.current.id)},[e,c]),e?t.jsxs(t.Fragment,{children:[q()&&t.jsx(as,{callId:e.id,callerName:e.child_name||e.parent_name||"Caller",callerId:e.child_id||e.parent_id||"",onAccept:p,onDecline:_,isActive:!!e}),t.jsx(ns,{open:!!e,onOpenChange:y=>{!y&&e&&!o.current&&_()},children:t.jsxs(Ve,{className:"sm:max-w-md",children:[t.jsxs(ze,{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold text-white",style:{backgroundColor:e.child_avatar_color||"#3B82F6"},children:e.child_name?.[0]||"üìû"}),t.jsxs("div",{children:[t.jsx(Fe,{className:"text-xl",children:"Incoming Call"}),t.jsxs("p",{className:"text-base font-normal text-muted-foreground",children:[e.child_name||e.parent_name," is calling..."]})]})]}),t.jsxs("div",{className:"pt-4",children:[t.jsxs(He,{className:"sr-only",children:["Incoming call from ",e.child_name||e.parent_name]}),t.jsx("div",{className:"flex items-center justify-center gap-2 text-4xl animate-pulse",children:t.jsx(at,{className:"h-12 w-12"})})]})]}),t.jsxs(Ge,{className:"sm:justify-center gap-2",children:[t.jsx($e,{onClick:_,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Decline"}),t.jsx(We,{onClick:p,className:"bg-green-600 hover:bg-green-700",children:"Answer"})]})]})})]}):null},os=()=>{const e=se(),s=L(),{toast:a}=Te(),r=l.useRef(null),o=l.useRef(null),n=l.useRef(null);return l.useEffect(()=>{const i=e.pathname.match(/^\/chat\/(.+)$/);n.current=i?i[1]:null},[e.pathname]),l.useEffect(()=>{let i=null,u=null,c=null,f=null,p=0;const _=300*1e3;(async()=>{const{data:{session:E}}=await m.auth.getSession(),S=localStorage.getItem("childSession");if(!E&&!S)return;const j=!E&&!!S;!j&&E?.user?.id&&(c=E.user.id);const d=async x=>{if(x.id===o.current)return;if(n.current===x.child_id){console.log("üì® [GLOBAL MESSAGE] User is actively chatting with this child, not showing notification",{childId:x.child_id,activeChat:n.current});return}if(j&&x.sender_type==="child"||!j&&x.sender_type==="parent")return;o.current=x.id;let g="Someone",h=null,v=null;try{if(x.sender_type==="parent"){const{data:w}=await m.from("parents").select("name").eq("id",x.sender_id).maybeSingle();w?.name?g=w.name:g="Parent",j&&(v="hsl(213, 94%, 68%)")}else{const{data:w}=await m.from("children").select("name, avatar_color").eq("id",x.sender_id).maybeSingle();w?.name?g=w.name:g="Child",!j&&w?.avatar_color&&(h=w.avatar_color)}}catch(w){console.error("Error fetching sender name:",w)}const C=x.content.length>50?`${x.content.substring(0,50)}...`:x.content,N=j?v?{style:{backgroundColor:v,borderColor:v,color:"#ffffff"},className:"border-2 shadow-lg ring-2 ring-opacity-30 custom-parent-color"}:void 0:h?{style:{backgroundColor:h,borderColor:h,color:"#ffffff"},className:"border-2 shadow-lg ring-2 ring-opacity-30 custom-child-color"}:void 0;a({title:`New message from ${g}`,description:C,variant:void 0,...N,action:t.jsxs(R,{variant:j?"default":"secondary",size:"sm",onClick:()=>{s(`/chat/${x.child_id}`)},className:j?"ml-2 bg-primary hover:bg-primary/90":"ml-2 bg-white/20 hover:bg-white/30 text-white border-white/30",style:!j&&h?{borderColor:"rgba(255,255,255,0.3)"}:void 0,children:[t.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Open"]})})},b=async()=>{try{const x=new Date(Date.now()-6e4).toISOString();if(j){const g=JSON.parse(S),{data:h}=await m.from("messages").select("*").eq("child_id",g.id).eq("sender_type","parent").is("read_at",null).gte("created_at",x).order("created_at",{ascending:!1}).limit(5);if(h&&h.length>0){for(const v of h.reverse())if(v.id!==u&&v.id!==o.current){await d(v),u=v.id;break}}}else{if(!c){const{data:{session:v}}=await m.auth.getSession();if(!v?.user?.id)return;c=v.user.id}const g=Date.now();if(!f||g-p>_){const{data:v}=await m.from("children").select("id").eq("parent_id",c);if(!v||v.length===0)return;f=v.map(C=>C.id),p=g}if(!f||f.length===0)return;const{data:h}=await m.from("messages").select("*").in("child_id",f).eq("sender_type","child").is("read_at",null).gte("created_at",x).order("created_at",{ascending:!1}).limit(5);if(h&&h.length>0){for(const v of h.reverse())if(v.id!==u&&v.id!==o.current){await d(v),u=v.id;break}}}}catch(x){console.error("‚ùå [GLOBAL MESSAGE] Polling error:",x)}};if(j){const x=JSON.parse(S);r.current=m.channel("global-child-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`child_id=eq.${x.id}`},async g=>{const h=g.new;h.sender_type==="parent"&&!h.read_at&&await d(h)}).subscribe((g,h)=>{h?(h instanceof Error?h.message:String(h)).includes("mismatch between server and client bindings")||console.error("‚ùå [GLOBAL MESSAGE] Child subscription error:",h):g==="TIMED_OUT"||g==="CHANNEL_ERROR"&&((h instanceof Error?h.message:String(h||"")).includes("mismatch between server and client bindings")||console.error("‚ùå [GLOBAL MESSAGE] Child subscription failed:",g))})}else{if(!c){const{data:{session:h}}=await m.auth.getSession();if(!h?.user?.id)return;c=h.user.id}const{data:x}=await m.from("children").select("id").eq("parent_id",c);if(!x||x.length===0)return;const g=x.map(h=>h.id);f=g,p=Date.now(),r.current=m.channel("global-parent-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},async h=>{const v=h.new;v.sender_type==="child"&&!v.read_at&&g.includes(v.child_id)&&await d(v)}).subscribe((h,v)=>{v?(v instanceof Error?v.message:String(v)).includes("mismatch between server and client bindings")||console.error("‚ùå [GLOBAL MESSAGE] Parent subscription error:",v):h==="TIMED_OUT"||h==="CHANNEL_ERROR"&&((v instanceof Error?v.message:String(v||"")).includes("mismatch between server and client bindings")||console.error("‚ùå [GLOBAL MESSAGE] Parent subscription failed:",h))})}return i=setInterval(b,6e4),setTimeout(b,2e3),()=>{r.current&&m.removeChannel(r.current),i&&clearInterval(i)}})()},[s,a]),null};function ue({userId:e,userType:s,name:a,enabled:r=!0}){const o=l.useRef(null),n=l.useRef(null),i=l.useRef(!1);l.useEffect(()=>{if(!r||!e)return;const u=`presence:${s}:${e}`,c=m.channel(u,{config:{presence:{key:e}}}),f={userId:e,userType:s,name:a,lastSeen:new Date().toISOString()};c.on("presence",{event:"sync"},()=>{}).subscribe(async y=>{y==="SUBSCRIBED"?(i.current=!0,await c.track(f),n.current=setInterval(()=>{i.current&&o.current&&o.current.track({...f,lastSeen:new Date().toISOString()})},6e4)):(y==="CHANNEL_ERROR"||y==="TIMED_OUT"||y==="CLOSED")&&(i.current=!1)}),o.current=c;const p=()=>{document.hidden||o.current&&i.current&&o.current.track({...f,lastSeen:new Date().toISOString()})};document.addEventListener("visibilitychange",p);const _=()=>{o.current&&o.current.untrack()};return window.addEventListener("beforeunload",_),()=>{o.current&&(o.current.untrack(),m.removeChannel(o.current)),n.current&&clearInterval(n.current),document.removeEventListener("visibilitychange",p),window.removeEventListener("beforeunload",_),i.current=!1,o.current=null}},[e,s,a,r])}const ls=()=>{const[e,s]=l.useState(null),[a,r]=l.useState(null),[o,n]=l.useState(null);return l.useEffect(()=>{const i=async()=>{const{data:{session:f}}=await m.auth.getSession();if(f?.user){r(f.user.id),s(null);const{data:p}=await m.from("parents").select("name").eq("id",f.user.id).maybeSingle();n(p?.name||null)}else{const p=localStorage.getItem("childSession");if(p)try{const _=JSON.parse(p);s(_),r(null),n(null)}catch(_){console.error("‚ùå [GLOBAL PRESENCE] Error parsing child session:",_),s(null),r(null),n(null)}else s(null),r(null),n(null)}};i();const u=f=>{f.key==="childSession"&&i()},{data:{subscription:c}}=m.auth.onAuthStateChange(()=>{i()});return window.addEventListener("storage",u),()=>{window.removeEventListener("storage",u),c.unsubscribe()}},[]),ue({userId:e?.id||"",userType:"child",name:e?.name,enabled:!!e}),ue({userId:a||"",userType:"parent",name:o||void 0,enabled:!!a}),null},Q="kch_cookie_consent",Z="1.0",cs=()=>{const[e,s]=l.useState(!1),a=L();l.useEffect(()=>{const i=localStorage.getItem(Q);if(!i){const u=setTimeout(()=>{s(!0)},1e3);return()=>clearTimeout(u)}try{const u=JSON.parse(i);if(u.version===Z&&u.timestamp)return;const c=setTimeout(()=>{s(!0)},1e3);return()=>clearTimeout(c)}catch{const c=setTimeout(()=>{s(!0)},1e3);return()=>clearTimeout(c)}},[]);const r=()=>{localStorage.setItem(Q,JSON.stringify({accepted:!0,version:Z,timestamp:new Date().toISOString()})),s(!1)},o=()=>{localStorage.setItem(Q,JSON.stringify({accepted:!1,version:Z,timestamp:new Date().toISOString()})),s(!1)},n=()=>{a("/info#privacy"),s(!1)};return e?t.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4",style:{paddingBottom:"calc(1rem + var(--safe-area-inset-bottom))"},children:t.jsx(U,{className:"max-w-4xl mx-auto shadow-lg border-2 p-4 md:p-6",children:t.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[t.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{className:"mt-1",children:t.jsx(nt,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("h3",{className:"font-semibold mb-1 flex items-center gap-2",children:[t.jsx(rt,{className:"h-4 w-4"}),"Privacy & Cookie Consent"]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["We use essential cookies and local storage to provide our service (authentication, preferences). We do not use tracking cookies or third-party analytics. By using this app, you agree to our"," ",t.jsx("button",{onClick:n,className:"text-primary hover:underline font-medium",children:"Privacy Policy"}),"."]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[t.jsx(R,{variant:"outline",size:"sm",onClick:n,className:"w-full sm:w-auto",children:"Learn More"}),t.jsx(R,{size:"sm",onClick:r,className:"w-full sm:w-auto",children:"Accept"}),t.jsx(R,{variant:"ghost",size:"sm",onClick:o,className:"w-full sm:w-auto text-muted-foreground",children:"Decline"})]})]})})}):null},X="kch_install_prompt_dismissed",ds=()=>{const[e,s]=l.useState(!1),[a,r]=l.useState(null),[o,n]=l.useState(!1);l.useEffect(()=>{const c=window.matchMedia("(display-mode: standalone)").matches,f=window.navigator.standalone===!0;if(c||f){n(!0);return}if(localStorage.getItem(X))return;const _=y=>{y.preventDefault(),r(y),setTimeout(()=>{s(!0)},3e3)};return window.addEventListener("beforeinstallprompt",_),window.addEventListener("appinstalled",()=>{n(!0),s(!1),r(null)}),()=>{window.removeEventListener("beforeinstallprompt",_)}},[]);const i=async()=>{if(!a)return;await a.prompt();const{outcome:c}=await a.userChoice;c==="accepted"?(s(!1),r(null),localStorage.removeItem(X)):u()},u=()=>{s(!1),localStorage.setItem(X,JSON.stringify({dismissed:!0,timestamp:new Date().toISOString()}))};return o||!e||!a?null:t.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4",style:{paddingBottom:"calc(1rem + var(--safe-area-inset-bottom))"},children:t.jsx(U,{className:"max-w-4xl mx-auto shadow-lg border-2 p-4 md:p-6",children:t.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[t.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{className:"mt-1",children:t.jsx(re,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold mb-1",children:"Install Kids Call Home"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Install our app for a better experience! Get faster access, offline support, and push notifications for calls and messages."})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[t.jsxs(R,{size:"sm",onClick:i,className:"w-full sm:w-auto",children:[t.jsx(re,{className:"h-4 w-4 mr-2"}),"Install App"]}),t.jsxs(R,{variant:"ghost",size:"sm",onClick:u,className:"w-full sm:w-auto text-muted-foreground",children:[t.jsx(pe,{className:"h-4 w-4 mr-2"}),"Not Now"]})]})]})})})};async function Je(){try{const{data:{session:e}}=await m.auth.getSession();if(!e?.user?.id)return null;const s=e.user.id,{data:a,error:r}=await m.from("children").select("id, name, avatar_color").eq("parent_id",s).order("created_at",{ascending:!1});if(r)return console.error("Error fetching children for widget:",r),null;if(!a||a.length===0)return null;const{data:o,error:n}=await m.from("calls").select("child_id, created_at").eq("parent_id",s).in("status",["ringing","active","ended"]).order("created_at",{ascending:!1}).limit(1).maybeSingle();n&&console.error("Error fetching last call for widget:",n);let i=a[0];if(o){const f=a.find(p=>p.id===o.child_id);f&&(i=f)}const{count:u,error:c}=await m.from("messages").select("id",{count:"exact",head:!0}).eq("child_id",i.id).eq("sender_type","child").is("read_at",null);return c&&console.error("Error fetching unread count for widget:",c),{childId:i.id,childName:i.name,childAvatarColor:i.avatar_color||"#3B82F6",unreadCount:u||0,lastCallTime:o?.created_at||null}}catch(e){return console.error("Error fetching widget data:",e),null}}function Ke(e){if(!e){localStorage.removeItem("widget_data");return}const s={...e,updatedAt:new Date().toISOString()};localStorage.setItem("widget_data",JSON.stringify(s)),typeof window<"u"&&window.dispatchEvent(new CustomEvent("widgetDataUpdated",{detail:s}))}function us(){try{const e=localStorage.getItem("widget_data");if(!e)return null;const s=JSON.parse(e),{updatedAt:a,...r}=s;return r}catch(e){return console.error("Error loading widget data:",e),null}}const ms=Object.freeze(Object.defineProperty({__proto__:null,fetchWidgetData:Je,loadWidgetData:us,storeWidgetData:Ke},Symbol.toStringTag,{value:"Module"}));function fs(){const e=l.useRef(null),s=I(a=>a.unreadMessagesByChild);l.useEffect(()=>{if(!q())return;const a=async()=>{try{const n=await Je();if(n){const i=s[n.childId]||0;n.unreadCount=i,Ke(n),await ss(n)}}catch(n){console.error("Error updating widget data:",n)}};a(),e.current=setInterval(a,300*1e3);const r=()=>{a()},o=I.subscribe(n=>n.unreadMessagesByChild,r);return()=>{e.current&&clearInterval(e.current),o()}},[s])}const gs=()=>{const e=L();return t.jsx("div",{className:"min-h-[100dvh] bg-gradient-to-b from-primary/10 to-background",children:t.jsxs("div",{className:"container mx-auto px-4 py-16",children:[t.jsxs("div",{className:"text-center space-y-6 mb-16",children:[t.jsx("div",{className:"aspect-square w-20 mx-auto",children:t.jsx("img",{src:"/icon-192x192.png",alt:"Kids Call Home",className:"w-full h-full object-contain",width:"192",height:"192"})}),t.jsx("h1",{className:"text-5xl md:text-6xl font-bold text-primary",children:"Kids Call Home"}),t.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Stay connected with your family through simple video calls and messaging"})]}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:[t.jsxs(U,{className:"p-8 cursor-pointer hover:shadow-xl transition-all border-4 border-primary/20 hover:border-primary/40",onClick:()=>e("/parent/auth"),children:[t.jsx(it,{className:"h-16 w-16 text-primary mb-4"}),t.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Parents"}),t.jsx("p",{className:"text-muted-foreground mb-6",children:"Create an account and add your children. Manage their access and stay connected."}),t.jsx(R,{className:"w-full",size:"lg",children:"Parent Sign In"})]}),t.jsxs(U,{className:"p-8 cursor-pointer hover:shadow-xl transition-all border-4 border-secondary/20 hover:border-secondary/40",onClick:()=>e("/child/login"),children:[t.jsx(Ee,{className:"h-16 w-16 text-secondary mb-4"}),t.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Kids"}),t.jsx("p",{className:"text-muted-foreground mb-6",children:"Enter your special code to call and message your parents!"}),t.jsx(R,{className:"w-full",size:"lg",variant:"secondary",children:"Kid Login"})]})]}),t.jsxs("div",{className:"mt-16 grid md:grid-cols-3 gap-8 max-w-4xl mx-auto",children:[t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-4xl",children:"üé•"}),t.jsx("h3",{className:"font-bold text-xl",children:"Video Calls"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Face-to-face conversations anytime"})]}),t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-4xl",children:"üí¨"}),t.jsx("h3",{className:"font-bold text-xl",children:"Messaging"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Send messages instantly"})]}),t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-4xl",children:"üîí"}),t.jsx("h3",{className:"font-bold text-xl",children:"Safe & Secure"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Private family connections only"})]})]}),t.jsx("div",{className:"mt-16 pt-8 border-t text-center",children:t.jsx(R,{variant:"ghost",onClick:()=>e("/info"),className:"text-muted-foreground hover:text-foreground",children:"App Information & Legal"})})]})})},hs=()=>{const e=se(),s=L();return l.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),t.jsx("div",{className:"flex min-h-[100dvh] items-center justify-center bg-gradient-to-br from-primary/5 via-background to-secondary/5 p-4",children:t.jsxs("div",{className:"text-center space-y-8 max-w-md w-full",children:[t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"text-9xl font-bold text-primary/20 select-none",children:[t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0s",animationDuration:"2s"},children:"4"}),t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.2s",animationDuration:"2s"},children:"0"}),t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.4s",animationDuration:"2s"},children:"4"})]}),t.jsx(J,{className:"absolute top-0 left-1/4 w-6 h-6 text-kid-purple animate-pulse",style:{animationDelay:"0.5s"}}),t.jsx(J,{className:"absolute top-4 right-1/4 w-5 h-5 text-kid-pink animate-pulse",style:{animationDelay:"1s"}}),t.jsx(J,{className:"absolute bottom-0 left-1/3 w-4 h-4 text-kid-green animate-pulse",style:{animationDelay:"1.5s"}})]}),t.jsxs("div",{className:"space-y-4 animate-fade-in",children:[t.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"Oops! This page went on an adventure! üó∫Ô∏è"}),t.jsx("p",{className:"text-xl text-muted-foreground",children:"We couldn't find the page you're looking for. Maybe it's playing hide and seek?"})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("div",{className:"relative",children:[t.jsx(ot,{className:"w-24 h-24 text-primary/30 animate-spin-slow"}),t.jsx("div",{className:"absolute inset-0 border-4 border-primary/20 rounded-full animate-ping"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center pt-4",children:[t.jsxs(R,{onClick:()=>s("/"),size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.3s"},children:[t.jsx(ae,{className:"mr-2 h-5 w-5"}),"Go Home"]}),t.jsx(R,{onClick:()=>s(-1),variant:"outline",size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.5s"},children:"Go Back"})]}),t.jsxs("div",{className:"flex justify-center gap-4 text-2xl pt-4",children:[t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:"üè†"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:"üåü"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.4s"},children:"üéà"})]})]})})},ps=()=>{const e=L(),s=()=>{window.location.reload()};return t.jsx("div",{className:"flex min-h-[100dvh] items-center justify-center bg-gradient-to-br from-destructive/5 via-background to-secondary/5 p-4",children:t.jsxs("div",{className:"text-center space-y-8 max-w-md w-full",children:[t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"text-9xl font-bold text-destructive/20 select-none",children:[t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0s",animationDuration:"2s"},children:"5"}),t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.2s",animationDuration:"2s"},children:"0"}),t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.4s",animationDuration:"2s"},children:"0"})]}),t.jsx(lt,{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 text-destructive/40 animate-pulse"})]}),t.jsxs("div",{className:"space-y-4 animate-fade-in",children:[t.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"Oops! Something went wrong! üîß"}),t.jsx("p",{className:"text-xl text-muted-foreground",children:"Our servers are taking a little break. Don't worry, we're working on fixing it!"})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(ee,{className:"w-24 h-24 text-destructive/30 animate-spin-slow"})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center pt-4",children:[t.jsxs(R,{onClick:s,size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.3s"},children:[t.jsx(ee,{className:"mr-2 h-5 w-5"}),"Try Again"]}),t.jsxs(R,{onClick:()=>e("/"),variant:"outline",size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.5s"},children:[t.jsx(ae,{className:"mr-2 h-5 w-5"}),"Go Home"]})]}),t.jsxs("div",{className:"flex justify-center gap-4 text-2xl pt-4",children:[t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:"üîß"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:"‚ö°"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.4s"},children:"‚ú®"})]})]})})},xs=()=>{const e=L(),s=()=>{window.location.reload()};return t.jsx("div",{className:"flex min-h-[100dvh] items-center justify-center bg-gradient-to-br from-secondary/5 via-background to-primary/5 p-4",children:t.jsxs("div",{className:"text-center space-y-8 max-w-md w-full",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"text-9xl font-bold text-secondary/20 select-none flex items-center justify-center",children:t.jsx(ie,{className:"w-32 h-32 text-secondary/30"})}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("div",{className:"relative w-40 h-40",children:[t.jsx("div",{className:"absolute inset-0 border-4 border-secondary/20 rounded-full animate-ping"}),t.jsx("div",{className:"absolute inset-0 border-4 border-secondary/20 rounded-full animate-ping",style:{animationDelay:"0.5s"}}),t.jsx("div",{className:"absolute inset-0 border-4 border-secondary/20 rounded-full animate-ping",style:{animationDelay:"1s"}})]})})]}),t.jsxs("div",{className:"space-y-4 animate-fade-in",children:[t.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"Oops! No internet connection! üì°"}),t.jsx("p",{className:"text-xl text-muted-foreground",children:"It looks like you're not connected to the internet. Check your connection and try again!"})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("div",{className:"relative",children:[t.jsx(ct,{className:"w-24 h-24 text-secondary/30 animate-pulse"}),t.jsx(ie,{className:"absolute inset-0 w-24 h-24 text-destructive/30 animate-pulse",style:{animationDelay:"0.5s"}})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center pt-4",children:[t.jsxs(R,{onClick:s,size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.3s"},children:[t.jsx(ee,{className:"mr-2 h-5 w-5"}),"Try Again"]}),t.jsxs(R,{onClick:()=>e("/"),variant:"outline",size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.5s"},children:[t.jsx(ae,{className:"mr-2 h-5 w-5"}),"Go Home"]})]}),t.jsxs("div",{className:"flex justify-center gap-4 text-2xl pt-4",children:[t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:"üì°"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:"üåê"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.4s"},children:"üîå"})]})]})})},ys=l.lazy(()=>k(()=>import("./ParentAuth-BEj7PDIV.js"),__vite__mapDeps([2,1,3,4,5,6,7,8]))),vs=l.lazy(()=>k(()=>import("./ParentDashboard-CrNVSxOv.js"),__vite__mapDeps([9,1,3,4,5,10,6,11,12,13,14,15,16,8]))),ws=l.lazy(()=>k(()=>import("./ParentHome-cxnauCkF.js"),__vite__mapDeps([17,3,4,5,13,14,15,1,8]))),bs=l.lazy(()=>k(()=>import("./ParentChildrenList-BahljVNJ.js"),__vite__mapDeps([18,3,4,5,13,12,10,6,11,14,15,1,8]))),Cs=l.lazy(()=>k(()=>import("./ParentCallScreen-Vg8ii67y.js"),__vite__mapDeps([19,3,4,5,20,21,1,8]))),_s=l.lazy(()=>k(()=>import("./DeviceManagement-CerkDBAc.js"),__vite__mapDeps([22,3,4,5,23,24,6,11,13,14,15,1,8]))),Ns=l.lazy(()=>k(()=>import("./Upgrade-E9IgA6Sn.js"),__vite__mapDeps([25,3,4,5,13,14,15,1,11,6,7,16,8]))),Ss=l.lazy(()=>k(()=>import("./AccountSettings-DUObl8tO.js"),__vite__mapDeps([26,3,4,5,13,14,15,1,16,8]))),Es=l.lazy(()=>k(()=>import("./ChildLogin-_kT1U6Va.js"),__vite__mapDeps([27,1,3,4,5,15,8]))),js=l.lazy(()=>k(()=>import("./ChildDashboard-D8DSUR4u.js"),__vite__mapDeps([28,1,3,4,5,13,14,15,29,12,8]))),Is=l.lazy(()=>k(()=>import("./ChildHome-CWPV2_da.js"),__vite__mapDeps([30,3,4,5,13,14,15,1,8]))),As=l.lazy(()=>k(()=>import("./ChildParentsList-CLsnsmid.js"),__vite__mapDeps([31,3,4,5,13,29,12,14,15,1,8]))),Ts=l.lazy(()=>k(()=>import("./ChildCallScreen-e_hhfgid.js"),__vite__mapDeps([32,3,4,5,20,21,1,8]))),Ds=l.lazy(()=>k(()=>import("./VideoCall-CeuMi1xq.js"),__vite__mapDeps([33,3,4,5,20,1,8]))),Rs=l.lazy(()=>k(()=>import("./Chat-E_Uq9AdG.js"),__vite__mapDeps([34,3,4,5,6,1,8]))),ks=l.lazy(()=>k(()=>import("./Info-TbeWtPVH.js"),__vite__mapDeps([35,3,4,5,13,1,8]))),Os=()=>t.jsx("div",{className:"flex items-center justify-center min-h-[100dvh]",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]"}),t.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"Loading..."})]})}),Ls=new wt,Ps=()=>(Wt(),$t(),null),Bs=()=>(l.useEffect(()=>{es().catch(e=>{console.error("Failed to initialize native Android features:",e)})},[]),null),Ms=()=>{const e=L();return l.useEffect(()=>{if(!q())return;const s=async a=>{console.log("üì± Widget quick call received:",a.detail);const{childId:r}=a.detail||{};if(r){console.log("üì± Routing to child from widget:",r),e(`/parent/call/${r}`);return}const{loadWidgetData:o}=await k(async()=>{const{loadWidgetData:i}=await Promise.resolve().then(()=>ms);return{loadWidgetData:i}},void 0),n=o();n?.childId?(console.log("üì± Routing to last-called child:",n.childId),e(`/parent/call/${n.childId}`)):e("/parent/dashboard")};return window.addEventListener("widgetQuickCall",s),()=>{window.removeEventListener("widgetQuickCall",s)}},[e]),null},Us=()=>(fs(),null),qs=()=>(l.useEffect(()=>{if(sessionStorage.getItem("clearSessionOnClose")==="true"){const s=()=>{Object.keys(localStorage).filter(n=>n.startsWith("sb-")||n.includes("supabase")).forEach(n=>localStorage.removeItem(n)),m.auth.signOut().catch(()=>{})},a=()=>{s()},r=()=>{s()};return window.addEventListener("pagehide",a),window.addEventListener("beforeunload",r),()=>{window.removeEventListener("pagehide",a),window.removeEventListener("beforeunload",r)}}},[]),null),Vs=()=>t.jsx(Ft,{children:t.jsx(dt,{client:Ls,children:t.jsxs(Rt,{children:[t.jsx(Ps,{}),t.jsx(qs,{}),t.jsx(Bs,{}),t.jsx(Us,{}),t.jsx(Ms,{}),t.jsx(Tt,{}),t.jsx(Dt,{}),t.jsx(Ot,{className:"w-full overflow-x-hidden",children:t.jsxs(ut,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[t.jsx(is,{}),t.jsx(os,{}),t.jsx(ls,{}),t.jsx(cs,{}),t.jsx(ds,{}),t.jsx(l.Suspense,{fallback:t.jsx(Os,{}),children:t.jsxs(mt,{children:[t.jsx(D,{path:"/",element:t.jsx(gs,{})}),t.jsx(D,{path:"/parent/auth",element:t.jsx(ys,{})}),t.jsx(D,{path:"/parent",element:t.jsx(ws,{})}),t.jsx(D,{path:"/parent/children",element:t.jsx(bs,{})}),t.jsx(D,{path:"/parent/call/:childId",element:t.jsx(Cs,{})}),t.jsx(D,{path:"/parent/dashboard",element:t.jsx(vs,{})}),t.jsx(D,{path:"/parent/devices",element:t.jsx(_s,{})}),t.jsx(D,{path:"/parent/upgrade",element:t.jsx(Ns,{})}),t.jsx(D,{path:"/parent/settings",element:t.jsx(Ss,{})}),t.jsx(D,{path:"/child/login",element:t.jsx(Es,{})}),t.jsx(D,{path:"/child",element:t.jsx(Is,{})}),t.jsx(D,{path:"/child/parents",element:t.jsx(As,{})}),t.jsx(D,{path:"/child/call/:parentId",element:t.jsx(Ts,{})}),t.jsx(D,{path:"/child/dashboard",element:t.jsx(js,{})}),t.jsx(D,{path:"/call/:childId",element:t.jsx(Ds,{})}),t.jsx(D,{path:"/chat/:childId",element:t.jsx(Rs,{})}),t.jsx(D,{path:"/info",element:t.jsx(ks,{})}),t.jsx(D,{path:"/error/server",element:t.jsx(ps,{})}),t.jsx(D,{path:"/error/network",element:t.jsx(xs,{})}),t.jsx(D,{path:"*",element:t.jsx(hs,{})})]})})]})})]})})});{const e=()=>{};console.log=e,console.debug=e,console.info=e}const te=document.getElementById("root");if(!te){const e=new Error("Root element not found. Make sure index.html has a <div id='root'></div> element.");throw console.error("‚ùå [APP INIT]",e),document.body.innerHTML=`
    <div style="padding: 2rem; font-family: system-ui; max-width: 600px; margin: 2rem auto;">
      <h1 style="color: #dc2626;">Application Error</h1>
      <p style="color: #6b7280;">Root element not found.</p>
      <pre style="background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow: auto; margin-top: 1rem;">
${e.message}
      </pre>
    </div>
  `,e}try{A.log("‚öõÔ∏è [APP INIT] Creating React root...");const e=ft.createRoot(te);A.log("‚öõÔ∏è [APP INIT] Rendering App component..."),e.render(t.jsx(Vs,{})),A.log("‚úÖ [APP INIT] App rendered successfully")}catch(e){throw te.innerHTML=`
    <div style="padding: 2rem; font-family: system-ui; max-width: 600px; margin: 2rem auto;">
      <h1 style="color: #dc2626;">Application Error</h1>
      <p style="color: #6b7280;">Failed to initialize the application.</p>
      <pre style="background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow: auto; margin-top: 1rem; white-space: pre-wrap;">
${e instanceof Error?e.message+`

`+e.stack:String(e)}
      </pre>
      <button 
        onclick="window.location.reload()" 
        style="margin-top: 1rem; padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 0.25rem; cursor: pointer;"
      >
        Reload Page
      </button>
      <p style="margin-top: 1rem; font-size: 0.875rem; color: #6b7280;">
        Check the browser console (F12) for more details.
      </p>
    </div>
  `,e}export{ns as A,R as B,U as C,A as a,W as b,T as c,$s as d,Qs as e,Ys as f,Ve as g,ze as h,Fe as i,He as j,Ge as k,$e as l,We as m,Yt as n,I as o,Js as p,Ks as q,Qt as r,m as s,ue as t,Te as u,Zs as v,Be as w};

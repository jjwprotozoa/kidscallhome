const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WidgetDataPlugin-DwiTLMeD.js","assets/vendor-capacitor-DSxgEnoB.js","assets/ParentAuth-C21C0EQa.js","assets/vendor-react-mDIoga_b.js","assets/vendor-radix-BQCqNqg0.js","assets/vendor-other-BA4qpukX.js","assets/input-UTyCM2Df.js","assets/label-CU-FEe3V.js","assets/vendor-supabase-DQP4RkUL.js","assets/ParentDashboard-BebEP0qs.js","assets/useChildrenPresence-D51CVWNq.js","assets/dialog-D8RTy2fV.js","assets/StatusIndicator-BZUItRQn.js","assets/Navigation-CglVk_ff.js","assets/OnboardingTour-BCKJLloU.js","assets/deviceTracking-lBUE_lfK.js","assets/platformDetection-DMTH-XIz.js","assets/ParentHome-qEwe4Fm4.js","assets/ParentChildrenList-Iultx56o.js","assets/ParentCallScreen-BwEswMu4.js","assets/useWebRTC-DpOhSsm3.js","assets/useCallEngine-C7F9nffZ.js","assets/DeviceManagement-BFbStljv.js","assets/ipGeolocation-Cm-ayuRY.js","assets/vendor-date-5vrp8xtd.js","assets/Upgrade-DfDRvq7X.js","assets/AccountSettings-qBtBZGBg.js","assets/ChildLogin-DJQ-bEyE.js","assets/ChildDashboard-FBTOt4p0.js","assets/useParentPresence-xis4RCQ0.js","assets/ChildHome-B5PU_5A0.js","assets/ChildParentsList-DMcJttqc.js","assets/ChildCallScreen-IbdI_xPx.js","assets/VideoCall-BumiNdfR.js","assets/Chat-BQVPcN5b.js","assets/Info-BMXzJQqb.js"])))=>i.map(i=>d[i]);
import{r as l,j as t,V as de,a as ue,A as me,C as fe,X as We,T as ge,D as he,P as Je,b as pe,c as Ke,S as Ye,d as Qe,e as Ze,u as L,O as xe,f as Xe,g as ye,h as ve,i as we,k as be,l as Ce,m as et,n as ee,o as tt,M as _e,p as st,q as at,U as nt,s as J,t as rt,H as te,w as it,x as Z,W as ae,y as ot,Q as lt,B as ct,z as dt,E as D,F as ut}from"./vendor-react-mDIoga_b.js";import{P,A as ne,C as Ne,L as Se,_ as R,H as mt,I as ft}from"./vendor-capacitor-DSxgEnoB.js";import{H as gt,I as ht,J as Ee,K as pt,$ as xt,Q as yt}from"./vendor-other-BA4qpukX.js";import{c as vt}from"./vendor-supabase-DQP4RkUL.js";import"./vendor-radix-BQCqNqg0.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=a(i);fetch(i.href,n)}})();const wt=1,bt=1e6;let K=0;function Ct(){return K=(K+1)%Number.MAX_SAFE_INTEGER,K.toString()}const Y=new Map,re=e=>{if(Y.has(e))return;const s=setTimeout(()=>{Y.delete(e),q({type:"REMOVE_TOAST",toastId:e})},bt);Y.set(e,s)},_t=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,wt)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(a=>a.id===s.toast.id?{...a,...s.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?re(a):e.toasts.forEach(r=>{re(r.id)}),{...e,toasts:e.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return s.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(a=>a.id!==s.toastId)}}},G=[];let H={toasts:[]};function q(e){H=_t(H,e),G.forEach(s=>{s(H)})}function Nt({...e}){const s=Ct(),a=i=>q({type:"UPDATE_TOAST",toast:{...i,id:s}}),r=()=>q({type:"DISMISS_TOAST",toastId:s});return q({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:i=>{i||r()}}}),{id:s,dismiss:r,update:a}}function je(){const[e,s]=l.useState(H);return l.useEffect(()=>(G.push(s),()=>{const a=G.indexOf(s);a>-1&&G.splice(a,1)}),[e]),{...e,toast:Nt,dismiss:a=>q({type:"DISMISS_TOAST",toastId:a})}}function T(...e){return gt(ht(e))}const St=Je,Ie=l.forwardRef(({className:e,...s},a)=>t.jsx(de,{ref:a,className:T("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...s}));Ie.displayName=de.displayName;const Et=Ee("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground",message:"border-primary bg-primary text-primary-foreground shadow-lg ring-2 ring-primary/30",success:"border-green-500 bg-green-50 dark:bg-green-950 text-green-900 dark:text-green-100 shadow-lg ring-2 ring-green-500/30"}},defaultVariants:{variant:"default"}}),Ae=l.forwardRef(({className:e,variant:s,swipeDirection:a,...r},i)=>t.jsx(ue,{ref:i,className:T(Et({variant:s}),e),...r}));Ae.displayName=ue.displayName;const jt=l.forwardRef(({className:e,...s},a)=>t.jsx(me,{ref:a,className:T("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...s}));jt.displayName=me.displayName;const Te=l.forwardRef(({className:e,...s},a)=>t.jsx(fe,{ref:a,className:T("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...s,children:t.jsx(We,{className:"h-4 w-4"})}));Te.displayName=fe.displayName;const De=l.forwardRef(({className:e,...s},a)=>t.jsx(ge,{ref:a,className:T("text-sm font-semibold group-[.custom-child-color]:text-white group-[.custom-parent-color]:text-white",e),...s}));De.displayName=ge.displayName;const Re=l.forwardRef(({className:e,...s},a)=>t.jsx(he,{ref:a,className:T("text-sm opacity-90 group-[.message]:opacity-100 group-[.message]:text-primary-foreground group-[.custom-child-color]:opacity-100 group-[.custom-child-color]:text-white group-[.custom-parent-color]:opacity-100 group-[.custom-parent-color]:text-white",e),...s}));Re.displayName=he.displayName;function It(){const{toasts:e}=je();return t.jsxs(St,{swipeDirection:"right",duration:5e3,children:[e.map(function({id:s,title:a,description:r,action:i,swipeDirection:n,...o}){return t.jsxs(Ae,{...o,children:[t.jsxs("div",{className:"grid gap-1",children:[a&&t.jsx(De,{children:a}),r&&t.jsx(Re,{children:r})]}),i,t.jsx(Te,{})]},s)}),t.jsx(Ie,{})]})}const At=({...e})=>{const{theme:s="system"}=pt();return t.jsx(xt,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},Tt=Ke,Dt=l.forwardRef(({className:e,sideOffset:s=4,...a},r)=>t.jsx(pe,{ref:r,sideOffset:s,className:T("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));Dt.displayName=pe.displayName;const Rt=({children:e,className:s,withTopInset:a=!0,withBottomInset:r=!0})=>t.jsx("div",{className:T("safe-area-layout min-h-[100dvh] w-full overflow-x-hidden",{"safe-area-top":a,"safe-area-bottom":r},s),children:e}),kt=["password","Password","PASSWORD","passwd","pwd","secret","Secret","SECRET","token","Token","TOKEN","apiKey","api_key","apikey","accessToken","access_token","refreshToken","refresh_token","authToken","auth_token","sessionToken","session_token","privateKey","private_key","privatekey","secretKey","secret_key","secretkey","authorization","Authorization","AUTHORIZATION","cookie","Cookie","COOKIE","session","Session","SESSION","credential","credentials","Credential","Credentials","CREDENTIALS","email","Email","EMAIL","userId","user_id","userId","ip","IP","ipAddress","ip_address","userAgent","user_agent","UserAgent"],Ot=[/password/i,/passwd/i,/secret/i,/token/i,/key/i,/credential/i,/auth/i,/session/i,/cookie/i,/email/i,/userid/i,/user_id/i,/ip/i,/useragent/i,/user_agent/i];function $(e,s={}){const{maskValue:a=!0,removeField:r=!1}=s;if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map(n=>$(n,s));if(e instanceof Date)return e;if(e instanceof Error)return{name:e.name,message:e.message,stack:"[REDACTED]"};const i={};for(const[n,o]of Object.entries(e))if(kt.includes(n)||Ot.some(u=>u.test(n))){if(r)continue;a&&(i[n]="[REDACTED]")}else o&&typeof o=="object"?i[n]=$(o,s):i[n]=o;return i}const A={log:(...e)=>{},error:(...e)=>{},warn:(...e)=>{},debug:(...e)=>{}};function Gs(e){return e instanceof Error?{name:e.name,message:e.message,stack:void 0,...e.code&&{code:e.code},...e.details&&{details:$(e.details)}}:typeof e=="object"&&e!==null?{message:"Unknown error",...$(e)}:{message:String(e)}}const Lt="https://itmhojbjfacocrpmslmt.supabase.co",Pt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0bWhvamJqZmFjb2NycG1zbG10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODExMDIsImV4cCI6MjA3NDQ1NzEwMn0.i8cdSYaeY7u4YaDqGI_92KmMwEpyEYt3ZZ9GuKxXVPk",m=vt(Lt,Pt,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1},realtime:{params:{eventsPerSecond:10}},global:{headers:{"x-client-info":"kidscallhome-web"}}});m.auth.onAuthStateChange((e,s)=>{});typeof window<"u"&&window.addEventListener("unhandledrejection",e=>{const s=e.reason;(s?.message?.includes("Invalid Refresh Token")||s?.message?.includes("Refresh Token Not Found"))&&(Object.keys(localStorage).filter(r=>r.startsWith("sb-")&&r.includes("auth-token")).forEach(r=>localStorage.removeItem(r)),e.preventDefault(),m.auth.signOut({scope:"local"}).catch(()=>{}))});const se=Ee("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-base font-semibold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),k=l.forwardRef(({className:e,variant:s,size:a,asChild:r=!1,...i},n)=>{const o=r?Ye:"button";return t.jsx(o,{className:T(se({variant:s,size:a,className:e})),ref:n,...i})});k.displayName="Button";const V=l.forwardRef(({className:e,...s},a)=>t.jsx("div",{ref:a,className:T("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));V.displayName="Card";const Bt=l.forwardRef(({className:e,...s},a)=>t.jsx("div",{ref:a,className:T("flex flex-col space-y-1.5 p-6",e),...s}));Bt.displayName="CardHeader";const Mt=l.forwardRef(({className:e,...s},a)=>t.jsx("h3",{ref:a,className:T("text-2xl font-semibold leading-none tracking-tight",e),...s}));Mt.displayName="CardTitle";const Ut=l.forwardRef(({className:e,...s},a)=>t.jsx("p",{ref:a,className:T("text-sm text-muted-foreground",e),...s}));Ut.displayName="CardDescription";const qt=l.forwardRef(({className:e,...s},a)=>t.jsx("div",{ref:a,className:T("p-6 pt-0",e),...s}));qt.displayName="CardContent";const Vt=l.forwardRef(({className:e,...s},a)=>t.jsx("div",{ref:a,className:T("flex items-center p-6 pt-0",e),...s}));Vt.displayName="CardFooter";class Ft extends l.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,a){console.error("‚ùå [ERROR BOUNDARY] Caught error:",s,a),this.setState({error:s,errorInfo:a})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const s=this.state.error?.message?.includes("VITE_SUPABASE")||this.state.error?.message?.includes("environment variable");return t.jsx("div",{className:"min-h-[100dvh] flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-secondary/5 p-4",children:t.jsxs(V,{className:"max-w-2xl w-full p-8 space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(Qe,{className:"h-12 w-12 text-destructive"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Something went wrong"}),t.jsx("p",{className:"text-muted-foreground mt-1",children:s?"Missing required configuration":"An unexpected error occurred"})]})]}),s?t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"The app is missing required environment variables. Please check:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 text-sm text-muted-foreground ml-4",children:[t.jsx("li",{children:"VITE_SUPABASE_URL"}),t.jsx("li",{children:"VITE_SUPABASE_PUBLISHABLE_KEY"})]}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Set these in your Vercel project settings (Settings ‚Üí Environment Variables) or in a .env file for local development."})]}):t.jsx("div",{className:"space-y-4",children:this.state.error&&t.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[t.jsx("p",{className:"font-mono text-sm text-destructive break-all",children:this.state.error.toString()}),this.state.errorInfo&&t.jsxs("details",{className:"mt-4",children:[t.jsx("summary",{className:"cursor-pointer text-sm text-muted-foreground",children:"Stack trace"}),t.jsx("pre",{className:"mt-2 text-xs text-muted-foreground overflow-auto max-h-48",children:this.state.errorInfo.componentStack})]})]})}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx(k,{onClick:this.handleReset,className:"flex-1",children:"Reload Page"}),t.jsx(k,{variant:"outline",onClick:()=>window.location.href="/",className:"flex-1",children:"Go Home"})]})]})})}return this.props.children}}const W="kidscallhome_badge_state",ke=1;function F(){try{const e=localStorage.getItem(W);if(!e)return{unreadMessagesByChild:{},missedCallsByChild:{},lastClearedTimestamps:{messages:{},calls:{}}};const s=JSON.parse(e);return s.version!==ke?(console.log("‚ö†Ô∏è [BADGE STORAGE] Version mismatch, clearing old data"),localStorage.removeItem(W),{unreadMessagesByChild:{},missedCallsByChild:{},lastClearedTimestamps:{messages:{},calls:{}}}):{unreadMessagesByChild:s.unreadMessagesByChild||{},missedCallsByChild:s.missedCallsByChild||{},lastClearedTimestamps:s.lastClearedTimestamps||{messages:{},calls:{}}}}catch(e){return console.error("‚ùå [BADGE STORAGE] Error loading badge state:",e),{unreadMessagesByChild:{},missedCallsByChild:{},lastClearedTimestamps:{messages:{},calls:{}}}}}function O(e,s,a){try{const r=F(),i=a||r.lastClearedTimestamps,n={version:ke,unreadMessagesByChild:e,missedCallsByChild:s,lastUpdated:new Date().toISOString(),lastClearedTimestamps:i};localStorage.setItem(W,JSON.stringify(n))}catch(r){console.error("‚ùå [BADGE STORAGE] Error saving badge state:",r)}}function ie(e,s){try{const a=F(),r=new Date().toISOString(),i={...a.lastClearedTimestamps};(s==="messages"||s==="both")&&(i.messages[e]=r),(s==="calls"||s==="both")&&(i.calls[e]=r),O(a.unreadMessagesByChild,a.missedCallsByChild,i),console.log(`‚úÖ [BADGE STORAGE] Marked ${s} badges as cleared for child ${e} at ${r}`)}catch(a){console.error("‚ùå [BADGE STORAGE] Error marking badges as cleared:",a)}}function M(e,s){try{return F().lastClearedTimestamps[s][e]||null}catch(a){return console.error("‚ùå [BADGE STORAGE] Error getting last cleared timestamp:",a),null}}function zt(){try{localStorage.removeItem(W)}catch(e){console.error("‚ùå [BADGE STORAGE] Error clearing badge state:",e)}}const oe=F(),I=Ze((e,s)=>({unreadMessagesByChild:oe.unreadMessagesByChild,missedCallsByChild:oe.missedCallsByChild,setInitialUnread:a=>{e({unreadMessagesByChild:a}),O(s().unreadMessagesByChild,s().missedCallsByChild)},setInitialMissed:a=>{e({missedCallsByChild:a}),O(s().unreadMessagesByChild,s().missedCallsByChild)},incrementUnread:a=>e(r=>{const i={unreadMessagesByChild:{...r.unreadMessagesByChild,[a]:(r.unreadMessagesByChild[a]??0)+1}};return O(i.unreadMessagesByChild,r.missedCallsByChild),i}),decrementUnread:(a,r=1)=>e(i=>{const n={unreadMessagesByChild:{...i.unreadMessagesByChild,[a]:Math.max(0,(i.unreadMessagesByChild[a]??0)-r)}};return O(n.unreadMessagesByChild,i.missedCallsByChild),n}),clearUnreadForChild:a=>e(r=>{const i={unreadMessagesByChild:{...r.unreadMessagesByChild,[a]:0}};return O(i.unreadMessagesByChild,r.missedCallsByChild),ie(a,"messages"),i}),incrementMissed:a=>e(r=>{const i={missedCallsByChild:{...r.missedCallsByChild,[a]:(r.missedCallsByChild[a]??0)+1}};return O(r.unreadMessagesByChild,i.missedCallsByChild),i}),decrementMissed:(a,r=1)=>e(i=>{const n={missedCallsByChild:{...i.missedCallsByChild,[a]:Math.max(0,(i.missedCallsByChild[a]??0)-r)}};return O(i.unreadMessagesByChild,n.missedCallsByChild),n}),clearMissedForChild:a=>e(r=>{const i={missedCallsByChild:{...r.missedCallsByChild,[a]:0}};return O(r.unreadMessagesByChild,i.missedCallsByChild),ie(a,"calls"),i}),reset:()=>{e({unreadMessagesByChild:{},missedCallsByChild:{}}),zt()}}));function Hs(){const e=I(s=>s.unreadMessagesByChild);return Object.values(e).reduce((s,a)=>s+a,0)}function $s(){const e=I(s=>s.missedCallsByChild);return Object.values(e).reduce((s,a)=>s+a,0)}function Ws(e){return I(s=>e?s.unreadMessagesByChild[e]??0:0)}function Js(e){return I(s=>e?s.missedCallsByChild[e]??0:0)}function Gt(){l.useEffect(()=>{let e=!0;return(async()=>{try{const a=F();e&&(Object.keys(a.unreadMessagesByChild).length>0||Object.keys(a.missedCallsByChild).length>0)&&(console.log("üì¶ [BADGE INIT] Loading cached badge state from local storage"),I.getState().setInitialUnread(a.unreadMessagesByChild),I.getState().setInitialMissed(a.missedCallsByChild));const r=localStorage.getItem("childSession");if(!!r){const o=JSON.parse(r).id,d=M(o,"messages"),u=M(o,"calls");let f=m.from("messages").select("child_id, created_at").eq("child_id",o).eq("sender_type","parent").is("read_at",null);d&&(f=f.gt("created_at",d));const{data:p,error:N}=await f;if(N)throw N;let w=m.from("calls").select("child_id, created_at").eq("child_id",o).eq("caller_type","parent").eq("missed_call",!0).is("missed_call_read_at",null);u&&(w=w.gt("created_at",u));const{data:E,error:S}=await w;if(S)throw S;if(e){const j=p?.length??0,c=E?.length??0;console.log(`üì¶ [BADGE INIT] Child ${o}: ${j} new unread messages, ${c} new missed calls`,{lastClearedMessages:d,lastClearedCalls:u}),I.getState().setInitialUnread({[o]:j}),I.getState().setInitialMissed({[o]:c})}}else{const{data:{user:n}}=await m.auth.getUser();if(!n)return;const{data:o,error:d}=await m.from("children").select("id").eq("parent_id",n.id);if(d)throw d;if(!o||o.length===0)return;const u=o.map(N=>N.id),f={},p={};for(const N of u){const w=M(N,"messages"),E=M(N,"calls");let S=m.from("messages").select("child_id, created_at").eq("child_id",N).eq("sender_type","child").is("read_at",null);w&&(S=S.gt("created_at",w));const{data:j}=await S;f[N]=j?.length??0;let c=m.from("calls").select("child_id, created_at").eq("child_id",N).eq("caller_type","child").eq("missed_call",!0).is("missed_call_read_at",null);E&&(c=c.gt("created_at",E));const{data:b}=await c;p[N]=b?.length??0}e&&(console.log(`üì¶ [BADGE INIT] Parent: loaded badge counts for ${u.length} children`,{unreadByChild:f,missedByChild:p}),I.getState().setInitialUnread(f),I.getState().setInitialMissed(p))}}catch(a){console.error("Error fetching initial badge counts:",a)}})(),()=>{e=!1}},[])}function Ht(){const e=l.useRef(null),s=l.useRef(null);return l.useEffect(()=>{const r=!!localStorage.getItem("childSession");return e.current=m.channel("badge-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},i=>{const n=i.new,o=M(n.child_id,"messages");o&&n.created_at<=o||(r?n.sender_type==="parent"&&!n.read_at&&I.getState().incrementUnread(n.child_id):n.sender_type==="child"&&!n.read_at&&I.getState().incrementUnread(n.child_id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},i=>{const n=i.old,o=i.new,d=!n.read_at,u=!!o.read_at;d&&u&&(r?n.sender_type==="parent"&&I.getState().decrementUnread(n.child_id):n.sender_type==="child"&&I.getState().decrementUnread(n.child_id))}).subscribe((i,n)=>{n?(n instanceof Error?n.message:String(n)).includes("mismatch between server and client bindings")||console.error("‚ùå [BADGE REALTIME] Messages subscription error:",n):i==="TIMED_OUT"||i==="CHANNEL_ERROR"&&((n instanceof Error?n.message:String(n||"")).includes("mismatch between server and client bindings")||console.error("‚ùå [BADGE REALTIME] Messages subscription failed:",i))}),s.current=m.channel("badge-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls"},i=>{const n=i.new,o=M(n.child_id,"calls");o&&n.created_at<=o||n.missed_call&&!n.missed_call_read_at&&(r?n.caller_type==="parent"&&I.getState().incrementMissed(n.child_id):n.caller_type==="child"&&I.getState().incrementMissed(n.child_id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls"},i=>{const n=i.old,o=i.new,d=!n.missed_call_read_at,u=!!o.missed_call_read_at;d&&u&&n.missed_call&&(r?n.caller_type==="parent"&&I.getState().decrementMissed(n.child_id):n.caller_type==="child"&&I.getState().decrementMissed(n.child_id)),o.status==="active"&&n.status!=="active"&&(console.log("‚úÖ [BADGE REALTIME] Call became active - clearing missed call badge",{childId:o.child_id,callerType:o.caller_type}),r?o.caller_type==="parent"&&I.getState().clearMissedForChild(o.child_id):o.caller_type==="child"&&I.getState().clearMissedForChild(o.child_id)),!n.missed_call&&o.missed_call&&!o.missed_call_read_at&&(r?o.caller_type==="parent"&&I.getState().incrementMissed(o.child_id):o.caller_type==="child"&&I.getState().incrementMissed(o.child_id))}).subscribe((i,n)=>{n?(n instanceof Error?n.message:String(n)).includes("mismatch between server and client bindings")||console.error("‚ùå [BADGE REALTIME] Calls subscription error:",n):i==="TIMED_OUT"||i==="CHANNEL_ERROR"&&((n instanceof Error?n.message:String(n||"")).includes("mismatch between server and client bindings")||console.error("‚ùå [BADGE REALTIME] Calls subscription failed:",i))}),()=>{e.current&&m.removeChannel(e.current),s.current&&m.removeChannel(s.current)}},[]),null}const $t=()=>{const[e,s]=l.useState(!document.hidden),[a,r]=l.useState(!document.hidden);return l.useEffect(()=>{const i=()=>{const d=!document.hidden;s(d),d&&r(!0)};s(!document.hidden),r(!document.hidden),document.addEventListener("visibilitychange",i);const n=()=>{s(!0),r(!0)},o=()=>{s(!1)};return window.addEventListener("focus",n),window.addEventListener("blur",o),()=>{document.removeEventListener("visibilitychange",i),window.removeEventListener("focus",n),window.removeEventListener("blur",o)}},[]),{isVisible:e,hasBeenVisible:a,isHidden:!e}},Wt=()=>{const e=l.useRef(null),s=l.useRef(null);l.useEffect(()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.js").then(o=>{console.log("‚úÖ [PUSH] Service Worker registered:",o),e.current=o,o.addEventListener("updatefound",()=>{console.log("üîÑ [PUSH] Service Worker update found");const d=o.installing;d&&d.addEventListener("statechange",()=>{d.state==="installed"&&navigator.serviceWorker.controller&&console.log("üîÑ [PUSH] New service worker installed, reload to activate")})})}).catch(o=>{console.error("‚ùå [PUSH] Service Worker registration failed:",o)}),navigator.serviceWorker.addEventListener("message",o=>{if(console.log("üì® [PUSH] Message from service worker:",o.data),o.data&&o.data.type==="NOTIFICATION_CLICKED"){const{callId:d,url:u}=o.data;s.current&&s.current({callId:d,url:u})}}))},[]);const a=l.useCallback(async()=>{if(!("Notification"in window))return console.warn("‚ö†Ô∏è [PUSH] This browser does not support notifications"),"denied";if(Notification.permission==="granted")return"granted";if(Notification.permission==="denied")return console.warn("‚ö†Ô∏è [PUSH] Notification permission denied"),"denied";const o=await Notification.requestPermission();return console.log("üîî [PUSH] Notification permission:",o),o},[]),r=l.useCallback(async o=>{if(!("Notification"in window)){console.warn("‚ö†Ô∏è [PUSH] Notifications not supported");return}if(await a()!=="granted"){console.warn("‚ö†Ô∏è [PUSH] Notification permission not granted");return}if(e.current)try{await e.current.showNotification(o.title,{body:o.body,icon:o.icon||"/icon-192x192.png",badge:o.badge||"/icon-96x96.png",tag:o.tag||"notification",requireInteraction:o.requireInteraction??!0,vibrate:o.vibrate||[200,100,200],data:o.data||{},actions:o.actions||[]}),console.log("‚úÖ [PUSH] Notification sent via service worker")}catch(u){console.error("‚ùå [PUSH] Failed to send notification:",u)}else try{new Notification(o.title,{body:o.body,icon:o.icon||"/icon-192x192.png",tag:o.tag||"notification",requireInteraction:o.requireInteraction??!0,data:o.data||{}}),console.log("‚úÖ [PUSH] Notification sent via Notification API")}catch(u){console.error("‚ùå [PUSH] Failed to send notification:",u)}},[a]),i=l.useCallback(async o=>{e.current&&(await e.current.getNotifications({tag:o})).forEach(u=>u.close())},[]),n=l.useCallback(o=>{s.current=o},[]);return{requestPermission:a,sendNotification:r,closeNotification:i,onNotificationClick:n,hasPermission:"Notification"in window&&Notification.permission==="granted",permission:"Notification"in window?Notification.permission:"default"}},Oe=(e={})=>{const{enabled:s=!0,volume:a=.7}=e,r=l.useRef(null),i=l.useRef(null),n=l.useRef(null),o=l.useRef({}),d=l.useRef([]);l.useEffect(()=>()=>{o.current.ringtone&&(o.current.ringtone=!1),i.current&&(clearInterval(i.current),i.current=null);const c=n.current!==null;if(n.current&&(clearInterval(n.current),n.current=null),c&&"vibrate"in navigator)try{navigator.vibrate(0)}catch{}d.current.forEach(({event:b,handler:x})=>{document.removeEventListener(b,x)}),d.current=[],r.current&&(r.current.close().catch(b=>A.error("Error:",b)),r.current=null)},[]);const u=l.useCallback(async()=>{if(!s)return null;if(!r.current)try{const c=window.AudioContext||window.webkitAudioContext;r.current=new c,A.log("üîä [AUDIO] AudioContext created (lazy init), initial state:",r.current.state);const b=async()=>{if(r.current&&r.current.state==="suspended")try{await r.current.resume(),A.log("üîä [AUDIO] AudioContext resumed via user interaction")}catch(g){A.error("‚ùå [AUDIO] Failed to resume AudioContext:",g)}};["click","touchstart","keydown","mousedown"].forEach(g=>{document.addEventListener(g,b,{passive:!0}),d.current.push({event:g,handler:b})})}catch{return null}if(r.current.state==="suspended")try{A.log("üîä [AUDIO] AudioContext is suspended, attempting to resume..."),await r.current.resume(),A.log("üîä [AUDIO] AudioContext resumed successfully, state:",r.current.state)}catch{try{await new Promise(b=>setTimeout(b,100)),r.current&&r.current.state==="suspended"&&(await r.current.resume(),A.log("üîä [AUDIO] AudioContext resumed on retry, state:",r.current.state))}catch{return null}}return r.current},[s]),f=l.useCallback(()=>{if(!(!s||!("vibrate"in navigator)))try{const c=()=>{if(o.current.ringtone&&"vibrate"in navigator)try{navigator.vibrate([200,100,200])}catch{}};c(),n.current=setInterval(()=>{o.current.ringtone&&c()},2e3),A.log("üì≥ [AUDIO] Vibration started")}catch{}},[s]),p=l.useCallback(async()=>{if(!s||o.current.ringtone)return;const c=await u();if(c)try{o.current.ringtone=!0,A.log("üîî [AUDIO] Ringtone started, AudioContext state:",c.state);const b=()=>{if(!(!o.current.ringtone||!r.current))try{const x=r.current.createOscillator(),g=r.current.createGain();x.connect(g),g.connect(r.current.destination),x.frequency.value=800,x.type="sine";const h=r.current.currentTime;g.gain.setValueAtTime(0,h),g.gain.linearRampToValueAtTime(a*.4,h+.05),g.gain.linearRampToValueAtTime(a*.4,h+.2),g.gain.linearRampToValueAtTime(0,h+.25),x.start(h),x.stop(h+.25)}catch(x){A.error("‚ùå [AUDIO] Error playing tone:",x)}};b(),f(),i.current=setInterval(()=>{o.current.ringtone&&(b(),setTimeout(()=>{o.current.ringtone&&b()},250))},2e3)}catch{o.current.ringtone=!1}},[s,a,u,f]),N=l.useCallback(()=>{if(n.current&&(clearInterval(n.current),n.current=null),"vibrate"in navigator)try{navigator.vibrate(0)}catch{}},[]),w=l.useCallback(()=>{o.current.ringtone&&(o.current.ringtone=!1,i.current&&(clearInterval(i.current),i.current=null),N())},[N]),E=l.useCallback(async()=>{if(!s)return;const c=await u();if(c)try{const b=c.createOscillator(),x=c.createGain();b.connect(x),x.connect(c.destination),b.frequency.value=400,b.type="sine";const g=c.currentTime;x.gain.setValueAtTime(0,g),x.gain.linearRampToValueAtTime(a*.3,g+.05),x.gain.linearRampToValueAtTime(0,g+.2),b.start(g),b.stop(g+.2),A.log("üîî [AUDIO] Call ended sound played")}catch{}},[s,a,u]),S=l.useCallback(async()=>{if(!s)return;const c=await u();if(c)try{[600,800].forEach((b,x)=>{const g=c.createOscillator(),h=c.createGain();g.connect(h),h.connect(c.destination),g.frequency.value=b,g.type="sine";const y=c.currentTime+x*.1;h.gain.setValueAtTime(0,y),h.gain.linearRampToValueAtTime(a*.4,y+.05),h.gain.linearRampToValueAtTime(0,y+.15),g.start(y),g.stop(y+.15)}),A.log("üîî [AUDIO] Call answered sound played")}catch{}},[s,a,u]),j=l.useCallback(c=>{c==="ringtone"&&w()},[w]);return{playRingtone:p,stopRingtone:w,startVibration:f,stopVibration:N,playCallEnded:E,playCallAnswered:S,stopSound:j,isPlaying:o.current}},Jt=(e={})=>{const{enabled:s=!0,volume:a=.7}=e,r=L(),{isVisible:i,hasBeenVisible:n}=$t(),{sendNotification:o,closeNotification:d,onNotificationClick:u,hasPermission:f}=Wt(),{playRingtone:p,stopRingtone:N}=Oe({enabled:s,volume:a}),w=l.useRef(null),E=l.useRef(!1);l.useEffect(()=>{u(c=>{console.log("üîî [CALL NOTIFICATIONS] Notification clicked, starting ringtone",c),d("incoming-call"),c.url&&r(c.url),c.callId===w.current&&p().catch(b=>{console.error("‚ùå [CALL NOTIFICATIONS] Failed to play ringtone after notification click:",b)})})},[u,d,r,p]);const S=l.useCallback(async c=>{s&&(w.current=c.callId,E.current=!1,console.log("üìû [CALL NOTIFICATIONS] Handling incoming call:",{callId:c.callId,isVisible:i,hasBeenVisible:n}),i&&n?(console.log("üîî [CALL NOTIFICATIONS] Tab is active, playing ringtone immediately"),p().catch(b=>{console.error("‚ùå [CALL NOTIFICATIONS] Failed to play ringtone:",b)})):(console.log("üîî [CALL NOTIFICATIONS] Tab is not active, showing push notification"),await o({title:"Incoming Call",body:c.callerName?`${c.callerName} is calling...`:"You have an incoming call",icon:"/icon-192x192.png",badge:"/icon-96x96.png",tag:"incoming-call",requireInteraction:!0,vibrate:[200,100,200,100,200],data:{callId:c.callId,callerName:c.callerName,callerId:c.callerId,url:c.url}}),E.current=!0))},[s,i,n,f,o,p]);l.useEffect(()=>{i&&w.current&&n&&E.current&&(console.log("üîî [CALL NOTIFICATIONS] Tab became visible, starting ringtone"),p().catch(c=>{console.error("‚ùå [CALL NOTIFICATIONS] Failed to play ringtone when tab became visible:",c)}))},[i,n,p]);const j=l.useCallback(async c=>{w.current===c&&(console.log("üîá [CALL NOTIFICATIONS] Stopping incoming call notifications:",c),N(),await d("incoming-call"),w.current=null,E.current=!1)},[N,d]);return l.useEffect(()=>()=>{w.current&&j(w.current)},[j]),{handleIncomingCall:S,stopIncomingCall:j,hasActiveCall:w.current!==null,activeCallId:w.current}};async function Kt({callId:e,by:s,reason:a="hangup"}){A.log("üõë [CALL LIFECYCLE] End requested",{callId:e,by:s,reason:a,timestamp:new Date().toISOString()});let r=null;try{const{data:f,error:p}=await m.from("calls").select("id, status, ended_at").eq("id",e).maybeSingle();p?A.warn("‚ö†Ô∏è [CALL LIFECYCLE] Error checking call status (will continue):",p):r=f}catch{}if(r&&(r.status==="ended"||r.ended_at))return A.log("‚úÖ [CALL LIFECYCLE] Call already ended (idempotent)",{callId:e,status:r.status,ended_at:r.ended_at}),r;let i=null,n=null;const o={status:"ended",ended_at:new Date().toISOString(),ended_by:s,end_reason:a},{data:d,error:u}=await m.from("calls").update(o).eq("id",e).select("id, status, ended_at, ended_by, end_reason").single();if(i=d,n=u,n&&(n.code==="PGRST204"||n.code==="406"||n.message?.includes("end_reason")||n.message?.includes("ended_by")||n.message?.includes("ended_at")||n.message?.includes("Not Acceptable"))){A.warn("‚ö†Ô∏è [CALL LIFECYCLE] Update failed (possibly schema issue), trying fallback",{callId:e,errorCode:n.code,errorMessage:n.message});let f=null;try{const{error:p}=await m.rpc("ensure_call_ending_columns");f=p}catch{f={message:"RPC function not available"}}if(!f){const{data:p,error:N}=await m.from("calls").update({status:"ended",ended_at:new Date().toISOString(),ended_by:s,end_reason:a}).eq("id",e).select("id, status, ended_at, ended_by, end_reason").single();N?n=N:(i=p,n=null)}if(n){const{data:p,error:N}=await m.from("calls").update({status:"ended"}).eq("id",e).select("id, status").single();if(!N)i={...p,ended_at:null},n=null;else{const{data:w}=await m.from("calls").select("id, status").eq("id",e).maybeSingle();if(w?.status==="ended")i={...w,ended_at:null},n=null;else return A.warn("‚ö†Ô∏è [CALL LIFECYCLE] Fallback update failed, but continuing",{callId:e,error:N,currentStatus:w?.status}),null}}}if(!n&&i)try{await m.rpc("increment_call_version",{call_id:e})}catch{}if(n){if(n.code==="PGRST116"||n.message?.includes("No rows")){const{data:f}=await m.from("calls").select("id, status, ended_at").eq("id",e).maybeSingle();return f}if(n.code==="406"||n.message?.includes("Not Acceptable")){const{data:f,error:p}=await m.from("calls").update({status:"ended"}).eq("id",e).select("id, status").single();if(!p&&f)return{...f,ended_at:null}}return null}return i&&A.log("‚úÖ [CALL LIFECYCLE] Call ended successfully",{callId:i.id,status:i.status,ended_at:i.ended_at,ended_by:i.ended_by,end_reason:i.end_reason}),i}function Ks(e){return e.status==="ended"||!!e.ended_at}function U(){return Ne.getPlatform()==="android"}function z(){return Ne.isNativePlatform()}async function Le(e=[200,100,200,100,200]){if(U())try{for(let s=0;s<e.length;s+=2)await mt.impact({style:ft.Heavy}),e[s+1]&&await new Promise(a=>setTimeout(a,e[s+1]))}catch(s){console.warn("Vibration pattern not available:",s)}}async function Pe(){if(!z())return!1;try{return(await P.requestPermissions()).receive==="granted"}catch(e){return console.error("Failed to request push notification permission:",e),!1}}async function Yt(e,s,a,r,i){if(z())try{if(!await Pe()){console.warn("Push notification permission not granted");return}P.addListener("registration",o=>{A.log("Push registration success, token: [REDACTED]")}),P.addListener("registrationError",o=>{console.error("Push registration error:",o)}),P.addListener("pushNotificationActionPerformed",o=>{const d=o.notification.data;d?.action==="accept"?r():d?.action==="decline"&&i()}),await Se.schedule({notifications:[{title:"Incoming Call",body:`${s} is calling...`,id:parseInt(e.slice(0,8),16)||Date.now(),sound:"default",attachments:void 0,actionTypeId:"INCOMING_CALL",extra:{callId:e,callerName:s,callerId:a,action:"incoming_call"},schedule:{at:new Date(Date.now()+100)}}]}),await Le([200,100,200,100,200])}catch(n){console.error("Failed to show incoming call notification:",n)}}async function Qt(e){if(z())try{const s=parseInt(e.slice(0,8),16)||Date.now();await Se.cancel({notifications:[{id:s}]})}catch(s){console.error("Failed to cancel notification:",s)}}async function Zt(){if(z())try{P.addListener("registration",e=>{A.log("üì± Push registration success, token: [REDACTED]")}),P.addListener("registrationError",e=>{console.error("‚ùå Push registration error:",e)}),P.addListener("pushNotificationReceived",e=>{console.log("üì¨ Push notification received:",e)}),P.addListener("pushNotificationActionPerformed",e=>{console.log("üì¨ Push notification action performed:",e),e.notification.data?.url}),ne.addListener("appStateChange",({isActive:e})=>{console.log("App state changed. Is active?",e)}),ne.addListener("appUrlOpen",e=>{console.log("üì± App opened from URL/intent:",e),Xt(e)}),await Pe()}catch(e){console.error("Failed to initialize native Android features:",e)}}function Xt(e){if(z())try{const s=new URL(e.url),a=s.searchParams.get("fromWidget")==="true",r=s.searchParams.get("widgetAction"),i=s.searchParams.get("childId");a&&r==="quick_call"&&(console.log("üì± Widget quick call action triggered",{childId:i}),window.dispatchEvent(new CustomEvent("widgetQuickCall",{detail:{action:r,childId:i}}))),s.pathname&&(console.log("üì± Deep link path:",s.pathname),window.location.href=s.pathname+s.search)}catch(s){console.error("Failed to handle app intent:",s)}}async function es(e){if(U())try{const s={...e,updatedAt:new Date().toISOString()};localStorage.setItem("widget_data",JSON.stringify(s));const{WidgetDataPlugin:a}=await R(async()=>{const{WidgetDataPlugin:r}=await import("./WidgetDataPlugin-DwiTLMeD.js");return{WidgetDataPlugin:r}},__vite__mapDeps([0,1]));await a.syncWidgetData(e),console.log("‚úÖ Widget data synced to native Android")}catch(s){console.error("Failed to sync widget data to native:",s)}}function ts({callId:e,callerName:s,callerId:a,onAccept:r,onDecline:i,isActive:n}){const o=l.useRef(null),{playRingtone:d,stopRingtone:u}=Oe({enabled:!0,volume:.8});return l.useEffect(()=>!U()||!n?void 0:(Yt(e,s,a,r,i).catch(p=>{console.error("Failed to show native call notification:",p)}),(async()=>{for(;n;)await Le([200,100,200,100,200]),await new Promise(p=>setTimeout(p,2e3))})(),d().catch(p=>{console.error("Failed to play ringtone:",p)}),()=>{o.current&&clearInterval(o.current),u(),Qt(e).catch(()=>{})}),[e,s,a,n,r,i,d,u]),null}const ss=et,as=Xe,Be=l.forwardRef(({className:e,...s},a)=>t.jsx(xe,{className:T("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:a}));Be.displayName=xe.displayName;const Me=l.forwardRef(({className:e,...s},a)=>t.jsxs(as,{children:[t.jsx(Be,{}),t.jsx(ye,{ref:a,className:T("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));Me.displayName=ye.displayName;const Ue=({className:e,...s})=>t.jsx("div",{className:T("flex flex-col space-y-2 text-center sm:text-left",e),...s});Ue.displayName="AlertDialogHeader";const qe=({className:e,...s})=>t.jsx("div",{className:T("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});qe.displayName="AlertDialogFooter";const Ve=l.forwardRef(({className:e,...s},a)=>t.jsx(ve,{ref:a,className:T("text-lg font-semibold",e),...s}));Ve.displayName=ve.displayName;const Fe=l.forwardRef(({className:e,...s},a)=>t.jsx(we,{ref:a,className:T("text-sm text-muted-foreground",e),...s}));Fe.displayName=we.displayName;const ze=l.forwardRef(({className:e,...s},a)=>t.jsx(be,{ref:a,className:T(se(),e),...s}));ze.displayName=be.displayName;const Ge=l.forwardRef(({className:e,...s},a)=>t.jsx(Ce,{ref:a,className:T(se({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));Ge.displayName=Ce.displayName;const ns=()=>{const[e,s]=l.useState(null),a=l.useRef(null),r=l.useRef(null),i=l.useRef(!1),n=L(),o=ee(),{handleIncomingCall:d,stopIncomingCall:u}=Jt({enabled:!0,volume:.7}),f=l.useRef(d);l.useEffect(()=>{a.current=e},[e]),l.useEffect(()=>{f.current=d},[d]),l.useEffect(()=>{let w=null,E=null,S=null;(async()=>{const{data:{session:c}}=await m.auth.getSession(),b=localStorage.getItem("childSession"),x=!c&&!!b;if(!c&&!b)return;!x&&c?.user?.id&&(S=c.user.id);const g=async C=>{if(C.id!==w&&!o.pathname.startsWith("/call/"))if(w=C.id,x){const{data:_}=await m.from("parents").select("name").eq("id",C.parent_id).maybeSingle();s({id:C.id,parent_id:C.parent_id,parent_name:_?.name||"Parent"}),f.current({callId:C.id,callerName:_?.name||"Parent",callerId:C.parent_id,url:`/call/${C.child_id}?callId=${C.id}`})}else{const{data:_}=await m.from("children").select("name, avatar_color").eq("id",C.child_id).single();_&&(s({id:C.id,child_id:C.child_id,child_name:_.name,child_avatar_color:_.avatar_color}),f.current({callId:C.id,callerName:_.name,callerId:C.child_id,url:`/call/${C.child_id}?callId=${C.id}`}))}},h=async()=>{const C=new Date(Date.now()-12e4).toISOString();if(x){const _=JSON.parse(b),{data:v}=await m.from("calls").select("*").eq("child_id",_.id).eq("caller_type","parent").eq("status","ringing").gte("created_at",C).order("created_at",{ascending:!1}).limit(1);if(v&&v.length>0){const B=v[0];B.id!==w&&await g(B)}}else{if(!S){const{data:{session:v}}=await m.auth.getSession();if(!v?.user?.id)return;S=v.user.id}const{data:_}=await m.from("calls").select("*").eq("parent_id",S).eq("caller_type","child").eq("status","ringing").gte("created_at",C).order("created_at",{ascending:!1}).limit(1);if(_&&_.length>0){const v=_[0];v.id!==w&&await g(v)}}},y=async()=>{const C=new Date(Date.now()-6e4).toISOString();if(x){const _=JSON.parse(b),{data:v}=await m.from("calls").select("*").eq("child_id",_.id).eq("caller_type","parent").eq("status","ringing").gte("created_at",C).order("created_at",{ascending:!1}).limit(1);if(v&&v.length>0){const B=v[0];B.id!==w&&await g(B)}}else{if(!S){const{data:{session:v}}=await m.auth.getSession();if(!v?.user?.id)return;S=v.user.id}const{data:_}=await m.from("calls").select("*").eq("parent_id",S).eq("caller_type","child").eq("status","ringing").gte("created_at",C).order("created_at",{ascending:!1}).limit(1);if(_&&_.length>0){const v=_[0];v.id!==w&&await g(v)}}};if(await h(),E=setInterval(y,6e4),x){const C=JSON.parse(b);r.current=m.channel("global-child-incoming-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:`child_id=eq.${C.id}`},async _=>{const v=_.new;v.caller_type==="parent"&&v.child_id===C.id&&v.status==="ringing"&&await g(v)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`child_id=eq.${C.id}`},async _=>{const v=_.new,B=_.old;v.caller_type!=="child"&&(a.current&&a.current.id===v.id&&(v.status==="active"||v.status==="ended")&&(s(null),a.current=null),v.caller_type==="parent"&&v.child_id===C.id&&v.status==="ringing"&&B.status!=="ringing"&&await g(v))}).subscribe()}else{if(!S){const{data:{session:C}}=await m.auth.getSession();if(!C?.user?.id)return;S=C.user.id}r.current=m.channel("global-parent-incoming-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:`parent_id=eq.${S}`},async C=>{const _=C.new;_.caller_type==="child"&&_.parent_id===S&&_.status==="ringing"&&await g(_)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`parent_id=eq.${S}`},async C=>{const _=C.new,v=C.old;_.caller_type!=="parent"&&(a.current&&a.current.id===_.id&&(_.status==="active"||_.status==="ended")&&(s(null),a.current=null),_.caller_type==="child"&&_.parent_id===S&&_.status==="ringing"&&v.status!=="ringing"&&await g(_))}).subscribe()}return()=>{r.current&&m.removeChannel(r.current),E&&clearInterval(E)}})()},[o.pathname]);const p=()=>{if(e){u(e.id),i.current=!0;const w=e.id;if(e.child_id)n(`/call/${e.child_id}?callId=${w}`);else if(e.parent_id){const E=localStorage.getItem("childSession");if(E){const S=JSON.parse(E);n(`/call/${S.id}?callId=${w}`)}}s(null),setTimeout(()=>{i.current=!1},2e3)}},N=async()=>{if(e){const{data:{session:w}}=await m.auth.getSession(),E=localStorage.getItem("childSession"),j=!w&&!!E?"child":"parent";try{await Kt({callId:e.id,by:j,reason:"declined"})}catch(c){console.error("Error declining call:",c)}u(e.id),s(null)}};return l.useEffect(()=>{!e&&a.current&&u(a.current.id)},[e,u]),e?t.jsxs(t.Fragment,{children:[U()&&t.jsx(ts,{callId:e.id,callerName:e.child_name||e.parent_name||"Caller",callerId:e.child_id||e.parent_id||"",onAccept:p,onDecline:N,isActive:!!e}),t.jsx(ss,{open:!!e,onOpenChange:w=>{!w&&e&&!i.current&&N()},children:t.jsxs(Me,{className:"sm:max-w-md",children:[t.jsxs(Ue,{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold text-white",style:{backgroundColor:e.child_avatar_color||"#3B82F6"},children:e.child_name?.[0]||"üìû"}),t.jsxs("div",{children:[t.jsx(Ve,{className:"text-xl",children:"Incoming Call"}),t.jsxs("p",{className:"text-base font-normal text-muted-foreground",children:[e.child_name||e.parent_name," is calling..."]})]})]}),t.jsxs("div",{className:"pt-4",children:[t.jsxs(Fe,{className:"sr-only",children:["Incoming call from ",e.child_name||e.parent_name]}),t.jsx("div",{className:"flex items-center justify-center gap-2 text-4xl animate-pulse",children:t.jsx(tt,{className:"h-12 w-12"})})]})]}),t.jsxs(qe,{className:"sm:justify-center gap-2",children:[t.jsx(Ge,{onClick:N,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Decline"}),t.jsx(ze,{onClick:p,className:"bg-green-600 hover:bg-green-700",children:"Answer"})]})]})})]}):null},rs=()=>{const e=ee(),s=L(),{toast:a}=je(),r=l.useRef(null),i=l.useRef(null),n=l.useRef(null);return l.useEffect(()=>{const o=e.pathname.match(/^\/chat\/(.+)$/);n.current=o?o[1]:null},[e.pathname]),l.useEffect(()=>{let o=null,d=null,u=null,f=null,p=0;const N=300*1e3;(async()=>{const{data:{session:E}}=await m.auth.getSession(),S=localStorage.getItem("childSession");if(!E&&!S)return;const j=!E&&!!S;!j&&E?.user?.id&&(u=E.user.id);const c=async x=>{if(x.id===i.current)return;if(n.current===x.child_id){console.log("üì® [GLOBAL MESSAGE] User is actively chatting with this child, not showing notification",{childId:x.child_id,activeChat:n.current});return}if(j&&x.sender_type==="child"||!j&&x.sender_type==="parent")return;i.current=x.id;let g="Someone",h=null,y=null;try{if(x.sender_type==="parent"){const{data:v}=await m.from("parents").select("name").eq("id",x.sender_id).maybeSingle();v?.name?g=v.name:g="Parent",j&&(y="hsl(213, 94%, 68%)")}else{const{data:v}=await m.from("children").select("name, avatar_color").eq("id",x.sender_id).maybeSingle();v?.name?g=v.name:g="Child",!j&&v?.avatar_color&&(h=v.avatar_color)}}catch(v){console.error("Error fetching sender name:",v)}const C=x.content.length>50?`${x.content.substring(0,50)}...`:x.content,_=j?y?{style:{backgroundColor:y,borderColor:y,color:"#ffffff"},className:"border-2 shadow-lg ring-2 ring-opacity-30 custom-parent-color"}:void 0:h?{style:{backgroundColor:h,borderColor:h,color:"#ffffff"},className:"border-2 shadow-lg ring-2 ring-opacity-30 custom-child-color"}:void 0;a({title:`New message from ${g}`,description:C,variant:void 0,..._,action:t.jsxs(k,{variant:j?"default":"secondary",size:"sm",onClick:()=>{s(`/chat/${x.child_id}`)},className:j?"ml-2 bg-primary hover:bg-primary/90":"ml-2 bg-white/20 hover:bg-white/30 text-white border-white/30",style:!j&&h?{borderColor:"rgba(255,255,255,0.3)"}:void 0,children:[t.jsx(_e,{className:"h-4 w-4 mr-1"}),"Open"]})})},b=async()=>{try{const x=new Date(Date.now()-6e4).toISOString();if(j){const g=JSON.parse(S),{data:h}=await m.from("messages").select("*").eq("child_id",g.id).eq("sender_type","parent").is("read_at",null).gte("created_at",x).order("created_at",{ascending:!1}).limit(5);if(h&&h.length>0){for(const y of h.reverse())if(y.id!==d&&y.id!==i.current){await c(y),d=y.id;break}}}else{if(!u){const{data:{session:y}}=await m.auth.getSession();if(!y?.user?.id)return;u=y.user.id}const g=Date.now();if(!f||g-p>N){const{data:y}=await m.from("children").select("id").eq("parent_id",u);if(!y||y.length===0)return;f=y.map(C=>C.id),p=g}if(!f||f.length===0)return;const{data:h}=await m.from("messages").select("*").in("child_id",f).eq("sender_type","child").is("read_at",null).gte("created_at",x).order("created_at",{ascending:!1}).limit(5);if(h&&h.length>0){for(const y of h.reverse())if(y.id!==d&&y.id!==i.current){await c(y),d=y.id;break}}}}catch(x){console.error("‚ùå [GLOBAL MESSAGE] Polling error:",x)}};if(j){const x=JSON.parse(S);r.current=m.channel("global-child-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`child_id=eq.${x.id}`},async g=>{const h=g.new;h.sender_type==="parent"&&!h.read_at&&await c(h)}).subscribe((g,h)=>{h?(h instanceof Error?h.message:String(h)).includes("mismatch between server and client bindings")||console.error("‚ùå [GLOBAL MESSAGE] Child subscription error:",h):g==="TIMED_OUT"||g==="CHANNEL_ERROR"&&((h instanceof Error?h.message:String(h||"")).includes("mismatch between server and client bindings")||console.error("‚ùå [GLOBAL MESSAGE] Child subscription failed:",g))})}else{if(!u){const{data:{session:h}}=await m.auth.getSession();if(!h?.user?.id)return;u=h.user.id}const{data:x}=await m.from("children").select("id").eq("parent_id",u);if(!x||x.length===0)return;const g=x.map(h=>h.id);f=g,p=Date.now(),r.current=m.channel("global-parent-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},async h=>{const y=h.new;y.sender_type==="child"&&!y.read_at&&g.includes(y.child_id)&&await c(y)}).subscribe((h,y)=>{y?(y instanceof Error?y.message:String(y)).includes("mismatch between server and client bindings")||console.error("‚ùå [GLOBAL MESSAGE] Parent subscription error:",y):h==="TIMED_OUT"||h==="CHANNEL_ERROR"&&((y instanceof Error?y.message:String(y||"")).includes("mismatch between server and client bindings")||console.error("‚ùå [GLOBAL MESSAGE] Parent subscription failed:",h))})}return o=setInterval(b,6e4),setTimeout(b,2e3),()=>{r.current&&m.removeChannel(r.current),o&&clearInterval(o)}})()},[s,a]),null};function le({userId:e,userType:s,name:a,enabled:r=!0}){const i=l.useRef(null),n=l.useRef(null),o=l.useRef(!1);l.useEffect(()=>{if(!r||!e)return;const d=`presence:${s}:${e}`,u=m.channel(d,{config:{presence:{key:e}}}),f={userId:e,userType:s,name:a,lastSeen:new Date().toISOString()};u.on("presence",{event:"sync"},()=>{}).subscribe(async w=>{w==="SUBSCRIBED"?(o.current=!0,await u.track(f),n.current=setInterval(()=>{o.current&&i.current&&i.current.track({...f,lastSeen:new Date().toISOString()})},6e4)):(w==="CHANNEL_ERROR"||w==="TIMED_OUT"||w==="CLOSED")&&(o.current=!1)}),i.current=u;const p=()=>{document.hidden||i.current&&o.current&&i.current.track({...f,lastSeen:new Date().toISOString()})};document.addEventListener("visibilitychange",p);const N=()=>{i.current&&i.current.untrack()};return window.addEventListener("beforeunload",N),()=>{i.current&&(i.current.untrack(),m.removeChannel(i.current)),n.current&&clearInterval(n.current),document.removeEventListener("visibilitychange",p),window.removeEventListener("beforeunload",N),o.current=!1,i.current=null}},[e,s,a,r])}const is=()=>{const[e,s]=l.useState(null),[a,r]=l.useState(null),[i,n]=l.useState(null);return l.useEffect(()=>{const o=async()=>{const{data:{session:f}}=await m.auth.getSession();if(f?.user){r(f.user.id),s(null);const{data:p}=await m.from("parents").select("name").eq("id",f.user.id).maybeSingle();n(p?.name||null)}else{const p=localStorage.getItem("childSession");if(p)try{const N=JSON.parse(p);s(N),r(null),n(null)}catch(N){console.error("‚ùå [GLOBAL PRESENCE] Error parsing child session:",N),s(null),r(null),n(null)}else s(null),r(null),n(null)}};o();const d=f=>{f.key==="childSession"&&o()},{data:{subscription:u}}=m.auth.onAuthStateChange(()=>{o()});return window.addEventListener("storage",d),()=>{window.removeEventListener("storage",d),u.unsubscribe()}},[]),le({userId:e?.id||"",userType:"child",name:e?.name,enabled:!!e}),le({userId:a||"",userType:"parent",name:i||void 0,enabled:!!a}),null},Q="kch_cookie_consent",ce="1.0",os=()=>{const[e,s]=l.useState(!1),a=L();l.useEffect(()=>{if(!localStorage.getItem(Q)){const d=setTimeout(()=>{s(!0)},1e3);return()=>clearTimeout(d)}},[]);const r=()=>{localStorage.setItem(Q,JSON.stringify({accepted:!0,version:ce,timestamp:new Date().toISOString()})),s(!1)},i=()=>{localStorage.setItem(Q,JSON.stringify({accepted:!1,version:ce,timestamp:new Date().toISOString()})),s(!1)},n=()=>{a("/info#privacy"),s(!1)};return e?t.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4",style:{paddingBottom:"calc(1rem + var(--safe-area-inset-bottom))"},children:t.jsx(V,{className:"max-w-4xl mx-auto shadow-lg border-2 p-4 md:p-6",children:t.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[t.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{className:"mt-1",children:t.jsx(st,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("h3",{className:"font-semibold mb-1 flex items-center gap-2",children:[t.jsx(at,{className:"h-4 w-4"}),"Privacy & Cookie Consent"]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["We use essential cookies and local storage to provide our service (authentication, preferences). We do not use tracking cookies or third-party analytics. By using this app, you agree to our"," ",t.jsx("button",{onClick:n,className:"text-primary hover:underline font-medium",children:"Privacy Policy"}),"."]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[t.jsx(k,{variant:"outline",size:"sm",onClick:n,className:"w-full sm:w-auto",children:"Learn More"}),t.jsx(k,{size:"sm",onClick:r,className:"w-full sm:w-auto",children:"Accept"}),t.jsx(k,{variant:"ghost",size:"sm",onClick:i,className:"w-full sm:w-auto text-muted-foreground",children:"Decline"})]})]})})}):null};async function He(){try{const{data:{session:e}}=await m.auth.getSession();if(!e?.user?.id)return null;const s=e.user.id,{data:a,error:r}=await m.from("children").select("id, name, avatar_color").eq("parent_id",s).order("created_at",{ascending:!1});if(r)return console.error("Error fetching children for widget:",r),null;if(!a||a.length===0)return null;const{data:i,error:n}=await m.from("calls").select("child_id, created_at").eq("parent_id",s).in("status",["ringing","active","ended"]).order("created_at",{ascending:!1}).limit(1).maybeSingle();n&&console.error("Error fetching last call for widget:",n);let o=a[0];if(i){const f=a.find(p=>p.id===i.child_id);f&&(o=f)}const{count:d,error:u}=await m.from("messages").select("id",{count:"exact",head:!0}).eq("child_id",o.id).eq("sender_type","child").is("read_at",null);return u&&console.error("Error fetching unread count for widget:",u),{childId:o.id,childName:o.name,childAvatarColor:o.avatar_color||"#3B82F6",unreadCount:d||0,lastCallTime:i?.created_at||null}}catch(e){return console.error("Error fetching widget data:",e),null}}function $e(e){if(!e){localStorage.removeItem("widget_data");return}const s={...e,updatedAt:new Date().toISOString()};localStorage.setItem("widget_data",JSON.stringify(s)),typeof window<"u"&&window.dispatchEvent(new CustomEvent("widgetDataUpdated",{detail:s}))}function ls(){try{const e=localStorage.getItem("widget_data");if(!e)return null;const s=JSON.parse(e),{updatedAt:a,...r}=s;return r}catch(e){return console.error("Error loading widget data:",e),null}}const cs=Object.freeze(Object.defineProperty({__proto__:null,fetchWidgetData:He,loadWidgetData:ls,storeWidgetData:$e},Symbol.toStringTag,{value:"Module"}));function ds(){const e=l.useRef(null),s=I(a=>a.unreadMessagesByChild);l.useEffect(()=>{if(!U())return;const a=async()=>{try{const n=await He();if(n){const o=s[n.childId]||0;n.unreadCount=o,$e(n),await es(n)}}catch(n){console.error("Error updating widget data:",n)}};a(),e.current=setInterval(a,300*1e3);const r=()=>{a()},i=I.subscribe(n=>n.unreadMessagesByChild,r);return()=>{e.current&&clearInterval(e.current),i()}},[s])}const us=()=>{const e=L();return t.jsx("div",{className:"min-h-[100dvh] bg-gradient-to-b from-primary/10 to-background",children:t.jsxs("div",{className:"container mx-auto px-4 py-16",children:[t.jsxs("div",{className:"text-center space-y-6 mb-16",children:[t.jsx("div",{className:"aspect-square w-20 mx-auto",children:t.jsx("img",{src:"/icon-192x192.png",alt:"Kids Call Home",className:"w-full h-full object-contain",width:"192",height:"192"})}),t.jsx("h1",{className:"text-5xl md:text-6xl font-bold text-primary",children:"Kids Call Home"}),t.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Stay connected with your family through simple video calls and messaging"})]}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:[t.jsxs(V,{className:"p-8 cursor-pointer hover:shadow-xl transition-all border-4 border-primary/20 hover:border-primary/40",onClick:()=>e("/parent/auth"),children:[t.jsx(nt,{className:"h-16 w-16 text-primary mb-4"}),t.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Parents"}),t.jsx("p",{className:"text-muted-foreground mb-6",children:"Create an account and add your children. Manage their access and stay connected."}),t.jsx(k,{className:"w-full",size:"lg",children:"Parent Sign In"})]}),t.jsxs(V,{className:"p-8 cursor-pointer hover:shadow-xl transition-all border-4 border-secondary/20 hover:border-secondary/40",onClick:()=>e("/child/login"),children:[t.jsx(_e,{className:"h-16 w-16 text-secondary mb-4"}),t.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Kids"}),t.jsx("p",{className:"text-muted-foreground mb-6",children:"Enter your special code to call and message your parents!"}),t.jsx(k,{className:"w-full",size:"lg",variant:"secondary",children:"Kid Login"})]})]}),t.jsxs("div",{className:"mt-16 grid md:grid-cols-3 gap-8 max-w-4xl mx-auto",children:[t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-4xl",children:"üé•"}),t.jsx("h3",{className:"font-bold text-xl",children:"Video Calls"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Face-to-face conversations anytime"})]}),t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-4xl",children:"üí¨"}),t.jsx("h3",{className:"font-bold text-xl",children:"Messaging"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Send messages instantly"})]}),t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-4xl",children:"üîí"}),t.jsx("h3",{className:"font-bold text-xl",children:"Safe & Secure"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Private family connections only"})]})]}),t.jsx("div",{className:"mt-16 pt-8 border-t text-center",children:t.jsx(k,{variant:"ghost",onClick:()=>e("/info"),className:"text-muted-foreground hover:text-foreground",children:"App Information & Legal"})})]})})},ms=()=>{const e=ee(),s=L();return l.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),t.jsx("div",{className:"flex min-h-[100dvh] items-center justify-center bg-gradient-to-br from-primary/5 via-background to-secondary/5 p-4",children:t.jsxs("div",{className:"text-center space-y-8 max-w-md w-full",children:[t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"text-9xl font-bold text-primary/20 select-none",children:[t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0s",animationDuration:"2s"},children:"4"}),t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.2s",animationDuration:"2s"},children:"0"}),t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.4s",animationDuration:"2s"},children:"4"})]}),t.jsx(J,{className:"absolute top-0 left-1/4 w-6 h-6 text-kid-purple animate-pulse",style:{animationDelay:"0.5s"}}),t.jsx(J,{className:"absolute top-4 right-1/4 w-5 h-5 text-kid-pink animate-pulse",style:{animationDelay:"1s"}}),t.jsx(J,{className:"absolute bottom-0 left-1/3 w-4 h-4 text-kid-green animate-pulse",style:{animationDelay:"1.5s"}})]}),t.jsxs("div",{className:"space-y-4 animate-fade-in",children:[t.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"Oops! This page went on an adventure! üó∫Ô∏è"}),t.jsx("p",{className:"text-xl text-muted-foreground",children:"We couldn't find the page you're looking for. Maybe it's playing hide and seek?"})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("div",{className:"relative",children:[t.jsx(rt,{className:"w-24 h-24 text-primary/30 animate-spin-slow"}),t.jsx("div",{className:"absolute inset-0 border-4 border-primary/20 rounded-full animate-ping"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center pt-4",children:[t.jsxs(k,{onClick:()=>s("/"),size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.3s"},children:[t.jsx(te,{className:"mr-2 h-5 w-5"}),"Go Home"]}),t.jsx(k,{onClick:()=>s(-1),variant:"outline",size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.5s"},children:"Go Back"})]}),t.jsxs("div",{className:"flex justify-center gap-4 text-2xl pt-4",children:[t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:"üè†"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:"üåü"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.4s"},children:"üéà"})]})]})})},fs=()=>{const e=L(),s=()=>{window.location.reload()};return t.jsx("div",{className:"flex min-h-[100dvh] items-center justify-center bg-gradient-to-br from-destructive/5 via-background to-secondary/5 p-4",children:t.jsxs("div",{className:"text-center space-y-8 max-w-md w-full",children:[t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"text-9xl font-bold text-destructive/20 select-none",children:[t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0s",animationDuration:"2s"},children:"5"}),t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.2s",animationDuration:"2s"},children:"0"}),t.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.4s",animationDuration:"2s"},children:"0"})]}),t.jsx(it,{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 text-destructive/40 animate-pulse"})]}),t.jsxs("div",{className:"space-y-4 animate-fade-in",children:[t.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"Oops! Something went wrong! üîß"}),t.jsx("p",{className:"text-xl text-muted-foreground",children:"Our servers are taking a little break. Don't worry, we're working on fixing it!"})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(Z,{className:"w-24 h-24 text-destructive/30 animate-spin-slow"})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center pt-4",children:[t.jsxs(k,{onClick:s,size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.3s"},children:[t.jsx(Z,{className:"mr-2 h-5 w-5"}),"Try Again"]}),t.jsxs(k,{onClick:()=>e("/"),variant:"outline",size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.5s"},children:[t.jsx(te,{className:"mr-2 h-5 w-5"}),"Go Home"]})]}),t.jsxs("div",{className:"flex justify-center gap-4 text-2xl pt-4",children:[t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:"üîß"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:"‚ö°"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.4s"},children:"‚ú®"})]})]})})},gs=()=>{const e=L(),s=()=>{window.location.reload()};return t.jsx("div",{className:"flex min-h-[100dvh] items-center justify-center bg-gradient-to-br from-secondary/5 via-background to-primary/5 p-4",children:t.jsxs("div",{className:"text-center space-y-8 max-w-md w-full",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"text-9xl font-bold text-secondary/20 select-none flex items-center justify-center",children:t.jsx(ae,{className:"w-32 h-32 text-secondary/30"})}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("div",{className:"relative w-40 h-40",children:[t.jsx("div",{className:"absolute inset-0 border-4 border-secondary/20 rounded-full animate-ping"}),t.jsx("div",{className:"absolute inset-0 border-4 border-secondary/20 rounded-full animate-ping",style:{animationDelay:"0.5s"}}),t.jsx("div",{className:"absolute inset-0 border-4 border-secondary/20 rounded-full animate-ping",style:{animationDelay:"1s"}})]})})]}),t.jsxs("div",{className:"space-y-4 animate-fade-in",children:[t.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"Oops! No internet connection! üì°"}),t.jsx("p",{className:"text-xl text-muted-foreground",children:"It looks like you're not connected to the internet. Check your connection and try again!"})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("div",{className:"relative",children:[t.jsx(ot,{className:"w-24 h-24 text-secondary/30 animate-pulse"}),t.jsx(ae,{className:"absolute inset-0 w-24 h-24 text-destructive/30 animate-pulse",style:{animationDelay:"0.5s"}})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center pt-4",children:[t.jsxs(k,{onClick:s,size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.3s"},children:[t.jsx(Z,{className:"mr-2 h-5 w-5"}),"Try Again"]}),t.jsxs(k,{onClick:()=>e("/"),variant:"outline",size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.5s"},children:[t.jsx(te,{className:"mr-2 h-5 w-5"}),"Go Home"]})]}),t.jsxs("div",{className:"flex justify-center gap-4 text-2xl pt-4",children:[t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:"üì°"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:"üåê"}),t.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.4s"},children:"üîå"})]})]})})},hs=l.lazy(()=>R(()=>import("./ParentAuth-C21C0EQa.js"),__vite__mapDeps([2,1,3,4,5,6,7,8]))),ps=l.lazy(()=>R(()=>import("./ParentDashboard-BebEP0qs.js"),__vite__mapDeps([9,1,3,4,5,10,6,11,12,13,14,15,16,8]))),xs=l.lazy(()=>R(()=>import("./ParentHome-qEwe4Fm4.js"),__vite__mapDeps([17,3,4,5,13,14,15,1,8]))),ys=l.lazy(()=>R(()=>import("./ParentChildrenList-Iultx56o.js"),__vite__mapDeps([18,3,4,5,13,12,10,6,11,14,15,1,8]))),vs=l.lazy(()=>R(()=>import("./ParentCallScreen-BwEswMu4.js"),__vite__mapDeps([19,3,4,5,20,21,1,8]))),ws=l.lazy(()=>R(()=>import("./DeviceManagement-BFbStljv.js"),__vite__mapDeps([22,3,4,5,23,24,6,11,13,14,15,1,8]))),bs=l.lazy(()=>R(()=>import("./Upgrade-DfDRvq7X.js"),__vite__mapDeps([25,3,4,5,13,14,15,1,11,6,7,16,8]))),Cs=l.lazy(()=>R(()=>import("./AccountSettings-qBtBZGBg.js"),__vite__mapDeps([26,3,4,5,13,14,15,1,16,8]))),_s=l.lazy(()=>R(()=>import("./ChildLogin-DJQ-bEyE.js"),__vite__mapDeps([27,1,3,4,5,15,8]))),Ns=l.lazy(()=>R(()=>import("./ChildDashboard-FBTOt4p0.js"),__vite__mapDeps([28,1,3,4,5,13,14,15,29,12,8]))),Ss=l.lazy(()=>R(()=>import("./ChildHome-B5PU_5A0.js"),__vite__mapDeps([30,3,4,5,13,14,15,1,8]))),Es=l.lazy(()=>R(()=>import("./ChildParentsList-DMcJttqc.js"),__vite__mapDeps([31,3,4,5,13,29,12,14,15,1,8]))),js=l.lazy(()=>R(()=>import("./ChildCallScreen-IbdI_xPx.js"),__vite__mapDeps([32,3,4,5,20,21,1,8]))),Is=l.lazy(()=>R(()=>import("./VideoCall-BumiNdfR.js"),__vite__mapDeps([33,3,4,5,20,1,8]))),As=l.lazy(()=>R(()=>import("./Chat-BQVPcN5b.js"),__vite__mapDeps([34,3,4,5,6,1,8]))),Ts=l.lazy(()=>R(()=>import("./Info-BMXzJQqb.js"),__vite__mapDeps([35,3,4,5,13,1,8]))),Ds=()=>t.jsx("div",{className:"flex items-center justify-center min-h-[100dvh]",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]"}),t.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"Loading..."})]})}),Rs=new yt,ks=()=>(Gt(),Ht(),null),Os=()=>(l.useEffect(()=>{Zt().catch(e=>{console.error("Failed to initialize native Android features:",e)})},[]),null),Ls=()=>{const e=L();return l.useEffect(()=>{if(!U())return;const s=async a=>{console.log("üì± Widget quick call received:",a.detail);const{childId:r}=a.detail||{};if(r){console.log("üì± Routing to child from widget:",r),e(`/parent/call/${r}`);return}const{loadWidgetData:i}=await R(async()=>{const{loadWidgetData:o}=await Promise.resolve().then(()=>cs);return{loadWidgetData:o}},void 0),n=i();n?.childId?(console.log("üì± Routing to last-called child:",n.childId),e(`/parent/call/${n.childId}`)):e("/parent/dashboard")};return window.addEventListener("widgetQuickCall",s),()=>{window.removeEventListener("widgetQuickCall",s)}},[e]),null},Ps=()=>(ds(),null),Bs=()=>(l.useEffect(()=>{if(sessionStorage.getItem("clearSessionOnClose")==="true"){const s=()=>{Object.keys(localStorage).filter(n=>n.startsWith("sb-")||n.includes("supabase")).forEach(n=>localStorage.removeItem(n)),m.auth.signOut().catch(()=>{})},a=()=>{s()},r=()=>{s()};return window.addEventListener("pagehide",a),window.addEventListener("beforeunload",r),()=>{window.removeEventListener("pagehide",a),window.removeEventListener("beforeunload",r)}}},[]),null),Ms=()=>t.jsx(Ft,{children:t.jsx(lt,{client:Rs,children:t.jsxs(Tt,{children:[t.jsx(ks,{}),t.jsx(Bs,{}),t.jsx(Os,{}),t.jsx(Ps,{}),t.jsx(Ls,{}),t.jsx(It,{}),t.jsx(At,{}),t.jsx(Rt,{className:"w-full overflow-x-hidden",children:t.jsxs(ct,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[t.jsx(ns,{}),t.jsx(rs,{}),t.jsx(is,{}),t.jsx(os,{}),t.jsx(l.Suspense,{fallback:t.jsx(Ds,{}),children:t.jsxs(dt,{children:[t.jsx(D,{path:"/",element:t.jsx(us,{})}),t.jsx(D,{path:"/parent/auth",element:t.jsx(hs,{})}),t.jsx(D,{path:"/parent",element:t.jsx(xs,{})}),t.jsx(D,{path:"/parent/children",element:t.jsx(ys,{})}),t.jsx(D,{path:"/parent/call/:childId",element:t.jsx(vs,{})}),t.jsx(D,{path:"/parent/dashboard",element:t.jsx(ps,{})}),t.jsx(D,{path:"/parent/devices",element:t.jsx(ws,{})}),t.jsx(D,{path:"/parent/upgrade",element:t.jsx(bs,{})}),t.jsx(D,{path:"/parent/settings",element:t.jsx(Cs,{})}),t.jsx(D,{path:"/child/login",element:t.jsx(_s,{})}),t.jsx(D,{path:"/child",element:t.jsx(Ss,{})}),t.jsx(D,{path:"/child/parents",element:t.jsx(Es,{})}),t.jsx(D,{path:"/child/call/:parentId",element:t.jsx(js,{})}),t.jsx(D,{path:"/child/dashboard",element:t.jsx(Ns,{})}),t.jsx(D,{path:"/call/:childId",element:t.jsx(Is,{})}),t.jsx(D,{path:"/chat/:childId",element:t.jsx(As,{})}),t.jsx(D,{path:"/info",element:t.jsx(Ts,{})}),t.jsx(D,{path:"/error/server",element:t.jsx(fs,{})}),t.jsx(D,{path:"/error/network",element:t.jsx(gs,{})}),t.jsx(D,{path:"*",element:t.jsx(ms,{})})]})})]})})]})})});{const e=()=>{};console.log=e,console.debug=e,console.info=e}const X=document.getElementById("root");if(!X){const e=new Error("Root element not found. Make sure index.html has a <div id='root'></div> element.");throw console.error("‚ùå [APP INIT]",e),document.body.innerHTML=`
    <div style="padding: 2rem; font-family: system-ui; max-width: 600px; margin: 2rem auto;">
      <h1 style="color: #dc2626;">Application Error</h1>
      <p style="color: #6b7280;">Root element not found.</p>
      <pre style="background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow: auto; margin-top: 1rem;">
${e.message}
      </pre>
    </div>
  `,e}try{A.log("‚öõÔ∏è [APP INIT] Creating React root...");const e=ut.createRoot(X);A.log("‚öõÔ∏è [APP INIT] Rendering App component..."),e.render(t.jsx(Ms,{})),A.log("‚úÖ [APP INIT] App rendered successfully")}catch(e){throw X.innerHTML=`
    <div style="padding: 2rem; font-family: system-ui; max-width: 600px; margin: 2rem auto;">
      <h1 style="color: #dc2626;">Application Error</h1>
      <p style="color: #6b7280;">Failed to initialize the application.</p>
      <pre style="background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow: auto; margin-top: 1rem; white-space: pre-wrap;">
${e instanceof Error?e.message+`

`+e.stack:String(e)}
      </pre>
      <button 
        onclick="window.location.reload()" 
        style="margin-top: 1rem; padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 0.25rem; cursor: pointer;"
      >
        Reload Page
      </button>
      <p style="margin-top: 1rem; font-size: 0.875rem; color: #6b7280;">
        Check the browser console (F12) for more details.
      </p>
    </div>
  `,e}export{ss as A,k as B,V as C,A as a,$ as b,T as c,Gs as d,Js as e,Ws as f,Me as g,Ue as h,Ve as i,Fe as j,qe as k,Ge as l,ze as m,Jt as n,I as o,Hs as p,$s as q,Kt as r,m as s,le as t,je as u,Ks as v,Oe as w};

function Yw(e,t){for(var n=0;n<t.length;n++){const s=t[n];if(typeof s!="string"&&!Array.isArray(s)){for(const o in s)if(o!=="default"&&!(o in e)){const l=Object.getOwnPropertyDescriptor(s,o);l&&Object.defineProperty(e,o,l.get?l:{enumerable:!0,get:()=>s[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();function Yf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function lN(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var n=function s(){var o=!1;try{o=this instanceof s}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var o=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:function(){return e[s]}})}),n}var mh={exports:{}},Gi={},ph={exports:{}},qe={};var Mv;function cN(){if(Mv)return qe;Mv=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),v=Symbol.iterator;function b(F){return F===null||typeof F!="object"?null:(F=v&&F[v]||F["@@iterator"],typeof F=="function"?F:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,C={};function w(F,ee,ce){this.props=F,this.context=ee,this.refs=C,this.updater=ce||x}w.prototype.isReactComponent={},w.prototype.setState=function(F,ee){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,ee,"setState")},w.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function N(){}N.prototype=w.prototype;function _(F,ee,ce){this.props=F,this.context=ee,this.refs=C,this.updater=ce||x}var j=_.prototype=new N;j.constructor=_,S(j,w.prototype),j.isPureReactComponent=!0;var T=Array.isArray,R=Object.prototype.hasOwnProperty,A={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function L(F,ee,ce){var K,W={},ne=null,G=null;if(ee!=null)for(K in ee.ref!==void 0&&(G=ee.ref),ee.key!==void 0&&(ne=""+ee.key),ee)R.call(ee,K)&&!I.hasOwnProperty(K)&&(W[K]=ee[K]);var ae=arguments.length-2;if(ae===1)W.children=ce;else if(1<ae){for(var fe=Array(ae),ve=0;ve<ae;ve++)fe[ve]=arguments[ve+2];W.children=fe}if(F&&F.defaultProps)for(K in ae=F.defaultProps,ae)W[K]===void 0&&(W[K]=ae[K]);return{$$typeof:e,type:F,key:ne,ref:G,props:W,_owner:A.current}}function Z(F,ee){return{$$typeof:e,type:F.type,key:ee,ref:F.ref,props:F.props,_owner:F._owner}}function M(F){return typeof F=="object"&&F!==null&&F.$$typeof===e}function U(F){var ee={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(ce){return ee[ce]})}var D=/\/+/g;function B(F,ee){return typeof F=="object"&&F!==null&&F.key!=null?U(""+F.key):ee.toString(36)}function z(F,ee,ce,K,W){var ne=typeof F;(ne==="undefined"||ne==="boolean")&&(F=null);var G=!1;if(F===null)G=!0;else switch(ne){case"string":case"number":G=!0;break;case"object":switch(F.$$typeof){case e:case t:G=!0}}if(G)return G=F,W=W(G),F=K===""?"."+B(G,0):K,T(W)?(ce="",F!=null&&(ce=F.replace(D,"$&/")+"/"),z(W,ee,ce,"",function(ve){return ve})):W!=null&&(M(W)&&(W=Z(W,ce+(!W.key||G&&G.key===W.key?"":(""+W.key).replace(D,"$&/")+"/")+F)),ee.push(W)),1;if(G=0,K=K===""?".":K+":",T(F))for(var ae=0;ae<F.length;ae++){ne=F[ae];var fe=K+B(ne,ae);G+=z(ne,ee,ce,fe,W)}else if(fe=b(F),typeof fe=="function")for(F=fe.call(F),ae=0;!(ne=F.next()).done;)ne=ne.value,fe=K+B(ne,ae++),G+=z(ne,ee,ce,fe,W);else if(ne==="object")throw ee=String(F),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.");return G}function q(F,ee,ce){if(F==null)return F;var K=[],W=0;return z(F,K,"","",function(ne){return ee.call(ce,ne,W++)}),K}function H(F){if(F._status===-1){var ee=F._result;ee=ee(),ee.then(function(ce){(F._status===0||F._status===-1)&&(F._status=1,F._result=ce)},function(ce){(F._status===0||F._status===-1)&&(F._status=2,F._result=ce)}),F._status===-1&&(F._status=0,F._result=ee)}if(F._status===1)return F._result.default;throw F._result}var Q={current:null},$={transition:null},O={ReactCurrentDispatcher:Q,ReactCurrentBatchConfig:$,ReactCurrentOwner:A};function J(){throw Error("act(...) is not supported in production builds of React.")}return qe.Children={map:q,forEach:function(F,ee,ce){q(F,function(){ee.apply(this,arguments)},ce)},count:function(F){var ee=0;return q(F,function(){ee++}),ee},toArray:function(F){return q(F,function(ee){return ee})||[]},only:function(F){if(!M(F))throw Error("React.Children.only expected to receive a single React element child.");return F}},qe.Component=w,qe.Fragment=n,qe.Profiler=o,qe.PureComponent=_,qe.StrictMode=s,qe.Suspense=h,qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,qe.act=J,qe.cloneElement=function(F,ee,ce){if(F==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+F+".");var K=S({},F.props),W=F.key,ne=F.ref,G=F._owner;if(ee!=null){if(ee.ref!==void 0&&(ne=ee.ref,G=A.current),ee.key!==void 0&&(W=""+ee.key),F.type&&F.type.defaultProps)var ae=F.type.defaultProps;for(fe in ee)R.call(ee,fe)&&!I.hasOwnProperty(fe)&&(K[fe]=ee[fe]===void 0&&ae!==void 0?ae[fe]:ee[fe])}var fe=arguments.length-2;if(fe===1)K.children=ce;else if(1<fe){ae=Array(fe);for(var ve=0;ve<fe;ve++)ae[ve]=arguments[ve+2];K.children=ae}return{$$typeof:e,type:F.type,key:W,ref:ne,props:K,_owner:G}},qe.createContext=function(F){return F={$$typeof:c,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},F.Provider={$$typeof:l,_context:F},F.Consumer=F},qe.createElement=L,qe.createFactory=function(F){var ee=L.bind(null,F);return ee.type=F,ee},qe.createRef=function(){return{current:null}},qe.forwardRef=function(F){return{$$typeof:u,render:F}},qe.isValidElement=M,qe.lazy=function(F){return{$$typeof:g,_payload:{_status:-1,_result:F},_init:H}},qe.memo=function(F,ee){return{$$typeof:f,type:F,compare:ee===void 0?null:ee}},qe.startTransition=function(F){var ee=$.transition;$.transition={};try{F()}finally{$.transition=ee}},qe.unstable_act=J,qe.useCallback=function(F,ee){return Q.current.useCallback(F,ee)},qe.useContext=function(F){return Q.current.useContext(F)},qe.useDebugValue=function(){},qe.useDeferredValue=function(F){return Q.current.useDeferredValue(F)},qe.useEffect=function(F,ee){return Q.current.useEffect(F,ee)},qe.useId=function(){return Q.current.useId()},qe.useImperativeHandle=function(F,ee,ce){return Q.current.useImperativeHandle(F,ee,ce)},qe.useInsertionEffect=function(F,ee){return Q.current.useInsertionEffect(F,ee)},qe.useLayoutEffect=function(F,ee){return Q.current.useLayoutEffect(F,ee)},qe.useMemo=function(F,ee){return Q.current.useMemo(F,ee)},qe.useReducer=function(F,ee,ce){return Q.current.useReducer(F,ee,ce)},qe.useRef=function(F){return Q.current.useRef(F)},qe.useState=function(F){return Q.current.useState(F)},qe.useSyncExternalStore=function(F,ee,ce){return Q.current.useSyncExternalStore(F,ee,ce)},qe.useTransition=function(){return Q.current.useTransition()},qe.version="18.3.1",qe}var $v;function Jf(){return $v||($v=1,ph.exports=cN()),ph.exports}var Fv;function dN(){if(Fv)return Gi;Fv=1;var e=Jf(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(u,h,f){var g,v={},b=null,x=null;f!==void 0&&(b=""+f),h.key!==void 0&&(b=""+h.key),h.ref!==void 0&&(x=h.ref);for(g in h)s.call(h,g)&&!l.hasOwnProperty(g)&&(v[g]=h[g]);if(u&&u.defaultProps)for(g in h=u.defaultProps,h)v[g]===void 0&&(v[g]=h[g]);return{$$typeof:t,type:u,key:b,ref:x,props:v,_owner:o.current}}return Gi.Fragment=n,Gi.jsx=c,Gi.jsxs=c,Gi}var Uv;function uN(){return Uv||(Uv=1,mh.exports=dN()),mh.exports}var i=uN(),Jl={},gh={exports:{}},ln={},vh={exports:{}},yh={};var Bv;function hN(){return Bv||(Bv=1,(function(e){function t($,O){var J=$.length;$.push(O);e:for(;0<J;){var F=J-1>>>1,ee=$[F];if(0<o(ee,O))$[F]=O,$[J]=ee,J=F;else break e}}function n($){return $.length===0?null:$[0]}function s($){if($.length===0)return null;var O=$[0],J=$.pop();if(J!==O){$[0]=J;e:for(var F=0,ee=$.length,ce=ee>>>1;F<ce;){var K=2*(F+1)-1,W=$[K],ne=K+1,G=$[ne];if(0>o(W,J))ne<ee&&0>o(G,W)?($[F]=G,$[ne]=J,F=ne):($[F]=W,$[K]=J,F=K);else if(ne<ee&&0>o(G,J))$[F]=G,$[ne]=J,F=ne;else break e}}return O}function o($,O){var J=$.sortIndex-O.sortIndex;return J!==0?J:$.id-O.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();e.unstable_now=function(){return c.now()-u}}var h=[],f=[],g=1,v=null,b=3,x=!1,S=!1,C=!1,w=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function j($){for(var O=n(f);O!==null;){if(O.callback===null)s(f);else if(O.startTime<=$)s(f),O.sortIndex=O.expirationTime,t(h,O);else break;O=n(f)}}function T($){if(C=!1,j($),!S)if(n(h)!==null)S=!0,H(R);else{var O=n(f);O!==null&&Q(T,O.startTime-$)}}function R($,O){S=!1,C&&(C=!1,N(L),L=-1),x=!0;var J=b;try{for(j(O),v=n(h);v!==null&&(!(v.expirationTime>O)||$&&!U());){var F=v.callback;if(typeof F=="function"){v.callback=null,b=v.priorityLevel;var ee=F(v.expirationTime<=O);O=e.unstable_now(),typeof ee=="function"?v.callback=ee:v===n(h)&&s(h),j(O)}else s(h);v=n(h)}if(v!==null)var ce=!0;else{var K=n(f);K!==null&&Q(T,K.startTime-O),ce=!1}return ce}finally{v=null,b=J,x=!1}}var A=!1,I=null,L=-1,Z=5,M=-1;function U(){return!(e.unstable_now()-M<Z)}function D(){if(I!==null){var $=e.unstable_now();M=$;var O=!0;try{O=I(!0,$)}finally{O?B():(A=!1,I=null)}}else A=!1}var B;if(typeof _=="function")B=function(){_(D)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,q=z.port2;z.port1.onmessage=D,B=function(){q.postMessage(null)}}else B=function(){w(D,0)};function H($){I=$,A||(A=!0,B())}function Q($,O){L=w(function(){$(e.unstable_now())},O)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function($){$.callback=null},e.unstable_continueExecution=function(){S||x||(S=!0,H(R))},e.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<$?Math.floor(1e3/$):5},e.unstable_getCurrentPriorityLevel=function(){return b},e.unstable_getFirstCallbackNode=function(){return n(h)},e.unstable_next=function($){switch(b){case 1:case 2:case 3:var O=3;break;default:O=b}var J=b;b=O;try{return $()}finally{b=J}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function($,O){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var J=b;b=$;try{return O()}finally{b=J}},e.unstable_scheduleCallback=function($,O,J){var F=e.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?F+J:F):J=F,$){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=J+ee,$={id:g++,callback:O,priorityLevel:$,startTime:J,expirationTime:ee,sortIndex:-1},J>F?($.sortIndex=J,t(f,$),n(h)===null&&$===n(f)&&(C?(N(L),L=-1):C=!0,Q(T,J-F))):($.sortIndex=ee,t(h,$),S||x||(S=!0,H(R))),$},e.unstable_shouldYield=U,e.unstable_wrapCallback=function($){var O=b;return function(){var J=b;b=O;try{return $.apply(this,arguments)}finally{b=J}}}})(yh)),yh}var zv;function fN(){return zv||(zv=1,vh.exports=hN()),vh.exports}var Hv;function mN(){if(Hv)return ln;Hv=1;var e=Jf(),t=fN();function n(r){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+r,d=1;d<arguments.length;d++)a+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,o={};function l(r,a){c(r,a),c(r+"Capture",a)}function c(r,a){for(o[r]=a,r=0;r<a.length;r++)s.add(a[r])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},v={};function b(r){return h.call(v,r)?!0:h.call(g,r)?!1:f.test(r)?v[r]=!0:(g[r]=!0,!1)}function x(r,a,d,m){if(d!==null&&d.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return m?!1:d!==null?!d.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function S(r,a,d,m){if(a===null||typeof a>"u"||x(r,a,d,m))return!0;if(m)return!1;if(d!==null)switch(d.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function C(r,a,d,m,y,E,P){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=m,this.attributeNamespace=y,this.mustUseProperty=d,this.propertyName=r,this.type=a,this.sanitizeURL=E,this.removeEmptyString=P}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){w[r]=new C(r,0,!1,r,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var a=r[0];w[a]=new C(a,1,!1,r[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(r){w[r]=new C(r,2,!1,r.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){w[r]=new C(r,2,!1,r,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){w[r]=new C(r,3,!1,r.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(r){w[r]=new C(r,3,!0,r,null,!1,!1)}),["capture","download"].forEach(function(r){w[r]=new C(r,4,!1,r,null,!1,!1)}),["cols","rows","size","span"].forEach(function(r){w[r]=new C(r,6,!1,r,null,!1,!1)}),["rowSpan","start"].forEach(function(r){w[r]=new C(r,5,!1,r.toLowerCase(),null,!1,!1)});var N=/[\-:]([a-z])/g;function _(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var a=r.replace(N,_);w[a]=new C(a,1,!1,r,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var a=r.replace(N,_);w[a]=new C(a,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(r){var a=r.replace(N,_);w[a]=new C(a,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(r){w[r]=new C(r,1,!1,r.toLowerCase(),null,!1,!1)}),w.xlinkHref=new C("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(r){w[r]=new C(r,1,!1,r.toLowerCase(),null,!0,!0)});function j(r,a,d,m){var y=w.hasOwnProperty(a)?w[a]:null;(y!==null?y.type!==0:m||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(S(a,d,y,m)&&(d=null),m||y===null?b(a)&&(d===null?r.removeAttribute(a):r.setAttribute(a,""+d)):y.mustUseProperty?r[y.propertyName]=d===null?y.type===3?!1:"":d:(a=y.attributeName,m=y.attributeNamespace,d===null?r.removeAttribute(a):(y=y.type,d=y===3||y===4&&d===!0?"":""+d,m?r.setAttributeNS(m,a,d):r.setAttribute(a,d))))}var T=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,R=Symbol.for("react.element"),A=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),Z=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),U=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),Q=Symbol.for("react.offscreen"),$=Symbol.iterator;function O(r){return r===null||typeof r!="object"?null:(r=$&&r[$]||r["@@iterator"],typeof r=="function"?r:null)}var J=Object.assign,F;function ee(r){if(F===void 0)try{throw Error()}catch(d){var a=d.stack.trim().match(/\n( *(at )?)/);F=a&&a[1]||""}return`
`+F+r}var ce=!1;function K(r,a){if(!r||ce)return"";ce=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(oe){var m=oe}Reflect.construct(r,[],a)}else{try{a.call()}catch(oe){m=oe}r.call(a.prototype)}else{try{throw Error()}catch(oe){m=oe}r()}}catch(oe){if(oe&&m&&typeof oe.stack=="string"){for(var y=oe.stack.split(`
`),E=m.stack.split(`
`),P=y.length-1,V=E.length-1;1<=P&&0<=V&&y[P]!==E[V];)V--;for(;1<=P&&0<=V;P--,V--)if(y[P]!==E[V]){if(P!==1||V!==1)do if(P--,V--,0>V||y[P]!==E[V]){var X=`
`+y[P].replace(" at new "," at ");return r.displayName&&X.includes("<anonymous>")&&(X=X.replace("<anonymous>",r.displayName)),X}while(1<=P&&0<=V);break}}}finally{ce=!1,Error.prepareStackTrace=d}return(r=r?r.displayName||r.name:"")?ee(r):""}function W(r){switch(r.tag){case 5:return ee(r.type);case 16:return ee("Lazy");case 13:return ee("Suspense");case 19:return ee("SuspenseList");case 0:case 2:case 15:return r=K(r.type,!1),r;case 11:return r=K(r.type.render,!1),r;case 1:return r=K(r.type,!0),r;default:return""}}function ne(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case I:return"Fragment";case A:return"Portal";case Z:return"Profiler";case L:return"StrictMode";case B:return"Suspense";case z:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case U:return(r.displayName||"Context")+".Consumer";case M:return(r._context.displayName||"Context")+".Provider";case D:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case q:return a=r.displayName||null,a!==null?a:ne(r.type)||"Memo";case H:a=r._payload,r=r._init;try{return ne(r(a))}catch{}}return null}function G(r){var a=r.type;switch(r.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=a.render,r=r.displayName||r.name||"",a.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ne(a);case 8:return a===L?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function ae(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function fe(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function ve(r){var a=fe(r)?"checked":"value",d=Object.getOwnPropertyDescriptor(r.constructor.prototype,a),m=""+r[a];if(!r.hasOwnProperty(a)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var y=d.get,E=d.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return y.call(this)},set:function(P){m=""+P,E.call(this,P)}}),Object.defineProperty(r,a,{enumerable:d.enumerable}),{getValue:function(){return m},setValue:function(P){m=""+P},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function xe(r){r._valueTracker||(r._valueTracker=ve(r))}function Ie(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var d=a.getValue(),m="";return r&&(m=fe(r)?r.checked?"true":"false":r.value),r=m,r!==d?(a.setValue(r),!0):!1}function $e(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Ke(r,a){var d=a.checked;return J({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??r._wrapperState.initialChecked})}function Ve(r,a){var d=a.defaultValue==null?"":a.defaultValue,m=a.checked!=null?a.checked:a.defaultChecked;d=ae(a.value!=null?a.value:d),r._wrapperState={initialChecked:m,initialValue:d,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function ie(r,a){a=a.checked,a!=null&&j(r,"checked",a,!1)}function Re(r,a){ie(r,a);var d=ae(a.value),m=a.type;if(d!=null)m==="number"?(d===0&&r.value===""||r.value!=d)&&(r.value=""+d):r.value!==""+d&&(r.value=""+d);else if(m==="submit"||m==="reset"){r.removeAttribute("value");return}a.hasOwnProperty("value")?ye(r,a.type,d):a.hasOwnProperty("defaultValue")&&ye(r,a.type,ae(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(r.defaultChecked=!!a.defaultChecked)}function le(r,a,d){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var m=a.type;if(!(m!=="submit"&&m!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+r._wrapperState.initialValue,d||a===r.value||(r.value=a),r.defaultValue=a}d=r.name,d!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,d!==""&&(r.name=d)}function ye(r,a,d){(a!=="number"||$e(r.ownerDocument)!==r)&&(d==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+d&&(r.defaultValue=""+d))}var je=Array.isArray;function ze(r,a,d,m){if(r=r.options,a){a={};for(var y=0;y<d.length;y++)a["$"+d[y]]=!0;for(d=0;d<r.length;d++)y=a.hasOwnProperty("$"+r[d].value),r[d].selected!==y&&(r[d].selected=y),y&&m&&(r[d].defaultSelected=!0)}else{for(d=""+ae(d),a=null,y=0;y<r.length;y++){if(r[y].value===d){r[y].selected=!0,m&&(r[y].defaultSelected=!0);return}a!==null||r[y].disabled||(a=r[y])}a!==null&&(a.selected=!0)}}function dt(r,a){if(a.dangerouslySetInnerHTML!=null)throw Error(n(91));return J({},a,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function Je(r,a){var d=a.value;if(d==null){if(d=a.children,a=a.defaultValue,d!=null){if(a!=null)throw Error(n(92));if(je(d)){if(1<d.length)throw Error(n(93));d=d[0]}a=d}a==null&&(a=""),d=a}r._wrapperState={initialValue:ae(d)}}function pt(r,a){var d=ae(a.value),m=ae(a.defaultValue);d!=null&&(d=""+d,d!==r.value&&(r.value=d),a.defaultValue==null&&r.defaultValue!==d&&(r.defaultValue=d)),m!=null&&(r.defaultValue=""+m)}function st(r){var a=r.textContent;a===r._wrapperState.initialValue&&a!==""&&a!==null&&(r.value=a)}function gt(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function We(r,a){return r==null||r==="http://www.w3.org/1999/xhtml"?gt(a):r==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Ue,Bt=(function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,d,m,y){MSApp.execUnsafeLocalFunction(function(){return r(a,d,m,y)})}:r})(function(r,a){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=a;else{for(Ue=Ue||document.createElement("div"),Ue.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=Ue.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;a.firstChild;)r.appendChild(a.firstChild)}});function Rt(r,a){if(a){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=a;return}}r.textContent=a}var Cr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},js=["Webkit","ms","Moz","O"];Object.keys(Cr).forEach(function(r){js.forEach(function(a){a=a+r.charAt(0).toUpperCase()+r.substring(1),Cr[a]=Cr[r]})});function Br(r,a,d){return a==null||typeof a=="boolean"||a===""?"":d||typeof a!="number"||a===0||Cr.hasOwnProperty(r)&&Cr[r]?(""+a).trim():a+"px"}function Sr(r,a){r=r.style;for(var d in a)if(a.hasOwnProperty(d)){var m=d.indexOf("--")===0,y=Br(d,a[d],m);d==="float"&&(d="cssFloat"),m?r.setProperty(d,y):r[d]=y}}var Bo=J({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ar(r,a){if(a){if(Bo[r]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(n(137,r));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(n(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(n(61))}if(a.style!=null&&typeof a.style!="object")throw Error(n(62))}}function ui(r,a){if(r.indexOf("-")===-1)return typeof a.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hi=null;function ia(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var oa=null,zr=null,ir=null;function Fn(r){if(r=Ri(r)){if(typeof oa!="function")throw Error(n(280));var a=r.stateNode;a&&(a=ul(a),oa(r.stateNode,r.type,a))}}function zo(r){zr?ir?ir.push(r):ir=[r]:zr=r}function Be(){if(zr){var r=zr,a=ir;if(ir=zr=null,Fn(r),a)for(r=0;r<a.length;r++)Fn(a[r])}}function Ze(r,a){return r(a)}function nt(){}var Gt=!1;function en(r,a,d){if(Gt)return r(a,d);Gt=!0;try{return Ze(r,a,d)}finally{Gt=!1,(zr!==null||ir!==null)&&(nt(),Be())}}function tn(r,a){var d=r.stateNode;if(d===null)return null;var m=ul(d);if(m===null)return null;d=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(r=r.type,m=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!m;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(n(231,a,typeof d));return d}var Un=!1;if(u)try{var It={};Object.defineProperty(It,"passive",{get:function(){Un=!0}}),window.addEventListener("test",It,It),window.removeEventListener("test",It,It)}catch{Un=!1}function or(r,a,d,m,y,E,P,V,X){var oe=Array.prototype.slice.call(arguments,3);try{a.apply(d,oe)}catch(he){this.onError(he)}}var fi=!1,Ho=null,Vo=!1,Id=null,p_={onError:function(r){fi=!0,Ho=r}};function g_(r,a,d,m,y,E,P,V,X){fi=!1,Ho=null,or.apply(p_,arguments)}function v_(r,a,d,m,y,E,P,V,X){if(g_.apply(this,arguments),fi){if(fi){var oe=Ho;fi=!1,Ho=null}else throw Error(n(198));Vo||(Vo=!0,Id=oe)}}function ks(r){var a=r,d=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(d=a.return),r=a.return;while(r)}return a.tag===3?d:null}function ip(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function op(r){if(ks(r)!==r)throw Error(n(188))}function y_(r){var a=r.alternate;if(!a){if(a=ks(r),a===null)throw Error(n(188));return a!==r?null:r}for(var d=r,m=a;;){var y=d.return;if(y===null)break;var E=y.alternate;if(E===null){if(m=y.return,m!==null){d=m;continue}break}if(y.child===E.child){for(E=y.child;E;){if(E===d)return op(y),r;if(E===m)return op(y),a;E=E.sibling}throw Error(n(188))}if(d.return!==m.return)d=y,m=E;else{for(var P=!1,V=y.child;V;){if(V===d){P=!0,d=y,m=E;break}if(V===m){P=!0,m=y,d=E;break}V=V.sibling}if(!P){for(V=E.child;V;){if(V===d){P=!0,d=E,m=y;break}if(V===m){P=!0,m=E,d=y;break}V=V.sibling}if(!P)throw Error(n(189))}}if(d.alternate!==m)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?r:a}function lp(r){return r=y_(r),r!==null?cp(r):null}function cp(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var a=cp(r);if(a!==null)return a;r=r.sibling}return null}var dp=t.unstable_scheduleCallback,up=t.unstable_cancelCallback,w_=t.unstable_shouldYield,x_=t.unstable_requestPaint,xt=t.unstable_now,b_=t.unstable_getCurrentPriorityLevel,Dd=t.unstable_ImmediatePriority,hp=t.unstable_UserBlockingPriority,qo=t.unstable_NormalPriority,C_=t.unstable_LowPriority,fp=t.unstable_IdlePriority,Wo=null,lr=null;function S_(r){if(lr&&typeof lr.onCommitFiberRoot=="function")try{lr.onCommitFiberRoot(Wo,r,void 0,(r.current.flags&128)===128)}catch{}}var Bn=Math.clz32?Math.clz32:N_,E_=Math.log,__=Math.LN2;function N_(r){return r>>>=0,r===0?32:31-(E_(r)/__|0)|0}var Go=64,Ko=4194304;function mi(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Yo(r,a){var d=r.pendingLanes;if(d===0)return 0;var m=0,y=r.suspendedLanes,E=r.pingedLanes,P=d&268435455;if(P!==0){var V=P&~y;V!==0?m=mi(V):(E&=P,E!==0&&(m=mi(E)))}else P=d&~y,P!==0?m=mi(P):E!==0&&(m=mi(E));if(m===0)return 0;if(a!==0&&a!==m&&(a&y)===0&&(y=m&-m,E=a&-a,y>=E||y===16&&(E&4194240)!==0))return a;if((m&4)!==0&&(m|=d&16),a=r.entangledLanes,a!==0)for(r=r.entanglements,a&=m;0<a;)d=31-Bn(a),y=1<<d,m|=r[d],a&=~y;return m}function j_(r,a){switch(r){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function k_(r,a){for(var d=r.suspendedLanes,m=r.pingedLanes,y=r.expirationTimes,E=r.pendingLanes;0<E;){var P=31-Bn(E),V=1<<P,X=y[P];X===-1?((V&d)===0||(V&m)!==0)&&(y[P]=j_(V,a)):X<=a&&(r.expiredLanes|=V),E&=~V}}function Od(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function mp(){var r=Go;return Go<<=1,(Go&4194240)===0&&(Go=64),r}function Ld(r){for(var a=[],d=0;31>d;d++)a.push(r);return a}function pi(r,a,d){r.pendingLanes|=a,a!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,a=31-Bn(a),r[a]=d}function T_(r,a){var d=r.pendingLanes&~a;r.pendingLanes=a,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=a,r.mutableReadLanes&=a,r.entangledLanes&=a,a=r.entanglements;var m=r.eventTimes;for(r=r.expirationTimes;0<d;){var y=31-Bn(d),E=1<<y;a[y]=0,m[y]=-1,r[y]=-1,d&=~E}}function Md(r,a){var d=r.entangledLanes|=a;for(r=r.entanglements;d;){var m=31-Bn(d),y=1<<m;y&a|r[m]&a&&(r[m]|=a),d&=~y}}var et=0;function pp(r){return r&=-r,1<r?4<r?(r&268435455)!==0?16:536870912:4:1}var gp,$d,vp,yp,wp,Fd=!1,Jo=[],Hr=null,Vr=null,qr=null,gi=new Map,vi=new Map,Wr=[],A_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xp(r,a){switch(r){case"focusin":case"focusout":Hr=null;break;case"dragenter":case"dragleave":Vr=null;break;case"mouseover":case"mouseout":qr=null;break;case"pointerover":case"pointerout":gi.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":vi.delete(a.pointerId)}}function yi(r,a,d,m,y,E){return r===null||r.nativeEvent!==E?(r={blockedOn:a,domEventName:d,eventSystemFlags:m,nativeEvent:E,targetContainers:[y]},a!==null&&(a=Ri(a),a!==null&&$d(a)),r):(r.eventSystemFlags|=m,a=r.targetContainers,y!==null&&a.indexOf(y)===-1&&a.push(y),r)}function P_(r,a,d,m,y){switch(a){case"focusin":return Hr=yi(Hr,r,a,d,m,y),!0;case"dragenter":return Vr=yi(Vr,r,a,d,m,y),!0;case"mouseover":return qr=yi(qr,r,a,d,m,y),!0;case"pointerover":var E=y.pointerId;return gi.set(E,yi(gi.get(E)||null,r,a,d,m,y)),!0;case"gotpointercapture":return E=y.pointerId,vi.set(E,yi(vi.get(E)||null,r,a,d,m,y)),!0}return!1}function bp(r){var a=Ts(r.target);if(a!==null){var d=ks(a);if(d!==null){if(a=d.tag,a===13){if(a=ip(d),a!==null){r.blockedOn=a,wp(r.priority,function(){vp(d)});return}}else if(a===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Qo(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var d=Bd(r.domEventName,r.eventSystemFlags,a[0],r.nativeEvent);if(d===null){d=r.nativeEvent;var m=new d.constructor(d.type,d);hi=m,d.target.dispatchEvent(m),hi=null}else return a=Ri(d),a!==null&&$d(a),r.blockedOn=d,!1;a.shift()}return!0}function Cp(r,a,d){Qo(r)&&d.delete(a)}function R_(){Fd=!1,Hr!==null&&Qo(Hr)&&(Hr=null),Vr!==null&&Qo(Vr)&&(Vr=null),qr!==null&&Qo(qr)&&(qr=null),gi.forEach(Cp),vi.forEach(Cp)}function wi(r,a){r.blockedOn===a&&(r.blockedOn=null,Fd||(Fd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,R_)))}function xi(r){function a(y){return wi(y,r)}if(0<Jo.length){wi(Jo[0],r);for(var d=1;d<Jo.length;d++){var m=Jo[d];m.blockedOn===r&&(m.blockedOn=null)}}for(Hr!==null&&wi(Hr,r),Vr!==null&&wi(Vr,r),qr!==null&&wi(qr,r),gi.forEach(a),vi.forEach(a),d=0;d<Wr.length;d++)m=Wr[d],m.blockedOn===r&&(m.blockedOn=null);for(;0<Wr.length&&(d=Wr[0],d.blockedOn===null);)bp(d),d.blockedOn===null&&Wr.shift()}var la=T.ReactCurrentBatchConfig,Xo=!0;function I_(r,a,d,m){var y=et,E=la.transition;la.transition=null;try{et=1,Ud(r,a,d,m)}finally{et=y,la.transition=E}}function D_(r,a,d,m){var y=et,E=la.transition;la.transition=null;try{et=4,Ud(r,a,d,m)}finally{et=y,la.transition=E}}function Ud(r,a,d,m){if(Xo){var y=Bd(r,a,d,m);if(y===null)su(r,a,m,Zo,d),xp(r,m);else if(P_(y,r,a,d,m))m.stopPropagation();else if(xp(r,m),a&4&&-1<A_.indexOf(r)){for(;y!==null;){var E=Ri(y);if(E!==null&&gp(E),E=Bd(r,a,d,m),E===null&&su(r,a,m,Zo,d),E===y)break;y=E}y!==null&&m.stopPropagation()}else su(r,a,m,null,d)}}var Zo=null;function Bd(r,a,d,m){if(Zo=null,r=ia(m),r=Ts(r),r!==null)if(a=ks(r),a===null)r=null;else if(d=a.tag,d===13){if(r=ip(a),r!==null)return r;r=null}else if(d===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null);return Zo=r,null}function Sp(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(b_()){case Dd:return 1;case hp:return 4;case qo:case C_:return 16;case fp:return 536870912;default:return 16}default:return 16}}var Gr=null,zd=null,el=null;function Ep(){if(el)return el;var r,a=zd,d=a.length,m,y="value"in Gr?Gr.value:Gr.textContent,E=y.length;for(r=0;r<d&&a[r]===y[r];r++);var P=d-r;for(m=1;m<=P&&a[d-m]===y[E-m];m++);return el=y.slice(r,1<m?1-m:void 0)}function tl(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function nl(){return!0}function _p(){return!1}function hn(r){function a(d,m,y,E,P){this._reactName=d,this._targetInst=y,this.type=m,this.nativeEvent=E,this.target=P,this.currentTarget=null;for(var V in r)r.hasOwnProperty(V)&&(d=r[V],this[V]=d?d(E):E[V]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?nl:_p,this.isPropagationStopped=_p,this}return J(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=nl)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=nl)},persist:function(){},isPersistent:nl}),a}var ca={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hd=hn(ca),bi=J({},ca,{view:0,detail:0}),O_=hn(bi),Vd,qd,Ci,rl=J({},bi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gd,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ci&&(Ci&&r.type==="mousemove"?(Vd=r.screenX-Ci.screenX,qd=r.screenY-Ci.screenY):qd=Vd=0,Ci=r),Vd)},movementY:function(r){return"movementY"in r?r.movementY:qd}}),Np=hn(rl),L_=J({},rl,{dataTransfer:0}),M_=hn(L_),$_=J({},bi,{relatedTarget:0}),Wd=hn($_),F_=J({},ca,{animationName:0,elapsedTime:0,pseudoElement:0}),U_=hn(F_),B_=J({},ca,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),z_=hn(B_),H_=J({},ca,{data:0}),jp=hn(H_),V_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},q_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},W_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function G_(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=W_[r])?!!a[r]:!1}function Gd(){return G_}var K_=J({},bi,{key:function(r){if(r.key){var a=V_[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=tl(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?q_[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gd,charCode:function(r){return r.type==="keypress"?tl(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?tl(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Y_=hn(K_),J_=J({},rl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kp=hn(J_),Q_=J({},bi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gd}),X_=hn(Q_),Z_=J({},ca,{propertyName:0,elapsedTime:0,pseudoElement:0}),e1=hn(Z_),t1=J({},rl,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),n1=hn(t1),r1=[9,13,27,32],Kd=u&&"CompositionEvent"in window,Si=null;u&&"documentMode"in document&&(Si=document.documentMode);var s1=u&&"TextEvent"in window&&!Si,Tp=u&&(!Kd||Si&&8<Si&&11>=Si),Ap=" ",Pp=!1;function Rp(r,a){switch(r){case"keyup":return r1.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ip(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var da=!1;function a1(r,a){switch(r){case"compositionend":return Ip(a);case"keypress":return a.which!==32?null:(Pp=!0,Ap);case"textInput":return r=a.data,r===Ap&&Pp?null:r;default:return null}}function i1(r,a){if(da)return r==="compositionend"||!Kd&&Rp(r,a)?(r=Ep(),el=zd=Gr=null,da=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Tp&&a.locale!=="ko"?null:a.data;default:return null}}var o1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dp(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!o1[r.type]:a==="textarea"}function Op(r,a,d,m){zo(m),a=ll(a,"onChange"),0<a.length&&(d=new Hd("onChange","change",null,d,m),r.push({event:d,listeners:a}))}var Ei=null,_i=null;function l1(r){Zp(r,0)}function sl(r){var a=pa(r);if(Ie(a))return r}function c1(r,a){if(r==="change")return a}var Lp=!1;if(u){var Yd;if(u){var Jd="oninput"in document;if(!Jd){var Mp=document.createElement("div");Mp.setAttribute("oninput","return;"),Jd=typeof Mp.oninput=="function"}Yd=Jd}else Yd=!1;Lp=Yd&&(!document.documentMode||9<document.documentMode)}function $p(){Ei&&(Ei.detachEvent("onpropertychange",Fp),_i=Ei=null)}function Fp(r){if(r.propertyName==="value"&&sl(_i)){var a=[];Op(a,_i,r,ia(r)),en(l1,a)}}function d1(r,a,d){r==="focusin"?($p(),Ei=a,_i=d,Ei.attachEvent("onpropertychange",Fp)):r==="focusout"&&$p()}function u1(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return sl(_i)}function h1(r,a){if(r==="click")return sl(a)}function f1(r,a){if(r==="input"||r==="change")return sl(a)}function m1(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var zn=typeof Object.is=="function"?Object.is:m1;function Ni(r,a){if(zn(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var d=Object.keys(r),m=Object.keys(a);if(d.length!==m.length)return!1;for(m=0;m<d.length;m++){var y=d[m];if(!h.call(a,y)||!zn(r[y],a[y]))return!1}return!0}function Up(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Bp(r,a){var d=Up(r);r=0;for(var m;d;){if(d.nodeType===3){if(m=r+d.textContent.length,r<=a&&m>=a)return{node:d,offset:a-r};r=m}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Up(d)}}function zp(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?zp(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function Hp(){for(var r=window,a=$e();a instanceof r.HTMLIFrameElement;){try{var d=typeof a.contentWindow.location.href=="string"}catch{d=!1}if(d)r=a.contentWindow;else break;a=$e(r.document)}return a}function Qd(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}function p1(r){var a=Hp(),d=r.focusedElem,m=r.selectionRange;if(a!==d&&d&&d.ownerDocument&&zp(d.ownerDocument.documentElement,d)){if(m!==null&&Qd(d)){if(a=m.start,r=m.end,r===void 0&&(r=a),"selectionStart"in d)d.selectionStart=a,d.selectionEnd=Math.min(r,d.value.length);else if(r=(a=d.ownerDocument||document)&&a.defaultView||window,r.getSelection){r=r.getSelection();var y=d.textContent.length,E=Math.min(m.start,y);m=m.end===void 0?E:Math.min(m.end,y),!r.extend&&E>m&&(y=m,m=E,E=y),y=Bp(d,E);var P=Bp(d,m);y&&P&&(r.rangeCount!==1||r.anchorNode!==y.node||r.anchorOffset!==y.offset||r.focusNode!==P.node||r.focusOffset!==P.offset)&&(a=a.createRange(),a.setStart(y.node,y.offset),r.removeAllRanges(),E>m?(r.addRange(a),r.extend(P.node,P.offset)):(a.setEnd(P.node,P.offset),r.addRange(a)))}}for(a=[],r=d;r=r.parentNode;)r.nodeType===1&&a.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<a.length;d++)r=a[d],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var g1=u&&"documentMode"in document&&11>=document.documentMode,ua=null,Xd=null,ji=null,Zd=!1;function Vp(r,a,d){var m=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Zd||ua==null||ua!==$e(m)||(m=ua,"selectionStart"in m&&Qd(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),ji&&Ni(ji,m)||(ji=m,m=ll(Xd,"onSelect"),0<m.length&&(a=new Hd("onSelect","select",null,a,d),r.push({event:a,listeners:m}),a.target=ua)))}function al(r,a){var d={};return d[r.toLowerCase()]=a.toLowerCase(),d["Webkit"+r]="webkit"+a,d["Moz"+r]="moz"+a,d}var ha={animationend:al("Animation","AnimationEnd"),animationiteration:al("Animation","AnimationIteration"),animationstart:al("Animation","AnimationStart"),transitionend:al("Transition","TransitionEnd")},eu={},qp={};u&&(qp=document.createElement("div").style,"AnimationEvent"in window||(delete ha.animationend.animation,delete ha.animationiteration.animation,delete ha.animationstart.animation),"TransitionEvent"in window||delete ha.transitionend.transition);function il(r){if(eu[r])return eu[r];if(!ha[r])return r;var a=ha[r],d;for(d in a)if(a.hasOwnProperty(d)&&d in qp)return eu[r]=a[d];return r}var Wp=il("animationend"),Gp=il("animationiteration"),Kp=il("animationstart"),Yp=il("transitionend"),Jp=new Map,Qp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Kr(r,a){Jp.set(r,a),l(a,[r])}for(var tu=0;tu<Qp.length;tu++){var nu=Qp[tu],v1=nu.toLowerCase(),y1=nu[0].toUpperCase()+nu.slice(1);Kr(v1,"on"+y1)}Kr(Wp,"onAnimationEnd"),Kr(Gp,"onAnimationIteration"),Kr(Kp,"onAnimationStart"),Kr("dblclick","onDoubleClick"),Kr("focusin","onFocus"),Kr("focusout","onBlur"),Kr(Yp,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ki="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),w1=new Set("cancel close invalid load scroll toggle".split(" ").concat(ki));function Xp(r,a,d){var m=r.type||"unknown-event";r.currentTarget=d,v_(m,a,void 0,r),r.currentTarget=null}function Zp(r,a){a=(a&4)!==0;for(var d=0;d<r.length;d++){var m=r[d],y=m.event;m=m.listeners;e:{var E=void 0;if(a)for(var P=m.length-1;0<=P;P--){var V=m[P],X=V.instance,oe=V.currentTarget;if(V=V.listener,X!==E&&y.isPropagationStopped())break e;Xp(y,V,oe),E=X}else for(P=0;P<m.length;P++){if(V=m[P],X=V.instance,oe=V.currentTarget,V=V.listener,X!==E&&y.isPropagationStopped())break e;Xp(y,V,oe),E=X}}}if(Vo)throw r=Id,Vo=!1,Id=null,r}function ot(r,a){var d=a[du];d===void 0&&(d=a[du]=new Set);var m=r+"__bubble";d.has(m)||(eg(a,r,2,!1),d.add(m))}function ru(r,a,d){var m=0;a&&(m|=4),eg(d,r,m,a)}var ol="_reactListening"+Math.random().toString(36).slice(2);function Ti(r){if(!r[ol]){r[ol]=!0,s.forEach(function(d){d!=="selectionchange"&&(w1.has(d)||ru(d,!1,r),ru(d,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[ol]||(a[ol]=!0,ru("selectionchange",!1,a))}}function eg(r,a,d,m){switch(Sp(a)){case 1:var y=I_;break;case 4:y=D_;break;default:y=Ud}d=y.bind(null,a,d,r),y=void 0,!Un||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(y=!0),m?y!==void 0?r.addEventListener(a,d,{capture:!0,passive:y}):r.addEventListener(a,d,!0):y!==void 0?r.addEventListener(a,d,{passive:y}):r.addEventListener(a,d,!1)}function su(r,a,d,m,y){var E=m;if((a&1)===0&&(a&2)===0&&m!==null)e:for(;;){if(m===null)return;var P=m.tag;if(P===3||P===4){var V=m.stateNode.containerInfo;if(V===y||V.nodeType===8&&V.parentNode===y)break;if(P===4)for(P=m.return;P!==null;){var X=P.tag;if((X===3||X===4)&&(X=P.stateNode.containerInfo,X===y||X.nodeType===8&&X.parentNode===y))return;P=P.return}for(;V!==null;){if(P=Ts(V),P===null)return;if(X=P.tag,X===5||X===6){m=E=P;continue e}V=V.parentNode}}m=m.return}en(function(){var oe=E,he=ia(d),me=[];e:{var ue=Jp.get(r);if(ue!==void 0){var be=Hd,Ee=r;switch(r){case"keypress":if(tl(d)===0)break e;case"keydown":case"keyup":be=Y_;break;case"focusin":Ee="focus",be=Wd;break;case"focusout":Ee="blur",be=Wd;break;case"beforeblur":case"afterblur":be=Wd;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":be=Np;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":be=M_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":be=X_;break;case Wp:case Gp:case Kp:be=U_;break;case Yp:be=e1;break;case"scroll":be=O_;break;case"wheel":be=n1;break;case"copy":case"cut":case"paste":be=z_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":be=kp}var _e=(a&4)!==0,bt=!_e&&r==="scroll",re=_e?ue!==null?ue+"Capture":null:ue;_e=[];for(var te=oe,se;te!==null;){se=te;var pe=se.stateNode;if(se.tag===5&&pe!==null&&(se=pe,re!==null&&(pe=tn(te,re),pe!=null&&_e.push(Ai(te,pe,se)))),bt)break;te=te.return}0<_e.length&&(ue=new be(ue,Ee,null,d,he),me.push({event:ue,listeners:_e}))}}if((a&7)===0){e:{if(ue=r==="mouseover"||r==="pointerover",be=r==="mouseout"||r==="pointerout",ue&&d!==hi&&(Ee=d.relatedTarget||d.fromElement)&&(Ts(Ee)||Ee[Er]))break e;if((be||ue)&&(ue=he.window===he?he:(ue=he.ownerDocument)?ue.defaultView||ue.parentWindow:window,be?(Ee=d.relatedTarget||d.toElement,be=oe,Ee=Ee?Ts(Ee):null,Ee!==null&&(bt=ks(Ee),Ee!==bt||Ee.tag!==5&&Ee.tag!==6)&&(Ee=null)):(be=null,Ee=oe),be!==Ee)){if(_e=Np,pe="onMouseLeave",re="onMouseEnter",te="mouse",(r==="pointerout"||r==="pointerover")&&(_e=kp,pe="onPointerLeave",re="onPointerEnter",te="pointer"),bt=be==null?ue:pa(be),se=Ee==null?ue:pa(Ee),ue=new _e(pe,te+"leave",be,d,he),ue.target=bt,ue.relatedTarget=se,pe=null,Ts(he)===oe&&(_e=new _e(re,te+"enter",Ee,d,he),_e.target=se,_e.relatedTarget=bt,pe=_e),bt=pe,be&&Ee)t:{for(_e=be,re=Ee,te=0,se=_e;se;se=fa(se))te++;for(se=0,pe=re;pe;pe=fa(pe))se++;for(;0<te-se;)_e=fa(_e),te--;for(;0<se-te;)re=fa(re),se--;for(;te--;){if(_e===re||re!==null&&_e===re.alternate)break t;_e=fa(_e),re=fa(re)}_e=null}else _e=null;be!==null&&tg(me,ue,be,_e,!1),Ee!==null&&bt!==null&&tg(me,bt,Ee,_e,!0)}}e:{if(ue=oe?pa(oe):window,be=ue.nodeName&&ue.nodeName.toLowerCase(),be==="select"||be==="input"&&ue.type==="file")var ke=c1;else if(Dp(ue))if(Lp)ke=f1;else{ke=u1;var De=d1}else(be=ue.nodeName)&&be.toLowerCase()==="input"&&(ue.type==="checkbox"||ue.type==="radio")&&(ke=h1);if(ke&&(ke=ke(r,oe))){Op(me,ke,d,he);break e}De&&De(r,ue,oe),r==="focusout"&&(De=ue._wrapperState)&&De.controlled&&ue.type==="number"&&ye(ue,"number",ue.value)}switch(De=oe?pa(oe):window,r){case"focusin":(Dp(De)||De.contentEditable==="true")&&(ua=De,Xd=oe,ji=null);break;case"focusout":ji=Xd=ua=null;break;case"mousedown":Zd=!0;break;case"contextmenu":case"mouseup":case"dragend":Zd=!1,Vp(me,d,he);break;case"selectionchange":if(g1)break;case"keydown":case"keyup":Vp(me,d,he)}var Oe;if(Kd)e:{switch(r){case"compositionstart":var Fe="onCompositionStart";break e;case"compositionend":Fe="onCompositionEnd";break e;case"compositionupdate":Fe="onCompositionUpdate";break e}Fe=void 0}else da?Rp(r,d)&&(Fe="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Fe="onCompositionStart");Fe&&(Tp&&d.locale!=="ko"&&(da||Fe!=="onCompositionStart"?Fe==="onCompositionEnd"&&da&&(Oe=Ep()):(Gr=he,zd="value"in Gr?Gr.value:Gr.textContent,da=!0)),De=ll(oe,Fe),0<De.length&&(Fe=new jp(Fe,r,null,d,he),me.push({event:Fe,listeners:De}),Oe?Fe.data=Oe:(Oe=Ip(d),Oe!==null&&(Fe.data=Oe)))),(Oe=s1?a1(r,d):i1(r,d))&&(oe=ll(oe,"onBeforeInput"),0<oe.length&&(he=new jp("onBeforeInput","beforeinput",null,d,he),me.push({event:he,listeners:oe}),he.data=Oe))}Zp(me,a)})}function Ai(r,a,d){return{instance:r,listener:a,currentTarget:d}}function ll(r,a){for(var d=a+"Capture",m=[];r!==null;){var y=r,E=y.stateNode;y.tag===5&&E!==null&&(y=E,E=tn(r,d),E!=null&&m.unshift(Ai(r,E,y)),E=tn(r,a),E!=null&&m.push(Ai(r,E,y))),r=r.return}return m}function fa(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function tg(r,a,d,m,y){for(var E=a._reactName,P=[];d!==null&&d!==m;){var V=d,X=V.alternate,oe=V.stateNode;if(X!==null&&X===m)break;V.tag===5&&oe!==null&&(V=oe,y?(X=tn(d,E),X!=null&&P.unshift(Ai(d,X,V))):y||(X=tn(d,E),X!=null&&P.push(Ai(d,X,V)))),d=d.return}P.length!==0&&r.push({event:a,listeners:P})}var x1=/\r\n?/g,b1=/\u0000|\uFFFD/g;function ng(r){return(typeof r=="string"?r:""+r).replace(x1,`
`).replace(b1,"")}function cl(r,a,d){if(a=ng(a),ng(r)!==a&&d)throw Error(n(425))}function dl(){}var au=null,iu=null;function ou(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var lu=typeof setTimeout=="function"?setTimeout:void 0,C1=typeof clearTimeout=="function"?clearTimeout:void 0,rg=typeof Promise=="function"?Promise:void 0,S1=typeof queueMicrotask=="function"?queueMicrotask:typeof rg<"u"?function(r){return rg.resolve(null).then(r).catch(E1)}:lu;function E1(r){setTimeout(function(){throw r})}function cu(r,a){var d=a,m=0;do{var y=d.nextSibling;if(r.removeChild(d),y&&y.nodeType===8)if(d=y.data,d==="/$"){if(m===0){r.removeChild(y),xi(a);return}m--}else d!=="$"&&d!=="$?"&&d!=="$!"||m++;d=y}while(d);xi(a)}function Yr(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return r}function sg(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"){if(a===0)return r;a--}else d==="/$"&&a++}r=r.previousSibling}return null}var ma=Math.random().toString(36).slice(2),cr="__reactFiber$"+ma,Pi="__reactProps$"+ma,Er="__reactContainer$"+ma,du="__reactEvents$"+ma,_1="__reactListeners$"+ma,N1="__reactHandles$"+ma;function Ts(r){var a=r[cr];if(a)return a;for(var d=r.parentNode;d;){if(a=d[Er]||d[cr]){if(d=a.alternate,a.child!==null||d!==null&&d.child!==null)for(r=sg(r);r!==null;){if(d=r[cr])return d;r=sg(r)}return a}r=d,d=r.parentNode}return null}function Ri(r){return r=r[cr]||r[Er],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function pa(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(n(33))}function ul(r){return r[Pi]||null}var uu=[],ga=-1;function Jr(r){return{current:r}}function lt(r){0>ga||(r.current=uu[ga],uu[ga]=null,ga--)}function at(r,a){ga++,uu[ga]=r.current,r.current=a}var Qr={},zt=Jr(Qr),nn=Jr(!1),As=Qr;function va(r,a){var d=r.type.contextTypes;if(!d)return Qr;var m=r.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===a)return m.__reactInternalMemoizedMaskedChildContext;var y={},E;for(E in d)y[E]=a[E];return m&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=a,r.__reactInternalMemoizedMaskedChildContext=y),y}function rn(r){return r=r.childContextTypes,r!=null}function hl(){lt(nn),lt(zt)}function ag(r,a,d){if(zt.current!==Qr)throw Error(n(168));at(zt,a),at(nn,d)}function ig(r,a,d){var m=r.stateNode;if(a=a.childContextTypes,typeof m.getChildContext!="function")return d;m=m.getChildContext();for(var y in m)if(!(y in a))throw Error(n(108,G(r)||"Unknown",y));return J({},d,m)}function fl(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Qr,As=zt.current,at(zt,r),at(nn,nn.current),!0}function og(r,a,d){var m=r.stateNode;if(!m)throw Error(n(169));d?(r=ig(r,a,As),m.__reactInternalMemoizedMergedChildContext=r,lt(nn),lt(zt),at(zt,r)):lt(nn),at(nn,d)}var _r=null,ml=!1,hu=!1;function lg(r){_r===null?_r=[r]:_r.push(r)}function j1(r){ml=!0,lg(r)}function Xr(){if(!hu&&_r!==null){hu=!0;var r=0,a=et;try{var d=_r;for(et=1;r<d.length;r++){var m=d[r];do m=m(!0);while(m!==null)}_r=null,ml=!1}catch(y){throw _r!==null&&(_r=_r.slice(r+1)),dp(Dd,Xr),y}finally{et=a,hu=!1}}return null}var ya=[],wa=0,pl=null,gl=0,Cn=[],Sn=0,Ps=null,Nr=1,jr="";function Rs(r,a){ya[wa++]=gl,ya[wa++]=pl,pl=r,gl=a}function cg(r,a,d){Cn[Sn++]=Nr,Cn[Sn++]=jr,Cn[Sn++]=Ps,Ps=r;var m=Nr;r=jr;var y=32-Bn(m)-1;m&=~(1<<y),d+=1;var E=32-Bn(a)+y;if(30<E){var P=y-y%5;E=(m&(1<<P)-1).toString(32),m>>=P,y-=P,Nr=1<<32-Bn(a)+y|d<<y|m,jr=E+r}else Nr=1<<E|d<<y|m,jr=r}function fu(r){r.return!==null&&(Rs(r,1),cg(r,1,0))}function mu(r){for(;r===pl;)pl=ya[--wa],ya[wa]=null,gl=ya[--wa],ya[wa]=null;for(;r===Ps;)Ps=Cn[--Sn],Cn[Sn]=null,jr=Cn[--Sn],Cn[Sn]=null,Nr=Cn[--Sn],Cn[Sn]=null}var fn=null,mn=null,ut=!1,Hn=null;function dg(r,a){var d=jn(5,null,null,0);d.elementType="DELETED",d.stateNode=a,d.return=r,a=r.deletions,a===null?(r.deletions=[d],r.flags|=16):a.push(d)}function ug(r,a){switch(r.tag){case 5:var d=r.type;return a=a.nodeType!==1||d.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(r.stateNode=a,fn=r,mn=Yr(a.firstChild),!0):!1;case 6:return a=r.pendingProps===""||a.nodeType!==3?null:a,a!==null?(r.stateNode=a,fn=r,mn=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(d=Ps!==null?{id:Nr,overflow:jr}:null,r.memoizedState={dehydrated:a,treeContext:d,retryLane:1073741824},d=jn(18,null,null,0),d.stateNode=a,d.return=r,r.child=d,fn=r,mn=null,!0):!1;default:return!1}}function pu(r){return(r.mode&1)!==0&&(r.flags&128)===0}function gu(r){if(ut){var a=mn;if(a){var d=a;if(!ug(r,a)){if(pu(r))throw Error(n(418));a=Yr(d.nextSibling);var m=fn;a&&ug(r,a)?dg(m,d):(r.flags=r.flags&-4097|2,ut=!1,fn=r)}}else{if(pu(r))throw Error(n(418));r.flags=r.flags&-4097|2,ut=!1,fn=r}}}function hg(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;fn=r}function vl(r){if(r!==fn)return!1;if(!ut)return hg(r),ut=!0,!1;var a;if((a=r.tag!==3)&&!(a=r.tag!==5)&&(a=r.type,a=a!=="head"&&a!=="body"&&!ou(r.type,r.memoizedProps)),a&&(a=mn)){if(pu(r))throw fg(),Error(n(418));for(;a;)dg(r,a),a=Yr(a.nextSibling)}if(hg(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));e:{for(r=r.nextSibling,a=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"){if(a===0){mn=Yr(r.nextSibling);break e}a--}else d!=="$"&&d!=="$!"&&d!=="$?"||a++}r=r.nextSibling}mn=null}}else mn=fn?Yr(r.stateNode.nextSibling):null;return!0}function fg(){for(var r=mn;r;)r=Yr(r.nextSibling)}function xa(){mn=fn=null,ut=!1}function vu(r){Hn===null?Hn=[r]:Hn.push(r)}var k1=T.ReactCurrentBatchConfig;function Ii(r,a,d){if(r=d.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(n(309));var m=d.stateNode}if(!m)throw Error(n(147,r));var y=m,E=""+r;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===E?a.ref:(a=function(P){var V=y.refs;P===null?delete V[E]:V[E]=P},a._stringRef=E,a)}if(typeof r!="string")throw Error(n(284));if(!d._owner)throw Error(n(290,r))}return r}function yl(r,a){throw r=Object.prototype.toString.call(a),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r))}function mg(r){var a=r._init;return a(r._payload)}function pg(r){function a(re,te){if(r){var se=re.deletions;se===null?(re.deletions=[te],re.flags|=16):se.push(te)}}function d(re,te){if(!r)return null;for(;te!==null;)a(re,te),te=te.sibling;return null}function m(re,te){for(re=new Map;te!==null;)te.key!==null?re.set(te.key,te):re.set(te.index,te),te=te.sibling;return re}function y(re,te){return re=is(re,te),re.index=0,re.sibling=null,re}function E(re,te,se){return re.index=se,r?(se=re.alternate,se!==null?(se=se.index,se<te?(re.flags|=2,te):se):(re.flags|=2,te)):(re.flags|=1048576,te)}function P(re){return r&&re.alternate===null&&(re.flags|=2),re}function V(re,te,se,pe){return te===null||te.tag!==6?(te=lh(se,re.mode,pe),te.return=re,te):(te=y(te,se),te.return=re,te)}function X(re,te,se,pe){var ke=se.type;return ke===I?he(re,te,se.props.children,pe,se.key):te!==null&&(te.elementType===ke||typeof ke=="object"&&ke!==null&&ke.$$typeof===H&&mg(ke)===te.type)?(pe=y(te,se.props),pe.ref=Ii(re,te,se),pe.return=re,pe):(pe=zl(se.type,se.key,se.props,null,re.mode,pe),pe.ref=Ii(re,te,se),pe.return=re,pe)}function oe(re,te,se,pe){return te===null||te.tag!==4||te.stateNode.containerInfo!==se.containerInfo||te.stateNode.implementation!==se.implementation?(te=ch(se,re.mode,pe),te.return=re,te):(te=y(te,se.children||[]),te.return=re,te)}function he(re,te,se,pe,ke){return te===null||te.tag!==7?(te=Us(se,re.mode,pe,ke),te.return=re,te):(te=y(te,se),te.return=re,te)}function me(re,te,se){if(typeof te=="string"&&te!==""||typeof te=="number")return te=lh(""+te,re.mode,se),te.return=re,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case R:return se=zl(te.type,te.key,te.props,null,re.mode,se),se.ref=Ii(re,null,te),se.return=re,se;case A:return te=ch(te,re.mode,se),te.return=re,te;case H:var pe=te._init;return me(re,pe(te._payload),se)}if(je(te)||O(te))return te=Us(te,re.mode,se,null),te.return=re,te;yl(re,te)}return null}function ue(re,te,se,pe){var ke=te!==null?te.key:null;if(typeof se=="string"&&se!==""||typeof se=="number")return ke!==null?null:V(re,te,""+se,pe);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case R:return se.key===ke?X(re,te,se,pe):null;case A:return se.key===ke?oe(re,te,se,pe):null;case H:return ke=se._init,ue(re,te,ke(se._payload),pe)}if(je(se)||O(se))return ke!==null?null:he(re,te,se,pe,null);yl(re,se)}return null}function be(re,te,se,pe,ke){if(typeof pe=="string"&&pe!==""||typeof pe=="number")return re=re.get(se)||null,V(te,re,""+pe,ke);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case R:return re=re.get(pe.key===null?se:pe.key)||null,X(te,re,pe,ke);case A:return re=re.get(pe.key===null?se:pe.key)||null,oe(te,re,pe,ke);case H:var De=pe._init;return be(re,te,se,De(pe._payload),ke)}if(je(pe)||O(pe))return re=re.get(se)||null,he(te,re,pe,ke,null);yl(te,pe)}return null}function Ee(re,te,se,pe){for(var ke=null,De=null,Oe=te,Fe=te=0,Pt=null;Oe!==null&&Fe<se.length;Fe++){Oe.index>Fe?(Pt=Oe,Oe=null):Pt=Oe.sibling;var Xe=ue(re,Oe,se[Fe],pe);if(Xe===null){Oe===null&&(Oe=Pt);break}r&&Oe&&Xe.alternate===null&&a(re,Oe),te=E(Xe,te,Fe),De===null?ke=Xe:De.sibling=Xe,De=Xe,Oe=Pt}if(Fe===se.length)return d(re,Oe),ut&&Rs(re,Fe),ke;if(Oe===null){for(;Fe<se.length;Fe++)Oe=me(re,se[Fe],pe),Oe!==null&&(te=E(Oe,te,Fe),De===null?ke=Oe:De.sibling=Oe,De=Oe);return ut&&Rs(re,Fe),ke}for(Oe=m(re,Oe);Fe<se.length;Fe++)Pt=be(Oe,re,Fe,se[Fe],pe),Pt!==null&&(r&&Pt.alternate!==null&&Oe.delete(Pt.key===null?Fe:Pt.key),te=E(Pt,te,Fe),De===null?ke=Pt:De.sibling=Pt,De=Pt);return r&&Oe.forEach(function(os){return a(re,os)}),ut&&Rs(re,Fe),ke}function _e(re,te,se,pe){var ke=O(se);if(typeof ke!="function")throw Error(n(150));if(se=ke.call(se),se==null)throw Error(n(151));for(var De=ke=null,Oe=te,Fe=te=0,Pt=null,Xe=se.next();Oe!==null&&!Xe.done;Fe++,Xe=se.next()){Oe.index>Fe?(Pt=Oe,Oe=null):Pt=Oe.sibling;var os=ue(re,Oe,Xe.value,pe);if(os===null){Oe===null&&(Oe=Pt);break}r&&Oe&&os.alternate===null&&a(re,Oe),te=E(os,te,Fe),De===null?ke=os:De.sibling=os,De=os,Oe=Pt}if(Xe.done)return d(re,Oe),ut&&Rs(re,Fe),ke;if(Oe===null){for(;!Xe.done;Fe++,Xe=se.next())Xe=me(re,Xe.value,pe),Xe!==null&&(te=E(Xe,te,Fe),De===null?ke=Xe:De.sibling=Xe,De=Xe);return ut&&Rs(re,Fe),ke}for(Oe=m(re,Oe);!Xe.done;Fe++,Xe=se.next())Xe=be(Oe,re,Fe,Xe.value,pe),Xe!==null&&(r&&Xe.alternate!==null&&Oe.delete(Xe.key===null?Fe:Xe.key),te=E(Xe,te,Fe),De===null?ke=Xe:De.sibling=Xe,De=Xe);return r&&Oe.forEach(function(oN){return a(re,oN)}),ut&&Rs(re,Fe),ke}function bt(re,te,se,pe){if(typeof se=="object"&&se!==null&&se.type===I&&se.key===null&&(se=se.props.children),typeof se=="object"&&se!==null){switch(se.$$typeof){case R:e:{for(var ke=se.key,De=te;De!==null;){if(De.key===ke){if(ke=se.type,ke===I){if(De.tag===7){d(re,De.sibling),te=y(De,se.props.children),te.return=re,re=te;break e}}else if(De.elementType===ke||typeof ke=="object"&&ke!==null&&ke.$$typeof===H&&mg(ke)===De.type){d(re,De.sibling),te=y(De,se.props),te.ref=Ii(re,De,se),te.return=re,re=te;break e}d(re,De);break}else a(re,De);De=De.sibling}se.type===I?(te=Us(se.props.children,re.mode,pe,se.key),te.return=re,re=te):(pe=zl(se.type,se.key,se.props,null,re.mode,pe),pe.ref=Ii(re,te,se),pe.return=re,re=pe)}return P(re);case A:e:{for(De=se.key;te!==null;){if(te.key===De)if(te.tag===4&&te.stateNode.containerInfo===se.containerInfo&&te.stateNode.implementation===se.implementation){d(re,te.sibling),te=y(te,se.children||[]),te.return=re,re=te;break e}else{d(re,te);break}else a(re,te);te=te.sibling}te=ch(se,re.mode,pe),te.return=re,re=te}return P(re);case H:return De=se._init,bt(re,te,De(se._payload),pe)}if(je(se))return Ee(re,te,se,pe);if(O(se))return _e(re,te,se,pe);yl(re,se)}return typeof se=="string"&&se!==""||typeof se=="number"?(se=""+se,te!==null&&te.tag===6?(d(re,te.sibling),te=y(te,se),te.return=re,re=te):(d(re,te),te=lh(se,re.mode,pe),te.return=re,re=te),P(re)):d(re,te)}return bt}var ba=pg(!0),gg=pg(!1),wl=Jr(null),xl=null,Ca=null,yu=null;function wu(){yu=Ca=xl=null}function xu(r){var a=wl.current;lt(wl),r._currentValue=a}function bu(r,a,d){for(;r!==null;){var m=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),r===d)break;r=r.return}}function Sa(r,a){xl=r,yu=Ca=null,r=r.dependencies,r!==null&&r.firstContext!==null&&((r.lanes&a)!==0&&(sn=!0),r.firstContext=null)}function En(r){var a=r._currentValue;if(yu!==r)if(r={context:r,memoizedValue:a,next:null},Ca===null){if(xl===null)throw Error(n(308));Ca=r,xl.dependencies={lanes:0,firstContext:r}}else Ca=Ca.next=r;return a}var Is=null;function Cu(r){Is===null?Is=[r]:Is.push(r)}function vg(r,a,d,m){var y=a.interleaved;return y===null?(d.next=d,Cu(a)):(d.next=y.next,y.next=d),a.interleaved=d,kr(r,m)}function kr(r,a){r.lanes|=a;var d=r.alternate;for(d!==null&&(d.lanes|=a),d=r,r=r.return;r!==null;)r.childLanes|=a,d=r.alternate,d!==null&&(d.childLanes|=a),d=r,r=r.return;return d.tag===3?d.stateNode:null}var Zr=!1;function Su(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function yg(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Tr(r,a){return{eventTime:r,lane:a,tag:0,payload:null,callback:null,next:null}}function es(r,a,d){var m=r.updateQueue;if(m===null)return null;if(m=m.shared,(Qe&2)!==0){var y=m.pending;return y===null?a.next=a:(a.next=y.next,y.next=a),m.pending=a,kr(r,d)}return y=m.interleaved,y===null?(a.next=a,Cu(m)):(a.next=y.next,y.next=a),m.interleaved=a,kr(r,d)}function bl(r,a,d){if(a=a.updateQueue,a!==null&&(a=a.shared,(d&4194240)!==0)){var m=a.lanes;m&=r.pendingLanes,d|=m,a.lanes=d,Md(r,d)}}function wg(r,a){var d=r.updateQueue,m=r.alternate;if(m!==null&&(m=m.updateQueue,d===m)){var y=null,E=null;if(d=d.firstBaseUpdate,d!==null){do{var P={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};E===null?y=E=P:E=E.next=P,d=d.next}while(d!==null);E===null?y=E=a:E=E.next=a}else y=E=a;d={baseState:m.baseState,firstBaseUpdate:y,lastBaseUpdate:E,shared:m.shared,effects:m.effects},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=a:r.next=a,d.lastBaseUpdate=a}function Cl(r,a,d,m){var y=r.updateQueue;Zr=!1;var E=y.firstBaseUpdate,P=y.lastBaseUpdate,V=y.shared.pending;if(V!==null){y.shared.pending=null;var X=V,oe=X.next;X.next=null,P===null?E=oe:P.next=oe,P=X;var he=r.alternate;he!==null&&(he=he.updateQueue,V=he.lastBaseUpdate,V!==P&&(V===null?he.firstBaseUpdate=oe:V.next=oe,he.lastBaseUpdate=X))}if(E!==null){var me=y.baseState;P=0,he=oe=X=null,V=E;do{var ue=V.lane,be=V.eventTime;if((m&ue)===ue){he!==null&&(he=he.next={eventTime:be,lane:0,tag:V.tag,payload:V.payload,callback:V.callback,next:null});e:{var Ee=r,_e=V;switch(ue=a,be=d,_e.tag){case 1:if(Ee=_e.payload,typeof Ee=="function"){me=Ee.call(be,me,ue);break e}me=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=_e.payload,ue=typeof Ee=="function"?Ee.call(be,me,ue):Ee,ue==null)break e;me=J({},me,ue);break e;case 2:Zr=!0}}V.callback!==null&&V.lane!==0&&(r.flags|=64,ue=y.effects,ue===null?y.effects=[V]:ue.push(V))}else be={eventTime:be,lane:ue,tag:V.tag,payload:V.payload,callback:V.callback,next:null},he===null?(oe=he=be,X=me):he=he.next=be,P|=ue;if(V=V.next,V===null){if(V=y.shared.pending,V===null)break;ue=V,V=ue.next,ue.next=null,y.lastBaseUpdate=ue,y.shared.pending=null}}while(!0);if(he===null&&(X=me),y.baseState=X,y.firstBaseUpdate=oe,y.lastBaseUpdate=he,a=y.shared.interleaved,a!==null){y=a;do P|=y.lane,y=y.next;while(y!==a)}else E===null&&(y.shared.lanes=0);Ls|=P,r.lanes=P,r.memoizedState=me}}function xg(r,a,d){if(r=a.effects,a.effects=null,r!==null)for(a=0;a<r.length;a++){var m=r[a],y=m.callback;if(y!==null){if(m.callback=null,m=d,typeof y!="function")throw Error(n(191,y));y.call(m)}}}var Di={},dr=Jr(Di),Oi=Jr(Di),Li=Jr(Di);function Ds(r){if(r===Di)throw Error(n(174));return r}function Eu(r,a){switch(at(Li,a),at(Oi,r),at(dr,Di),r=a.nodeType,r){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:We(null,"");break;default:r=r===8?a.parentNode:a,a=r.namespaceURI||null,r=r.tagName,a=We(a,r)}lt(dr),at(dr,a)}function Ea(){lt(dr),lt(Oi),lt(Li)}function bg(r){Ds(Li.current);var a=Ds(dr.current),d=We(a,r.type);a!==d&&(at(Oi,r),at(dr,d))}function _u(r){Oi.current===r&&(lt(dr),lt(Oi))}var ht=Jr(0);function Sl(r){for(var a=r;a!==null;){if(a.tag===13){var d=a.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Nu=[];function ju(){for(var r=0;r<Nu.length;r++)Nu[r]._workInProgressVersionPrimary=null;Nu.length=0}var El=T.ReactCurrentDispatcher,ku=T.ReactCurrentBatchConfig,Os=0,ft=null,Nt=null,Tt=null,_l=!1,Mi=!1,$i=0,T1=0;function Ht(){throw Error(n(321))}function Tu(r,a){if(a===null)return!1;for(var d=0;d<a.length&&d<r.length;d++)if(!zn(r[d],a[d]))return!1;return!0}function Au(r,a,d,m,y,E){if(Os=E,ft=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,El.current=r===null||r.memoizedState===null?I1:D1,r=d(m,y),Mi){E=0;do{if(Mi=!1,$i=0,25<=E)throw Error(n(301));E+=1,Tt=Nt=null,a.updateQueue=null,El.current=O1,r=d(m,y)}while(Mi)}if(El.current=kl,a=Nt!==null&&Nt.next!==null,Os=0,Tt=Nt=ft=null,_l=!1,a)throw Error(n(300));return r}function Pu(){var r=$i!==0;return $i=0,r}function ur(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?ft.memoizedState=Tt=r:Tt=Tt.next=r,Tt}function _n(){if(Nt===null){var r=ft.alternate;r=r!==null?r.memoizedState:null}else r=Nt.next;var a=Tt===null?ft.memoizedState:Tt.next;if(a!==null)Tt=a,Nt=r;else{if(r===null)throw Error(n(310));Nt=r,r={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},Tt===null?ft.memoizedState=Tt=r:Tt=Tt.next=r}return Tt}function Fi(r,a){return typeof a=="function"?a(r):a}function Ru(r){var a=_n(),d=a.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=r;var m=Nt,y=m.baseQueue,E=d.pending;if(E!==null){if(y!==null){var P=y.next;y.next=E.next,E.next=P}m.baseQueue=y=E,d.pending=null}if(y!==null){E=y.next,m=m.baseState;var V=P=null,X=null,oe=E;do{var he=oe.lane;if((Os&he)===he)X!==null&&(X=X.next={lane:0,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null}),m=oe.hasEagerState?oe.eagerState:r(m,oe.action);else{var me={lane:he,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null};X===null?(V=X=me,P=m):X=X.next=me,ft.lanes|=he,Ls|=he}oe=oe.next}while(oe!==null&&oe!==E);X===null?P=m:X.next=V,zn(m,a.memoizedState)||(sn=!0),a.memoizedState=m,a.baseState=P,a.baseQueue=X,d.lastRenderedState=m}if(r=d.interleaved,r!==null){y=r;do E=y.lane,ft.lanes|=E,Ls|=E,y=y.next;while(y!==r)}else y===null&&(d.lanes=0);return[a.memoizedState,d.dispatch]}function Iu(r){var a=_n(),d=a.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=r;var m=d.dispatch,y=d.pending,E=a.memoizedState;if(y!==null){d.pending=null;var P=y=y.next;do E=r(E,P.action),P=P.next;while(P!==y);zn(E,a.memoizedState)||(sn=!0),a.memoizedState=E,a.baseQueue===null&&(a.baseState=E),d.lastRenderedState=E}return[E,m]}function Cg(){}function Sg(r,a){var d=ft,m=_n(),y=a(),E=!zn(m.memoizedState,y);if(E&&(m.memoizedState=y,sn=!0),m=m.queue,Du(Ng.bind(null,d,m,r),[r]),m.getSnapshot!==a||E||Tt!==null&&Tt.memoizedState.tag&1){if(d.flags|=2048,Ui(9,_g.bind(null,d,m,y,a),void 0,null),At===null)throw Error(n(349));(Os&30)!==0||Eg(d,a,y)}return y}function Eg(r,a,d){r.flags|=16384,r={getSnapshot:a,value:d},a=ft.updateQueue,a===null?(a={lastEffect:null,stores:null},ft.updateQueue=a,a.stores=[r]):(d=a.stores,d===null?a.stores=[r]:d.push(r))}function _g(r,a,d,m){a.value=d,a.getSnapshot=m,jg(a)&&kg(r)}function Ng(r,a,d){return d(function(){jg(a)&&kg(r)})}function jg(r){var a=r.getSnapshot;r=r.value;try{var d=a();return!zn(r,d)}catch{return!0}}function kg(r){var a=kr(r,1);a!==null&&Gn(a,r,1,-1)}function Tg(r){var a=ur();return typeof r=="function"&&(r=r()),a.memoizedState=a.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fi,lastRenderedState:r},a.queue=r,r=r.dispatch=R1.bind(null,ft,r),[a.memoizedState,r]}function Ui(r,a,d,m){return r={tag:r,create:a,destroy:d,deps:m,next:null},a=ft.updateQueue,a===null?(a={lastEffect:null,stores:null},ft.updateQueue=a,a.lastEffect=r.next=r):(d=a.lastEffect,d===null?a.lastEffect=r.next=r:(m=d.next,d.next=r,r.next=m,a.lastEffect=r)),r}function Ag(){return _n().memoizedState}function Nl(r,a,d,m){var y=ur();ft.flags|=r,y.memoizedState=Ui(1|a,d,void 0,m===void 0?null:m)}function jl(r,a,d,m){var y=_n();m=m===void 0?null:m;var E=void 0;if(Nt!==null){var P=Nt.memoizedState;if(E=P.destroy,m!==null&&Tu(m,P.deps)){y.memoizedState=Ui(a,d,E,m);return}}ft.flags|=r,y.memoizedState=Ui(1|a,d,E,m)}function Pg(r,a){return Nl(8390656,8,r,a)}function Du(r,a){return jl(2048,8,r,a)}function Rg(r,a){return jl(4,2,r,a)}function Ig(r,a){return jl(4,4,r,a)}function Dg(r,a){if(typeof a=="function")return r=r(),a(r),function(){a(null)};if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function Og(r,a,d){return d=d!=null?d.concat([r]):null,jl(4,4,Dg.bind(null,a,r),d)}function Ou(){}function Lg(r,a){var d=_n();a=a===void 0?null:a;var m=d.memoizedState;return m!==null&&a!==null&&Tu(a,m[1])?m[0]:(d.memoizedState=[r,a],r)}function Mg(r,a){var d=_n();a=a===void 0?null:a;var m=d.memoizedState;return m!==null&&a!==null&&Tu(a,m[1])?m[0]:(r=r(),d.memoizedState=[r,a],r)}function $g(r,a,d){return(Os&21)===0?(r.baseState&&(r.baseState=!1,sn=!0),r.memoizedState=d):(zn(d,a)||(d=mp(),ft.lanes|=d,Ls|=d,r.baseState=!0),a)}function A1(r,a){var d=et;et=d!==0&&4>d?d:4,r(!0);var m=ku.transition;ku.transition={};try{r(!1),a()}finally{et=d,ku.transition=m}}function Fg(){return _n().memoizedState}function P1(r,a,d){var m=ss(r);if(d={lane:m,action:d,hasEagerState:!1,eagerState:null,next:null},Ug(r))Bg(a,d);else if(d=vg(r,a,d,m),d!==null){var y=Yt();Gn(d,r,m,y),zg(d,a,m)}}function R1(r,a,d){var m=ss(r),y={lane:m,action:d,hasEagerState:!1,eagerState:null,next:null};if(Ug(r))Bg(a,y);else{var E=r.alternate;if(r.lanes===0&&(E===null||E.lanes===0)&&(E=a.lastRenderedReducer,E!==null))try{var P=a.lastRenderedState,V=E(P,d);if(y.hasEagerState=!0,y.eagerState=V,zn(V,P)){var X=a.interleaved;X===null?(y.next=y,Cu(a)):(y.next=X.next,X.next=y),a.interleaved=y;return}}catch{}finally{}d=vg(r,a,y,m),d!==null&&(y=Yt(),Gn(d,r,m,y),zg(d,a,m))}}function Ug(r){var a=r.alternate;return r===ft||a!==null&&a===ft}function Bg(r,a){Mi=_l=!0;var d=r.pending;d===null?a.next=a:(a.next=d.next,d.next=a),r.pending=a}function zg(r,a,d){if((d&4194240)!==0){var m=a.lanes;m&=r.pendingLanes,d|=m,a.lanes=d,Md(r,d)}}var kl={readContext:En,useCallback:Ht,useContext:Ht,useEffect:Ht,useImperativeHandle:Ht,useInsertionEffect:Ht,useLayoutEffect:Ht,useMemo:Ht,useReducer:Ht,useRef:Ht,useState:Ht,useDebugValue:Ht,useDeferredValue:Ht,useTransition:Ht,useMutableSource:Ht,useSyncExternalStore:Ht,useId:Ht,unstable_isNewReconciler:!1},I1={readContext:En,useCallback:function(r,a){return ur().memoizedState=[r,a===void 0?null:a],r},useContext:En,useEffect:Pg,useImperativeHandle:function(r,a,d){return d=d!=null?d.concat([r]):null,Nl(4194308,4,Dg.bind(null,a,r),d)},useLayoutEffect:function(r,a){return Nl(4194308,4,r,a)},useInsertionEffect:function(r,a){return Nl(4,2,r,a)},useMemo:function(r,a){var d=ur();return a=a===void 0?null:a,r=r(),d.memoizedState=[r,a],r},useReducer:function(r,a,d){var m=ur();return a=d!==void 0?d(a):a,m.memoizedState=m.baseState=a,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:a},m.queue=r,r=r.dispatch=P1.bind(null,ft,r),[m.memoizedState,r]},useRef:function(r){var a=ur();return r={current:r},a.memoizedState=r},useState:Tg,useDebugValue:Ou,useDeferredValue:function(r){return ur().memoizedState=r},useTransition:function(){var r=Tg(!1),a=r[0];return r=A1.bind(null,r[1]),ur().memoizedState=r,[a,r]},useMutableSource:function(){},useSyncExternalStore:function(r,a,d){var m=ft,y=ur();if(ut){if(d===void 0)throw Error(n(407));d=d()}else{if(d=a(),At===null)throw Error(n(349));(Os&30)!==0||Eg(m,a,d)}y.memoizedState=d;var E={value:d,getSnapshot:a};return y.queue=E,Pg(Ng.bind(null,m,E,r),[r]),m.flags|=2048,Ui(9,_g.bind(null,m,E,d,a),void 0,null),d},useId:function(){var r=ur(),a=At.identifierPrefix;if(ut){var d=jr,m=Nr;d=(m&~(1<<32-Bn(m)-1)).toString(32)+d,a=":"+a+"R"+d,d=$i++,0<d&&(a+="H"+d.toString(32)),a+=":"}else d=T1++,a=":"+a+"r"+d.toString(32)+":";return r.memoizedState=a},unstable_isNewReconciler:!1},D1={readContext:En,useCallback:Lg,useContext:En,useEffect:Du,useImperativeHandle:Og,useInsertionEffect:Rg,useLayoutEffect:Ig,useMemo:Mg,useReducer:Ru,useRef:Ag,useState:function(){return Ru(Fi)},useDebugValue:Ou,useDeferredValue:function(r){var a=_n();return $g(a,Nt.memoizedState,r)},useTransition:function(){var r=Ru(Fi)[0],a=_n().memoizedState;return[r,a]},useMutableSource:Cg,useSyncExternalStore:Sg,useId:Fg,unstable_isNewReconciler:!1},O1={readContext:En,useCallback:Lg,useContext:En,useEffect:Du,useImperativeHandle:Og,useInsertionEffect:Rg,useLayoutEffect:Ig,useMemo:Mg,useReducer:Iu,useRef:Ag,useState:function(){return Iu(Fi)},useDebugValue:Ou,useDeferredValue:function(r){var a=_n();return Nt===null?a.memoizedState=r:$g(a,Nt.memoizedState,r)},useTransition:function(){var r=Iu(Fi)[0],a=_n().memoizedState;return[r,a]},useMutableSource:Cg,useSyncExternalStore:Sg,useId:Fg,unstable_isNewReconciler:!1};function Vn(r,a){if(r&&r.defaultProps){a=J({},a),r=r.defaultProps;for(var d in r)a[d]===void 0&&(a[d]=r[d]);return a}return a}function Lu(r,a,d,m){a=r.memoizedState,d=d(m,a),d=d==null?a:J({},a,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var Tl={isMounted:function(r){return(r=r._reactInternals)?ks(r)===r:!1},enqueueSetState:function(r,a,d){r=r._reactInternals;var m=Yt(),y=ss(r),E=Tr(m,y);E.payload=a,d!=null&&(E.callback=d),a=es(r,E,y),a!==null&&(Gn(a,r,y,m),bl(a,r,y))},enqueueReplaceState:function(r,a,d){r=r._reactInternals;var m=Yt(),y=ss(r),E=Tr(m,y);E.tag=1,E.payload=a,d!=null&&(E.callback=d),a=es(r,E,y),a!==null&&(Gn(a,r,y,m),bl(a,r,y))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var d=Yt(),m=ss(r),y=Tr(d,m);y.tag=2,a!=null&&(y.callback=a),a=es(r,y,m),a!==null&&(Gn(a,r,m,d),bl(a,r,m))}};function Hg(r,a,d,m,y,E,P){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(m,E,P):a.prototype&&a.prototype.isPureReactComponent?!Ni(d,m)||!Ni(y,E):!0}function Vg(r,a,d){var m=!1,y=Qr,E=a.contextType;return typeof E=="object"&&E!==null?E=En(E):(y=rn(a)?As:zt.current,m=a.contextTypes,E=(m=m!=null)?va(r,y):Qr),a=new a(d,E),r.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=Tl,r.stateNode=a,a._reactInternals=r,m&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=y,r.__reactInternalMemoizedMaskedChildContext=E),a}function qg(r,a,d,m){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(d,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(d,m),a.state!==r&&Tl.enqueueReplaceState(a,a.state,null)}function Mu(r,a,d,m){var y=r.stateNode;y.props=d,y.state=r.memoizedState,y.refs={},Su(r);var E=a.contextType;typeof E=="object"&&E!==null?y.context=En(E):(E=rn(a)?As:zt.current,y.context=va(r,E)),y.state=r.memoizedState,E=a.getDerivedStateFromProps,typeof E=="function"&&(Lu(r,a,E,d),y.state=r.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(a=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),a!==y.state&&Tl.enqueueReplaceState(y,y.state,null),Cl(r,d,y,m),y.state=r.memoizedState),typeof y.componentDidMount=="function"&&(r.flags|=4194308)}function _a(r,a){try{var d="",m=a;do d+=W(m),m=m.return;while(m);var y=d}catch(E){y=`
Error generating stack: `+E.message+`
`+E.stack}return{value:r,source:a,stack:y,digest:null}}function $u(r,a,d){return{value:r,source:null,stack:d??null,digest:a??null}}function Fu(r,a){try{console.error(a.value)}catch(d){setTimeout(function(){throw d})}}var L1=typeof WeakMap=="function"?WeakMap:Map;function Wg(r,a,d){d=Tr(-1,d),d.tag=3,d.payload={element:null};var m=a.value;return d.callback=function(){Ll||(Ll=!0,eh=m),Fu(r,a)},d}function Gg(r,a,d){d=Tr(-1,d),d.tag=3;var m=r.type.getDerivedStateFromError;if(typeof m=="function"){var y=a.value;d.payload=function(){return m(y)},d.callback=function(){Fu(r,a)}}var E=r.stateNode;return E!==null&&typeof E.componentDidCatch=="function"&&(d.callback=function(){Fu(r,a),typeof m!="function"&&(ns===null?ns=new Set([this]):ns.add(this));var P=a.stack;this.componentDidCatch(a.value,{componentStack:P!==null?P:""})}),d}function Kg(r,a,d){var m=r.pingCache;if(m===null){m=r.pingCache=new L1;var y=new Set;m.set(a,y)}else y=m.get(a),y===void 0&&(y=new Set,m.set(a,y));y.has(d)||(y.add(d),r=J1.bind(null,r,a,d),a.then(r,r))}function Yg(r){do{var a;if((a=r.tag===13)&&(a=r.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return r;r=r.return}while(r!==null);return null}function Jg(r,a,d,m,y){return(r.mode&1)===0?(r===a?r.flags|=65536:(r.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(a=Tr(-1,1),a.tag=2,es(d,a,1))),d.lanes|=1),r):(r.flags|=65536,r.lanes=y,r)}var M1=T.ReactCurrentOwner,sn=!1;function Kt(r,a,d,m){a.child=r===null?gg(a,null,d,m):ba(a,r.child,d,m)}function Qg(r,a,d,m,y){d=d.render;var E=a.ref;return Sa(a,y),m=Au(r,a,d,m,E,y),d=Pu(),r!==null&&!sn?(a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~y,Ar(r,a,y)):(ut&&d&&fu(a),a.flags|=1,Kt(r,a,m,y),a.child)}function Xg(r,a,d,m,y){if(r===null){var E=d.type;return typeof E=="function"&&!oh(E)&&E.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(a.tag=15,a.type=E,Zg(r,a,E,m,y)):(r=zl(d.type,null,m,a,a.mode,y),r.ref=a.ref,r.return=a,a.child=r)}if(E=r.child,(r.lanes&y)===0){var P=E.memoizedProps;if(d=d.compare,d=d!==null?d:Ni,d(P,m)&&r.ref===a.ref)return Ar(r,a,y)}return a.flags|=1,r=is(E,m),r.ref=a.ref,r.return=a,a.child=r}function Zg(r,a,d,m,y){if(r!==null){var E=r.memoizedProps;if(Ni(E,m)&&r.ref===a.ref)if(sn=!1,a.pendingProps=m=E,(r.lanes&y)!==0)(r.flags&131072)!==0&&(sn=!0);else return a.lanes=r.lanes,Ar(r,a,y)}return Uu(r,a,d,m,y)}function ev(r,a,d){var m=a.pendingProps,y=m.children,E=r!==null?r.memoizedState:null;if(m.mode==="hidden")if((a.mode&1)===0)a.memoizedState={baseLanes:0,cachePool:null,transitions:null},at(ja,pn),pn|=d;else{if((d&1073741824)===0)return r=E!==null?E.baseLanes|d:d,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:r,cachePool:null,transitions:null},a.updateQueue=null,at(ja,pn),pn|=r,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=E!==null?E.baseLanes:d,at(ja,pn),pn|=m}else E!==null?(m=E.baseLanes|d,a.memoizedState=null):m=d,at(ja,pn),pn|=m;return Kt(r,a,y,d),a.child}function tv(r,a){var d=a.ref;(r===null&&d!==null||r!==null&&r.ref!==d)&&(a.flags|=512,a.flags|=2097152)}function Uu(r,a,d,m,y){var E=rn(d)?As:zt.current;return E=va(a,E),Sa(a,y),d=Au(r,a,d,m,E,y),m=Pu(),r!==null&&!sn?(a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~y,Ar(r,a,y)):(ut&&m&&fu(a),a.flags|=1,Kt(r,a,d,y),a.child)}function nv(r,a,d,m,y){if(rn(d)){var E=!0;fl(a)}else E=!1;if(Sa(a,y),a.stateNode===null)Pl(r,a),Vg(a,d,m),Mu(a,d,m,y),m=!0;else if(r===null){var P=a.stateNode,V=a.memoizedProps;P.props=V;var X=P.context,oe=d.contextType;typeof oe=="object"&&oe!==null?oe=En(oe):(oe=rn(d)?As:zt.current,oe=va(a,oe));var he=d.getDerivedStateFromProps,me=typeof he=="function"||typeof P.getSnapshotBeforeUpdate=="function";me||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(V!==m||X!==oe)&&qg(a,P,m,oe),Zr=!1;var ue=a.memoizedState;P.state=ue,Cl(a,m,P,y),X=a.memoizedState,V!==m||ue!==X||nn.current||Zr?(typeof he=="function"&&(Lu(a,d,he,m),X=a.memoizedState),(V=Zr||Hg(a,d,V,m,ue,X,oe))?(me||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(a.flags|=4194308)):(typeof P.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=X),P.props=m,P.state=X,P.context=oe,m=V):(typeof P.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{P=a.stateNode,yg(r,a),V=a.memoizedProps,oe=a.type===a.elementType?V:Vn(a.type,V),P.props=oe,me=a.pendingProps,ue=P.context,X=d.contextType,typeof X=="object"&&X!==null?X=En(X):(X=rn(d)?As:zt.current,X=va(a,X));var be=d.getDerivedStateFromProps;(he=typeof be=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(V!==me||ue!==X)&&qg(a,P,m,X),Zr=!1,ue=a.memoizedState,P.state=ue,Cl(a,m,P,y);var Ee=a.memoizedState;V!==me||ue!==Ee||nn.current||Zr?(typeof be=="function"&&(Lu(a,d,be,m),Ee=a.memoizedState),(oe=Zr||Hg(a,d,oe,m,ue,Ee,X)||!1)?(he||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(m,Ee,X),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(m,Ee,X)),typeof P.componentDidUpdate=="function"&&(a.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof P.componentDidUpdate!="function"||V===r.memoizedProps&&ue===r.memoizedState||(a.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||V===r.memoizedProps&&ue===r.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=Ee),P.props=m,P.state=Ee,P.context=X,m=oe):(typeof P.componentDidUpdate!="function"||V===r.memoizedProps&&ue===r.memoizedState||(a.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||V===r.memoizedProps&&ue===r.memoizedState||(a.flags|=1024),m=!1)}return Bu(r,a,d,m,E,y)}function Bu(r,a,d,m,y,E){tv(r,a);var P=(a.flags&128)!==0;if(!m&&!P)return y&&og(a,d,!1),Ar(r,a,E);m=a.stateNode,M1.current=a;var V=P&&typeof d.getDerivedStateFromError!="function"?null:m.render();return a.flags|=1,r!==null&&P?(a.child=ba(a,r.child,null,E),a.child=ba(a,null,V,E)):Kt(r,a,V,E),a.memoizedState=m.state,y&&og(a,d,!0),a.child}function rv(r){var a=r.stateNode;a.pendingContext?ag(r,a.pendingContext,a.pendingContext!==a.context):a.context&&ag(r,a.context,!1),Eu(r,a.containerInfo)}function sv(r,a,d,m,y){return xa(),vu(y),a.flags|=256,Kt(r,a,d,m),a.child}var zu={dehydrated:null,treeContext:null,retryLane:0};function Hu(r){return{baseLanes:r,cachePool:null,transitions:null}}function av(r,a,d){var m=a.pendingProps,y=ht.current,E=!1,P=(a.flags&128)!==0,V;if((V=P)||(V=r!==null&&r.memoizedState===null?!1:(y&2)!==0),V?(E=!0,a.flags&=-129):(r===null||r.memoizedState!==null)&&(y|=1),at(ht,y&1),r===null)return gu(a),r=a.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?((a.mode&1)===0?a.lanes=1:r.data==="$!"?a.lanes=8:a.lanes=1073741824,null):(P=m.children,r=m.fallback,E?(m=a.mode,E=a.child,P={mode:"hidden",children:P},(m&1)===0&&E!==null?(E.childLanes=0,E.pendingProps=P):E=Hl(P,m,0,null),r=Us(r,m,d,null),E.return=a,r.return=a,E.sibling=r,a.child=E,a.child.memoizedState=Hu(d),a.memoizedState=zu,r):Vu(a,P));if(y=r.memoizedState,y!==null&&(V=y.dehydrated,V!==null))return $1(r,a,P,m,V,y,d);if(E){E=m.fallback,P=a.mode,y=r.child,V=y.sibling;var X={mode:"hidden",children:m.children};return(P&1)===0&&a.child!==y?(m=a.child,m.childLanes=0,m.pendingProps=X,a.deletions=null):(m=is(y,X),m.subtreeFlags=y.subtreeFlags&14680064),V!==null?E=is(V,E):(E=Us(E,P,d,null),E.flags|=2),E.return=a,m.return=a,m.sibling=E,a.child=m,m=E,E=a.child,P=r.child.memoizedState,P=P===null?Hu(d):{baseLanes:P.baseLanes|d,cachePool:null,transitions:P.transitions},E.memoizedState=P,E.childLanes=r.childLanes&~d,a.memoizedState=zu,m}return E=r.child,r=E.sibling,m=is(E,{mode:"visible",children:m.children}),(a.mode&1)===0&&(m.lanes=d),m.return=a,m.sibling=null,r!==null&&(d=a.deletions,d===null?(a.deletions=[r],a.flags|=16):d.push(r)),a.child=m,a.memoizedState=null,m}function Vu(r,a){return a=Hl({mode:"visible",children:a},r.mode,0,null),a.return=r,r.child=a}function Al(r,a,d,m){return m!==null&&vu(m),ba(a,r.child,null,d),r=Vu(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function $1(r,a,d,m,y,E,P){if(d)return a.flags&256?(a.flags&=-257,m=$u(Error(n(422))),Al(r,a,P,m)):a.memoizedState!==null?(a.child=r.child,a.flags|=128,null):(E=m.fallback,y=a.mode,m=Hl({mode:"visible",children:m.children},y,0,null),E=Us(E,y,P,null),E.flags|=2,m.return=a,E.return=a,m.sibling=E,a.child=m,(a.mode&1)!==0&&ba(a,r.child,null,P),a.child.memoizedState=Hu(P),a.memoizedState=zu,E);if((a.mode&1)===0)return Al(r,a,P,null);if(y.data==="$!"){if(m=y.nextSibling&&y.nextSibling.dataset,m)var V=m.dgst;return m=V,E=Error(n(419)),m=$u(E,m,void 0),Al(r,a,P,m)}if(V=(P&r.childLanes)!==0,sn||V){if(m=At,m!==null){switch(P&-P){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}y=(y&(m.suspendedLanes|P))!==0?0:y,y!==0&&y!==E.retryLane&&(E.retryLane=y,kr(r,y),Gn(m,r,y,-1))}return ih(),m=$u(Error(n(421))),Al(r,a,P,m)}return y.data==="$?"?(a.flags|=128,a.child=r.child,a=Q1.bind(null,r),y._reactRetry=a,null):(r=E.treeContext,mn=Yr(y.nextSibling),fn=a,ut=!0,Hn=null,r!==null&&(Cn[Sn++]=Nr,Cn[Sn++]=jr,Cn[Sn++]=Ps,Nr=r.id,jr=r.overflow,Ps=a),a=Vu(a,m.children),a.flags|=4096,a)}function iv(r,a,d){r.lanes|=a;var m=r.alternate;m!==null&&(m.lanes|=a),bu(r.return,a,d)}function qu(r,a,d,m,y){var E=r.memoizedState;E===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:d,tailMode:y}:(E.isBackwards=a,E.rendering=null,E.renderingStartTime=0,E.last=m,E.tail=d,E.tailMode=y)}function ov(r,a,d){var m=a.pendingProps,y=m.revealOrder,E=m.tail;if(Kt(r,a,m.children,d),m=ht.current,(m&2)!==0)m=m&1|2,a.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&iv(r,d,a);else if(r.tag===19)iv(r,d,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}m&=1}if(at(ht,m),(a.mode&1)===0)a.memoizedState=null;else switch(y){case"forwards":for(d=a.child,y=null;d!==null;)r=d.alternate,r!==null&&Sl(r)===null&&(y=d),d=d.sibling;d=y,d===null?(y=a.child,a.child=null):(y=d.sibling,d.sibling=null),qu(a,!1,y,d,E);break;case"backwards":for(d=null,y=a.child,a.child=null;y!==null;){if(r=y.alternate,r!==null&&Sl(r)===null){a.child=y;break}r=y.sibling,y.sibling=d,d=y,y=r}qu(a,!0,d,null,E);break;case"together":qu(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Pl(r,a){(a.mode&1)===0&&r!==null&&(r.alternate=null,a.alternate=null,a.flags|=2)}function Ar(r,a,d){if(r!==null&&(a.dependencies=r.dependencies),Ls|=a.lanes,(d&a.childLanes)===0)return null;if(r!==null&&a.child!==r.child)throw Error(n(153));if(a.child!==null){for(r=a.child,d=is(r,r.pendingProps),a.child=d,d.return=a;r.sibling!==null;)r=r.sibling,d=d.sibling=is(r,r.pendingProps),d.return=a;d.sibling=null}return a.child}function F1(r,a,d){switch(a.tag){case 3:rv(a),xa();break;case 5:bg(a);break;case 1:rn(a.type)&&fl(a);break;case 4:Eu(a,a.stateNode.containerInfo);break;case 10:var m=a.type._context,y=a.memoizedProps.value;at(wl,m._currentValue),m._currentValue=y;break;case 13:if(m=a.memoizedState,m!==null)return m.dehydrated!==null?(at(ht,ht.current&1),a.flags|=128,null):(d&a.child.childLanes)!==0?av(r,a,d):(at(ht,ht.current&1),r=Ar(r,a,d),r!==null?r.sibling:null);at(ht,ht.current&1);break;case 19:if(m=(d&a.childLanes)!==0,(r.flags&128)!==0){if(m)return ov(r,a,d);a.flags|=128}if(y=a.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),at(ht,ht.current),m)break;return null;case 22:case 23:return a.lanes=0,ev(r,a,d)}return Ar(r,a,d)}var lv,Wu,cv,dv;lv=function(r,a){for(var d=a.child;d!==null;){if(d.tag===5||d.tag===6)r.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},Wu=function(){},cv=function(r,a,d,m){var y=r.memoizedProps;if(y!==m){r=a.stateNode,Ds(dr.current);var E=null;switch(d){case"input":y=Ke(r,y),m=Ke(r,m),E=[];break;case"select":y=J({},y,{value:void 0}),m=J({},m,{value:void 0}),E=[];break;case"textarea":y=dt(r,y),m=dt(r,m),E=[];break;default:typeof y.onClick!="function"&&typeof m.onClick=="function"&&(r.onclick=dl)}ar(d,m);var P;d=null;for(oe in y)if(!m.hasOwnProperty(oe)&&y.hasOwnProperty(oe)&&y[oe]!=null)if(oe==="style"){var V=y[oe];for(P in V)V.hasOwnProperty(P)&&(d||(d={}),d[P]="")}else oe!=="dangerouslySetInnerHTML"&&oe!=="children"&&oe!=="suppressContentEditableWarning"&&oe!=="suppressHydrationWarning"&&oe!=="autoFocus"&&(o.hasOwnProperty(oe)?E||(E=[]):(E=E||[]).push(oe,null));for(oe in m){var X=m[oe];if(V=y?.[oe],m.hasOwnProperty(oe)&&X!==V&&(X!=null||V!=null))if(oe==="style")if(V){for(P in V)!V.hasOwnProperty(P)||X&&X.hasOwnProperty(P)||(d||(d={}),d[P]="");for(P in X)X.hasOwnProperty(P)&&V[P]!==X[P]&&(d||(d={}),d[P]=X[P])}else d||(E||(E=[]),E.push(oe,d)),d=X;else oe==="dangerouslySetInnerHTML"?(X=X?X.__html:void 0,V=V?V.__html:void 0,X!=null&&V!==X&&(E=E||[]).push(oe,X)):oe==="children"?typeof X!="string"&&typeof X!="number"||(E=E||[]).push(oe,""+X):oe!=="suppressContentEditableWarning"&&oe!=="suppressHydrationWarning"&&(o.hasOwnProperty(oe)?(X!=null&&oe==="onScroll"&&ot("scroll",r),E||V===X||(E=[])):(E=E||[]).push(oe,X))}d&&(E=E||[]).push("style",d);var oe=E;(a.updateQueue=oe)&&(a.flags|=4)}},dv=function(r,a,d,m){d!==m&&(a.flags|=4)};function Bi(r,a){if(!ut)switch(r.tailMode){case"hidden":a=r.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var m=null;d!==null;)d.alternate!==null&&(m=d),d=d.sibling;m===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:m.sibling=null}}function Vt(r){var a=r.alternate!==null&&r.alternate.child===r.child,d=0,m=0;if(a)for(var y=r.child;y!==null;)d|=y.lanes|y.childLanes,m|=y.subtreeFlags&14680064,m|=y.flags&14680064,y.return=r,y=y.sibling;else for(y=r.child;y!==null;)d|=y.lanes|y.childLanes,m|=y.subtreeFlags,m|=y.flags,y.return=r,y=y.sibling;return r.subtreeFlags|=m,r.childLanes=d,a}function U1(r,a,d){var m=a.pendingProps;switch(mu(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vt(a),null;case 1:return rn(a.type)&&hl(),Vt(a),null;case 3:return m=a.stateNode,Ea(),lt(nn),lt(zt),ju(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(r===null||r.child===null)&&(vl(a)?a.flags|=4:r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Hn!==null&&(rh(Hn),Hn=null))),Wu(r,a),Vt(a),null;case 5:_u(a);var y=Ds(Li.current);if(d=a.type,r!==null&&a.stateNode!=null)cv(r,a,d,m,y),r.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!m){if(a.stateNode===null)throw Error(n(166));return Vt(a),null}if(r=Ds(dr.current),vl(a)){m=a.stateNode,d=a.type;var E=a.memoizedProps;switch(m[cr]=a,m[Pi]=E,r=(a.mode&1)!==0,d){case"dialog":ot("cancel",m),ot("close",m);break;case"iframe":case"object":case"embed":ot("load",m);break;case"video":case"audio":for(y=0;y<ki.length;y++)ot(ki[y],m);break;case"source":ot("error",m);break;case"img":case"image":case"link":ot("error",m),ot("load",m);break;case"details":ot("toggle",m);break;case"input":Ve(m,E),ot("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!E.multiple},ot("invalid",m);break;case"textarea":Je(m,E),ot("invalid",m)}ar(d,E),y=null;for(var P in E)if(E.hasOwnProperty(P)){var V=E[P];P==="children"?typeof V=="string"?m.textContent!==V&&(E.suppressHydrationWarning!==!0&&cl(m.textContent,V,r),y=["children",V]):typeof V=="number"&&m.textContent!==""+V&&(E.suppressHydrationWarning!==!0&&cl(m.textContent,V,r),y=["children",""+V]):o.hasOwnProperty(P)&&V!=null&&P==="onScroll"&&ot("scroll",m)}switch(d){case"input":xe(m),le(m,E,!0);break;case"textarea":xe(m),st(m);break;case"select":case"option":break;default:typeof E.onClick=="function"&&(m.onclick=dl)}m=y,a.updateQueue=m,m!==null&&(a.flags|=4)}else{P=y.nodeType===9?y:y.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=gt(d)),r==="http://www.w3.org/1999/xhtml"?d==="script"?(r=P.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof m.is=="string"?r=P.createElement(d,{is:m.is}):(r=P.createElement(d),d==="select"&&(P=r,m.multiple?P.multiple=!0:m.size&&(P.size=m.size))):r=P.createElementNS(r,d),r[cr]=a,r[Pi]=m,lv(r,a,!1,!1),a.stateNode=r;e:{switch(P=ui(d,m),d){case"dialog":ot("cancel",r),ot("close",r),y=m;break;case"iframe":case"object":case"embed":ot("load",r),y=m;break;case"video":case"audio":for(y=0;y<ki.length;y++)ot(ki[y],r);y=m;break;case"source":ot("error",r),y=m;break;case"img":case"image":case"link":ot("error",r),ot("load",r),y=m;break;case"details":ot("toggle",r),y=m;break;case"input":Ve(r,m),y=Ke(r,m),ot("invalid",r);break;case"option":y=m;break;case"select":r._wrapperState={wasMultiple:!!m.multiple},y=J({},m,{value:void 0}),ot("invalid",r);break;case"textarea":Je(r,m),y=dt(r,m),ot("invalid",r);break;default:y=m}ar(d,y),V=y;for(E in V)if(V.hasOwnProperty(E)){var X=V[E];E==="style"?Sr(r,X):E==="dangerouslySetInnerHTML"?(X=X?X.__html:void 0,X!=null&&Bt(r,X)):E==="children"?typeof X=="string"?(d!=="textarea"||X!=="")&&Rt(r,X):typeof X=="number"&&Rt(r,""+X):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(o.hasOwnProperty(E)?X!=null&&E==="onScroll"&&ot("scroll",r):X!=null&&j(r,E,X,P))}switch(d){case"input":xe(r),le(r,m,!1);break;case"textarea":xe(r),st(r);break;case"option":m.value!=null&&r.setAttribute("value",""+ae(m.value));break;case"select":r.multiple=!!m.multiple,E=m.value,E!=null?ze(r,!!m.multiple,E,!1):m.defaultValue!=null&&ze(r,!!m.multiple,m.defaultValue,!0);break;default:typeof y.onClick=="function"&&(r.onclick=dl)}switch(d){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return Vt(a),null;case 6:if(r&&a.stateNode!=null)dv(r,a,r.memoizedProps,m);else{if(typeof m!="string"&&a.stateNode===null)throw Error(n(166));if(d=Ds(Li.current),Ds(dr.current),vl(a)){if(m=a.stateNode,d=a.memoizedProps,m[cr]=a,(E=m.nodeValue!==d)&&(r=fn,r!==null))switch(r.tag){case 3:cl(m.nodeValue,d,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&cl(m.nodeValue,d,(r.mode&1)!==0)}E&&(a.flags|=4)}else m=(d.nodeType===9?d:d.ownerDocument).createTextNode(m),m[cr]=a,a.stateNode=m}return Vt(a),null;case 13:if(lt(ht),m=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(ut&&mn!==null&&(a.mode&1)!==0&&(a.flags&128)===0)fg(),xa(),a.flags|=98560,E=!1;else if(E=vl(a),m!==null&&m.dehydrated!==null){if(r===null){if(!E)throw Error(n(318));if(E=a.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(n(317));E[cr]=a}else xa(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Vt(a),E=!1}else Hn!==null&&(rh(Hn),Hn=null),E=!0;if(!E)return a.flags&65536?a:null}return(a.flags&128)!==0?(a.lanes=d,a):(m=m!==null,m!==(r!==null&&r.memoizedState!==null)&&m&&(a.child.flags|=8192,(a.mode&1)!==0&&(r===null||(ht.current&1)!==0?jt===0&&(jt=3):ih())),a.updateQueue!==null&&(a.flags|=4),Vt(a),null);case 4:return Ea(),Wu(r,a),r===null&&Ti(a.stateNode.containerInfo),Vt(a),null;case 10:return xu(a.type._context),Vt(a),null;case 17:return rn(a.type)&&hl(),Vt(a),null;case 19:if(lt(ht),E=a.memoizedState,E===null)return Vt(a),null;if(m=(a.flags&128)!==0,P=E.rendering,P===null)if(m)Bi(E,!1);else{if(jt!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(P=Sl(r),P!==null){for(a.flags|=128,Bi(E,!1),m=P.updateQueue,m!==null&&(a.updateQueue=m,a.flags|=4),a.subtreeFlags=0,m=d,d=a.child;d!==null;)E=d,r=m,E.flags&=14680066,P=E.alternate,P===null?(E.childLanes=0,E.lanes=r,E.child=null,E.subtreeFlags=0,E.memoizedProps=null,E.memoizedState=null,E.updateQueue=null,E.dependencies=null,E.stateNode=null):(E.childLanes=P.childLanes,E.lanes=P.lanes,E.child=P.child,E.subtreeFlags=0,E.deletions=null,E.memoizedProps=P.memoizedProps,E.memoizedState=P.memoizedState,E.updateQueue=P.updateQueue,E.type=P.type,r=P.dependencies,E.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),d=d.sibling;return at(ht,ht.current&1|2),a.child}r=r.sibling}E.tail!==null&&xt()>ka&&(a.flags|=128,m=!0,Bi(E,!1),a.lanes=4194304)}else{if(!m)if(r=Sl(P),r!==null){if(a.flags|=128,m=!0,d=r.updateQueue,d!==null&&(a.updateQueue=d,a.flags|=4),Bi(E,!0),E.tail===null&&E.tailMode==="hidden"&&!P.alternate&&!ut)return Vt(a),null}else 2*xt()-E.renderingStartTime>ka&&d!==1073741824&&(a.flags|=128,m=!0,Bi(E,!1),a.lanes=4194304);E.isBackwards?(P.sibling=a.child,a.child=P):(d=E.last,d!==null?d.sibling=P:a.child=P,E.last=P)}return E.tail!==null?(a=E.tail,E.rendering=a,E.tail=a.sibling,E.renderingStartTime=xt(),a.sibling=null,d=ht.current,at(ht,m?d&1|2:d&1),a):(Vt(a),null);case 22:case 23:return ah(),m=a.memoizedState!==null,r!==null&&r.memoizedState!==null!==m&&(a.flags|=8192),m&&(a.mode&1)!==0?(pn&1073741824)!==0&&(Vt(a),a.subtreeFlags&6&&(a.flags|=8192)):Vt(a),null;case 24:return null;case 25:return null}throw Error(n(156,a.tag))}function B1(r,a){switch(mu(a),a.tag){case 1:return rn(a.type)&&hl(),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return Ea(),lt(nn),lt(zt),ju(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 5:return _u(a),null;case 13:if(lt(ht),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(n(340));xa()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return lt(ht),null;case 4:return Ea(),null;case 10:return xu(a.type._context),null;case 22:case 23:return ah(),null;case 24:return null;default:return null}}var Rl=!1,qt=!1,z1=typeof WeakSet=="function"?WeakSet:Set,Se=null;function Na(r,a){var d=r.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(m){vt(r,a,m)}else d.current=null}function Gu(r,a,d){try{d()}catch(m){vt(r,a,m)}}var uv=!1;function H1(r,a){if(au=Xo,r=Hp(),Qd(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var m=d.getSelection&&d.getSelection();if(m&&m.rangeCount!==0){d=m.anchorNode;var y=m.anchorOffset,E=m.focusNode;m=m.focusOffset;try{d.nodeType,E.nodeType}catch{d=null;break e}var P=0,V=-1,X=-1,oe=0,he=0,me=r,ue=null;t:for(;;){for(var be;me!==d||y!==0&&me.nodeType!==3||(V=P+y),me!==E||m!==0&&me.nodeType!==3||(X=P+m),me.nodeType===3&&(P+=me.nodeValue.length),(be=me.firstChild)!==null;)ue=me,me=be;for(;;){if(me===r)break t;if(ue===d&&++oe===y&&(V=P),ue===E&&++he===m&&(X=P),(be=me.nextSibling)!==null)break;me=ue,ue=me.parentNode}me=be}d=V===-1||X===-1?null:{start:V,end:X}}else d=null}d=d||{start:0,end:0}}else d=null;for(iu={focusedElem:r,selectionRange:d},Xo=!1,Se=a;Se!==null;)if(a=Se,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,Se=r;else for(;Se!==null;){a=Se;try{var Ee=a.alternate;if((a.flags&1024)!==0)switch(a.tag){case 0:case 11:case 15:break;case 1:if(Ee!==null){var _e=Ee.memoizedProps,bt=Ee.memoizedState,re=a.stateNode,te=re.getSnapshotBeforeUpdate(a.elementType===a.type?_e:Vn(a.type,_e),bt);re.__reactInternalSnapshotBeforeUpdate=te}break;case 3:var se=a.stateNode.containerInfo;se.nodeType===1?se.textContent="":se.nodeType===9&&se.documentElement&&se.removeChild(se.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(pe){vt(a,a.return,pe)}if(r=a.sibling,r!==null){r.return=a.return,Se=r;break}Se=a.return}return Ee=uv,uv=!1,Ee}function zi(r,a,d){var m=a.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var y=m=m.next;do{if((y.tag&r)===r){var E=y.destroy;y.destroy=void 0,E!==void 0&&Gu(a,d,E)}y=y.next}while(y!==m)}}function Il(r,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&r)===r){var m=d.create;d.destroy=m()}d=d.next}while(d!==a)}}function Ku(r){var a=r.ref;if(a!==null){var d=r.stateNode;switch(r.tag){case 5:r=d;break;default:r=d}typeof a=="function"?a(r):a.current=r}}function hv(r){var a=r.alternate;a!==null&&(r.alternate=null,hv(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&(delete a[cr],delete a[Pi],delete a[du],delete a[_1],delete a[N1])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function fv(r){return r.tag===5||r.tag===3||r.tag===4}function mv(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||fv(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Yu(r,a,d){var m=r.tag;if(m===5||m===6)r=r.stateNode,a?d.nodeType===8?d.parentNode.insertBefore(r,a):d.insertBefore(r,a):(d.nodeType===8?(a=d.parentNode,a.insertBefore(r,d)):(a=d,a.appendChild(r)),d=d._reactRootContainer,d!=null||a.onclick!==null||(a.onclick=dl));else if(m!==4&&(r=r.child,r!==null))for(Yu(r,a,d),r=r.sibling;r!==null;)Yu(r,a,d),r=r.sibling}function Ju(r,a,d){var m=r.tag;if(m===5||m===6)r=r.stateNode,a?d.insertBefore(r,a):d.appendChild(r);else if(m!==4&&(r=r.child,r!==null))for(Ju(r,a,d),r=r.sibling;r!==null;)Ju(r,a,d),r=r.sibling}var Dt=null,qn=!1;function ts(r,a,d){for(d=d.child;d!==null;)pv(r,a,d),d=d.sibling}function pv(r,a,d){if(lr&&typeof lr.onCommitFiberUnmount=="function")try{lr.onCommitFiberUnmount(Wo,d)}catch{}switch(d.tag){case 5:qt||Na(d,a);case 6:var m=Dt,y=qn;Dt=null,ts(r,a,d),Dt=m,qn=y,Dt!==null&&(qn?(r=Dt,d=d.stateNode,r.nodeType===8?r.parentNode.removeChild(d):r.removeChild(d)):Dt.removeChild(d.stateNode));break;case 18:Dt!==null&&(qn?(r=Dt,d=d.stateNode,r.nodeType===8?cu(r.parentNode,d):r.nodeType===1&&cu(r,d),xi(r)):cu(Dt,d.stateNode));break;case 4:m=Dt,y=qn,Dt=d.stateNode.containerInfo,qn=!0,ts(r,a,d),Dt=m,qn=y;break;case 0:case 11:case 14:case 15:if(!qt&&(m=d.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){y=m=m.next;do{var E=y,P=E.destroy;E=E.tag,P!==void 0&&((E&2)!==0||(E&4)!==0)&&Gu(d,a,P),y=y.next}while(y!==m)}ts(r,a,d);break;case 1:if(!qt&&(Na(d,a),m=d.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=d.memoizedProps,m.state=d.memoizedState,m.componentWillUnmount()}catch(V){vt(d,a,V)}ts(r,a,d);break;case 21:ts(r,a,d);break;case 22:d.mode&1?(qt=(m=qt)||d.memoizedState!==null,ts(r,a,d),qt=m):ts(r,a,d);break;default:ts(r,a,d)}}function gv(r){var a=r.updateQueue;if(a!==null){r.updateQueue=null;var d=r.stateNode;d===null&&(d=r.stateNode=new z1),a.forEach(function(m){var y=X1.bind(null,r,m);d.has(m)||(d.add(m),m.then(y,y))})}}function Wn(r,a){var d=a.deletions;if(d!==null)for(var m=0;m<d.length;m++){var y=d[m];try{var E=r,P=a,V=P;e:for(;V!==null;){switch(V.tag){case 5:Dt=V.stateNode,qn=!1;break e;case 3:Dt=V.stateNode.containerInfo,qn=!0;break e;case 4:Dt=V.stateNode.containerInfo,qn=!0;break e}V=V.return}if(Dt===null)throw Error(n(160));pv(E,P,y),Dt=null,qn=!1;var X=y.alternate;X!==null&&(X.return=null),y.return=null}catch(oe){vt(y,a,oe)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)vv(a,r),a=a.sibling}function vv(r,a){var d=r.alternate,m=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Wn(a,r),hr(r),m&4){try{zi(3,r,r.return),Il(3,r)}catch(_e){vt(r,r.return,_e)}try{zi(5,r,r.return)}catch(_e){vt(r,r.return,_e)}}break;case 1:Wn(a,r),hr(r),m&512&&d!==null&&Na(d,d.return);break;case 5:if(Wn(a,r),hr(r),m&512&&d!==null&&Na(d,d.return),r.flags&32){var y=r.stateNode;try{Rt(y,"")}catch(_e){vt(r,r.return,_e)}}if(m&4&&(y=r.stateNode,y!=null)){var E=r.memoizedProps,P=d!==null?d.memoizedProps:E,V=r.type,X=r.updateQueue;if(r.updateQueue=null,X!==null)try{V==="input"&&E.type==="radio"&&E.name!=null&&ie(y,E),ui(V,P);var oe=ui(V,E);for(P=0;P<X.length;P+=2){var he=X[P],me=X[P+1];he==="style"?Sr(y,me):he==="dangerouslySetInnerHTML"?Bt(y,me):he==="children"?Rt(y,me):j(y,he,me,oe)}switch(V){case"input":Re(y,E);break;case"textarea":pt(y,E);break;case"select":var ue=y._wrapperState.wasMultiple;y._wrapperState.wasMultiple=!!E.multiple;var be=E.value;be!=null?ze(y,!!E.multiple,be,!1):ue!==!!E.multiple&&(E.defaultValue!=null?ze(y,!!E.multiple,E.defaultValue,!0):ze(y,!!E.multiple,E.multiple?[]:"",!1))}y[Pi]=E}catch(_e){vt(r,r.return,_e)}}break;case 6:if(Wn(a,r),hr(r),m&4){if(r.stateNode===null)throw Error(n(162));y=r.stateNode,E=r.memoizedProps;try{y.nodeValue=E}catch(_e){vt(r,r.return,_e)}}break;case 3:if(Wn(a,r),hr(r),m&4&&d!==null&&d.memoizedState.isDehydrated)try{xi(a.containerInfo)}catch(_e){vt(r,r.return,_e)}break;case 4:Wn(a,r),hr(r);break;case 13:Wn(a,r),hr(r),y=r.child,y.flags&8192&&(E=y.memoizedState!==null,y.stateNode.isHidden=E,!E||y.alternate!==null&&y.alternate.memoizedState!==null||(Zu=xt())),m&4&&gv(r);break;case 22:if(he=d!==null&&d.memoizedState!==null,r.mode&1?(qt=(oe=qt)||he,Wn(a,r),qt=oe):Wn(a,r),hr(r),m&8192){if(oe=r.memoizedState!==null,(r.stateNode.isHidden=oe)&&!he&&(r.mode&1)!==0)for(Se=r,he=r.child;he!==null;){for(me=Se=he;Se!==null;){switch(ue=Se,be=ue.child,ue.tag){case 0:case 11:case 14:case 15:zi(4,ue,ue.return);break;case 1:Na(ue,ue.return);var Ee=ue.stateNode;if(typeof Ee.componentWillUnmount=="function"){m=ue,d=ue.return;try{a=m,Ee.props=a.memoizedProps,Ee.state=a.memoizedState,Ee.componentWillUnmount()}catch(_e){vt(m,d,_e)}}break;case 5:Na(ue,ue.return);break;case 22:if(ue.memoizedState!==null){xv(me);continue}}be!==null?(be.return=ue,Se=be):xv(me)}he=he.sibling}e:for(he=null,me=r;;){if(me.tag===5){if(he===null){he=me;try{y=me.stateNode,oe?(E=y.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none"):(V=me.stateNode,X=me.memoizedProps.style,P=X!=null&&X.hasOwnProperty("display")?X.display:null,V.style.display=Br("display",P))}catch(_e){vt(r,r.return,_e)}}}else if(me.tag===6){if(he===null)try{me.stateNode.nodeValue=oe?"":me.memoizedProps}catch(_e){vt(r,r.return,_e)}}else if((me.tag!==22&&me.tag!==23||me.memoizedState===null||me===r)&&me.child!==null){me.child.return=me,me=me.child;continue}if(me===r)break e;for(;me.sibling===null;){if(me.return===null||me.return===r)break e;he===me&&(he=null),me=me.return}he===me&&(he=null),me.sibling.return=me.return,me=me.sibling}}break;case 19:Wn(a,r),hr(r),m&4&&gv(r);break;case 21:break;default:Wn(a,r),hr(r)}}function hr(r){var a=r.flags;if(a&2){try{e:{for(var d=r.return;d!==null;){if(fv(d)){var m=d;break e}d=d.return}throw Error(n(160))}switch(m.tag){case 5:var y=m.stateNode;m.flags&32&&(Rt(y,""),m.flags&=-33);var E=mv(r);Ju(r,E,y);break;case 3:case 4:var P=m.stateNode.containerInfo,V=mv(r);Yu(r,V,P);break;default:throw Error(n(161))}}catch(X){vt(r,r.return,X)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function V1(r,a,d){Se=r,yv(r)}function yv(r,a,d){for(var m=(r.mode&1)!==0;Se!==null;){var y=Se,E=y.child;if(y.tag===22&&m){var P=y.memoizedState!==null||Rl;if(!P){var V=y.alternate,X=V!==null&&V.memoizedState!==null||qt;V=Rl;var oe=qt;if(Rl=P,(qt=X)&&!oe)for(Se=y;Se!==null;)P=Se,X=P.child,P.tag===22&&P.memoizedState!==null?bv(y):X!==null?(X.return=P,Se=X):bv(y);for(;E!==null;)Se=E,yv(E),E=E.sibling;Se=y,Rl=V,qt=oe}wv(r)}else(y.subtreeFlags&8772)!==0&&E!==null?(E.return=y,Se=E):wv(r)}}function wv(r){for(;Se!==null;){var a=Se;if((a.flags&8772)!==0){var d=a.alternate;try{if((a.flags&8772)!==0)switch(a.tag){case 0:case 11:case 15:qt||Il(5,a);break;case 1:var m=a.stateNode;if(a.flags&4&&!qt)if(d===null)m.componentDidMount();else{var y=a.elementType===a.type?d.memoizedProps:Vn(a.type,d.memoizedProps);m.componentDidUpdate(y,d.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var E=a.updateQueue;E!==null&&xg(a,E,m);break;case 3:var P=a.updateQueue;if(P!==null){if(d=null,a.child!==null)switch(a.child.tag){case 5:d=a.child.stateNode;break;case 1:d=a.child.stateNode}xg(a,P,d)}break;case 5:var V=a.stateNode;if(d===null&&a.flags&4){d=V;var X=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":X.autoFocus&&d.focus();break;case"img":X.src&&(d.src=X.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var oe=a.alternate;if(oe!==null){var he=oe.memoizedState;if(he!==null){var me=he.dehydrated;me!==null&&xi(me)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}qt||a.flags&512&&Ku(a)}catch(ue){vt(a,a.return,ue)}}if(a===r){Se=null;break}if(d=a.sibling,d!==null){d.return=a.return,Se=d;break}Se=a.return}}function xv(r){for(;Se!==null;){var a=Se;if(a===r){Se=null;break}var d=a.sibling;if(d!==null){d.return=a.return,Se=d;break}Se=a.return}}function bv(r){for(;Se!==null;){var a=Se;try{switch(a.tag){case 0:case 11:case 15:var d=a.return;try{Il(4,a)}catch(X){vt(a,d,X)}break;case 1:var m=a.stateNode;if(typeof m.componentDidMount=="function"){var y=a.return;try{m.componentDidMount()}catch(X){vt(a,y,X)}}var E=a.return;try{Ku(a)}catch(X){vt(a,E,X)}break;case 5:var P=a.return;try{Ku(a)}catch(X){vt(a,P,X)}}}catch(X){vt(a,a.return,X)}if(a===r){Se=null;break}var V=a.sibling;if(V!==null){V.return=a.return,Se=V;break}Se=a.return}}var q1=Math.ceil,Dl=T.ReactCurrentDispatcher,Qu=T.ReactCurrentOwner,Nn=T.ReactCurrentBatchConfig,Qe=0,At=null,St=null,Ot=0,pn=0,ja=Jr(0),jt=0,Hi=null,Ls=0,Ol=0,Xu=0,Vi=null,an=null,Zu=0,ka=1/0,Pr=null,Ll=!1,eh=null,ns=null,Ml=!1,rs=null,$l=0,qi=0,th=null,Fl=-1,Ul=0;function Yt(){return(Qe&6)!==0?xt():Fl!==-1?Fl:Fl=xt()}function ss(r){return(r.mode&1)===0?1:(Qe&2)!==0&&Ot!==0?Ot&-Ot:k1.transition!==null?(Ul===0&&(Ul=mp()),Ul):(r=et,r!==0||(r=window.event,r=r===void 0?16:Sp(r.type)),r)}function Gn(r,a,d,m){if(50<qi)throw qi=0,th=null,Error(n(185));pi(r,d,m),((Qe&2)===0||r!==At)&&(r===At&&((Qe&2)===0&&(Ol|=d),jt===4&&as(r,Ot)),on(r,m),d===1&&Qe===0&&(a.mode&1)===0&&(ka=xt()+500,ml&&Xr()))}function on(r,a){var d=r.callbackNode;k_(r,a);var m=Yo(r,r===At?Ot:0);if(m===0)d!==null&&up(d),r.callbackNode=null,r.callbackPriority=0;else if(a=m&-m,r.callbackPriority!==a){if(d!=null&&up(d),a===1)r.tag===0?j1(Sv.bind(null,r)):lg(Sv.bind(null,r)),S1(function(){(Qe&6)===0&&Xr()}),d=null;else{switch(pp(m)){case 1:d=Dd;break;case 4:d=hp;break;case 16:d=qo;break;case 536870912:d=fp;break;default:d=qo}d=Pv(d,Cv.bind(null,r))}r.callbackPriority=a,r.callbackNode=d}}function Cv(r,a){if(Fl=-1,Ul=0,(Qe&6)!==0)throw Error(n(327));var d=r.callbackNode;if(Ta()&&r.callbackNode!==d)return null;var m=Yo(r,r===At?Ot:0);if(m===0)return null;if((m&30)!==0||(m&r.expiredLanes)!==0||a)a=Bl(r,m);else{a=m;var y=Qe;Qe|=2;var E=_v();(At!==r||Ot!==a)&&(Pr=null,ka=xt()+500,$s(r,a));do try{K1();break}catch(V){Ev(r,V)}while(!0);wu(),Dl.current=E,Qe=y,St!==null?a=0:(At=null,Ot=0,a=jt)}if(a!==0){if(a===2&&(y=Od(r),y!==0&&(m=y,a=nh(r,y))),a===1)throw d=Hi,$s(r,0),as(r,m),on(r,xt()),d;if(a===6)as(r,m);else{if(y=r.current.alternate,(m&30)===0&&!W1(y)&&(a=Bl(r,m),a===2&&(E=Od(r),E!==0&&(m=E,a=nh(r,E))),a===1))throw d=Hi,$s(r,0),as(r,m),on(r,xt()),d;switch(r.finishedWork=y,r.finishedLanes=m,a){case 0:case 1:throw Error(n(345));case 2:Fs(r,an,Pr);break;case 3:if(as(r,m),(m&130023424)===m&&(a=Zu+500-xt(),10<a)){if(Yo(r,0)!==0)break;if(y=r.suspendedLanes,(y&m)!==m){Yt(),r.pingedLanes|=r.suspendedLanes&y;break}r.timeoutHandle=lu(Fs.bind(null,r,an,Pr),a);break}Fs(r,an,Pr);break;case 4:if(as(r,m),(m&4194240)===m)break;for(a=r.eventTimes,y=-1;0<m;){var P=31-Bn(m);E=1<<P,P=a[P],P>y&&(y=P),m&=~E}if(m=y,m=xt()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*q1(m/1960))-m,10<m){r.timeoutHandle=lu(Fs.bind(null,r,an,Pr),m);break}Fs(r,an,Pr);break;case 5:Fs(r,an,Pr);break;default:throw Error(n(329))}}}return on(r,xt()),r.callbackNode===d?Cv.bind(null,r):null}function nh(r,a){var d=Vi;return r.current.memoizedState.isDehydrated&&($s(r,a).flags|=256),r=Bl(r,a),r!==2&&(a=an,an=d,a!==null&&rh(a)),r}function rh(r){an===null?an=r:an.push.apply(an,r)}function W1(r){for(var a=r;;){if(a.flags&16384){var d=a.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var m=0;m<d.length;m++){var y=d[m],E=y.getSnapshot;y=y.value;try{if(!zn(E(),y))return!1}catch{return!1}}}if(d=a.child,a.subtreeFlags&16384&&d!==null)d.return=a,a=d;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function as(r,a){for(a&=~Xu,a&=~Ol,r.suspendedLanes|=a,r.pingedLanes&=~a,r=r.expirationTimes;0<a;){var d=31-Bn(a),m=1<<d;r[d]=-1,a&=~m}}function Sv(r){if((Qe&6)!==0)throw Error(n(327));Ta();var a=Yo(r,0);if((a&1)===0)return on(r,xt()),null;var d=Bl(r,a);if(r.tag!==0&&d===2){var m=Od(r);m!==0&&(a=m,d=nh(r,m))}if(d===1)throw d=Hi,$s(r,0),as(r,a),on(r,xt()),d;if(d===6)throw Error(n(345));return r.finishedWork=r.current.alternate,r.finishedLanes=a,Fs(r,an,Pr),on(r,xt()),null}function sh(r,a){var d=Qe;Qe|=1;try{return r(a)}finally{Qe=d,Qe===0&&(ka=xt()+500,ml&&Xr())}}function Ms(r){rs!==null&&rs.tag===0&&(Qe&6)===0&&Ta();var a=Qe;Qe|=1;var d=Nn.transition,m=et;try{if(Nn.transition=null,et=1,r)return r()}finally{et=m,Nn.transition=d,Qe=a,(Qe&6)===0&&Xr()}}function ah(){pn=ja.current,lt(ja)}function $s(r,a){r.finishedWork=null,r.finishedLanes=0;var d=r.timeoutHandle;if(d!==-1&&(r.timeoutHandle=-1,C1(d)),St!==null)for(d=St.return;d!==null;){var m=d;switch(mu(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&hl();break;case 3:Ea(),lt(nn),lt(zt),ju();break;case 5:_u(m);break;case 4:Ea();break;case 13:lt(ht);break;case 19:lt(ht);break;case 10:xu(m.type._context);break;case 22:case 23:ah()}d=d.return}if(At=r,St=r=is(r.current,null),Ot=pn=a,jt=0,Hi=null,Xu=Ol=Ls=0,an=Vi=null,Is!==null){for(a=0;a<Is.length;a++)if(d=Is[a],m=d.interleaved,m!==null){d.interleaved=null;var y=m.next,E=d.pending;if(E!==null){var P=E.next;E.next=y,m.next=P}d.pending=m}Is=null}return r}function Ev(r,a){do{var d=St;try{if(wu(),El.current=kl,_l){for(var m=ft.memoizedState;m!==null;){var y=m.queue;y!==null&&(y.pending=null),m=m.next}_l=!1}if(Os=0,Tt=Nt=ft=null,Mi=!1,$i=0,Qu.current=null,d===null||d.return===null){jt=1,Hi=a,St=null;break}e:{var E=r,P=d.return,V=d,X=a;if(a=Ot,V.flags|=32768,X!==null&&typeof X=="object"&&typeof X.then=="function"){var oe=X,he=V,me=he.tag;if((he.mode&1)===0&&(me===0||me===11||me===15)){var ue=he.alternate;ue?(he.updateQueue=ue.updateQueue,he.memoizedState=ue.memoizedState,he.lanes=ue.lanes):(he.updateQueue=null,he.memoizedState=null)}var be=Yg(P);if(be!==null){be.flags&=-257,Jg(be,P,V,E,a),be.mode&1&&Kg(E,oe,a),a=be,X=oe;var Ee=a.updateQueue;if(Ee===null){var _e=new Set;_e.add(X),a.updateQueue=_e}else Ee.add(X);break e}else{if((a&1)===0){Kg(E,oe,a),ih();break e}X=Error(n(426))}}else if(ut&&V.mode&1){var bt=Yg(P);if(bt!==null){(bt.flags&65536)===0&&(bt.flags|=256),Jg(bt,P,V,E,a),vu(_a(X,V));break e}}E=X=_a(X,V),jt!==4&&(jt=2),Vi===null?Vi=[E]:Vi.push(E),E=P;do{switch(E.tag){case 3:E.flags|=65536,a&=-a,E.lanes|=a;var re=Wg(E,X,a);wg(E,re);break e;case 1:V=X;var te=E.type,se=E.stateNode;if((E.flags&128)===0&&(typeof te.getDerivedStateFromError=="function"||se!==null&&typeof se.componentDidCatch=="function"&&(ns===null||!ns.has(se)))){E.flags|=65536,a&=-a,E.lanes|=a;var pe=Gg(E,V,a);wg(E,pe);break e}}E=E.return}while(E!==null)}jv(d)}catch(ke){a=ke,St===d&&d!==null&&(St=d=d.return);continue}break}while(!0)}function _v(){var r=Dl.current;return Dl.current=kl,r===null?kl:r}function ih(){(jt===0||jt===3||jt===2)&&(jt=4),At===null||(Ls&268435455)===0&&(Ol&268435455)===0||as(At,Ot)}function Bl(r,a){var d=Qe;Qe|=2;var m=_v();(At!==r||Ot!==a)&&(Pr=null,$s(r,a));do try{G1();break}catch(y){Ev(r,y)}while(!0);if(wu(),Qe=d,Dl.current=m,St!==null)throw Error(n(261));return At=null,Ot=0,jt}function G1(){for(;St!==null;)Nv(St)}function K1(){for(;St!==null&&!w_();)Nv(St)}function Nv(r){var a=Av(r.alternate,r,pn);r.memoizedProps=r.pendingProps,a===null?jv(r):St=a,Qu.current=null}function jv(r){var a=r;do{var d=a.alternate;if(r=a.return,(a.flags&32768)===0){if(d=U1(d,a,pn),d!==null){St=d;return}}else{if(d=B1(d,a),d!==null){d.flags&=32767,St=d;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{jt=6,St=null;return}}if(a=a.sibling,a!==null){St=a;return}St=a=r}while(a!==null);jt===0&&(jt=5)}function Fs(r,a,d){var m=et,y=Nn.transition;try{Nn.transition=null,et=1,Y1(r,a,d,m)}finally{Nn.transition=y,et=m}return null}function Y1(r,a,d,m){do Ta();while(rs!==null);if((Qe&6)!==0)throw Error(n(327));d=r.finishedWork;var y=r.finishedLanes;if(d===null)return null;if(r.finishedWork=null,r.finishedLanes=0,d===r.current)throw Error(n(177));r.callbackNode=null,r.callbackPriority=0;var E=d.lanes|d.childLanes;if(T_(r,E),r===At&&(St=At=null,Ot=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||Ml||(Ml=!0,Pv(qo,function(){return Ta(),null})),E=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||E){E=Nn.transition,Nn.transition=null;var P=et;et=1;var V=Qe;Qe|=4,Qu.current=null,H1(r,d),vv(d,r),p1(iu),Xo=!!au,iu=au=null,r.current=d,V1(d),x_(),Qe=V,et=P,Nn.transition=E}else r.current=d;if(Ml&&(Ml=!1,rs=r,$l=y),E=r.pendingLanes,E===0&&(ns=null),S_(d.stateNode),on(r,xt()),a!==null)for(m=r.onRecoverableError,d=0;d<a.length;d++)y=a[d],m(y.value,{componentStack:y.stack,digest:y.digest});if(Ll)throw Ll=!1,r=eh,eh=null,r;return($l&1)!==0&&r.tag!==0&&Ta(),E=r.pendingLanes,(E&1)!==0?r===th?qi++:(qi=0,th=r):qi=0,Xr(),null}function Ta(){if(rs!==null){var r=pp($l),a=Nn.transition,d=et;try{if(Nn.transition=null,et=16>r?16:r,rs===null)var m=!1;else{if(r=rs,rs=null,$l=0,(Qe&6)!==0)throw Error(n(331));var y=Qe;for(Qe|=4,Se=r.current;Se!==null;){var E=Se,P=E.child;if((Se.flags&16)!==0){var V=E.deletions;if(V!==null){for(var X=0;X<V.length;X++){var oe=V[X];for(Se=oe;Se!==null;){var he=Se;switch(he.tag){case 0:case 11:case 15:zi(8,he,E)}var me=he.child;if(me!==null)me.return=he,Se=me;else for(;Se!==null;){he=Se;var ue=he.sibling,be=he.return;if(hv(he),he===oe){Se=null;break}if(ue!==null){ue.return=be,Se=ue;break}Se=be}}}var Ee=E.alternate;if(Ee!==null){var _e=Ee.child;if(_e!==null){Ee.child=null;do{var bt=_e.sibling;_e.sibling=null,_e=bt}while(_e!==null)}}Se=E}}if((E.subtreeFlags&2064)!==0&&P!==null)P.return=E,Se=P;else e:for(;Se!==null;){if(E=Se,(E.flags&2048)!==0)switch(E.tag){case 0:case 11:case 15:zi(9,E,E.return)}var re=E.sibling;if(re!==null){re.return=E.return,Se=re;break e}Se=E.return}}var te=r.current;for(Se=te;Se!==null;){P=Se;var se=P.child;if((P.subtreeFlags&2064)!==0&&se!==null)se.return=P,Se=se;else e:for(P=te;Se!==null;){if(V=Se,(V.flags&2048)!==0)try{switch(V.tag){case 0:case 11:case 15:Il(9,V)}}catch(ke){vt(V,V.return,ke)}if(V===P){Se=null;break e}var pe=V.sibling;if(pe!==null){pe.return=V.return,Se=pe;break e}Se=V.return}}if(Qe=y,Xr(),lr&&typeof lr.onPostCommitFiberRoot=="function")try{lr.onPostCommitFiberRoot(Wo,r)}catch{}m=!0}return m}finally{et=d,Nn.transition=a}}return!1}function kv(r,a,d){a=_a(d,a),a=Wg(r,a,1),r=es(r,a,1),a=Yt(),r!==null&&(pi(r,1,a),on(r,a))}function vt(r,a,d){if(r.tag===3)kv(r,r,d);else for(;a!==null;){if(a.tag===3){kv(a,r,d);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ns===null||!ns.has(m))){r=_a(d,r),r=Gg(a,r,1),a=es(a,r,1),r=Yt(),a!==null&&(pi(a,1,r),on(a,r));break}}a=a.return}}function J1(r,a,d){var m=r.pingCache;m!==null&&m.delete(a),a=Yt(),r.pingedLanes|=r.suspendedLanes&d,At===r&&(Ot&d)===d&&(jt===4||jt===3&&(Ot&130023424)===Ot&&500>xt()-Zu?$s(r,0):Xu|=d),on(r,a)}function Tv(r,a){a===0&&((r.mode&1)===0?a=1:(a=Ko,Ko<<=1,(Ko&130023424)===0&&(Ko=4194304)));var d=Yt();r=kr(r,a),r!==null&&(pi(r,a,d),on(r,d))}function Q1(r){var a=r.memoizedState,d=0;a!==null&&(d=a.retryLane),Tv(r,d)}function X1(r,a){var d=0;switch(r.tag){case 13:var m=r.stateNode,y=r.memoizedState;y!==null&&(d=y.retryLane);break;case 19:m=r.stateNode;break;default:throw Error(n(314))}m!==null&&m.delete(a),Tv(r,d)}var Av;Av=function(r,a,d){if(r!==null)if(r.memoizedProps!==a.pendingProps||nn.current)sn=!0;else{if((r.lanes&d)===0&&(a.flags&128)===0)return sn=!1,F1(r,a,d);sn=(r.flags&131072)!==0}else sn=!1,ut&&(a.flags&1048576)!==0&&cg(a,gl,a.index);switch(a.lanes=0,a.tag){case 2:var m=a.type;Pl(r,a),r=a.pendingProps;var y=va(a,zt.current);Sa(a,d),y=Au(null,a,m,r,y,d);var E=Pu();return a.flags|=1,typeof y=="object"&&y!==null&&typeof y.render=="function"&&y.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,rn(m)?(E=!0,fl(a)):E=!1,a.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,Su(a),y.updater=Tl,a.stateNode=y,y._reactInternals=a,Mu(a,m,r,d),a=Bu(null,a,m,!0,E,d)):(a.tag=0,ut&&E&&fu(a),Kt(null,a,y,d),a=a.child),a;case 16:m=a.elementType;e:{switch(Pl(r,a),r=a.pendingProps,y=m._init,m=y(m._payload),a.type=m,y=a.tag=eN(m),r=Vn(m,r),y){case 0:a=Uu(null,a,m,r,d);break e;case 1:a=nv(null,a,m,r,d);break e;case 11:a=Qg(null,a,m,r,d);break e;case 14:a=Xg(null,a,m,Vn(m.type,r),d);break e}throw Error(n(306,m,""))}return a;case 0:return m=a.type,y=a.pendingProps,y=a.elementType===m?y:Vn(m,y),Uu(r,a,m,y,d);case 1:return m=a.type,y=a.pendingProps,y=a.elementType===m?y:Vn(m,y),nv(r,a,m,y,d);case 3:e:{if(rv(a),r===null)throw Error(n(387));m=a.pendingProps,E=a.memoizedState,y=E.element,yg(r,a),Cl(a,m,null,d);var P=a.memoizedState;if(m=P.element,E.isDehydrated)if(E={element:m,isDehydrated:!1,cache:P.cache,pendingSuspenseBoundaries:P.pendingSuspenseBoundaries,transitions:P.transitions},a.updateQueue.baseState=E,a.memoizedState=E,a.flags&256){y=_a(Error(n(423)),a),a=sv(r,a,m,d,y);break e}else if(m!==y){y=_a(Error(n(424)),a),a=sv(r,a,m,d,y);break e}else for(mn=Yr(a.stateNode.containerInfo.firstChild),fn=a,ut=!0,Hn=null,d=gg(a,null,m,d),a.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(xa(),m===y){a=Ar(r,a,d);break e}Kt(r,a,m,d)}a=a.child}return a;case 5:return bg(a),r===null&&gu(a),m=a.type,y=a.pendingProps,E=r!==null?r.memoizedProps:null,P=y.children,ou(m,y)?P=null:E!==null&&ou(m,E)&&(a.flags|=32),tv(r,a),Kt(r,a,P,d),a.child;case 6:return r===null&&gu(a),null;case 13:return av(r,a,d);case 4:return Eu(a,a.stateNode.containerInfo),m=a.pendingProps,r===null?a.child=ba(a,null,m,d):Kt(r,a,m,d),a.child;case 11:return m=a.type,y=a.pendingProps,y=a.elementType===m?y:Vn(m,y),Qg(r,a,m,y,d);case 7:return Kt(r,a,a.pendingProps,d),a.child;case 8:return Kt(r,a,a.pendingProps.children,d),a.child;case 12:return Kt(r,a,a.pendingProps.children,d),a.child;case 10:e:{if(m=a.type._context,y=a.pendingProps,E=a.memoizedProps,P=y.value,at(wl,m._currentValue),m._currentValue=P,E!==null)if(zn(E.value,P)){if(E.children===y.children&&!nn.current){a=Ar(r,a,d);break e}}else for(E=a.child,E!==null&&(E.return=a);E!==null;){var V=E.dependencies;if(V!==null){P=E.child;for(var X=V.firstContext;X!==null;){if(X.context===m){if(E.tag===1){X=Tr(-1,d&-d),X.tag=2;var oe=E.updateQueue;if(oe!==null){oe=oe.shared;var he=oe.pending;he===null?X.next=X:(X.next=he.next,he.next=X),oe.pending=X}}E.lanes|=d,X=E.alternate,X!==null&&(X.lanes|=d),bu(E.return,d,a),V.lanes|=d;break}X=X.next}}else if(E.tag===10)P=E.type===a.type?null:E.child;else if(E.tag===18){if(P=E.return,P===null)throw Error(n(341));P.lanes|=d,V=P.alternate,V!==null&&(V.lanes|=d),bu(P,d,a),P=E.sibling}else P=E.child;if(P!==null)P.return=E;else for(P=E;P!==null;){if(P===a){P=null;break}if(E=P.sibling,E!==null){E.return=P.return,P=E;break}P=P.return}E=P}Kt(r,a,y.children,d),a=a.child}return a;case 9:return y=a.type,m=a.pendingProps.children,Sa(a,d),y=En(y),m=m(y),a.flags|=1,Kt(r,a,m,d),a.child;case 14:return m=a.type,y=Vn(m,a.pendingProps),y=Vn(m.type,y),Xg(r,a,m,y,d);case 15:return Zg(r,a,a.type,a.pendingProps,d);case 17:return m=a.type,y=a.pendingProps,y=a.elementType===m?y:Vn(m,y),Pl(r,a),a.tag=1,rn(m)?(r=!0,fl(a)):r=!1,Sa(a,d),Vg(a,m,y),Mu(a,m,y,d),Bu(null,a,m,!0,r,d);case 19:return ov(r,a,d);case 22:return ev(r,a,d)}throw Error(n(156,a.tag))};function Pv(r,a){return dp(r,a)}function Z1(r,a,d,m){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jn(r,a,d,m){return new Z1(r,a,d,m)}function oh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function eN(r){if(typeof r=="function")return oh(r)?1:0;if(r!=null){if(r=r.$$typeof,r===D)return 11;if(r===q)return 14}return 2}function is(r,a){var d=r.alternate;return d===null?(d=jn(r.tag,a,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=a,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&14680064,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,a=r.dependencies,d.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d}function zl(r,a,d,m,y,E){var P=2;if(m=r,typeof r=="function")oh(r)&&(P=1);else if(typeof r=="string")P=5;else e:switch(r){case I:return Us(d.children,y,E,a);case L:P=8,y|=8;break;case Z:return r=jn(12,d,a,y|2),r.elementType=Z,r.lanes=E,r;case B:return r=jn(13,d,a,y),r.elementType=B,r.lanes=E,r;case z:return r=jn(19,d,a,y),r.elementType=z,r.lanes=E,r;case Q:return Hl(d,y,E,a);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case M:P=10;break e;case U:P=9;break e;case D:P=11;break e;case q:P=14;break e;case H:P=16,m=null;break e}throw Error(n(130,r==null?r:typeof r,""))}return a=jn(P,d,a,y),a.elementType=r,a.type=m,a.lanes=E,a}function Us(r,a,d,m){return r=jn(7,r,m,a),r.lanes=d,r}function Hl(r,a,d,m){return r=jn(22,r,m,a),r.elementType=Q,r.lanes=d,r.stateNode={isHidden:!1},r}function lh(r,a,d){return r=jn(6,r,null,a),r.lanes=d,r}function ch(r,a,d){return a=jn(4,r.children!==null?r.children:[],r.key,a),a.lanes=d,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}function tN(r,a,d,m,y){this.tag=a,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ld(0),this.expirationTimes=Ld(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ld(0),this.identifierPrefix=m,this.onRecoverableError=y,this.mutableSourceEagerHydrationData=null}function dh(r,a,d,m,y,E,P,V,X){return r=new tN(r,a,d,V,X),a===1?(a=1,E===!0&&(a|=8)):a=0,E=jn(3,null,null,a),r.current=E,E.stateNode=r,E.memoizedState={element:m,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Su(E),r}function nN(r,a,d){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:A,key:m==null?null:""+m,children:r,containerInfo:a,implementation:d}}function Rv(r){if(!r)return Qr;r=r._reactInternals;e:{if(ks(r)!==r||r.tag!==1)throw Error(n(170));var a=r;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(rn(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(n(171))}if(r.tag===1){var d=r.type;if(rn(d))return ig(r,d,a)}return a}function Iv(r,a,d,m,y,E,P,V,X){return r=dh(d,m,!0,r,y,E,P,V,X),r.context=Rv(null),d=r.current,m=Yt(),y=ss(d),E=Tr(m,y),E.callback=a??null,es(d,E,y),r.current.lanes=y,pi(r,y,m),on(r,m),r}function Vl(r,a,d,m){var y=a.current,E=Yt(),P=ss(y);return d=Rv(d),a.context===null?a.context=d:a.pendingContext=d,a=Tr(E,P),a.payload={element:r},m=m===void 0?null:m,m!==null&&(a.callback=m),r=es(y,a,P),r!==null&&(Gn(r,y,P,E),bl(r,y,P)),P}function ql(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function Dv(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<a?d:a}}function uh(r,a){Dv(r,a),(r=r.alternate)&&Dv(r,a)}function rN(){return null}var Ov=typeof reportError=="function"?reportError:function(r){console.error(r)};function hh(r){this._internalRoot=r}Wl.prototype.render=hh.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(n(409));Vl(r,a,null,null)},Wl.prototype.unmount=hh.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;Ms(function(){Vl(null,r,null,null)}),a[Er]=null}};function Wl(r){this._internalRoot=r}Wl.prototype.unstable_scheduleHydration=function(r){if(r){var a=yp();r={blockedOn:null,target:r,priority:a};for(var d=0;d<Wr.length&&a!==0&&a<Wr[d].priority;d++);Wr.splice(d,0,r),d===0&&bp(r)}};function fh(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Gl(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function Lv(){}function sN(r,a,d,m,y){if(y){if(typeof m=="function"){var E=m;m=function(){var oe=ql(P);E.call(oe)}}var P=Iv(a,m,r,0,null,!1,!1,"",Lv);return r._reactRootContainer=P,r[Er]=P.current,Ti(r.nodeType===8?r.parentNode:r),Ms(),P}for(;y=r.lastChild;)r.removeChild(y);if(typeof m=="function"){var V=m;m=function(){var oe=ql(X);V.call(oe)}}var X=dh(r,0,!1,null,null,!1,!1,"",Lv);return r._reactRootContainer=X,r[Er]=X.current,Ti(r.nodeType===8?r.parentNode:r),Ms(function(){Vl(a,X,d,m)}),X}function Kl(r,a,d,m,y){var E=d._reactRootContainer;if(E){var P=E;if(typeof y=="function"){var V=y;y=function(){var X=ql(P);V.call(X)}}Vl(a,P,r,y)}else P=sN(d,a,r,y,m);return ql(P)}gp=function(r){switch(r.tag){case 3:var a=r.stateNode;if(a.current.memoizedState.isDehydrated){var d=mi(a.pendingLanes);d!==0&&(Md(a,d|1),on(a,xt()),(Qe&6)===0&&(ka=xt()+500,Xr()))}break;case 13:Ms(function(){var m=kr(r,1);if(m!==null){var y=Yt();Gn(m,r,1,y)}}),uh(r,1)}},$d=function(r){if(r.tag===13){var a=kr(r,134217728);if(a!==null){var d=Yt();Gn(a,r,134217728,d)}uh(r,134217728)}},vp=function(r){if(r.tag===13){var a=ss(r),d=kr(r,a);if(d!==null){var m=Yt();Gn(d,r,a,m)}uh(r,a)}},yp=function(){return et},wp=function(r,a){var d=et;try{return et=r,a()}finally{et=d}},oa=function(r,a,d){switch(a){case"input":if(Re(r,d),a=d.name,d.type==="radio"&&a!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<d.length;a++){var m=d[a];if(m!==r&&m.form===r.form){var y=ul(m);if(!y)throw Error(n(90));Ie(m),Re(m,y)}}}break;case"textarea":pt(r,d);break;case"select":a=d.value,a!=null&&ze(r,!!d.multiple,a,!1)}},Ze=sh,nt=Ms;var aN={usingClientEntryPoint:!1,Events:[Ri,pa,ul,zo,Be,sh]},Wi={findFiberByHostInstance:Ts,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iN={bundleType:Wi.bundleType,version:Wi.version,rendererPackageName:Wi.rendererPackageName,rendererConfig:Wi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:T.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=lp(r),r===null?null:r.stateNode},findFiberByHostInstance:Wi.findFiberByHostInstance||rN,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yl.isDisabled&&Yl.supportsFiber)try{Wo=Yl.inject(iN),lr=Yl}catch{}}return ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aN,ln.createPortal=function(r,a){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fh(a))throw Error(n(200));return nN(r,a,null,d)},ln.createRoot=function(r,a){if(!fh(r))throw Error(n(299));var d=!1,m="",y=Ov;return a!=null&&(a.unstable_strictMode===!0&&(d=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onRecoverableError!==void 0&&(y=a.onRecoverableError)),a=dh(r,1,!1,null,null,d,!1,m,y),r[Er]=a.current,Ti(r.nodeType===8?r.parentNode:r),new hh(a)},ln.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=lp(a),r=r===null?null:r.stateNode,r},ln.flushSync=function(r){return Ms(r)},ln.hydrate=function(r,a,d){if(!Gl(a))throw Error(n(200));return Kl(null,r,a,!0,d)},ln.hydrateRoot=function(r,a,d){if(!fh(r))throw Error(n(405));var m=d!=null&&d.hydratedSources||null,y=!1,E="",P=Ov;if(d!=null&&(d.unstable_strictMode===!0&&(y=!0),d.identifierPrefix!==void 0&&(E=d.identifierPrefix),d.onRecoverableError!==void 0&&(P=d.onRecoverableError)),a=Iv(a,null,r,1,d??null,y,!1,E,P),r[Er]=a.current,Ti(r),m)for(r=0;r<m.length;r++)d=m[r],y=d._getVersion,y=y(d._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[d,y]:a.mutableSourceEagerHydrationData.push(d,y);return new Wl(a)},ln.render=function(r,a,d){if(!Gl(a))throw Error(n(200));return Kl(null,r,a,!1,d)},ln.unmountComponentAtNode=function(r){if(!Gl(r))throw Error(n(40));return r._reactRootContainer?(Ms(function(){Kl(null,null,r,!1,function(){r._reactRootContainer=null,r[Er]=null})}),!0):!1},ln.unstable_batchedUpdates=sh,ln.unstable_renderSubtreeIntoContainer=function(r,a,d,m){if(!Gl(d))throw Error(n(200));if(r==null||r._reactInternals===void 0)throw Error(n(38));return Kl(r,a,d,!1,m)},ln.version="18.3.1-next-f1338f8080-20240426",ln}var Vv;function Jw(){if(Vv)return gh.exports;Vv=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),gh.exports=mN(),gh.exports}var qv;function pN(){if(qv)return Jl;qv=1;var e=Jw();return Jl.createRoot=e.createRoot,Jl.hydrateRoot=e.hydrateRoot,Jl}var gN=pN(),p=Jf();const ge=Yf(p),Qf=Yw({__proto__:null,default:ge},[p]),vN=1,yN=1e6;let wh=0;function wN(){return wh=(wh+1)%Number.MAX_SAFE_INTEGER,wh.toString()}const xh=new Map,Wv=e=>{if(xh.has(e))return;const t=setTimeout(()=>{xh.delete(e),so({type:"REMOVE_TOAST",toastId:e})},yN);xh.set(e,t)},xN=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,vN)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(n=>n.id===t.toast.id?{...n,...t.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=t;return n?Wv(n):e.toasts.forEach(s=>{Wv(s.id)}),{...e,toasts:e.toasts.map(s=>s.id===n||n===void 0?{...s,open:!1}:s)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(n=>n.id!==t.toastId)}}},bc=[];let Cc={toasts:[]};function so(e){Cc=xN(Cc,e),bc.forEach(t=>{t(Cc)})}function bN({...e}){const t=wN(),n=o=>so({type:"UPDATE_TOAST",toast:{...o,id:t}}),s=()=>so({type:"DISMISS_TOAST",toastId:t});return so({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:o=>{o||s()}}}),{id:t,dismiss:s,update:n}}function _t(){const[e,t]=p.useState(Cc);return p.useEffect(()=>(bc.push(t),()=>{const n=bc.indexOf(t);n>-1&&bc.splice(n,1)}),[e]),{...e,toast:bN,dismiss:n=>so({type:"DISMISS_TOAST",toastId:n})}}var ei=Jw();const Qw=Yf(ei);function we(e,t,{checkForDefaultPrevented:n=!0}={}){return function(o){if(e?.(o),n===!1||!o.defaultPrevented)return t?.(o)}}function Gv(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Xc(...e){return t=>{let n=!1;const s=e.map(o=>{const l=Gv(o,t);return!n&&typeof l=="function"&&(n=!0),l});if(n)return()=>{for(let o=0;o<s.length;o++){const l=s[o];typeof l=="function"?l():Gv(e[o],null)}}}}function Ye(...e){return p.useCallback(Xc(...e),e)}function CN(e,t){const n=p.createContext(t),s=l=>{const{children:c,...u}=l,h=p.useMemo(()=>u,Object.values(u));return i.jsx(n.Provider,{value:h,children:c})};s.displayName=e+"Provider";function o(l){const c=p.useContext(n);if(c)return c;if(t!==void 0)return t;throw new Error(`\`${l}\` must be used within \`${e}\``)}return[s,o]}function Mn(e,t=[]){let n=[];function s(l,c){const u=p.createContext(c),h=n.length;n=[...n,c];const f=v=>{const{scope:b,children:x,...S}=v,C=b?.[e]?.[h]||u,w=p.useMemo(()=>S,Object.values(S));return i.jsx(C.Provider,{value:w,children:x})};f.displayName=l+"Provider";function g(v,b){const x=b?.[e]?.[h]||u,S=p.useContext(x);if(S)return S;if(c!==void 0)return c;throw new Error(`\`${v}\` must be used within \`${l}\``)}return[f,g]}const o=()=>{const l=n.map(c=>p.createContext(c));return function(u){const h=u?.[e]||l;return p.useMemo(()=>({[`__scope${e}`]:{...u,[e]:h}}),[u,h])}};return o.scopeName=e,[s,SN(o,...t)]}function SN(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const s=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(l){const c=s.reduce((u,{useScope:h,scopeName:f})=>{const v=h(l)[`__scope${f}`];return{...u,...v}},{});return p.useMemo(()=>({[`__scope${t.scopeName}`]:c}),[c])}};return n.scopeName=t.scopeName,n}function Qs(e){const t=_N(e),n=p.forwardRef((s,o)=>{const{children:l,...c}=s,u=p.Children.toArray(l),h=u.find(NN);if(h){const f=h.props.children,g=u.map(v=>v===h?p.Children.count(f)>1?p.Children.only(null):p.isValidElement(f)?f.props.children:null:v);return i.jsx(t,{...c,ref:o,children:p.isValidElement(f)?p.cloneElement(f,void 0,g):null})}return i.jsx(t,{...c,ref:o,children:l})});return n.displayName=`${e}.Slot`,n}var EN=Qs("Slot");function _N(e){const t=p.forwardRef((n,s)=>{const{children:o,...l}=n;if(p.isValidElement(o)){const c=kN(o),u=jN(l,o.props);return o.type!==p.Fragment&&(u.ref=s?Xc(s,c):c),p.cloneElement(o,u)}return p.Children.count(o)>1?p.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Xw=Symbol("radix.slottable");function Zw(e){const t=({children:n})=>i.jsx(i.Fragment,{children:n});return t.displayName=`${e}.Slottable`,t.__radixId=Xw,t}function NN(e){return p.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Xw}function jN(e,t){const n={...t};for(const s in t){const o=e[s],l=t[s];/^on[A-Z]/.test(s)?o&&l?n[s]=(...u)=>{const h=l(...u);return o(...u),h}:o&&(n[s]=o):s==="style"?n[s]={...o,...l}:s==="className"&&(n[s]=[o,l].filter(Boolean).join(" "))}return{...e,...n}}function kN(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function Zc(e){const t=e+"CollectionProvider",[n,s]=Mn(t),[o,l]=n(t,{collectionRef:{current:null},itemMap:new Map}),c=C=>{const{scope:w,children:N}=C,_=ge.useRef(null),j=ge.useRef(new Map).current;return i.jsx(o,{scope:w,itemMap:j,collectionRef:_,children:N})};c.displayName=t;const u=e+"CollectionSlot",h=Qs(u),f=ge.forwardRef((C,w)=>{const{scope:N,children:_}=C,j=l(u,N),T=Ye(w,j.collectionRef);return i.jsx(h,{ref:T,children:_})});f.displayName=u;const g=e+"CollectionItemSlot",v="data-radix-collection-item",b=Qs(g),x=ge.forwardRef((C,w)=>{const{scope:N,children:_,...j}=C,T=ge.useRef(null),R=Ye(w,T),A=l(g,N);return ge.useEffect(()=>(A.itemMap.set(T,{ref:T,...j}),()=>void A.itemMap.delete(T))),i.jsx(b,{[v]:"",ref:R,children:_})});x.displayName=g;function S(C){const w=l(e+"CollectionConsumer",C);return ge.useCallback(()=>{const _=w.collectionRef.current;if(!_)return[];const j=Array.from(_.querySelectorAll(`[${v}]`));return Array.from(w.itemMap.values()).sort((A,I)=>j.indexOf(A.ref.current)-j.indexOf(I.ref.current))},[w.collectionRef,w.itemMap])}return[{Provider:c,Slot:f,ItemSlot:x},S,s]}var TN=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Me=TN.reduce((e,t)=>{const n=Qs(`Primitive.${t}`),s=p.forwardRef((o,l)=>{const{asChild:c,...u}=o,h=c?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(h,{...u,ref:l})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{});function Xf(e,t){e&&ei.flushSync(()=>e.dispatchEvent(t))}function un(e){const t=p.useRef(e);return p.useEffect(()=>{t.current=e}),p.useMemo(()=>(...n)=>t.current?.(...n),[])}function AN(e,t=globalThis?.document){const n=un(e);p.useEffect(()=>{const s=o=>{o.key==="Escape"&&n(o)};return t.addEventListener("keydown",s,{capture:!0}),()=>t.removeEventListener("keydown",s,{capture:!0})},[n,t])}var PN="DismissableLayer",nf="dismissableLayer.update",RN="dismissableLayer.pointerDownOutside",IN="dismissableLayer.focusOutside",Kv,ex=p.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ti=p.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:l,onInteractOutside:c,onDismiss:u,...h}=e,f=p.useContext(ex),[g,v]=p.useState(null),b=g?.ownerDocument??globalThis?.document,[,x]=p.useState({}),S=Ye(t,I=>v(I)),C=Array.from(f.layers),[w]=[...f.layersWithOutsidePointerEventsDisabled].slice(-1),N=C.indexOf(w),_=g?C.indexOf(g):-1,j=f.layersWithOutsidePointerEventsDisabled.size>0,T=_>=N,R=ON(I=>{const L=I.target,Z=[...f.branches].some(M=>M.contains(L));!T||Z||(o?.(I),c?.(I),I.defaultPrevented||u?.())},b),A=LN(I=>{const L=I.target;[...f.branches].some(M=>M.contains(L))||(l?.(I),c?.(I),I.defaultPrevented||u?.())},b);return AN(I=>{_===f.layers.size-1&&(s?.(I),!I.defaultPrevented&&u&&(I.preventDefault(),u()))},b),p.useEffect(()=>{if(g)return n&&(f.layersWithOutsidePointerEventsDisabled.size===0&&(Kv=b.body.style.pointerEvents,b.body.style.pointerEvents="none"),f.layersWithOutsidePointerEventsDisabled.add(g)),f.layers.add(g),Yv(),()=>{n&&f.layersWithOutsidePointerEventsDisabled.size===1&&(b.body.style.pointerEvents=Kv)}},[g,b,n,f]),p.useEffect(()=>()=>{g&&(f.layers.delete(g),f.layersWithOutsidePointerEventsDisabled.delete(g),Yv())},[g,f]),p.useEffect(()=>{const I=()=>x({});return document.addEventListener(nf,I),()=>document.removeEventListener(nf,I)},[]),i.jsx(Me.div,{...h,ref:S,style:{pointerEvents:j?T?"auto":"none":void 0,...e.style},onFocusCapture:we(e.onFocusCapture,A.onFocusCapture),onBlurCapture:we(e.onBlurCapture,A.onBlurCapture),onPointerDownCapture:we(e.onPointerDownCapture,R.onPointerDownCapture)})});ti.displayName=PN;var DN="DismissableLayerBranch",tx=p.forwardRef((e,t)=>{const n=p.useContext(ex),s=p.useRef(null),o=Ye(t,s);return p.useEffect(()=>{const l=s.current;if(l)return n.branches.add(l),()=>{n.branches.delete(l)}},[n.branches]),i.jsx(Me.div,{...e,ref:o})});tx.displayName=DN;function ON(e,t=globalThis?.document){const n=un(e),s=p.useRef(!1),o=p.useRef(()=>{});return p.useEffect(()=>{const l=u=>{if(u.target&&!s.current){let h=function(){nx(RN,n,f,{discrete:!0})};const f={originalEvent:u};u.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=h,t.addEventListener("click",o.current,{once:!0})):h()}else t.removeEventListener("click",o.current);s.current=!1},c=window.setTimeout(()=>{t.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(c),t.removeEventListener("pointerdown",l),t.removeEventListener("click",o.current)}},[t,n]),{onPointerDownCapture:()=>s.current=!0}}function LN(e,t=globalThis?.document){const n=un(e),s=p.useRef(!1);return p.useEffect(()=>{const o=l=>{l.target&&!s.current&&nx(IN,n,{originalEvent:l},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function Yv(){const e=new CustomEvent(nf);document.dispatchEvent(e)}function nx(e,t,n,{discrete:s}){const o=n.originalEvent.target,l=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),s?Xf(o,l):o.dispatchEvent(l)}var MN=ti,$N=tx,Ut=globalThis?.document?p.useLayoutEffect:()=>{},FN="Portal",No=p.forwardRef((e,t)=>{const{container:n,...s}=e,[o,l]=p.useState(!1);Ut(()=>l(!0),[]);const c=n||o&&globalThis?.document?.body;return c?Qw.createPortal(i.jsx(Me.div,{...s,ref:t}),c):null});No.displayName=FN;function UN(e,t){return p.useReducer((n,s)=>t[n][s]??n,e)}var $n=e=>{const{present:t,children:n}=e,s=BN(t),o=typeof n=="function"?n({present:s.isPresent}):p.Children.only(n),l=Ye(s.ref,zN(o));return typeof n=="function"||s.isPresent?p.cloneElement(o,{ref:l}):null};$n.displayName="Presence";function BN(e){const[t,n]=p.useState(),s=p.useRef(null),o=p.useRef(e),l=p.useRef("none"),c=e?"mounted":"unmounted",[u,h]=UN(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return p.useEffect(()=>{const f=Ql(s.current);l.current=u==="mounted"?f:"none"},[u]),Ut(()=>{const f=s.current,g=o.current;if(g!==e){const b=l.current,x=Ql(f);e?h("MOUNT"):x==="none"||f?.display==="none"?h("UNMOUNT"):h(g&&b!==x?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,h]),Ut(()=>{if(t){let f;const g=t.ownerDocument.defaultView??window,v=x=>{const C=Ql(s.current).includes(x.animationName);if(x.target===t&&C&&(h("ANIMATION_END"),!o.current)){const w=t.style.animationFillMode;t.style.animationFillMode="forwards",f=g.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=w)})}},b=x=>{x.target===t&&(l.current=Ql(s.current))};return t.addEventListener("animationstart",b),t.addEventListener("animationcancel",v),t.addEventListener("animationend",v),()=>{g.clearTimeout(f),t.removeEventListener("animationstart",b),t.removeEventListener("animationcancel",v),t.removeEventListener("animationend",v)}}else h("ANIMATION_END")},[t,h]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:p.useCallback(f=>{s.current=f?getComputedStyle(f):null,n(f)},[])}}function Ql(e){return e?.animationName||"none"}function zN(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var HN=Qf[" useInsertionEffect ".trim().toString()]||Ut;function ys({prop:e,defaultProp:t,onChange:n=()=>{},caller:s}){const[o,l,c]=VN({defaultProp:t,onChange:n}),u=e!==void 0,h=u?e:o;{const g=p.useRef(e!==void 0);p.useEffect(()=>{const v=g.current;v!==u&&console.warn(`${s} is changing from ${v?"controlled":"uncontrolled"} to ${u?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),g.current=u},[u,s])}const f=p.useCallback(g=>{if(u){const v=qN(g)?g(e):g;v!==e&&c.current?.(v)}else l(g)},[u,e,l,c]);return[h,f]}function VN({defaultProp:e,onChange:t}){const[n,s]=p.useState(e),o=p.useRef(n),l=p.useRef(t);return HN(()=>{l.current=t},[t]),p.useEffect(()=>{o.current!==n&&(l.current?.(n),o.current=n)},[n,o]),[n,s,l]}function qN(e){return typeof e=="function"}var rx=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),WN="VisuallyHidden",ed=p.forwardRef((e,t)=>i.jsx(Me.span,{...e,ref:t,style:{...rx,...e.style}}));ed.displayName=WN;var GN=ed,Zf="ToastProvider",[em,KN,YN]=Zc("Toast"),[sx]=Mn("Toast",[YN]),[JN,td]=sx(Zf),ax=e=>{const{__scopeToast:t,label:n="Notification",duration:s=5e3,swipeDirection:o="right",swipeThreshold:l=50,children:c}=e,[u,h]=p.useState(null),[f,g]=p.useState(0),v=p.useRef(!1),b=p.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${Zf}\`. Expected non-empty \`string\`.`),i.jsx(em.Provider,{scope:t,children:i.jsx(JN,{scope:t,label:n,duration:s,swipeDirection:o,swipeThreshold:l,toastCount:f,viewport:u,onViewportChange:h,onToastAdd:p.useCallback(()=>g(x=>x+1),[]),onToastRemove:p.useCallback(()=>g(x=>x-1),[]),isFocusedToastEscapeKeyDownRef:v,isClosePausedRef:b,children:c})})};ax.displayName=Zf;var ix="ToastViewport",QN=["F8"],rf="toast.viewportPause",sf="toast.viewportResume",ox=p.forwardRef((e,t)=>{const{__scopeToast:n,hotkey:s=QN,label:o="Notifications ({hotkey})",...l}=e,c=td(ix,n),u=KN(n),h=p.useRef(null),f=p.useRef(null),g=p.useRef(null),v=p.useRef(null),b=Ye(t,v,c.onViewportChange),x=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),S=c.toastCount>0;p.useEffect(()=>{const w=N=>{s.length!==0&&s.every(j=>N[j]||N.code===j)&&v.current?.focus()};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[s]),p.useEffect(()=>{const w=h.current,N=v.current;if(S&&w&&N){const _=()=>{if(!c.isClosePausedRef.current){const A=new CustomEvent(rf);N.dispatchEvent(A),c.isClosePausedRef.current=!0}},j=()=>{if(c.isClosePausedRef.current){const A=new CustomEvent(sf);N.dispatchEvent(A),c.isClosePausedRef.current=!1}},T=A=>{!w.contains(A.relatedTarget)&&j()},R=()=>{w.contains(document.activeElement)||j()};return w.addEventListener("focusin",_),w.addEventListener("focusout",T),w.addEventListener("pointermove",_),w.addEventListener("pointerleave",R),window.addEventListener("blur",_),window.addEventListener("focus",j),()=>{w.removeEventListener("focusin",_),w.removeEventListener("focusout",T),w.removeEventListener("pointermove",_),w.removeEventListener("pointerleave",R),window.removeEventListener("blur",_),window.removeEventListener("focus",j)}}},[S,c.isClosePausedRef]);const C=p.useCallback(({tabbingDirection:w})=>{const _=u().map(j=>{const T=j.ref.current,R=[T,...dj(T)];return w==="forwards"?R:R.reverse()});return(w==="forwards"?_.reverse():_).flat()},[u]);return p.useEffect(()=>{const w=v.current;if(w){const N=_=>{const j=_.altKey||_.ctrlKey||_.metaKey;if(_.key==="Tab"&&!j){const R=document.activeElement,A=_.shiftKey;if(_.target===w&&A){f.current?.focus();return}const Z=C({tabbingDirection:A?"backwards":"forwards"}),M=Z.findIndex(U=>U===R);bh(Z.slice(M+1))?_.preventDefault():A?f.current?.focus():g.current?.focus()}};return w.addEventListener("keydown",N),()=>w.removeEventListener("keydown",N)}},[u,C]),i.jsxs($N,{ref:h,role:"region","aria-label":o.replace("{hotkey}",x),tabIndex:-1,style:{pointerEvents:S?void 0:"none"},children:[S&&i.jsx(af,{ref:f,onFocusFromOutsideViewport:()=>{const w=C({tabbingDirection:"forwards"});bh(w)}}),i.jsx(em.Slot,{scope:n,children:i.jsx(Me.ol,{tabIndex:-1,...l,ref:b})}),S&&i.jsx(af,{ref:g,onFocusFromOutsideViewport:()=>{const w=C({tabbingDirection:"backwards"});bh(w)}})]})});ox.displayName=ix;var lx="ToastFocusProxy",af=p.forwardRef((e,t)=>{const{__scopeToast:n,onFocusFromOutsideViewport:s,...o}=e,l=td(lx,n);return i.jsx(ed,{"aria-hidden":!0,tabIndex:0,...o,ref:t,style:{position:"fixed"},onFocus:c=>{const u=c.relatedTarget;!l.viewport?.contains(u)&&s()}})});af.displayName=lx;var jo="Toast",XN="toast.swipeStart",ZN="toast.swipeMove",ej="toast.swipeCancel",tj="toast.swipeEnd",cx=p.forwardRef((e,t)=>{const{forceMount:n,open:s,defaultOpen:o,onOpenChange:l,...c}=e,[u,h]=ys({prop:s,defaultProp:o??!0,onChange:l,caller:jo});return i.jsx($n,{present:n||u,children:i.jsx(sj,{open:u,...c,ref:t,onClose:()=>h(!1),onPause:un(e.onPause),onResume:un(e.onResume),onSwipeStart:we(e.onSwipeStart,f=>{f.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:we(e.onSwipeMove,f=>{const{x:g,y:v}=f.detail.delta;f.currentTarget.setAttribute("data-swipe","move"),f.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${g}px`),f.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${v}px`)}),onSwipeCancel:we(e.onSwipeCancel,f=>{f.currentTarget.setAttribute("data-swipe","cancel"),f.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),f.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),f.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),f.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:we(e.onSwipeEnd,f=>{const{x:g,y:v}=f.detail.delta;f.currentTarget.setAttribute("data-swipe","end"),f.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),f.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),f.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${g}px`),f.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${v}px`),h(!1)})})})});cx.displayName=jo;var[nj,rj]=sx(jo,{onClose(){}}),sj=p.forwardRef((e,t)=>{const{__scopeToast:n,type:s="foreground",duration:o,open:l,onClose:c,onEscapeKeyDown:u,onPause:h,onResume:f,onSwipeStart:g,onSwipeMove:v,onSwipeCancel:b,onSwipeEnd:x,...S}=e,C=td(jo,n),[w,N]=p.useState(null),_=Ye(t,z=>N(z)),j=p.useRef(null),T=p.useRef(null),R=o||C.duration,A=p.useRef(0),I=p.useRef(R),L=p.useRef(0),{onToastAdd:Z,onToastRemove:M}=C,U=un(()=>{w?.contains(document.activeElement)&&C.viewport?.focus(),c()}),D=p.useCallback(z=>{!z||z===1/0||(window.clearTimeout(L.current),A.current=new Date().getTime(),L.current=window.setTimeout(U,z))},[U]);p.useEffect(()=>{const z=C.viewport;if(z){const q=()=>{D(I.current),f?.()},H=()=>{const Q=new Date().getTime()-A.current;I.current=I.current-Q,window.clearTimeout(L.current),h?.()};return z.addEventListener(rf,H),z.addEventListener(sf,q),()=>{z.removeEventListener(rf,H),z.removeEventListener(sf,q)}}},[C.viewport,R,h,f,D]),p.useEffect(()=>{l&&!C.isClosePausedRef.current&&D(R)},[l,R,C.isClosePausedRef,D]),p.useEffect(()=>(Z(),()=>M()),[Z,M]);const B=p.useMemo(()=>w?gx(w):null,[w]);return C.viewport?i.jsxs(i.Fragment,{children:[B&&i.jsx(aj,{__scopeToast:n,role:"status","aria-live":s==="foreground"?"assertive":"polite","aria-atomic":!0,children:B}),i.jsx(nj,{scope:n,onClose:U,children:ei.createPortal(i.jsx(em.ItemSlot,{scope:n,children:i.jsx(MN,{asChild:!0,onEscapeKeyDown:we(u,()=>{C.isFocusedToastEscapeKeyDownRef.current||U(),C.isFocusedToastEscapeKeyDownRef.current=!1}),children:i.jsx(Me.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":l?"open":"closed","data-swipe-direction":C.swipeDirection,...S,ref:_,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:we(e.onKeyDown,z=>{z.key==="Escape"&&(u?.(z.nativeEvent),z.nativeEvent.defaultPrevented||(C.isFocusedToastEscapeKeyDownRef.current=!0,U()))}),onPointerDown:we(e.onPointerDown,z=>{z.button===0&&(j.current={x:z.clientX,y:z.clientY})}),onPointerMove:we(e.onPointerMove,z=>{if(!j.current)return;const q=z.clientX-j.current.x,H=z.clientY-j.current.y,Q=!!T.current,$=["left","right"].includes(C.swipeDirection),O=["left","up"].includes(C.swipeDirection)?Math.min:Math.max,J=$?O(0,q):0,F=$?0:O(0,H),ee=z.pointerType==="touch"?10:2,ce={x:J,y:F},K={originalEvent:z,delta:ce};Q?(T.current=ce,Xl(ZN,v,K,{discrete:!1})):Jv(ce,C.swipeDirection,ee)?(T.current=ce,Xl(XN,g,K,{discrete:!1}),z.target.setPointerCapture(z.pointerId)):(Math.abs(q)>ee||Math.abs(H)>ee)&&(j.current=null)}),onPointerUp:we(e.onPointerUp,z=>{const q=T.current,H=z.target;if(H.hasPointerCapture(z.pointerId)&&H.releasePointerCapture(z.pointerId),T.current=null,j.current=null,q){const Q=z.currentTarget,$={originalEvent:z,delta:q};Jv(q,C.swipeDirection,C.swipeThreshold)?Xl(tj,x,$,{discrete:!0}):Xl(ej,b,$,{discrete:!0}),Q.addEventListener("click",O=>O.preventDefault(),{once:!0})}})})})}),C.viewport)})]}):null}),aj=e=>{const{__scopeToast:t,children:n,...s}=e,o=td(jo,t),[l,c]=p.useState(!1),[u,h]=p.useState(!1);return lj(()=>c(!0)),p.useEffect(()=>{const f=window.setTimeout(()=>h(!0),1e3);return()=>window.clearTimeout(f)},[]),u?null:i.jsx(No,{asChild:!0,children:i.jsx(ed,{...s,children:l&&i.jsxs(i.Fragment,{children:[o.label," ",n]})})})},ij="ToastTitle",dx=p.forwardRef((e,t)=>{const{__scopeToast:n,...s}=e;return i.jsx(Me.div,{...s,ref:t})});dx.displayName=ij;var oj="ToastDescription",ux=p.forwardRef((e,t)=>{const{__scopeToast:n,...s}=e;return i.jsx(Me.div,{...s,ref:t})});ux.displayName=oj;var hx="ToastAction",fx=p.forwardRef((e,t)=>{const{altText:n,...s}=e;return n.trim()?i.jsx(px,{altText:n,asChild:!0,children:i.jsx(tm,{...s,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${hx}\`. Expected non-empty \`string\`.`),null)});fx.displayName=hx;var mx="ToastClose",tm=p.forwardRef((e,t)=>{const{__scopeToast:n,...s}=e,o=rj(mx,n);return i.jsx(px,{asChild:!0,children:i.jsx(Me.button,{type:"button",...s,ref:t,onClick:we(e.onClick,o.onClose)})})});tm.displayName=mx;var px=p.forwardRef((e,t)=>{const{__scopeToast:n,altText:s,...o}=e;return i.jsx(Me.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...o,ref:t})});function gx(e){const t=[];return Array.from(e.childNodes).forEach(s=>{if(s.nodeType===s.TEXT_NODE&&s.textContent&&t.push(s.textContent),cj(s)){const o=s.ariaHidden||s.hidden||s.style.display==="none",l=s.dataset.radixToastAnnounceExclude==="";if(!o)if(l){const c=s.dataset.radixToastAnnounceAlt;c&&t.push(c)}else t.push(...gx(s))}}),t}function Xl(e,t,n,{discrete:s}){const o=n.originalEvent.currentTarget,l=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),s?Xf(o,l):o.dispatchEvent(l)}var Jv=(e,t,n=0)=>{const s=Math.abs(e.x),o=Math.abs(e.y),l=s>o;return t==="left"||t==="right"?l&&s>n:!l&&o>n};function lj(e=()=>{}){const t=un(e);Ut(()=>{let n=0,s=0;return n=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(s)}},[t])}function cj(e){return e.nodeType===e.ELEMENT_NODE}function dj(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const o=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||o?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function bh(e){const t=document.activeElement;return e.some(n=>n===t?!0:(n.focus(),document.activeElement!==t))}var uj=ax,vx=ox,yx=cx,wx=dx,xx=ux,bx=fx,Cx=tm;function Sx(e){var t,n,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=Sx(e[t]))&&(s&&(s+=" "),s+=n)}else for(n in e)e[n]&&(s&&(s+=" "),s+=n);return s}function Ex(){for(var e,t,n=0,s="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=Sx(e))&&(s&&(s+=" "),s+=t);return s}const Qv=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,Xv=Ex,nd=(e,t)=>n=>{var s;if(t?.variants==null)return Xv(e,n?.class,n?.className);const{variants:o,defaultVariants:l}=t,c=Object.keys(o).map(f=>{const g=n?.[f],v=l?.[f];if(g===null)return null;const b=Qv(g)||Qv(v);return o[f][b]}),u=n&&Object.entries(n).reduce((f,g)=>{let[v,b]=g;return b===void 0||(f[v]=b),f},{}),h=t==null||(s=t.compoundVariants)===null||s===void 0?void 0:s.reduce((f,g)=>{let{class:v,className:b,...x}=g;return Object.entries(x).every(S=>{let[C,w]=S;return Array.isArray(w)?w.includes({...l,...u}[C]):{...l,...u}[C]===w})?[...f,v,b]:f},[]);return Xv(e,c,h,n?.class,n?.className)};const hj=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),_x=(...e)=>e.filter((t,n,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===n).join(" ").trim();var fj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const mj=p.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:o="",children:l,iconNode:c,...u},h)=>p.createElement("svg",{ref:h,...fj,width:t,height:t,stroke:e,strokeWidth:s?Number(n)*24/Number(t):n,className:_x("lucide",o),...u},[...c.map(([f,g])=>p.createElement(f,g)),...Array.isArray(l)?l:[l]]));const Ne=(e,t)=>{const n=p.forwardRef(({className:s,...o},l)=>p.createElement(mj,{ref:l,iconNode:t,className:_x(`lucide-${hj(e)}`,s),...o}));return n.displayName=`${e}`,n};const Nx=Ne("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const pj=Ne("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const jx=Ne("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);const gj=Ne("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const er=Ne("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const kx=Ne("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const Tx=Ne("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);const nm=Ne("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const vj=Ne("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const Ax=Ne("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const Zl=Ne("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const yj=Ne("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const wj=Ne("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const xj=Ne("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const bj=Ne("Cookie",[["path",{d:"M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5",key:"laymnq"}],["path",{d:"M8.5 8.5v.01",key:"ue8clq"}],["path",{d:"M16 15.5v.01",key:"14dtrp"}],["path",{d:"M12 12v.01",key:"u5ubse"}],["path",{d:"M11 17v.01",key:"1hyl5a"}],["path",{d:"M7 14v.01",key:"uct60s"}]]);const Ch=Ne("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Ac=Ne("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);const Zv=Ne("Delete",[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]]);const Cj=Ne("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);const ey=Ne("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);const Pc=Ne("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const Sj=Ne("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const ty=Ne("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const Sh=Ne("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);const Xs=Ne("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);const Rc=Ne("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);const ny=Ne("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const fr=Ne("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const Ej=Ne("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const ry=Ne("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const _j=Ne("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const Nj=Ne("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const ko=Ne("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);const jj=Ne("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const kj=Ne("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Tj=Ne("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);const Aj=Ne("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const Pj=Ne("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);const To=Ne("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const of=Ne("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Eh=Ne("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);const Rj=Ne("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);const fs=Ne("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const Ij=Ne("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const Dj=Ne("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const Px=Ne("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const lo=Ne("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Sc=Ne("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);const sy=Ne("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);const Js=Ne("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);const Oj=Ne("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const Lj=Ne("Tablet",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]]);const rm=Ne("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const Ks=Ne("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const Mj=Ne("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);const co=Ne("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const $j=Ne("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const sm=Ne("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);const ay=Ne("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const Fj=Ne("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);const Or=Ne("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),am="-",Uj=e=>{const t=zj(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:s}=e;return{getClassGroupId:c=>{const u=c.split(am);return u[0]===""&&u.length!==1&&u.shift(),Rx(u,t)||Bj(c)},getConflictingClassGroupIds:(c,u)=>{const h=n[c]||[];return u&&s[c]?[...h,...s[c]]:h}}},Rx=(e,t)=>{if(e.length===0)return t.classGroupId;const n=e[0],s=t.nextPart.get(n),o=s?Rx(e.slice(1),s):void 0;if(o)return o;if(t.validators.length===0)return;const l=e.join(am);return t.validators.find(({validator:c})=>c(l))?.classGroupId},iy=/^\[(.+)\]$/,Bj=e=>{if(iy.test(e)){const t=iy.exec(e)[1],n=t?.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},zj=e=>{const{theme:t,prefix:n}=e,s={nextPart:new Map,validators:[]};return Vj(Object.entries(e.classGroups),n).forEach(([l,c])=>{lf(c,s,l,t)}),s},lf=(e,t,n,s)=>{e.forEach(o=>{if(typeof o=="string"){const l=o===""?t:oy(t,o);l.classGroupId=n;return}if(typeof o=="function"){if(Hj(o)){lf(o(s),t,n,s);return}t.validators.push({validator:o,classGroupId:n});return}Object.entries(o).forEach(([l,c])=>{lf(c,oy(t,l),n,s)})})},oy=(e,t)=>{let n=e;return t.split(am).forEach(s=>{n.nextPart.has(s)||n.nextPart.set(s,{nextPart:new Map,validators:[]}),n=n.nextPart.get(s)}),n},Hj=e=>e.isThemeGetter,Vj=(e,t)=>t?e.map(([n,s])=>{const o=s.map(l=>typeof l=="string"?t+l:typeof l=="object"?Object.fromEntries(Object.entries(l).map(([c,u])=>[t+c,u])):l);return[n,o]}):e,qj=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,s=new Map;const o=(l,c)=>{n.set(l,c),t++,t>e&&(t=0,s=n,n=new Map)};return{get(l){let c=n.get(l);if(c!==void 0)return c;if((c=s.get(l))!==void 0)return o(l,c),c},set(l,c){n.has(l)?n.set(l,c):o(l,c)}}},Ix="!",Wj=e=>{const{separator:t,experimentalParseClassName:n}=e,s=t.length===1,o=t[0],l=t.length,c=u=>{const h=[];let f=0,g=0,v;for(let w=0;w<u.length;w++){let N=u[w];if(f===0){if(N===o&&(s||u.slice(w,w+l)===t)){h.push(u.slice(g,w)),g=w+l;continue}if(N==="/"){v=w;continue}}N==="["?f++:N==="]"&&f--}const b=h.length===0?u:u.substring(g),x=b.startsWith(Ix),S=x?b.substring(1):b,C=v&&v>g?v-g:void 0;return{modifiers:h,hasImportantModifier:x,baseClassName:S,maybePostfixModifierPosition:C}};return n?u=>n({className:u,parseClassName:c}):c},Gj=e=>{if(e.length<=1)return e;const t=[];let n=[];return e.forEach(s=>{s[0]==="["?(t.push(...n.sort(),s),n=[]):n.push(s)}),t.push(...n.sort()),t},Kj=e=>({cache:qj(e.cacheSize),parseClassName:Wj(e),...Uj(e)}),Yj=/\s+/,Jj=(e,t)=>{const{parseClassName:n,getClassGroupId:s,getConflictingClassGroupIds:o}=t,l=[],c=e.trim().split(Yj);let u="";for(let h=c.length-1;h>=0;h-=1){const f=c[h],{modifiers:g,hasImportantModifier:v,baseClassName:b,maybePostfixModifierPosition:x}=n(f);let S=!!x,C=s(S?b.substring(0,x):b);if(!C){if(!S){u=f+(u.length>0?" "+u:u);continue}if(C=s(b),!C){u=f+(u.length>0?" "+u:u);continue}S=!1}const w=Gj(g).join(":"),N=v?w+Ix:w,_=N+C;if(l.includes(_))continue;l.push(_);const j=o(C,S);for(let T=0;T<j.length;++T){const R=j[T];l.push(N+R)}u=f+(u.length>0?" "+u:u)}return u};function Qj(){let e=0,t,n,s="";for(;e<arguments.length;)(t=arguments[e++])&&(n=Dx(t))&&(s&&(s+=" "),s+=n);return s}const Dx=e=>{if(typeof e=="string")return e;let t,n="";for(let s=0;s<e.length;s++)e[s]&&(t=Dx(e[s]))&&(n&&(n+=" "),n+=t);return n};function Xj(e,...t){let n,s,o,l=c;function c(h){const f=t.reduce((g,v)=>v(g),e());return n=Kj(f),s=n.cache.get,o=n.cache.set,l=u,u(h)}function u(h){const f=s(h);if(f)return f;const g=Jj(h,n);return o(h,g),g}return function(){return l(Qj.apply(null,arguments))}}const ct=e=>{const t=n=>n[e]||[];return t.isThemeGetter=!0,t},Ox=/^\[(?:([a-z-]+):)?(.+)\]$/i,Zj=/^\d+\/\d+$/,ek=new Set(["px","full","screen"]),tk=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,nk=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,rk=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,sk=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,ak=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Rr=e=>za(e)||ek.has(e)||Zj.test(e),ls=e=>ni(e,"length",fk),za=e=>!!e&&!Number.isNaN(Number(e)),_h=e=>ni(e,"number",za),Ki=e=>!!e&&Number.isInteger(Number(e)),ik=e=>e.endsWith("%")&&za(e.slice(0,-1)),He=e=>Ox.test(e),cs=e=>tk.test(e),ok=new Set(["length","size","percentage"]),lk=e=>ni(e,ok,Lx),ck=e=>ni(e,"position",Lx),dk=new Set(["image","url"]),uk=e=>ni(e,dk,pk),hk=e=>ni(e,"",mk),Yi=()=>!0,ni=(e,t,n)=>{const s=Ox.exec(e);return s?s[1]?typeof t=="string"?s[1]===t:t.has(s[1]):n(s[2]):!1},fk=e=>nk.test(e)&&!rk.test(e),Lx=()=>!1,mk=e=>sk.test(e),pk=e=>ak.test(e),gk=()=>{const e=ct("colors"),t=ct("spacing"),n=ct("blur"),s=ct("brightness"),o=ct("borderColor"),l=ct("borderRadius"),c=ct("borderSpacing"),u=ct("borderWidth"),h=ct("contrast"),f=ct("grayscale"),g=ct("hueRotate"),v=ct("invert"),b=ct("gap"),x=ct("gradientColorStops"),S=ct("gradientColorStopPositions"),C=ct("inset"),w=ct("margin"),N=ct("opacity"),_=ct("padding"),j=ct("saturate"),T=ct("scale"),R=ct("sepia"),A=ct("skew"),I=ct("space"),L=ct("translate"),Z=()=>["auto","contain","none"],M=()=>["auto","hidden","clip","visible","scroll"],U=()=>["auto",He,t],D=()=>[He,t],B=()=>["",Rr,ls],z=()=>["auto",za,He],q=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],H=()=>["solid","dashed","dotted","double","none"],Q=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$=()=>["start","end","center","between","around","evenly","stretch"],O=()=>["","0",He],J=()=>["auto","avoid","all","avoid-page","page","left","right","column"],F=()=>[za,He];return{cacheSize:500,separator:":",theme:{colors:[Yi],spacing:[Rr,ls],blur:["none","",cs,He],brightness:F(),borderColor:[e],borderRadius:["none","","full",cs,He],borderSpacing:D(),borderWidth:B(),contrast:F(),grayscale:O(),hueRotate:F(),invert:O(),gap:D(),gradientColorStops:[e],gradientColorStopPositions:[ik,ls],inset:U(),margin:U(),opacity:F(),padding:D(),saturate:F(),scale:F(),sepia:O(),skew:F(),space:D(),translate:D()},classGroups:{aspect:[{aspect:["auto","square","video",He]}],container:["container"],columns:[{columns:[cs]}],"break-after":[{"break-after":J()}],"break-before":[{"break-before":J()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...q(),He]}],overflow:[{overflow:M()}],"overflow-x":[{"overflow-x":M()}],"overflow-y":[{"overflow-y":M()}],overscroll:[{overscroll:Z()}],"overscroll-x":[{"overscroll-x":Z()}],"overscroll-y":[{"overscroll-y":Z()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[C]}],"inset-x":[{"inset-x":[C]}],"inset-y":[{"inset-y":[C]}],start:[{start:[C]}],end:[{end:[C]}],top:[{top:[C]}],right:[{right:[C]}],bottom:[{bottom:[C]}],left:[{left:[C]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ki,He]}],basis:[{basis:U()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",He]}],grow:[{grow:O()}],shrink:[{shrink:O()}],order:[{order:["first","last","none",Ki,He]}],"grid-cols":[{"grid-cols":[Yi]}],"col-start-end":[{col:["auto",{span:["full",Ki,He]},He]}],"col-start":[{"col-start":z()}],"col-end":[{"col-end":z()}],"grid-rows":[{"grid-rows":[Yi]}],"row-start-end":[{row:["auto",{span:[Ki,He]},He]}],"row-start":[{"row-start":z()}],"row-end":[{"row-end":z()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",He]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",He]}],gap:[{gap:[b]}],"gap-x":[{"gap-x":[b]}],"gap-y":[{"gap-y":[b]}],"justify-content":[{justify:["normal",...$()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...$(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...$(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[w]}],mx:[{mx:[w]}],my:[{my:[w]}],ms:[{ms:[w]}],me:[{me:[w]}],mt:[{mt:[w]}],mr:[{mr:[w]}],mb:[{mb:[w]}],ml:[{ml:[w]}],"space-x":[{"space-x":[I]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[I]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",He,t]}],"min-w":[{"min-w":[He,t,"min","max","fit"]}],"max-w":[{"max-w":[He,t,"none","full","min","max","fit","prose",{screen:[cs]},cs]}],h:[{h:[He,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[He,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[He,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[He,t,"auto","min","max","fit"]}],"font-size":[{text:["base",cs,ls]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",_h]}],"font-family":[{font:[Yi]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",He]}],"line-clamp":[{"line-clamp":["none",za,_h]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Rr,He]}],"list-image":[{"list-image":["none",He]}],"list-style-type":[{list:["none","disc","decimal",He]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[N]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[N]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...H(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Rr,ls]}],"underline-offset":[{"underline-offset":["auto",Rr,He]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:D()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",He]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",He]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[N]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...q(),ck]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",lk]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},uk]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[S]}],"gradient-via-pos":[{via:[S]}],"gradient-to-pos":[{to:[S]}],"gradient-from":[{from:[x]}],"gradient-via":[{via:[x]}],"gradient-to":[{to:[x]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[u]}],"border-w-x":[{"border-x":[u]}],"border-w-y":[{"border-y":[u]}],"border-w-s":[{"border-s":[u]}],"border-w-e":[{"border-e":[u]}],"border-w-t":[{"border-t":[u]}],"border-w-r":[{"border-r":[u]}],"border-w-b":[{"border-b":[u]}],"border-w-l":[{"border-l":[u]}],"border-opacity":[{"border-opacity":[N]}],"border-style":[{border:[...H(),"hidden"]}],"divide-x":[{"divide-x":[u]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[u]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[N]}],"divide-style":[{divide:H()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...H()]}],"outline-offset":[{"outline-offset":[Rr,He]}],"outline-w":[{outline:[Rr,ls]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:B()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[N]}],"ring-offset-w":[{"ring-offset":[Rr,ls]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",cs,hk]}],"shadow-color":[{shadow:[Yi]}],opacity:[{opacity:[N]}],"mix-blend":[{"mix-blend":[...Q(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Q()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[s]}],contrast:[{contrast:[h]}],"drop-shadow":[{"drop-shadow":["","none",cs,He]}],grayscale:[{grayscale:[f]}],"hue-rotate":[{"hue-rotate":[g]}],invert:[{invert:[v]}],saturate:[{saturate:[j]}],sepia:[{sepia:[R]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[h]}],"backdrop-grayscale":[{"backdrop-grayscale":[f]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[g]}],"backdrop-invert":[{"backdrop-invert":[v]}],"backdrop-opacity":[{"backdrop-opacity":[N]}],"backdrop-saturate":[{"backdrop-saturate":[j]}],"backdrop-sepia":[{"backdrop-sepia":[R]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[c]}],"border-spacing-x":[{"border-spacing-x":[c]}],"border-spacing-y":[{"border-spacing-y":[c]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",He]}],duration:[{duration:F()}],ease:[{ease:["linear","in","out","in-out",He]}],delay:[{delay:F()}],animate:[{animate:["none","spin","ping","pulse","bounce",He]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[T]}],"scale-x":[{"scale-x":[T]}],"scale-y":[{"scale-y":[T]}],rotate:[{rotate:[Ki,He]}],"translate-x":[{"translate-x":[L]}],"translate-y":[{"translate-y":[L]}],"skew-x":[{"skew-x":[A]}],"skew-y":[{"skew-y":[A]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",He]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",He]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":D()}],"scroll-mx":[{"scroll-mx":D()}],"scroll-my":[{"scroll-my":D()}],"scroll-ms":[{"scroll-ms":D()}],"scroll-me":[{"scroll-me":D()}],"scroll-mt":[{"scroll-mt":D()}],"scroll-mr":[{"scroll-mr":D()}],"scroll-mb":[{"scroll-mb":D()}],"scroll-ml":[{"scroll-ml":D()}],"scroll-p":[{"scroll-p":D()}],"scroll-px":[{"scroll-px":D()}],"scroll-py":[{"scroll-py":D()}],"scroll-ps":[{"scroll-ps":D()}],"scroll-pe":[{"scroll-pe":D()}],"scroll-pt":[{"scroll-pt":D()}],"scroll-pr":[{"scroll-pr":D()}],"scroll-pb":[{"scroll-pb":D()}],"scroll-pl":[{"scroll-pl":D()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",He]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Rr,ls,_h]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},vk=Xj(gk);function Ce(...e){return vk(Ex(e))}const yk=uj,Mx=p.forwardRef(({className:e,...t},n)=>i.jsx(vx,{ref:n,className:Ce("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));Mx.displayName=vx.displayName;const wk=nd("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground",message:"border-primary bg-primary text-primary-foreground shadow-lg ring-2 ring-primary/30",success:"border-green-500 bg-green-50 dark:bg-green-950 text-green-900 dark:text-green-100 shadow-lg ring-2 ring-green-500/30"}},defaultVariants:{variant:"default"}}),$x=p.forwardRef(({className:e,variant:t,swipeDirection:n,...s},o)=>i.jsx(yx,{ref:o,className:Ce(wk({variant:t}),e),...s}));$x.displayName=yx.displayName;const xk=p.forwardRef(({className:e,...t},n)=>i.jsx(bx,{ref:n,className:Ce("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));xk.displayName=bx.displayName;const Fx=p.forwardRef(({className:e,...t},n)=>i.jsx(Cx,{ref:n,className:Ce("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:i.jsx(Or,{className:"h-4 w-4"})}));Fx.displayName=Cx.displayName;const Ux=p.forwardRef(({className:e,...t},n)=>i.jsx(wx,{ref:n,className:Ce("text-sm font-semibold group-[.custom-child-color]:text-white group-[.custom-parent-color]:text-white",e),...t}));Ux.displayName=wx.displayName;const Bx=p.forwardRef(({className:e,...t},n)=>i.jsx(xx,{ref:n,className:Ce("text-sm opacity-90 group-[.message]:opacity-100 group-[.message]:text-primary-foreground group-[.custom-child-color]:opacity-100 group-[.custom-child-color]:text-white group-[.custom-parent-color]:opacity-100 group-[.custom-parent-color]:text-white",e),...t}));Bx.displayName=xx.displayName;function bk(){const{toasts:e}=_t();return i.jsxs(yk,{swipeDirection:"right",duration:5e3,children:[e.map(function({id:t,title:n,description:s,action:o,swipeDirection:l,...c}){return i.jsxs($x,{...c,children:[i.jsxs("div",{className:"grid gap-1",children:[n&&i.jsx(Ux,{children:n}),s&&i.jsx(Bx,{children:s})]}),o,i.jsx(Fx,{})]},t)}),i.jsx(Mx,{})]})}var ly=["light","dark"],Ck="(prefers-color-scheme: dark)",Sk=p.createContext(void 0),Ek={setTheme:e=>{},themes:[]},_k=()=>{var e;return(e=p.useContext(Sk))!=null?e:Ek};p.memo(({forcedTheme:e,storageKey:t,attribute:n,enableSystem:s,enableColorScheme:o,defaultTheme:l,value:c,attrs:u,nonce:h})=>{let f=l==="system",g=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${u.map(S=>`'${S}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,v=o?ly.includes(l)&&l?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${l}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",b=(S,C=!1,w=!0)=>{let N=c?c[S]:S,_=C?S+"|| ''":`'${N}'`,j="";return o&&w&&!C&&ly.includes(S)&&(j+=`d.style.colorScheme = '${S}';`),n==="class"?C||N?j+=`c.add(${_})`:j+="null":N&&(j+=`d[s](n,${_})`),j},x=e?`!function(){${g}${b(e)}}()`:s?`!function(){try{${g}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${f})){var t='${Ck}',m=window.matchMedia(t);if(m.media!==t||m.matches){${b("dark")}}else{${b("light")}}}else if(e){${c?`var x=${JSON.stringify(c)};`:""}${b(c?"x[e]":"e",!0)}}${f?"":"else{"+b(l,!1,!1)+"}"}${v}}catch(e){}}()`:`!function(){try{${g}var e=localStorage.getItem('${t}');if(e){${c?`var x=${JSON.stringify(c)};`:""}${b(c?"x[e]":"e",!0)}}else{${b(l,!1,!1)};}${v}}catch(t){}}();`;return p.createElement("script",{nonce:h,dangerouslySetInnerHTML:{__html:x}})});var Nk=e=>{switch(e){case"success":return Tk;case"info":return Pk;case"warning":return Ak;case"error":return Rk;default:return null}},jk=Array(12).fill(0),kk=({visible:e,className:t})=>ge.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},ge.createElement("div",{className:"sonner-spinner"},jk.map((n,s)=>ge.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`})))),Tk=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ge.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Ak=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ge.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Pk=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ge.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Rk=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ge.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ik=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ge.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ge.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Dk=()=>{let[e,t]=ge.useState(document.hidden);return ge.useEffect(()=>{let n=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),e},cf=1,Ok=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:n,...s}=e,o=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:cf++,l=this.toasts.find(u=>u.id===o),c=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(o)&&this.dismissedToasts.delete(o),l?this.toasts=this.toasts.map(u=>u.id===o?(this.publish({...u,...e,id:o,title:n}),{...u,...e,id:o,dismissible:c,title:n}):u):this.addToast({title:n,...s,dismissible:c,id:o}),o},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(n=>n({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let n;t.loading!==void 0&&(n=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let s=e instanceof Promise?e:e(),o=n!==void 0,l,c=s.then(async h=>{if(l=["resolve",h],ge.isValidElement(h))o=!1,this.create({id:n,type:"default",message:h});else if(Mk(h)&&!h.ok){o=!1;let f=typeof t.error=="function"?await t.error(`HTTP error! status: ${h.status}`):t.error,g=typeof t.description=="function"?await t.description(`HTTP error! status: ${h.status}`):t.description;this.create({id:n,type:"error",message:f,description:g})}else if(t.success!==void 0){o=!1;let f=typeof t.success=="function"?await t.success(h):t.success,g=typeof t.description=="function"?await t.description(h):t.description;this.create({id:n,type:"success",message:f,description:g})}}).catch(async h=>{if(l=["reject",h],t.error!==void 0){o=!1;let f=typeof t.error=="function"?await t.error(h):t.error,g=typeof t.description=="function"?await t.description(h):t.description;this.create({id:n,type:"error",message:f,description:g})}}).finally(()=>{var h;o&&(this.dismiss(n),n=void 0),(h=t.finally)==null||h.call(t)}),u=()=>new Promise((h,f)=>c.then(()=>l[0]==="reject"?f(l[1]):h(l[1])).catch(f));return typeof n!="string"&&typeof n!="number"?{unwrap:u}:Object.assign(n,{unwrap:u})},this.custom=(e,t)=>{let n=t?.id||cf++;return this.create({jsx:e(n),id:n,...t}),n},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},dn=new Ok,Lk=(e,t)=>{let n=t?.id||cf++;return dn.addToast({title:e,...t,id:n}),n},Mk=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",$k=Lk,Fk=()=>dn.toasts,Uk=()=>dn.getActiveToasts();Object.assign($k,{success:dn.success,info:dn.info,warning:dn.warning,error:dn.error,custom:dn.custom,message:dn.message,promise:dn.promise,dismiss:dn.dismiss,loading:dn.loading},{getHistory:Fk,getToasts:Uk});function Bk(e,{insertAt:t}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}Bk(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function ec(e){return e.label!==void 0}var zk=3,Hk="32px",Vk="16px",cy=4e3,qk=356,Wk=14,Gk=20,Kk=200;function Kn(...e){return e.filter(Boolean).join(" ")}function Yk(e){let[t,n]=e.split("-"),s=[];return t&&s.push(t),n&&s.push(n),s}var Jk=e=>{var t,n,s,o,l,c,u,h,f,g,v;let{invert:b,toast:x,unstyled:S,interacting:C,setHeights:w,visibleToasts:N,heights:_,index:j,toasts:T,expanded:R,removeToast:A,defaultRichColors:I,closeButton:L,style:Z,cancelButtonStyle:M,actionButtonStyle:U,className:D="",descriptionClassName:B="",duration:z,position:q,gap:H,loadingIcon:Q,expandByDefault:$,classNames:O,icons:J,closeButtonAriaLabel:F="Close toast",pauseWhenPageIsHidden:ee}=e,[ce,K]=ge.useState(null),[W,ne]=ge.useState(null),[G,ae]=ge.useState(!1),[fe,ve]=ge.useState(!1),[xe,Ie]=ge.useState(!1),[$e,Ke]=ge.useState(!1),[Ve,ie]=ge.useState(!1),[Re,le]=ge.useState(0),[ye,je]=ge.useState(0),ze=ge.useRef(x.duration||z||cy),dt=ge.useRef(null),Je=ge.useRef(null),pt=j===0,st=j+1<=N,gt=x.type,We=x.dismissible!==!1,Ue=x.className||"",Bt=x.descriptionClassName||"",Rt=ge.useMemo(()=>_.findIndex(Be=>Be.toastId===x.id)||0,[_,x.id]),Cr=ge.useMemo(()=>{var Be;return(Be=x.closeButton)!=null?Be:L},[x.closeButton,L]),js=ge.useMemo(()=>x.duration||z||cy,[x.duration,z]),Br=ge.useRef(0),Sr=ge.useRef(0),Bo=ge.useRef(0),ar=ge.useRef(null),[ui,hi]=q.split("-"),ia=ge.useMemo(()=>_.reduce((Be,Ze,nt)=>nt>=Rt?Be:Be+Ze.height,0),[_,Rt]),oa=Dk(),zr=x.invert||b,ir=gt==="loading";Sr.current=ge.useMemo(()=>Rt*H+ia,[Rt,ia]),ge.useEffect(()=>{ze.current=js},[js]),ge.useEffect(()=>{ae(!0)},[]),ge.useEffect(()=>{let Be=Je.current;if(Be){let Ze=Be.getBoundingClientRect().height;return je(Ze),w(nt=>[{toastId:x.id,height:Ze,position:x.position},...nt]),()=>w(nt=>nt.filter(Gt=>Gt.toastId!==x.id))}},[w,x.id]),ge.useLayoutEffect(()=>{if(!G)return;let Be=Je.current,Ze=Be.style.height;Be.style.height="auto";let nt=Be.getBoundingClientRect().height;Be.style.height=Ze,je(nt),w(Gt=>Gt.find(en=>en.toastId===x.id)?Gt.map(en=>en.toastId===x.id?{...en,height:nt}:en):[{toastId:x.id,height:nt,position:x.position},...Gt])},[G,x.title,x.description,w,x.id]);let Fn=ge.useCallback(()=>{ve(!0),le(Sr.current),w(Be=>Be.filter(Ze=>Ze.toastId!==x.id)),setTimeout(()=>{A(x)},Kk)},[x,A,w,Sr]);ge.useEffect(()=>{if(x.promise&&gt==="loading"||x.duration===1/0||x.type==="loading")return;let Be;return R||C||ee&&oa?(()=>{if(Bo.current<Br.current){let Ze=new Date().getTime()-Br.current;ze.current=ze.current-Ze}Bo.current=new Date().getTime()})():ze.current!==1/0&&(Br.current=new Date().getTime(),Be=setTimeout(()=>{var Ze;(Ze=x.onAutoClose)==null||Ze.call(x,x),Fn()},ze.current)),()=>clearTimeout(Be)},[R,C,x,gt,ee,oa,Fn]),ge.useEffect(()=>{x.delete&&Fn()},[Fn,x.delete]);function zo(){var Be,Ze,nt;return J!=null&&J.loading?ge.createElement("div",{className:Kn(O?.loader,(Be=x?.classNames)==null?void 0:Be.loader,"sonner-loader"),"data-visible":gt==="loading"},J.loading):Q?ge.createElement("div",{className:Kn(O?.loader,(Ze=x?.classNames)==null?void 0:Ze.loader,"sonner-loader"),"data-visible":gt==="loading"},Q):ge.createElement(kk,{className:Kn(O?.loader,(nt=x?.classNames)==null?void 0:nt.loader),visible:gt==="loading"})}return ge.createElement("li",{tabIndex:0,ref:Je,className:Kn(D,Ue,O?.toast,(t=x?.classNames)==null?void 0:t.toast,O?.default,O?.[gt],(n=x?.classNames)==null?void 0:n[gt]),"data-sonner-toast":"","data-rich-colors":(s=x.richColors)!=null?s:I,"data-styled":!(x.jsx||x.unstyled||S),"data-mounted":G,"data-promise":!!x.promise,"data-swiped":Ve,"data-removed":fe,"data-visible":st,"data-y-position":ui,"data-x-position":hi,"data-index":j,"data-front":pt,"data-swiping":xe,"data-dismissible":We,"data-type":gt,"data-invert":zr,"data-swipe-out":$e,"data-swipe-direction":W,"data-expanded":!!(R||$&&G),style:{"--index":j,"--toasts-before":j,"--z-index":T.length-j,"--offset":`${fe?Re:Sr.current}px`,"--initial-height":$?"auto":`${ye}px`,...Z,...x.style},onDragEnd:()=>{Ie(!1),K(null),ar.current=null},onPointerDown:Be=>{ir||!We||(dt.current=new Date,le(Sr.current),Be.target.setPointerCapture(Be.pointerId),Be.target.tagName!=="BUTTON"&&(Ie(!0),ar.current={x:Be.clientX,y:Be.clientY}))},onPointerUp:()=>{var Be,Ze,nt,Gt;if($e||!We)return;ar.current=null;let en=Number(((Be=Je.current)==null?void 0:Be.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),tn=Number(((Ze=Je.current)==null?void 0:Ze.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Un=new Date().getTime()-((nt=dt.current)==null?void 0:nt.getTime()),It=ce==="x"?en:tn,or=Math.abs(It)/Un;if(Math.abs(It)>=Gk||or>.11){le(Sr.current),(Gt=x.onDismiss)==null||Gt.call(x,x),ne(ce==="x"?en>0?"right":"left":tn>0?"down":"up"),Fn(),Ke(!0),ie(!1);return}Ie(!1),K(null)},onPointerMove:Be=>{var Ze,nt,Gt,en;if(!ar.current||!We||((Ze=window.getSelection())==null?void 0:Ze.toString().length)>0)return;let tn=Be.clientY-ar.current.y,Un=Be.clientX-ar.current.x,It=(nt=e.swipeDirections)!=null?nt:Yk(q);!ce&&(Math.abs(Un)>1||Math.abs(tn)>1)&&K(Math.abs(Un)>Math.abs(tn)?"x":"y");let or={x:0,y:0};ce==="y"?(It.includes("top")||It.includes("bottom"))&&(It.includes("top")&&tn<0||It.includes("bottom")&&tn>0)&&(or.y=tn):ce==="x"&&(It.includes("left")||It.includes("right"))&&(It.includes("left")&&Un<0||It.includes("right")&&Un>0)&&(or.x=Un),(Math.abs(or.x)>0||Math.abs(or.y)>0)&&ie(!0),(Gt=Je.current)==null||Gt.style.setProperty("--swipe-amount-x",`${or.x}px`),(en=Je.current)==null||en.style.setProperty("--swipe-amount-y",`${or.y}px`)}},Cr&&!x.jsx?ge.createElement("button",{"aria-label":F,"data-disabled":ir,"data-close-button":!0,onClick:ir||!We?()=>{}:()=>{var Be;Fn(),(Be=x.onDismiss)==null||Be.call(x,x)},className:Kn(O?.closeButton,(o=x?.classNames)==null?void 0:o.closeButton)},(l=J?.close)!=null?l:Ik):null,x.jsx||p.isValidElement(x.title)?x.jsx?x.jsx:typeof x.title=="function"?x.title():x.title:ge.createElement(ge.Fragment,null,gt||x.icon||x.promise?ge.createElement("div",{"data-icon":"",className:Kn(O?.icon,(c=x?.classNames)==null?void 0:c.icon)},x.promise||x.type==="loading"&&!x.icon?x.icon||zo():null,x.type!=="loading"?x.icon||J?.[gt]||Nk(gt):null):null,ge.createElement("div",{"data-content":"",className:Kn(O?.content,(u=x?.classNames)==null?void 0:u.content)},ge.createElement("div",{"data-title":"",className:Kn(O?.title,(h=x?.classNames)==null?void 0:h.title)},typeof x.title=="function"?x.title():x.title),x.description?ge.createElement("div",{"data-description":"",className:Kn(B,Bt,O?.description,(f=x?.classNames)==null?void 0:f.description)},typeof x.description=="function"?x.description():x.description):null),p.isValidElement(x.cancel)?x.cancel:x.cancel&&ec(x.cancel)?ge.createElement("button",{"data-button":!0,"data-cancel":!0,style:x.cancelButtonStyle||M,onClick:Be=>{var Ze,nt;ec(x.cancel)&&We&&((nt=(Ze=x.cancel).onClick)==null||nt.call(Ze,Be),Fn())},className:Kn(O?.cancelButton,(g=x?.classNames)==null?void 0:g.cancelButton)},x.cancel.label):null,p.isValidElement(x.action)?x.action:x.action&&ec(x.action)?ge.createElement("button",{"data-button":!0,"data-action":!0,style:x.actionButtonStyle||U,onClick:Be=>{var Ze,nt;ec(x.action)&&((nt=(Ze=x.action).onClick)==null||nt.call(Ze,Be),!Be.defaultPrevented&&Fn())},className:Kn(O?.actionButton,(v=x?.classNames)==null?void 0:v.actionButton)},x.action.label):null))};function dy(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Qk(e,t){let n={};return[e,t].forEach((s,o)=>{let l=o===1,c=l?"--mobile-offset":"--offset",u=l?Vk:Hk;function h(f){["top","right","bottom","left"].forEach(g=>{n[`${c}-${g}`]=typeof f=="number"?`${f}px`:f})}typeof s=="number"||typeof s=="string"?h(s):typeof s=="object"?["top","right","bottom","left"].forEach(f=>{s[f]===void 0?n[`${c}-${f}`]=u:n[`${c}-${f}`]=typeof s[f]=="number"?`${s[f]}px`:s[f]}):h(u)}),n}var Xk=p.forwardRef(function(e,t){let{invert:n,position:s="bottom-right",hotkey:o=["altKey","KeyT"],expand:l,closeButton:c,className:u,offset:h,mobileOffset:f,theme:g="light",richColors:v,duration:b,style:x,visibleToasts:S=zk,toastOptions:C,dir:w=dy(),gap:N=Wk,loadingIcon:_,icons:j,containerAriaLabel:T="Notifications",pauseWhenPageIsHidden:R}=e,[A,I]=ge.useState([]),L=ge.useMemo(()=>Array.from(new Set([s].concat(A.filter(ee=>ee.position).map(ee=>ee.position)))),[A,s]),[Z,M]=ge.useState([]),[U,D]=ge.useState(!1),[B,z]=ge.useState(!1),[q,H]=ge.useState(g!=="system"?g:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Q=ge.useRef(null),$=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),O=ge.useRef(null),J=ge.useRef(!1),F=ge.useCallback(ee=>{I(ce=>{var K;return(K=ce.find(W=>W.id===ee.id))!=null&&K.delete||dn.dismiss(ee.id),ce.filter(({id:W})=>W!==ee.id)})},[]);return ge.useEffect(()=>dn.subscribe(ee=>{if(ee.dismiss){I(ce=>ce.map(K=>K.id===ee.id?{...K,delete:!0}:K));return}setTimeout(()=>{Qw.flushSync(()=>{I(ce=>{let K=ce.findIndex(W=>W.id===ee.id);return K!==-1?[...ce.slice(0,K),{...ce[K],...ee},...ce.slice(K+1)]:[ee,...ce]})})})}),[]),ge.useEffect(()=>{if(g!=="system"){H(g);return}if(g==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?H("dark"):H("light")),typeof window>"u")return;let ee=window.matchMedia("(prefers-color-scheme: dark)");try{ee.addEventListener("change",({matches:ce})=>{H(ce?"dark":"light")})}catch{ee.addListener(({matches:K})=>{try{H(K?"dark":"light")}catch(W){console.error(W)}})}},[g]),ge.useEffect(()=>{A.length<=1&&D(!1)},[A]),ge.useEffect(()=>{let ee=ce=>{var K,W;o.every(ne=>ce[ne]||ce.code===ne)&&(D(!0),(K=Q.current)==null||K.focus()),ce.code==="Escape"&&(document.activeElement===Q.current||(W=Q.current)!=null&&W.contains(document.activeElement))&&D(!1)};return document.addEventListener("keydown",ee),()=>document.removeEventListener("keydown",ee)},[o]),ge.useEffect(()=>{if(Q.current)return()=>{O.current&&(O.current.focus({preventScroll:!0}),O.current=null,J.current=!1)}},[Q.current]),ge.createElement("section",{ref:t,"aria-label":`${T} ${$}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},L.map((ee,ce)=>{var K;let[W,ne]=ee.split("-");return A.length?ge.createElement("ol",{key:ee,dir:w==="auto"?dy():w,tabIndex:-1,ref:Q,className:u,"data-sonner-toaster":!0,"data-theme":q,"data-y-position":W,"data-lifted":U&&A.length>1&&!l,"data-x-position":ne,style:{"--front-toast-height":`${((K=Z[0])==null?void 0:K.height)||0}px`,"--width":`${qk}px`,"--gap":`${N}px`,...x,...Qk(h,f)},onBlur:G=>{J.current&&!G.currentTarget.contains(G.relatedTarget)&&(J.current=!1,O.current&&(O.current.focus({preventScroll:!0}),O.current=null))},onFocus:G=>{G.target instanceof HTMLElement&&G.target.dataset.dismissible==="false"||J.current||(J.current=!0,O.current=G.relatedTarget)},onMouseEnter:()=>D(!0),onMouseMove:()=>D(!0),onMouseLeave:()=>{B||D(!1)},onDragEnd:()=>D(!1),onPointerDown:G=>{G.target instanceof HTMLElement&&G.target.dataset.dismissible==="false"||z(!0)},onPointerUp:()=>z(!1)},A.filter(G=>!G.position&&ce===0||G.position===ee).map((G,ae)=>{var fe,ve;return ge.createElement(Jk,{key:G.id,icons:j,index:ae,toast:G,defaultRichColors:v,duration:(fe=C?.duration)!=null?fe:b,className:C?.className,descriptionClassName:C?.descriptionClassName,invert:n,visibleToasts:S,closeButton:(ve=C?.closeButton)!=null?ve:c,interacting:B,position:ee,style:C?.style,unstyled:C?.unstyled,classNames:C?.classNames,cancelButtonStyle:C?.cancelButtonStyle,actionButtonStyle:C?.actionButtonStyle,removeToast:F,toasts:A.filter(xe=>xe.position==G.position),heights:Z.filter(xe=>xe.position==G.position),setHeights:M,expandByDefault:l,gap:N,loadingIcon:_,expanded:U,pauseWhenPageIsHidden:R,swipeDirections:e.swipeDirections})})):null}))});const Zk=({...e})=>{const{theme:t="system"}=_k();return i.jsx(Xk,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var eT=Qf[" useId ".trim().toString()]||(()=>{}),tT=0;function pr(e){const[t,n]=p.useState(eT());return Ut(()=>{n(s=>s??String(tT++))},[e]),t?`radix-${t}`:""}const nT=["top","right","bottom","left"],ws=Math.min,vn=Math.max,Ic=Math.round,tc=Math.floor,gr=e=>({x:e,y:e}),rT={left:"right",right:"left",bottom:"top",top:"bottom"},sT={start:"end",end:"start"};function df(e,t,n){return vn(e,ws(t,n))}function Lr(e,t){return typeof e=="function"?e(t):e}function Mr(e){return e.split("-")[0]}function ri(e){return e.split("-")[1]}function im(e){return e==="x"?"y":"x"}function om(e){return e==="y"?"height":"width"}const aT=new Set(["top","bottom"]);function mr(e){return aT.has(Mr(e))?"y":"x"}function lm(e){return im(mr(e))}function iT(e,t,n){n===void 0&&(n=!1);const s=ri(e),o=lm(e),l=om(o);let c=o==="x"?s===(n?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[l]>t.floating[l]&&(c=Dc(c)),[c,Dc(c)]}function oT(e){const t=Dc(e);return[uf(e),t,uf(t)]}function uf(e){return e.replace(/start|end/g,t=>sT[t])}const uy=["left","right"],hy=["right","left"],lT=["top","bottom"],cT=["bottom","top"];function dT(e,t,n){switch(e){case"top":case"bottom":return n?t?hy:uy:t?uy:hy;case"left":case"right":return t?lT:cT;default:return[]}}function uT(e,t,n,s){const o=ri(e);let l=dT(Mr(e),n==="start",s);return o&&(l=l.map(c=>c+"-"+o),t&&(l=l.concat(l.map(uf)))),l}function Dc(e){return e.replace(/left|right|bottom|top/g,t=>rT[t])}function hT(e){return{top:0,right:0,bottom:0,left:0,...e}}function zx(e){return typeof e!="number"?hT(e):{top:e,right:e,bottom:e,left:e}}function Oc(e){const{x:t,y:n,width:s,height:o}=e;return{width:s,height:o,top:n,left:t,right:t+s,bottom:n+o,x:t,y:n}}function fy(e,t,n){let{reference:s,floating:o}=e;const l=mr(t),c=lm(t),u=om(c),h=Mr(t),f=l==="y",g=s.x+s.width/2-o.width/2,v=s.y+s.height/2-o.height/2,b=s[u]/2-o[u]/2;let x;switch(h){case"top":x={x:g,y:s.y-o.height};break;case"bottom":x={x:g,y:s.y+s.height};break;case"right":x={x:s.x+s.width,y:v};break;case"left":x={x:s.x-o.width,y:v};break;default:x={x:s.x,y:s.y}}switch(ri(t)){case"start":x[c]-=b*(n&&f?-1:1);break;case"end":x[c]+=b*(n&&f?-1:1);break}return x}const fT=async(e,t,n)=>{const{placement:s="bottom",strategy:o="absolute",middleware:l=[],platform:c}=n,u=l.filter(Boolean),h=await(c.isRTL==null?void 0:c.isRTL(t));let f=await c.getElementRects({reference:e,floating:t,strategy:o}),{x:g,y:v}=fy(f,s,h),b=s,x={},S=0;for(let C=0;C<u.length;C++){const{name:w,fn:N}=u[C],{x:_,y:j,data:T,reset:R}=await N({x:g,y:v,initialPlacement:s,placement:b,strategy:o,middlewareData:x,rects:f,platform:c,elements:{reference:e,floating:t}});g=_??g,v=j??v,x={...x,[w]:{...x[w],...T}},R&&S<=50&&(S++,typeof R=="object"&&(R.placement&&(b=R.placement),R.rects&&(f=R.rects===!0?await c.getElementRects({reference:e,floating:t,strategy:o}):R.rects),{x:g,y:v}=fy(f,b,h)),C=-1)}return{x:g,y:v,placement:b,strategy:o,middlewareData:x}};async function uo(e,t){var n;t===void 0&&(t={});const{x:s,y:o,platform:l,rects:c,elements:u,strategy:h}=e,{boundary:f="clippingAncestors",rootBoundary:g="viewport",elementContext:v="floating",altBoundary:b=!1,padding:x=0}=Lr(t,e),S=zx(x),w=u[b?v==="floating"?"reference":"floating":v],N=Oc(await l.getClippingRect({element:(n=await(l.isElement==null?void 0:l.isElement(w)))==null||n?w:w.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(u.floating)),boundary:f,rootBoundary:g,strategy:h})),_=v==="floating"?{x:s,y:o,width:c.floating.width,height:c.floating.height}:c.reference,j=await(l.getOffsetParent==null?void 0:l.getOffsetParent(u.floating)),T=await(l.isElement==null?void 0:l.isElement(j))?await(l.getScale==null?void 0:l.getScale(j))||{x:1,y:1}:{x:1,y:1},R=Oc(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:u,rect:_,offsetParent:j,strategy:h}):_);return{top:(N.top-R.top+S.top)/T.y,bottom:(R.bottom-N.bottom+S.bottom)/T.y,left:(N.left-R.left+S.left)/T.x,right:(R.right-N.right+S.right)/T.x}}const mT=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:s,placement:o,rects:l,platform:c,elements:u,middlewareData:h}=t,{element:f,padding:g=0}=Lr(e,t)||{};if(f==null)return{};const v=zx(g),b={x:n,y:s},x=lm(o),S=om(x),C=await c.getDimensions(f),w=x==="y",N=w?"top":"left",_=w?"bottom":"right",j=w?"clientHeight":"clientWidth",T=l.reference[S]+l.reference[x]-b[x]-l.floating[S],R=b[x]-l.reference[x],A=await(c.getOffsetParent==null?void 0:c.getOffsetParent(f));let I=A?A[j]:0;(!I||!await(c.isElement==null?void 0:c.isElement(A)))&&(I=u.floating[j]||l.floating[S]);const L=T/2-R/2,Z=I/2-C[S]/2-1,M=ws(v[N],Z),U=ws(v[_],Z),D=M,B=I-C[S]-U,z=I/2-C[S]/2+L,q=df(D,z,B),H=!h.arrow&&ri(o)!=null&&z!==q&&l.reference[S]/2-(z<D?M:U)-C[S]/2<0,Q=H?z<D?z-D:z-B:0;return{[x]:b[x]+Q,data:{[x]:q,centerOffset:z-q-Q,...H&&{alignmentOffset:Q}},reset:H}}}),pT=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,s;const{placement:o,middlewareData:l,rects:c,initialPlacement:u,platform:h,elements:f}=t,{mainAxis:g=!0,crossAxis:v=!0,fallbackPlacements:b,fallbackStrategy:x="bestFit",fallbackAxisSideDirection:S="none",flipAlignment:C=!0,...w}=Lr(e,t);if((n=l.arrow)!=null&&n.alignmentOffset)return{};const N=Mr(o),_=mr(u),j=Mr(u)===u,T=await(h.isRTL==null?void 0:h.isRTL(f.floating)),R=b||(j||!C?[Dc(u)]:oT(u)),A=S!=="none";!b&&A&&R.push(...uT(u,C,S,T));const I=[u,...R],L=await uo(t,w),Z=[];let M=((s=l.flip)==null?void 0:s.overflows)||[];if(g&&Z.push(L[N]),v){const z=iT(o,c,T);Z.push(L[z[0]],L[z[1]])}if(M=[...M,{placement:o,overflows:Z}],!Z.every(z=>z<=0)){var U,D;const z=(((U=l.flip)==null?void 0:U.index)||0)+1,q=I[z];if(q&&(!(v==="alignment"?_!==mr(q):!1)||M.every($=>$.overflows[0]>0&&mr($.placement)===_)))return{data:{index:z,overflows:M},reset:{placement:q}};let H=(D=M.filter(Q=>Q.overflows[0]<=0).sort((Q,$)=>Q.overflows[1]-$.overflows[1])[0])==null?void 0:D.placement;if(!H)switch(x){case"bestFit":{var B;const Q=(B=M.filter($=>{if(A){const O=mr($.placement);return O===_||O==="y"}return!0}).map($=>[$.placement,$.overflows.filter(O=>O>0).reduce((O,J)=>O+J,0)]).sort(($,O)=>$[1]-O[1])[0])==null?void 0:B[0];Q&&(H=Q);break}case"initialPlacement":H=u;break}if(o!==H)return{reset:{placement:H}}}return{}}}};function my(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function py(e){return nT.some(t=>e[t]>=0)}const gT=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:s="referenceHidden",...o}=Lr(e,t);switch(s){case"referenceHidden":{const l=await uo(t,{...o,elementContext:"reference"}),c=my(l,n.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:py(c)}}}case"escaped":{const l=await uo(t,{...o,altBoundary:!0}),c=my(l,n.floating);return{data:{escapedOffsets:c,escaped:py(c)}}}default:return{}}}}},Hx=new Set(["left","top"]);async function vT(e,t){const{placement:n,platform:s,elements:o}=e,l=await(s.isRTL==null?void 0:s.isRTL(o.floating)),c=Mr(n),u=ri(n),h=mr(n)==="y",f=Hx.has(c)?-1:1,g=l&&h?-1:1,v=Lr(t,e);let{mainAxis:b,crossAxis:x,alignmentAxis:S}=typeof v=="number"?{mainAxis:v,crossAxis:0,alignmentAxis:null}:{mainAxis:v.mainAxis||0,crossAxis:v.crossAxis||0,alignmentAxis:v.alignmentAxis};return u&&typeof S=="number"&&(x=u==="end"?S*-1:S),h?{x:x*g,y:b*f}:{x:b*f,y:x*g}}const yT=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,s;const{x:o,y:l,placement:c,middlewareData:u}=t,h=await vT(t,e);return c===((n=u.offset)==null?void 0:n.placement)&&(s=u.arrow)!=null&&s.alignmentOffset?{}:{x:o+h.x,y:l+h.y,data:{...h,placement:c}}}}},wT=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:s,placement:o}=t,{mainAxis:l=!0,crossAxis:c=!1,limiter:u={fn:w=>{let{x:N,y:_}=w;return{x:N,y:_}}},...h}=Lr(e,t),f={x:n,y:s},g=await uo(t,h),v=mr(Mr(o)),b=im(v);let x=f[b],S=f[v];if(l){const w=b==="y"?"top":"left",N=b==="y"?"bottom":"right",_=x+g[w],j=x-g[N];x=df(_,x,j)}if(c){const w=v==="y"?"top":"left",N=v==="y"?"bottom":"right",_=S+g[w],j=S-g[N];S=df(_,S,j)}const C=u.fn({...t,[b]:x,[v]:S});return{...C,data:{x:C.x-n,y:C.y-s,enabled:{[b]:l,[v]:c}}}}}},xT=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:s,placement:o,rects:l,middlewareData:c}=t,{offset:u=0,mainAxis:h=!0,crossAxis:f=!0}=Lr(e,t),g={x:n,y:s},v=mr(o),b=im(v);let x=g[b],S=g[v];const C=Lr(u,t),w=typeof C=="number"?{mainAxis:C,crossAxis:0}:{mainAxis:0,crossAxis:0,...C};if(h){const j=b==="y"?"height":"width",T=l.reference[b]-l.floating[j]+w.mainAxis,R=l.reference[b]+l.reference[j]-w.mainAxis;x<T?x=T:x>R&&(x=R)}if(f){var N,_;const j=b==="y"?"width":"height",T=Hx.has(Mr(o)),R=l.reference[v]-l.floating[j]+(T&&((N=c.offset)==null?void 0:N[v])||0)+(T?0:w.crossAxis),A=l.reference[v]+l.reference[j]+(T?0:((_=c.offset)==null?void 0:_[v])||0)-(T?w.crossAxis:0);S<R?S=R:S>A&&(S=A)}return{[b]:x,[v]:S}}}},bT=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,s;const{placement:o,rects:l,platform:c,elements:u}=t,{apply:h=()=>{},...f}=Lr(e,t),g=await uo(t,f),v=Mr(o),b=ri(o),x=mr(o)==="y",{width:S,height:C}=l.floating;let w,N;v==="top"||v==="bottom"?(w=v,N=b===(await(c.isRTL==null?void 0:c.isRTL(u.floating))?"start":"end")?"left":"right"):(N=v,w=b==="end"?"top":"bottom");const _=C-g.top-g.bottom,j=S-g.left-g.right,T=ws(C-g[w],_),R=ws(S-g[N],j),A=!t.middlewareData.shift;let I=T,L=R;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(L=j),(s=t.middlewareData.shift)!=null&&s.enabled.y&&(I=_),A&&!b){const M=vn(g.left,0),U=vn(g.right,0),D=vn(g.top,0),B=vn(g.bottom,0);x?L=S-2*(M!==0||U!==0?M+U:vn(g.left,g.right)):I=C-2*(D!==0||B!==0?D+B:vn(g.top,g.bottom))}await h({...t,availableWidth:L,availableHeight:I});const Z=await c.getDimensions(u.floating);return S!==Z.width||C!==Z.height?{reset:{rects:!0}}:{}}}};function rd(){return typeof window<"u"}function si(e){return Vx(e)?(e.nodeName||"").toLowerCase():"#document"}function xn(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function br(e){var t;return(t=(Vx(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function Vx(e){return rd()?e instanceof Node||e instanceof xn(e).Node:!1}function nr(e){return rd()?e instanceof Element||e instanceof xn(e).Element:!1}function wr(e){return rd()?e instanceof HTMLElement||e instanceof xn(e).HTMLElement:!1}function gy(e){return!rd()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof xn(e).ShadowRoot}const CT=new Set(["inline","contents"]);function Ao(e){const{overflow:t,overflowX:n,overflowY:s,display:o}=rr(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+n)&&!CT.has(o)}const ST=new Set(["table","td","th"]);function ET(e){return ST.has(si(e))}const _T=[":popover-open",":modal"];function sd(e){return _T.some(t=>{try{return e.matches(t)}catch{return!1}})}const NT=["transform","translate","scale","rotate","perspective"],jT=["transform","translate","scale","rotate","perspective","filter"],kT=["paint","layout","strict","content"];function cm(e){const t=dm(),n=nr(e)?rr(e):e;return NT.some(s=>n[s]?n[s]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||jT.some(s=>(n.willChange||"").includes(s))||kT.some(s=>(n.contain||"").includes(s))}function TT(e){let t=xs(e);for(;wr(t)&&!Ka(t);){if(cm(t))return t;if(sd(t))return null;t=xs(t)}return null}function dm(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const AT=new Set(["html","body","#document"]);function Ka(e){return AT.has(si(e))}function rr(e){return xn(e).getComputedStyle(e)}function ad(e){return nr(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function xs(e){if(si(e)==="html")return e;const t=e.assignedSlot||e.parentNode||gy(e)&&e.host||br(e);return gy(t)?t.host:t}function qx(e){const t=xs(e);return Ka(t)?e.ownerDocument?e.ownerDocument.body:e.body:wr(t)&&Ao(t)?t:qx(t)}function ho(e,t,n){var s;t===void 0&&(t=[]),n===void 0&&(n=!0);const o=qx(e),l=o===((s=e.ownerDocument)==null?void 0:s.body),c=xn(o);if(l){const u=hf(c);return t.concat(c,c.visualViewport||[],Ao(o)?o:[],u&&n?ho(u):[])}return t.concat(o,ho(o,[],n))}function hf(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Wx(e){const t=rr(e);let n=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const o=wr(e),l=o?e.offsetWidth:n,c=o?e.offsetHeight:s,u=Ic(n)!==l||Ic(s)!==c;return u&&(n=l,s=c),{width:n,height:s,$:u}}function um(e){return nr(e)?e:e.contextElement}function Ha(e){const t=um(e);if(!wr(t))return gr(1);const n=t.getBoundingClientRect(),{width:s,height:o,$:l}=Wx(t);let c=(l?Ic(n.width):n.width)/s,u=(l?Ic(n.height):n.height)/o;return(!c||!Number.isFinite(c))&&(c=1),(!u||!Number.isFinite(u))&&(u=1),{x:c,y:u}}const PT=gr(0);function Gx(e){const t=xn(e);return!dm()||!t.visualViewport?PT:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function RT(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==xn(e)?!1:t}function Zs(e,t,n,s){t===void 0&&(t=!1),n===void 0&&(n=!1);const o=e.getBoundingClientRect(),l=um(e);let c=gr(1);t&&(s?nr(s)&&(c=Ha(s)):c=Ha(e));const u=RT(l,n,s)?Gx(l):gr(0);let h=(o.left+u.x)/c.x,f=(o.top+u.y)/c.y,g=o.width/c.x,v=o.height/c.y;if(l){const b=xn(l),x=s&&nr(s)?xn(s):s;let S=b,C=hf(S);for(;C&&s&&x!==S;){const w=Ha(C),N=C.getBoundingClientRect(),_=rr(C),j=N.left+(C.clientLeft+parseFloat(_.paddingLeft))*w.x,T=N.top+(C.clientTop+parseFloat(_.paddingTop))*w.y;h*=w.x,f*=w.y,g*=w.x,v*=w.y,h+=j,f+=T,S=xn(C),C=hf(S)}}return Oc({width:g,height:v,x:h,y:f})}function hm(e,t){const n=ad(e).scrollLeft;return t?t.left+n:Zs(br(e)).left+n}function Kx(e,t,n){n===void 0&&(n=!1);const s=e.getBoundingClientRect(),o=s.left+t.scrollLeft-(n?0:hm(e,s)),l=s.top+t.scrollTop;return{x:o,y:l}}function IT(e){let{elements:t,rect:n,offsetParent:s,strategy:o}=e;const l=o==="fixed",c=br(s),u=t?sd(t.floating):!1;if(s===c||u&&l)return n;let h={scrollLeft:0,scrollTop:0},f=gr(1);const g=gr(0),v=wr(s);if((v||!v&&!l)&&((si(s)!=="body"||Ao(c))&&(h=ad(s)),wr(s))){const x=Zs(s);f=Ha(s),g.x=x.x+s.clientLeft,g.y=x.y+s.clientTop}const b=c&&!v&&!l?Kx(c,h,!0):gr(0);return{width:n.width*f.x,height:n.height*f.y,x:n.x*f.x-h.scrollLeft*f.x+g.x+b.x,y:n.y*f.y-h.scrollTop*f.y+g.y+b.y}}function DT(e){return Array.from(e.getClientRects())}function OT(e){const t=br(e),n=ad(e),s=e.ownerDocument.body,o=vn(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),l=vn(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let c=-n.scrollLeft+hm(e);const u=-n.scrollTop;return rr(s).direction==="rtl"&&(c+=vn(t.clientWidth,s.clientWidth)-o),{width:o,height:l,x:c,y:u}}function LT(e,t){const n=xn(e),s=br(e),o=n.visualViewport;let l=s.clientWidth,c=s.clientHeight,u=0,h=0;if(o){l=o.width,c=o.height;const f=dm();(!f||f&&t==="fixed")&&(u=o.offsetLeft,h=o.offsetTop)}return{width:l,height:c,x:u,y:h}}const MT=new Set(["absolute","fixed"]);function $T(e,t){const n=Zs(e,!0,t==="fixed"),s=n.top+e.clientTop,o=n.left+e.clientLeft,l=wr(e)?Ha(e):gr(1),c=e.clientWidth*l.x,u=e.clientHeight*l.y,h=o*l.x,f=s*l.y;return{width:c,height:u,x:h,y:f}}function vy(e,t,n){let s;if(t==="viewport")s=LT(e,n);else if(t==="document")s=OT(br(e));else if(nr(t))s=$T(t,n);else{const o=Gx(e);s={x:t.x-o.x,y:t.y-o.y,width:t.width,height:t.height}}return Oc(s)}function Yx(e,t){const n=xs(e);return n===t||!nr(n)||Ka(n)?!1:rr(n).position==="fixed"||Yx(n,t)}function FT(e,t){const n=t.get(e);if(n)return n;let s=ho(e,[],!1).filter(u=>nr(u)&&si(u)!=="body"),o=null;const l=rr(e).position==="fixed";let c=l?xs(e):e;for(;nr(c)&&!Ka(c);){const u=rr(c),h=cm(c);!h&&u.position==="fixed"&&(o=null),(l?!h&&!o:!h&&u.position==="static"&&!!o&&MT.has(o.position)||Ao(c)&&!h&&Yx(e,c))?s=s.filter(g=>g!==c):o=u,c=xs(c)}return t.set(e,s),s}function UT(e){let{element:t,boundary:n,rootBoundary:s,strategy:o}=e;const c=[...n==="clippingAncestors"?sd(t)?[]:FT(t,this._c):[].concat(n),s],u=c[0],h=c.reduce((f,g)=>{const v=vy(t,g,o);return f.top=vn(v.top,f.top),f.right=ws(v.right,f.right),f.bottom=ws(v.bottom,f.bottom),f.left=vn(v.left,f.left),f},vy(t,u,o));return{width:h.right-h.left,height:h.bottom-h.top,x:h.left,y:h.top}}function BT(e){const{width:t,height:n}=Wx(e);return{width:t,height:n}}function zT(e,t,n){const s=wr(t),o=br(t),l=n==="fixed",c=Zs(e,!0,l,t);let u={scrollLeft:0,scrollTop:0};const h=gr(0);function f(){h.x=hm(o)}if(s||!s&&!l)if((si(t)!=="body"||Ao(o))&&(u=ad(t)),s){const x=Zs(t,!0,l,t);h.x=x.x+t.clientLeft,h.y=x.y+t.clientTop}else o&&f();l&&!s&&o&&f();const g=o&&!s&&!l?Kx(o,u):gr(0),v=c.left+u.scrollLeft-h.x-g.x,b=c.top+u.scrollTop-h.y-g.y;return{x:v,y:b,width:c.width,height:c.height}}function Nh(e){return rr(e).position==="static"}function yy(e,t){if(!wr(e)||rr(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return br(e)===n&&(n=n.ownerDocument.body),n}function Jx(e,t){const n=xn(e);if(sd(e))return n;if(!wr(e)){let o=xs(e);for(;o&&!Ka(o);){if(nr(o)&&!Nh(o))return o;o=xs(o)}return n}let s=yy(e,t);for(;s&&ET(s)&&Nh(s);)s=yy(s,t);return s&&Ka(s)&&Nh(s)&&!cm(s)?n:s||TT(e)||n}const HT=async function(e){const t=this.getOffsetParent||Jx,n=this.getDimensions,s=await n(e.floating);return{reference:zT(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function VT(e){return rr(e).direction==="rtl"}const qT={convertOffsetParentRelativeRectToViewportRelativeRect:IT,getDocumentElement:br,getClippingRect:UT,getOffsetParent:Jx,getElementRects:HT,getClientRects:DT,getDimensions:BT,getScale:Ha,isElement:nr,isRTL:VT};function Qx(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function WT(e,t){let n=null,s;const o=br(e);function l(){var u;clearTimeout(s),(u=n)==null||u.disconnect(),n=null}function c(u,h){u===void 0&&(u=!1),h===void 0&&(h=1),l();const f=e.getBoundingClientRect(),{left:g,top:v,width:b,height:x}=f;if(u||t(),!b||!x)return;const S=tc(v),C=tc(o.clientWidth-(g+b)),w=tc(o.clientHeight-(v+x)),N=tc(g),j={rootMargin:-S+"px "+-C+"px "+-w+"px "+-N+"px",threshold:vn(0,ws(1,h))||1};let T=!0;function R(A){const I=A[0].intersectionRatio;if(I!==h){if(!T)return c();I?c(!1,I):s=setTimeout(()=>{c(!1,1e-7)},1e3)}I===1&&!Qx(f,e.getBoundingClientRect())&&c(),T=!1}try{n=new IntersectionObserver(R,{...j,root:o.ownerDocument})}catch{n=new IntersectionObserver(R,j)}n.observe(e)}return c(!0),l}function GT(e,t,n,s){s===void 0&&(s={});const{ancestorScroll:o=!0,ancestorResize:l=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:u=typeof IntersectionObserver=="function",animationFrame:h=!1}=s,f=um(e),g=o||l?[...f?ho(f):[],...ho(t)]:[];g.forEach(N=>{o&&N.addEventListener("scroll",n,{passive:!0}),l&&N.addEventListener("resize",n)});const v=f&&u?WT(f,n):null;let b=-1,x=null;c&&(x=new ResizeObserver(N=>{let[_]=N;_&&_.target===f&&x&&(x.unobserve(t),cancelAnimationFrame(b),b=requestAnimationFrame(()=>{var j;(j=x)==null||j.observe(t)})),n()}),f&&!h&&x.observe(f),x.observe(t));let S,C=h?Zs(e):null;h&&w();function w(){const N=Zs(e);C&&!Qx(C,N)&&n(),C=N,S=requestAnimationFrame(w)}return n(),()=>{var N;g.forEach(_=>{o&&_.removeEventListener("scroll",n),l&&_.removeEventListener("resize",n)}),v?.(),(N=x)==null||N.disconnect(),x=null,h&&cancelAnimationFrame(S)}}const KT=yT,YT=wT,JT=pT,QT=bT,XT=gT,wy=mT,ZT=xT,eA=(e,t,n)=>{const s=new Map,o={platform:qT,...n},l={...o.platform,_c:s};return fT(e,t,{...o,platform:l})};var tA=typeof document<"u",nA=function(){},Ec=tA?p.useLayoutEffect:nA;function Lc(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,s,o;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(s=n;s--!==0;)if(!Lc(e[s],t[s]))return!1;return!0}if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!{}.hasOwnProperty.call(t,o[s]))return!1;for(s=n;s--!==0;){const l=o[s];if(!(l==="_owner"&&e.$$typeof)&&!Lc(e[l],t[l]))return!1}return!0}return e!==e&&t!==t}function Xx(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function xy(e,t){const n=Xx(e);return Math.round(t*n)/n}function jh(e){const t=p.useRef(e);return Ec(()=>{t.current=e}),t}function rA(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:s=[],platform:o,elements:{reference:l,floating:c}={},transform:u=!0,whileElementsMounted:h,open:f}=e,[g,v]=p.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[b,x]=p.useState(s);Lc(b,s)||x(s);const[S,C]=p.useState(null),[w,N]=p.useState(null),_=p.useCallback($=>{$!==A.current&&(A.current=$,C($))},[]),j=p.useCallback($=>{$!==I.current&&(I.current=$,N($))},[]),T=l||S,R=c||w,A=p.useRef(null),I=p.useRef(null),L=p.useRef(g),Z=h!=null,M=jh(h),U=jh(o),D=jh(f),B=p.useCallback(()=>{if(!A.current||!I.current)return;const $={placement:t,strategy:n,middleware:b};U.current&&($.platform=U.current),eA(A.current,I.current,$).then(O=>{const J={...O,isPositioned:D.current!==!1};z.current&&!Lc(L.current,J)&&(L.current=J,ei.flushSync(()=>{v(J)}))})},[b,t,n,U,D]);Ec(()=>{f===!1&&L.current.isPositioned&&(L.current.isPositioned=!1,v($=>({...$,isPositioned:!1})))},[f]);const z=p.useRef(!1);Ec(()=>(z.current=!0,()=>{z.current=!1}),[]),Ec(()=>{if(T&&(A.current=T),R&&(I.current=R),T&&R){if(M.current)return M.current(T,R,B);B()}},[T,R,B,M,Z]);const q=p.useMemo(()=>({reference:A,floating:I,setReference:_,setFloating:j}),[_,j]),H=p.useMemo(()=>({reference:T,floating:R}),[T,R]),Q=p.useMemo(()=>{const $={position:n,left:0,top:0};if(!H.floating)return $;const O=xy(H.floating,g.x),J=xy(H.floating,g.y);return u?{...$,transform:"translate("+O+"px, "+J+"px)",...Xx(H.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:O,top:J}},[n,u,H.floating,g.x,g.y]);return p.useMemo(()=>({...g,update:B,refs:q,elements:H,floatingStyles:Q}),[g,B,q,H,Q])}const sA=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:s,padding:o}=typeof e=="function"?e(n):e;return s&&t(s)?s.current!=null?wy({element:s.current,padding:o}).fn(n):{}:s?wy({element:s,padding:o}).fn(n):{}}}},aA=(e,t)=>({...KT(e),options:[e,t]}),iA=(e,t)=>({...YT(e),options:[e,t]}),oA=(e,t)=>({...ZT(e),options:[e,t]}),lA=(e,t)=>({...JT(e),options:[e,t]}),cA=(e,t)=>({...QT(e),options:[e,t]}),dA=(e,t)=>({...XT(e),options:[e,t]}),uA=(e,t)=>({...sA(e),options:[e,t]});var hA="Arrow",Zx=p.forwardRef((e,t)=>{const{children:n,width:s=10,height:o=5,...l}=e;return i.jsx(Me.svg,{...l,ref:t,width:s,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:i.jsx("polygon",{points:"0,0 30,0 15,10"})})});Zx.displayName=hA;var fA=Zx;function e0(e){const[t,n]=p.useState(void 0);return Ut(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const s=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const l=o[0];let c,u;if("borderBoxSize"in l){const h=l.borderBoxSize,f=Array.isArray(h)?h[0]:h;c=f.inlineSize,u=f.blockSize}else c=e.offsetWidth,u=e.offsetHeight;n({width:c,height:u})});return s.observe(e,{box:"border-box"}),()=>s.unobserve(e)}else n(void 0)},[e]),t}var fm="Popper",[t0,ai]=Mn(fm),[mA,n0]=t0(fm),r0=e=>{const{__scopePopper:t,children:n}=e,[s,o]=p.useState(null);return i.jsx(mA,{scope:t,anchor:s,onAnchorChange:o,children:n})};r0.displayName=fm;var s0="PopperAnchor",a0=p.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:s,...o}=e,l=n0(s0,n),c=p.useRef(null),u=Ye(t,c);return p.useEffect(()=>{l.onAnchorChange(s?.current||c.current)}),s?null:i.jsx(Me.div,{...o,ref:u})});a0.displayName=s0;var mm="PopperContent",[pA,gA]=t0(mm),i0=p.forwardRef((e,t)=>{const{__scopePopper:n,side:s="bottom",sideOffset:o=0,align:l="center",alignOffset:c=0,arrowPadding:u=0,avoidCollisions:h=!0,collisionBoundary:f=[],collisionPadding:g=0,sticky:v="partial",hideWhenDetached:b=!1,updatePositionStrategy:x="optimized",onPlaced:S,...C}=e,w=n0(mm,n),[N,_]=p.useState(null),j=Ye(t,G=>_(G)),[T,R]=p.useState(null),A=e0(T),I=A?.width??0,L=A?.height??0,Z=s+(l!=="center"?"-"+l:""),M=typeof g=="number"?g:{top:0,right:0,bottom:0,left:0,...g},U=Array.isArray(f)?f:[f],D=U.length>0,B={padding:M,boundary:U.filter(yA),altBoundary:D},{refs:z,floatingStyles:q,placement:H,isPositioned:Q,middlewareData:$}=rA({strategy:"fixed",placement:Z,whileElementsMounted:(...G)=>GT(...G,{animationFrame:x==="always"}),elements:{reference:w.anchor},middleware:[aA({mainAxis:o+L,alignmentAxis:c}),h&&iA({mainAxis:!0,crossAxis:!1,limiter:v==="partial"?oA():void 0,...B}),h&&lA({...B}),cA({...B,apply:({elements:G,rects:ae,availableWidth:fe,availableHeight:ve})=>{const{width:xe,height:Ie}=ae.reference,$e=G.floating.style;$e.setProperty("--radix-popper-available-width",`${fe}px`),$e.setProperty("--radix-popper-available-height",`${ve}px`),$e.setProperty("--radix-popper-anchor-width",`${xe}px`),$e.setProperty("--radix-popper-anchor-height",`${Ie}px`)}}),T&&uA({element:T,padding:u}),wA({arrowWidth:I,arrowHeight:L}),b&&dA({strategy:"referenceHidden",...B})]}),[O,J]=c0(H),F=un(S);Ut(()=>{Q&&F?.()},[Q,F]);const ee=$.arrow?.x,ce=$.arrow?.y,K=$.arrow?.centerOffset!==0,[W,ne]=p.useState();return Ut(()=>{N&&ne(window.getComputedStyle(N).zIndex)},[N]),i.jsx("div",{ref:z.setFloating,"data-radix-popper-content-wrapper":"",style:{...q,transform:Q?q.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:W,"--radix-popper-transform-origin":[$.transformOrigin?.x,$.transformOrigin?.y].join(" "),...$.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:i.jsx(pA,{scope:n,placedSide:O,onArrowChange:R,arrowX:ee,arrowY:ce,shouldHideArrow:K,children:i.jsx(Me.div,{"data-side":O,"data-align":J,...C,ref:j,style:{...C.style,animation:Q?void 0:"none"}})})})});i0.displayName=mm;var o0="PopperArrow",vA={top:"bottom",right:"left",bottom:"top",left:"right"},l0=p.forwardRef(function(t,n){const{__scopePopper:s,...o}=t,l=gA(o0,s),c=vA[l.placedSide];return i.jsx("span",{ref:l.onArrowChange,style:{position:"absolute",left:l.arrowX,top:l.arrowY,[c]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[l.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[l.placedSide],visibility:l.shouldHideArrow?"hidden":void 0},children:i.jsx(fA,{...o,ref:n,style:{...o.style,display:"block"}})})});l0.displayName=o0;function yA(e){return e!==null}var wA=e=>({name:"transformOrigin",options:e,fn(t){const{placement:n,rects:s,middlewareData:o}=t,c=o.arrow?.centerOffset!==0,u=c?0:e.arrowWidth,h=c?0:e.arrowHeight,[f,g]=c0(n),v={start:"0%",center:"50%",end:"100%"}[g],b=(o.arrow?.x??0)+u/2,x=(o.arrow?.y??0)+h/2;let S="",C="";return f==="bottom"?(S=c?v:`${b}px`,C=`${-h}px`):f==="top"?(S=c?v:`${b}px`,C=`${s.floating.height+h}px`):f==="right"?(S=`${-h}px`,C=c?v:`${x}px`):f==="left"&&(S=`${s.floating.width+h}px`,C=c?v:`${x}px`),{data:{x:S,y:C}}}});function c0(e){const[t,n="center"]=e.split("-");return[t,n]}var d0=r0,pm=a0,gm=i0,vm=l0,[id]=Mn("Tooltip",[ai]),ym=ai(),u0="TooltipProvider",xA=700,by="tooltip.open",[bA,h0]=id(u0),f0=e=>{const{__scopeTooltip:t,delayDuration:n=xA,skipDelayDuration:s=300,disableHoverableContent:o=!1,children:l}=e,c=p.useRef(!0),u=p.useRef(!1),h=p.useRef(0);return p.useEffect(()=>{const f=h.current;return()=>window.clearTimeout(f)},[]),i.jsx(bA,{scope:t,isOpenDelayedRef:c,delayDuration:n,onOpen:p.useCallback(()=>{window.clearTimeout(h.current),c.current=!1},[]),onClose:p.useCallback(()=>{window.clearTimeout(h.current),h.current=window.setTimeout(()=>c.current=!0,s)},[s]),isPointerInTransitRef:u,onPointerInTransitChange:p.useCallback(f=>{u.current=f},[]),disableHoverableContent:o,children:l})};f0.displayName=u0;var m0="Tooltip",[E$,od]=id(m0),ff="TooltipTrigger",CA=p.forwardRef((e,t)=>{const{__scopeTooltip:n,...s}=e,o=od(ff,n),l=h0(ff,n),c=ym(n),u=p.useRef(null),h=Ye(t,u,o.onTriggerChange),f=p.useRef(!1),g=p.useRef(!1),v=p.useCallback(()=>f.current=!1,[]);return p.useEffect(()=>()=>document.removeEventListener("pointerup",v),[v]),i.jsx(pm,{asChild:!0,...c,children:i.jsx(Me.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...s,ref:h,onPointerMove:we(e.onPointerMove,b=>{b.pointerType!=="touch"&&!g.current&&!l.isPointerInTransitRef.current&&(o.onTriggerEnter(),g.current=!0)}),onPointerLeave:we(e.onPointerLeave,()=>{o.onTriggerLeave(),g.current=!1}),onPointerDown:we(e.onPointerDown,()=>{o.open&&o.onClose(),f.current=!0,document.addEventListener("pointerup",v,{once:!0})}),onFocus:we(e.onFocus,()=>{f.current||o.onOpen()}),onBlur:we(e.onBlur,o.onClose),onClick:we(e.onClick,o.onClose)})})});CA.displayName=ff;var SA="TooltipPortal",[_$,EA]=id(SA,{forceMount:void 0}),Ya="TooltipContent",p0=p.forwardRef((e,t)=>{const n=EA(Ya,e.__scopeTooltip),{forceMount:s=n.forceMount,side:o="top",...l}=e,c=od(Ya,e.__scopeTooltip);return i.jsx($n,{present:s||c.open,children:c.disableHoverableContent?i.jsx(g0,{side:o,...l,ref:t}):i.jsx(_A,{side:o,...l,ref:t})})}),_A=p.forwardRef((e,t)=>{const n=od(Ya,e.__scopeTooltip),s=h0(Ya,e.__scopeTooltip),o=p.useRef(null),l=Ye(t,o),[c,u]=p.useState(null),{trigger:h,onClose:f}=n,g=o.current,{onPointerInTransitChange:v}=s,b=p.useCallback(()=>{u(null),v(!1)},[v]),x=p.useCallback((S,C)=>{const w=S.currentTarget,N={x:S.clientX,y:S.clientY},_=AA(N,w.getBoundingClientRect()),j=PA(N,_),T=RA(C.getBoundingClientRect()),R=DA([...j,...T]);u(R),v(!0)},[v]);return p.useEffect(()=>()=>b(),[b]),p.useEffect(()=>{if(h&&g){const S=w=>x(w,g),C=w=>x(w,h);return h.addEventListener("pointerleave",S),g.addEventListener("pointerleave",C),()=>{h.removeEventListener("pointerleave",S),g.removeEventListener("pointerleave",C)}}},[h,g,x,b]),p.useEffect(()=>{if(c){const S=C=>{const w=C.target,N={x:C.clientX,y:C.clientY},_=h?.contains(w)||g?.contains(w),j=!IA(N,c);_?b():j&&(b(),f())};return document.addEventListener("pointermove",S),()=>document.removeEventListener("pointermove",S)}},[h,g,c,f,b]),i.jsx(g0,{...e,ref:l})}),[NA,jA]=id(m0,{isInside:!1}),kA=Zw("TooltipContent"),g0=p.forwardRef((e,t)=>{const{__scopeTooltip:n,children:s,"aria-label":o,onEscapeKeyDown:l,onPointerDownOutside:c,...u}=e,h=od(Ya,n),f=ym(n),{onClose:g}=h;return p.useEffect(()=>(document.addEventListener(by,g),()=>document.removeEventListener(by,g)),[g]),p.useEffect(()=>{if(h.trigger){const v=b=>{b.target?.contains(h.trigger)&&g()};return window.addEventListener("scroll",v,{capture:!0}),()=>window.removeEventListener("scroll",v,{capture:!0})}},[h.trigger,g]),i.jsx(ti,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:v=>v.preventDefault(),onDismiss:g,children:i.jsxs(gm,{"data-state":h.stateAttribute,...f,...u,ref:t,style:{...u.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[i.jsx(kA,{children:s}),i.jsx(NA,{scope:n,isInside:!0,children:i.jsx(GN,{id:h.contentId,role:"tooltip",children:o||s})})]})})});p0.displayName=Ya;var v0="TooltipArrow",TA=p.forwardRef((e,t)=>{const{__scopeTooltip:n,...s}=e,o=ym(n);return jA(v0,n).isInside?null:i.jsx(vm,{...o,...s,ref:t})});TA.displayName=v0;function AA(e,t){const n=Math.abs(t.top-e.y),s=Math.abs(t.bottom-e.y),o=Math.abs(t.right-e.x),l=Math.abs(t.left-e.x);switch(Math.min(n,s,o,l)){case l:return"left";case o:return"right";case n:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function PA(e,t,n=5){const s=[];switch(t){case"top":s.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":s.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":s.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":s.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return s}function RA(e){const{top:t,right:n,bottom:s,left:o}=e;return[{x:o,y:t},{x:n,y:t},{x:n,y:s},{x:o,y:s}]}function IA(e,t){const{x:n,y:s}=e;let o=!1;for(let l=0,c=t.length-1;l<t.length;c=l++){const u=t[l],h=t[c],f=u.x,g=u.y,v=h.x,b=h.y;g>s!=b>s&&n<(v-f)*(s-g)/(b-g)+f&&(o=!o)}return o}function DA(e){const t=e.slice();return t.sort((n,s)=>n.x<s.x?-1:n.x>s.x?1:n.y<s.y?-1:n.y>s.y?1:0),OA(t)}function OA(e){if(e.length<=1)return e.slice();const t=[];for(let s=0;s<e.length;s++){const o=e[s];for(;t.length>=2;){const l=t[t.length-1],c=t[t.length-2];if((l.x-c.x)*(o.y-c.y)>=(l.y-c.y)*(o.x-c.x))t.pop();else break}t.push(o)}t.pop();const n=[];for(let s=e.length-1;s>=0;s--){const o=e[s];for(;n.length>=2;){const l=n[n.length-1],c=n[n.length-2];if((l.x-c.x)*(o.y-c.y)>=(l.y-c.y)*(o.x-c.x))n.pop();else break}n.push(o)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var LA=f0,y0=p0;const MA=LA,$A=p.forwardRef(({className:e,sideOffset:t=4,...n},s)=>i.jsx(y0,{ref:s,sideOffset:t,className:Ce("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));$A.displayName=y0.displayName;var ld=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},cd=typeof window>"u"||"Deno"in globalThis;function Xn(){}function FA(e,t){return typeof e=="function"?e(t):e}function UA(e){return typeof e=="number"&&e>=0&&e!==1/0}function BA(e,t){return Math.max(e+(t||0)-Date.now(),0)}function mf(e,t){return typeof e=="function"?e(t):e}function zA(e,t){return typeof e=="function"?e(t):e}function Cy(e,t){const{type:n="all",exact:s,fetchStatus:o,predicate:l,queryKey:c,stale:u}=e;if(c){if(s){if(t.queryHash!==wm(c,t.options))return!1}else if(!mo(t.queryKey,c))return!1}if(n!=="all"){const h=t.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof u=="boolean"&&t.isStale()!==u||o&&o!==t.state.fetchStatus||l&&!l(t))}function Sy(e,t){const{exact:n,status:s,predicate:o,mutationKey:l}=e;if(l){if(!t.options.mutationKey)return!1;if(n){if(fo(t.options.mutationKey)!==fo(l))return!1}else if(!mo(t.options.mutationKey,l))return!1}return!(s&&t.state.status!==s||o&&!o(t))}function wm(e,t){return(t?.queryKeyHashFn||fo)(e)}function fo(e){return JSON.stringify(e,(t,n)=>pf(n)?Object.keys(n).sort().reduce((s,o)=>(s[o]=n[o],s),{}):n)}function mo(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>mo(e[n],t[n])):!1}function w0(e,t){if(e===t)return e;const n=Ey(e)&&Ey(t);if(n||pf(e)&&pf(t)){const s=n?e:Object.keys(e),o=s.length,l=n?t:Object.keys(t),c=l.length,u=n?[]:{},h=new Set(s);let f=0;for(let g=0;g<c;g++){const v=n?g:l[g];(!n&&h.has(v)||n)&&e[v]===void 0&&t[v]===void 0?(u[v]=void 0,f++):(u[v]=w0(e[v],t[v]),u[v]===e[v]&&e[v]!==void 0&&f++)}return o===c&&f===o?e:u}return t}function Ey(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function pf(e){if(!_y(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!_y(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function _y(e){return Object.prototype.toString.call(e)==="[object Object]"}function HA(e){return new Promise(t=>{setTimeout(t,e)})}function VA(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?w0(e,t):t}function qA(e,t,n=0){const s=[...e,t];return n&&s.length>n?s.slice(1):s}function WA(e,t,n=0){const s=[t,...e];return n&&s.length>n?s.slice(0,-1):s}var xm=Symbol();function x0(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===xm?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var GA=class extends ld{#e;#t;#n;constructor(){super(),this.#n=e=>{if(!cd&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#n=e,this.#t?.(),this.#t=e(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},b0=new GA,KA=class extends ld{#e=!0;#t;#n;constructor(){super(),this.#n=e=>{if(!cd&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#n=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#e!==e&&(this.#e=e,this.listeners.forEach(n=>{n(e)}))}isOnline(){return this.#e}},Mc=new KA;function YA(){let e,t;const n=new Promise((o,l)=>{e=o,t=l});n.status="pending",n.catch(()=>{});function s(o){Object.assign(n,o),delete n.resolve,delete n.reject}return n.resolve=o=>{s({status:"fulfilled",value:o}),e(o)},n.reject=o=>{s({status:"rejected",reason:o}),t(o)},n}function JA(e){return Math.min(1e3*2**e,3e4)}function C0(e){return(e??"online")==="online"?Mc.isOnline():!0}var S0=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function kh(e){return e instanceof S0}function E0(e){let t=!1,n=0,s=!1,o;const l=YA(),c=C=>{s||(b(new S0(C)),e.abort?.())},u=()=>{t=!0},h=()=>{t=!1},f=()=>b0.isFocused()&&(e.networkMode==="always"||Mc.isOnline())&&e.canRun(),g=()=>C0(e.networkMode)&&e.canRun(),v=C=>{s||(s=!0,e.onSuccess?.(C),o?.(),l.resolve(C))},b=C=>{s||(s=!0,e.onError?.(C),o?.(),l.reject(C))},x=()=>new Promise(C=>{o=w=>{(s||f())&&C(w)},e.onPause?.()}).then(()=>{o=void 0,s||e.onContinue?.()}),S=()=>{if(s)return;let C;const w=n===0?e.initialPromise:void 0;try{C=w??e.fn()}catch(N){C=Promise.reject(N)}Promise.resolve(C).then(v).catch(N=>{if(s)return;const _=e.retry??(cd?0:3),j=e.retryDelay??JA,T=typeof j=="function"?j(n,N):j,R=_===!0||typeof _=="number"&&n<_||typeof _=="function"&&_(n,N);if(t||!R){b(N);return}n++,e.onFail?.(n,N),HA(T).then(()=>f()?void 0:x()).then(()=>{t?b(N):S()})})};return{promise:l,cancel:c,continue:()=>(o?.(),l),cancelRetry:u,continueRetry:h,canStart:g,start:()=>(g()?S():x().then(S),l)}}var QA=e=>setTimeout(e,0);function XA(){let e=[],t=0,n=u=>{u()},s=u=>{u()},o=QA;const l=u=>{t?e.push(u):o(()=>{n(u)})},c=()=>{const u=e;e=[],u.length&&o(()=>{s(()=>{u.forEach(h=>{n(h)})})})};return{batch:u=>{let h;t++;try{h=u()}finally{t--,t||c()}return h},batchCalls:u=>(...h)=>{l(()=>{u(...h)})},schedule:l,setNotifyFunction:u=>{n=u},setBatchNotifyFunction:u=>{s=u},setScheduler:u=>{o=u}}}var Qt=XA(),_0=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),UA(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(cd?1/0:300*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},ZA=class extends _0{#e;#t;#n;#s;#r;#i;#o;constructor(e){super(),this.#o=!1,this.#i=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=tP(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){this.options={...this.#i,...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,t){const n=VA(this.state.data,e,this.options);return this.#a({data:n,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),n}setState(e,t){this.#a({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#r?.promise;return this.#r?.cancel(e),t?t.then(Xn).catch(Xn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>zA(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===xm||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>mf(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!BA(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}fetch(e,t){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const n=new AbortController,s=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,n.signal)})},o=()=>{const h=x0(this.options,t),g=(()=>{const v={client:this.#s,queryKey:this.queryKey,meta:this.meta};return s(v),v})();return this.#o=!1,this.options.persister?this.options.persister(h,g,this):h(g)},c=(()=>{const h={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return s(h),h})();this.options.behavior?.onFetch(c,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==c.fetchOptions?.meta)&&this.#a({type:"fetch",meta:c.fetchOptions?.meta});const u=h=>{kh(h)&&h.silent||this.#a({type:"error",error:h}),kh(h)||(this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this)),this.scheduleGc()};return this.#r=E0({initialPromise:t?.initialPromise,fn:c.fetchFn,abort:n.abort.bind(n),onSuccess:h=>{if(h===void 0){u(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(h)}catch(f){u(f);return}this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),this.scheduleGc()},onError:u,onFail:(h,f)=>{this.#a({type:"failed",failureCount:h,error:f})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0}),this.#r.start()}#a(e){const t=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...eP(n.data,this.options),fetchMeta:e.meta??null};case"success":return this.#t=void 0,{...n,data:e.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=e.error;return kh(s)&&s.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=t(this.state),Qt.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function eP(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:C0(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function tP(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,s=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var nP=class extends ld{constructor(e={}){super(),this.config=e,this.#e=new Map}#e;build(e,t,n){const s=t.queryKey,o=t.queryHash??wm(s,t);let l=this.get(o);return l||(l=new ZA({client:e,queryKey:s,queryHash:o,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(s)}),this.add(l)),l}add(e){this.#e.has(e.queryHash)||(this.#e.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#e.get(e.queryHash);t&&(e.destroy(),t===e&&this.#e.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Qt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#e.get(e)}getAll(){return[...this.#e.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>Cy(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>Cy(e,n)):t}notify(e){Qt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Qt.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Qt.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},rP=class extends _0{#e;#t;#n;constructor(e){super(),this.mutationId=e.mutationId,this.#t=e.mutationCache,this.#e=[],this.state=e.state||sP(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#e.includes(e)||(this.#e.push(e),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#e=this.#e.filter(t=>t!==e),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#s({type:"continue"})};this.#n=E0({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(o,l)=>{this.#s({type:"failed",failureCount:o,error:l})},onPause:()=>{this.#s({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const n=this.state.status==="pending",s=!this.#n.canStart();try{if(n)t();else{this.#s({type:"pending",variables:e,isPaused:s}),await this.#t.config.onMutate?.(e,this);const l=await this.options.onMutate?.(e);l!==this.state.context&&this.#s({type:"pending",context:l,variables:e,isPaused:s})}const o=await this.#n.start();return await this.#t.config.onSuccess?.(o,e,this.state.context,this),await this.options.onSuccess?.(o,e,this.state.context),await this.#t.config.onSettled?.(o,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(o,null,e,this.state.context),this.#s({type:"success",data:o}),o}catch(o){try{throw await this.#t.config.onError?.(o,e,this.state.context,this),await this.options.onError?.(o,e,this.state.context),await this.#t.config.onSettled?.(void 0,o,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,o,e,this.state.context),o}finally{this.#s({type:"error",error:o})}}finally{this.#t.runNext(this)}}#s(e){const t=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Qt.batch(()=>{this.#e.forEach(n=>{n.onMutationUpdate(e)}),this.#t.notify({mutation:this,type:"updated",action:e})})}};function sP(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var aP=class extends ld{constructor(e={}){super(),this.config=e,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(e,t,n){const s=new rP({mutationCache:this,mutationId:++this.#n,options:e.defaultMutationOptions(t),state:n});return this.add(s),s}add(e){this.#e.add(e);const t=nc(e);if(typeof t=="string"){const n=this.#t.get(t);n?n.push(e):this.#t.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#e.delete(e)){const t=nc(e);if(typeof t=="string"){const n=this.#t.get(t);if(n)if(n.length>1){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}else n[0]===e&&this.#t.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=nc(e);if(typeof t=="string"){const s=this.#t.get(t)?.find(o=>o.state.status==="pending");return!s||s===e}else return!0}runNext(e){const t=nc(e);return typeof t=="string"?this.#t.get(t)?.find(s=>s!==e&&s.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Qt.batch(()=>{this.#e.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(e){const t={exact:!0,...e};return this.getAll().find(n=>Sy(t,n))}findAll(e={}){return this.getAll().filter(t=>Sy(e,t))}notify(e){Qt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Qt.batch(()=>Promise.all(e.map(t=>t.continue().catch(Xn))))}};function nc(e){return e.options.scope?.id}function Ny(e){return{onFetch:(t,n)=>{const s=t.options,o=t.fetchOptions?.meta?.fetchMore?.direction,l=t.state.data?.pages||[],c=t.state.data?.pageParams||[];let u={pages:[],pageParams:[]},h=0;const f=async()=>{let g=!1;const v=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(t.signal.aborted?g=!0:t.signal.addEventListener("abort",()=>{g=!0}),t.signal)})},b=x0(t.options,t.fetchOptions),x=async(S,C,w)=>{if(g)return Promise.reject();if(C==null&&S.pages.length)return Promise.resolve(S);const _=(()=>{const A={client:t.client,queryKey:t.queryKey,pageParam:C,direction:w?"backward":"forward",meta:t.options.meta};return v(A),A})(),j=await b(_),{maxPages:T}=t.options,R=w?WA:qA;return{pages:R(S.pages,j,T),pageParams:R(S.pageParams,C,T)}};if(o&&l.length){const S=o==="backward",C=S?iP:jy,w={pages:l,pageParams:c},N=C(s,w);u=await x(w,N,S)}else{const S=e??l.length;do{const C=h===0?c[0]??s.initialPageParam:jy(s,u);if(h>0&&C==null)break;u=await x(u,C),h++}while(h<S)}return u};t.options.persister?t.fetchFn=()=>t.options.persister?.(f,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n):t.fetchFn=f}}}function jy(e,{pages:t,pageParams:n}){const s=t.length-1;return t.length>0?e.getNextPageParam(t[s],t,n[s],n):void 0}function iP(e,{pages:t,pageParams:n}){return t.length>0?e.getPreviousPageParam?.(t[0],t,n[0],n):void 0}var oP=class{#e;#t;#n;#s;#r;#i;#o;#a;constructor(e={}){this.#e=e.queryCache||new nP,this.#t=e.mutationCache||new aP,this.#n=e.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#i=0}mount(){this.#i++,this.#i===1&&(this.#o=b0.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=Mc.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#i--,this.#i===0&&(this.#o?.(),this.#o=void 0,this.#a?.(),this.#a=void 0)}isFetching(e){return this.#e.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#t.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=this.#e.build(this,t),s=n.state.data;return s===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(mf(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(e){return this.#e.findAll(e).map(({queryKey:t,state:n})=>{const s=n.data;return[t,s]})}setQueryData(e,t,n){const s=this.defaultQueryOptions({queryKey:e}),l=this.#e.get(s.queryHash)?.state.data,c=FA(t,l);if(c!==void 0)return this.#e.build(this,s).setData(c,{...n,manual:!0})}setQueriesData(e,t,n){return Qt.batch(()=>this.#e.findAll(e).map(({queryKey:s})=>[s,this.setQueryData(s,t,n)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state}removeQueries(e){const t=this.#e;Qt.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=this.#e;return Qt.batch(()=>(n.findAll(e).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},s=Qt.batch(()=>this.#e.findAll(e).map(o=>o.cancel(n)));return Promise.all(s).then(Xn).catch(Xn)}invalidateQueries(e,t={}){return Qt.batch(()=>(this.#e.findAll(e).forEach(n=>{n.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},s=Qt.batch(()=>this.#e.findAll(e).filter(o=>!o.isDisabled()&&!o.isStatic()).map(o=>{let l=o.fetch(void 0,n);return n.throwOnError||(l=l.catch(Xn)),o.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(s).then(Xn)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=this.#e.build(this,t);return n.isStaleByTime(mf(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Xn).catch(Xn)}fetchInfiniteQuery(e){return e.behavior=Ny(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Xn).catch(Xn)}ensureInfiniteQueryData(e){return e.behavior=Ny(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Mc.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(e){this.#n=e}setQueryDefaults(e,t){this.#s.set(fo(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#s.values()],n={};return t.forEach(s=>{mo(e,s.queryKey)&&Object.assign(n,s.defaultOptions)}),n}setMutationDefaults(e,t){this.#r.set(fo(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#r.values()],n={};return t.forEach(s=>{mo(e,s.mutationKey)&&Object.assign(n,s.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#n.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=wm(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===xm&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#n.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},lP=p.createContext(void 0),cP=({client:e,children:t})=>(p.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),i.jsx(lP.Provider,{value:e,children:t}));function po(){return po=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},po.apply(this,arguments)}var ms;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(ms||(ms={}));const ky="popstate";function dP(e){e===void 0&&(e={});function t(s,o){let{pathname:l,search:c,hash:u}=s.location;return gf("",{pathname:l,search:c,hash:u},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(s,o){return typeof o=="string"?o:$c(o)}return hP(t,n,null,e)}function wt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function N0(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function uP(){return Math.random().toString(36).substr(2,8)}function Ty(e,t){return{usr:e.state,key:e.key,idx:t}}function gf(e,t,n,s){return n===void 0&&(n=null),po({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?ii(t):t,{state:n,key:t&&t.key||s||uP()})}function $c(e){let{pathname:t="/",search:n="",hash:s=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(t+=s.charAt(0)==="#"?s:"#"+s),t}function ii(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function hP(e,t,n,s){s===void 0&&(s={});let{window:o=document.defaultView,v5Compat:l=!1}=s,c=o.history,u=ms.Pop,h=null,f=g();f==null&&(f=0,c.replaceState(po({},c.state,{idx:f}),""));function g(){return(c.state||{idx:null}).idx}function v(){u=ms.Pop;let w=g(),N=w==null?null:w-f;f=w,h&&h({action:u,location:C.location,delta:N})}function b(w,N){u=ms.Push;let _=gf(C.location,w,N);f=g()+1;let j=Ty(_,f),T=C.createHref(_);try{c.pushState(j,"",T)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;o.location.assign(T)}l&&h&&h({action:u,location:C.location,delta:1})}function x(w,N){u=ms.Replace;let _=gf(C.location,w,N);f=g();let j=Ty(_,f),T=C.createHref(_);c.replaceState(j,"",T),l&&h&&h({action:u,location:C.location,delta:0})}function S(w){let N=o.location.origin!=="null"?o.location.origin:o.location.href,_=typeof w=="string"?w:$c(w);return _=_.replace(/ $/,"%20"),wt(N,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,N)}let C={get action(){return u},get location(){return e(o,c)},listen(w){if(h)throw new Error("A history only accepts one active listener");return o.addEventListener(ky,v),h=w,()=>{o.removeEventListener(ky,v),h=null}},createHref(w){return t(o,w)},createURL:S,encodeLocation(w){let N=S(w);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:b,replace:x,go(w){return c.go(w)}};return C}var Ay;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Ay||(Ay={}));function fP(e,t,n){return n===void 0&&(n="/"),mP(e,t,n)}function mP(e,t,n,s){let o=typeof t=="string"?ii(t):t,l=Ja(o.pathname||"/",n);if(l==null)return null;let c=j0(e);pP(c);let u=null;for(let h=0;u==null&&h<c.length;++h){let f=NP(l);u=EP(c[h],f)}return u}function j0(e,t,n,s){t===void 0&&(t=[]),n===void 0&&(n=[]),s===void 0&&(s="");let o=(l,c,u)=>{let h={relativePath:u===void 0?l.path||"":u,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};h.relativePath.startsWith("/")&&(wt(h.relativePath.startsWith(s),'Absolute route path "'+h.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),h.relativePath=h.relativePath.slice(s.length));let f=gs([s,h.relativePath]),g=n.concat(h);l.children&&l.children.length>0&&(wt(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),j0(l.children,t,g,f)),!(l.path==null&&!l.index)&&t.push({path:f,score:CP(f,l.index),routesMeta:g})};return e.forEach((l,c)=>{var u;if(l.path===""||!((u=l.path)!=null&&u.includes("?")))o(l,c);else for(let h of k0(l.path))o(l,c,h)}),t}function k0(e){let t=e.split("/");if(t.length===0)return[];let[n,...s]=t,o=n.endsWith("?"),l=n.replace(/\?$/,"");if(s.length===0)return o?[l,""]:[l];let c=k0(s.join("/")),u=[];return u.push(...c.map(h=>h===""?l:[l,h].join("/"))),o&&u.push(...c),u.map(h=>e.startsWith("/")&&h===""?"/":h)}function pP(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:SP(t.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}const gP=/^:[\w-]+$/,vP=3,yP=2,wP=1,xP=10,bP=-2,Py=e=>e==="*";function CP(e,t){let n=e.split("/"),s=n.length;return n.some(Py)&&(s+=bP),t&&(s+=yP),n.filter(o=>!Py(o)).reduce((o,l)=>o+(gP.test(l)?vP:l===""?wP:xP),s)}function SP(e,t){return e.length===t.length&&e.slice(0,-1).every((s,o)=>s===t[o])?e[e.length-1]-t[t.length-1]:0}function EP(e,t,n){let{routesMeta:s}=e,o={},l="/",c=[];for(let u=0;u<s.length;++u){let h=s[u],f=u===s.length-1,g=l==="/"?t:t.slice(l.length)||"/",v=vf({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},g),b=h.route;if(!v)return null;Object.assign(o,v.params),c.push({params:o,pathname:gs([l,v.pathname]),pathnameBase:AP(gs([l,v.pathnameBase])),route:b}),v.pathnameBase!=="/"&&(l=gs([l,v.pathnameBase]))}return c}function vf(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,s]=_P(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let l=o[0],c=l.replace(/(.)\/+$/,"$1"),u=o.slice(1);return{params:s.reduce((f,g,v)=>{let{paramName:b,isOptional:x}=g;if(b==="*"){let C=u[v]||"";c=l.slice(0,l.length-C.length).replace(/(.)\/+$/,"$1")}const S=u[v];return x&&!S?f[b]=void 0:f[b]=(S||"").replace(/%2F/g,"/"),f},{}),pathname:l,pathnameBase:c,pattern:e}}function _P(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),N0(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let s=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,u,h)=>(s.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),s]}function NP(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return N0(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Ja(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,s=e.charAt(n);return s&&s!=="/"?null:e.slice(n)||"/"}function jP(e,t){t===void 0&&(t="/");let{pathname:n,search:s="",hash:o=""}=typeof e=="string"?ii(e):e;return{pathname:n?n.startsWith("/")?n:kP(n,t):t,search:PP(s),hash:RP(o)}}function kP(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?n.length>1&&n.pop():o!=="."&&n.push(o)}),n.length>1?n.join("/"):"/"}function Th(e,t,n,s){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function TP(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function T0(e,t){let n=TP(e);return t?n.map((s,o)=>o===n.length-1?s.pathname:s.pathnameBase):n.map(s=>s.pathnameBase)}function A0(e,t,n,s){s===void 0&&(s=!1);let o;typeof e=="string"?o=ii(e):(o=po({},e),wt(!o.pathname||!o.pathname.includes("?"),Th("?","pathname","search",o)),wt(!o.pathname||!o.pathname.includes("#"),Th("#","pathname","hash",o)),wt(!o.search||!o.search.includes("#"),Th("#","search","hash",o)));let l=e===""||o.pathname==="",c=l?"/":o.pathname,u;if(c==null)u=n;else{let v=t.length-1;if(!s&&c.startsWith("..")){let b=c.split("/");for(;b[0]==="..";)b.shift(),v-=1;o.pathname=b.join("/")}u=v>=0?t[v]:"/"}let h=jP(o,u),f=c&&c!=="/"&&c.endsWith("/"),g=(l||c===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(f||g)&&(h.pathname+="/"),h}const gs=e=>e.join("/").replace(/\/\/+/g,"/"),AP=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),PP=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,RP=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function IP(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const P0=["post","put","patch","delete"];new Set(P0);const DP=["get",...P0];new Set(DP);function go(){return go=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},go.apply(this,arguments)}const dd=p.createContext(null),R0=p.createContext(null),bs=p.createContext(null),ud=p.createContext(null),Cs=p.createContext({outlet:null,matches:[],isDataRoute:!1}),I0=p.createContext(null);function OP(e,t){let{relative:n}=t===void 0?{}:t;Po()||wt(!1);let{basename:s,navigator:o}=p.useContext(bs),{hash:l,pathname:c,search:u}=fd(e,{relative:n}),h=c;return s!=="/"&&(h=c==="/"?s:gs([s,c])),o.createHref({pathname:h,search:u,hash:l})}function Po(){return p.useContext(ud)!=null}function bn(){return Po()||wt(!1),p.useContext(ud).location}function D0(e){p.useContext(bs).static||p.useLayoutEffect(e)}function rt(){let{isDataRoute:e}=p.useContext(Cs);return e?KP():LP()}function LP(){Po()||wt(!1);let e=p.useContext(dd),{basename:t,future:n,navigator:s}=p.useContext(bs),{matches:o}=p.useContext(Cs),{pathname:l}=bn(),c=JSON.stringify(T0(o,n.v7_relativeSplatPath)),u=p.useRef(!1);return D0(()=>{u.current=!0}),p.useCallback(function(f,g){if(g===void 0&&(g={}),!u.current)return;if(typeof f=="number"){s.go(f);return}let v=A0(f,JSON.parse(c),l,g.relative==="path");e==null&&t!=="/"&&(v.pathname=v.pathname==="/"?t:gs([t,v.pathname])),(g.replace?s.replace:s.push)(v,g.state,g)},[t,s,c,l,e])}function hd(){let{matches:e}=p.useContext(Cs),t=e[e.length-1];return t?t.params:{}}function fd(e,t){let{relative:n}=t===void 0?{}:t,{future:s}=p.useContext(bs),{matches:o}=p.useContext(Cs),{pathname:l}=bn(),c=JSON.stringify(T0(o,s.v7_relativeSplatPath));return p.useMemo(()=>A0(e,JSON.parse(c),l,n==="path"),[e,c,l,n])}function MP(e,t){return $P(e,t)}function $P(e,t,n,s){Po()||wt(!1);let{navigator:o}=p.useContext(bs),{matches:l}=p.useContext(Cs),c=l[l.length-1],u=c?c.params:{};c&&c.pathname;let h=c?c.pathnameBase:"/";c&&c.route;let f=bn(),g;if(t){var v;let w=typeof t=="string"?ii(t):t;h==="/"||(v=w.pathname)!=null&&v.startsWith(h)||wt(!1),g=w}else g=f;let b=g.pathname||"/",x=b;if(h!=="/"){let w=h.replace(/^\//,"").split("/");x="/"+b.replace(/^\//,"").split("/").slice(w.length).join("/")}let S=fP(e,{pathname:x}),C=HP(S&&S.map(w=>Object.assign({},w,{params:Object.assign({},u,w.params),pathname:gs([h,o.encodeLocation?o.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?h:gs([h,o.encodeLocation?o.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),l,n,s);return t&&C?p.createElement(ud.Provider,{value:{location:go({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:ms.Pop}},C):C}function FP(){let e=GP(),t=IP(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return p.createElement(p.Fragment,null,p.createElement("h2",null,"Unexpected Application Error!"),p.createElement("h3",{style:{fontStyle:"italic"}},t),n?p.createElement("pre",{style:o},n):null,null)}const UP=p.createElement(FP,null);class BP extends p.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?p.createElement(Cs.Provider,{value:this.props.routeContext},p.createElement(I0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function zP(e){let{routeContext:t,match:n,children:s}=e,o=p.useContext(dd);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),p.createElement(Cs.Provider,{value:t},s)}function HP(e,t,n,s){var o;if(t===void 0&&(t=[]),n===void 0&&(n=null),s===void 0&&(s=null),e==null){var l;if(!n)return null;if(n.errors)e=n.matches;else if((l=s)!=null&&l.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let c=e,u=(o=n)==null?void 0:o.errors;if(u!=null){let g=c.findIndex(v=>v.route.id&&u?.[v.route.id]!==void 0);g>=0||wt(!1),c=c.slice(0,Math.min(c.length,g+1))}let h=!1,f=-1;if(n&&s&&s.v7_partialHydration)for(let g=0;g<c.length;g++){let v=c[g];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(f=g),v.route.id){let{loaderData:b,errors:x}=n,S=v.route.loader&&b[v.route.id]===void 0&&(!x||x[v.route.id]===void 0);if(v.route.lazy||S){h=!0,f>=0?c=c.slice(0,f+1):c=[c[0]];break}}}return c.reduceRight((g,v,b)=>{let x,S=!1,C=null,w=null;n&&(x=u&&v.route.id?u[v.route.id]:void 0,C=v.route.errorElement||UP,h&&(f<0&&b===0?(YP("route-fallback"),S=!0,w=null):f===b&&(S=!0,w=v.route.hydrateFallbackElement||null)));let N=t.concat(c.slice(0,b+1)),_=()=>{let j;return x?j=C:S?j=w:v.route.Component?j=p.createElement(v.route.Component,null):v.route.element?j=v.route.element:j=g,p.createElement(zP,{match:v,routeContext:{outlet:g,matches:N,isDataRoute:n!=null},children:j})};return n&&(v.route.ErrorBoundary||v.route.errorElement||b===0)?p.createElement(BP,{location:n.location,revalidation:n.revalidation,component:C,error:x,children:_(),routeContext:{outlet:null,matches:N,isDataRoute:!0}}):_()},null)}var O0=(function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e})(O0||{}),L0=(function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e})(L0||{});function VP(e){let t=p.useContext(dd);return t||wt(!1),t}function qP(e){let t=p.useContext(R0);return t||wt(!1),t}function WP(e){let t=p.useContext(Cs);return t||wt(!1),t}function M0(e){let t=WP(),n=t.matches[t.matches.length-1];return n.route.id||wt(!1),n.route.id}function GP(){var e;let t=p.useContext(I0),n=qP(),s=M0();return t!==void 0?t:(e=n.errors)==null?void 0:e[s]}function KP(){let{router:e}=VP(O0.UseNavigateStable),t=M0(L0.UseNavigateStable),n=p.useRef(!1);return D0(()=>{n.current=!0}),p.useCallback(function(o,l){l===void 0&&(l={}),n.current&&(typeof o=="number"?e.navigate(o):e.navigate(o,go({fromRouteId:t},l)))},[e,t])}const Ry={};function YP(e,t,n){Ry[e]||(Ry[e]=!0)}function JP(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function Ct(e){wt(!1)}function QP(e){let{basename:t="/",children:n=null,location:s,navigationType:o=ms.Pop,navigator:l,static:c=!1,future:u}=e;Po()&&wt(!1);let h=t.replace(/^\/*/,"/"),f=p.useMemo(()=>({basename:h,navigator:l,static:c,future:go({v7_relativeSplatPath:!1},u)}),[h,u,l,c]);typeof s=="string"&&(s=ii(s));let{pathname:g="/",search:v="",hash:b="",state:x=null,key:S="default"}=s,C=p.useMemo(()=>{let w=Ja(g,h);return w==null?null:{location:{pathname:w,search:v,hash:b,state:x,key:S},navigationType:o}},[h,g,v,b,x,S,o]);return C==null?null:p.createElement(bs.Provider,{value:f},p.createElement(ud.Provider,{children:n,value:C}))}function XP(e){let{children:t,location:n}=e;return MP(yf(t),n)}new Promise(()=>{});function yf(e,t){t===void 0&&(t=[]);let n=[];return p.Children.forEach(e,(s,o)=>{if(!p.isValidElement(s))return;let l=[...t,o];if(s.type===p.Fragment){n.push.apply(n,yf(s.props.children,l));return}s.type!==Ct&&wt(!1),!s.props.index||!s.props.children||wt(!1);let c={id:s.props.id||l.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(c.children=yf(s.props.children,l)),n.push(c)}),n}function Fc(){return Fc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Fc.apply(this,arguments)}function $0(e,t){if(e==null)return{};var n={},s=Object.keys(e),o,l;for(l=0;l<s.length;l++)o=s[l],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function ZP(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function eR(e,t){return e.button===0&&(!t||t==="_self")&&!ZP(e)}function wf(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let s=e[n];return t.concat(Array.isArray(s)?s.map(o=>[n,o]):[[n,s]])},[]))}function tR(e,t){let n=wf(e);return t&&t.forEach((s,o)=>{n.has(o)||t.getAll(o).forEach(l=>{n.append(o,l)})}),n}const nR=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],rR=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],sR="6";try{window.__reactRouterVersion=sR}catch{}const aR=p.createContext({isTransitioning:!1}),iR="startTransition",Iy=Qf[iR];function oR(e){let{basename:t,children:n,future:s,window:o}=e,l=p.useRef();l.current==null&&(l.current=dP({window:o,v5Compat:!0}));let c=l.current,[u,h]=p.useState({action:c.action,location:c.location}),{v7_startTransition:f}=s||{},g=p.useCallback(v=>{f&&Iy?Iy(()=>h(v)):h(v)},[h,f]);return p.useLayoutEffect(()=>c.listen(g),[c,g]),p.useEffect(()=>JP(s),[s]),p.createElement(QP,{basename:t,children:n,location:u.location,navigationType:u.action,navigator:c,future:s})}const lR=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",cR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,dR=p.forwardRef(function(t,n){let{onClick:s,relative:o,reloadDocument:l,replace:c,state:u,target:h,to:f,preventScrollReset:g,viewTransition:v}=t,b=$0(t,nR),{basename:x}=p.useContext(bs),S,C=!1;if(typeof f=="string"&&cR.test(f)&&(S=f,lR))try{let j=new URL(window.location.href),T=f.startsWith("//")?new URL(j.protocol+f):new URL(f),R=Ja(T.pathname,x);T.origin===j.origin&&R!=null?f=R+T.search+T.hash:C=!0}catch{}let w=OP(f,{relative:o}),N=fR(f,{replace:c,state:u,target:h,preventScrollReset:g,relative:o,viewTransition:v});function _(j){s&&s(j),j.defaultPrevented||N(j)}return p.createElement("a",Fc({},b,{href:S||w,onClick:C||l?s:_,ref:n,target:h}))}),uR=p.forwardRef(function(t,n){let{"aria-current":s="page",caseSensitive:o=!1,className:l="",end:c=!1,style:u,to:h,viewTransition:f,children:g}=t,v=$0(t,rR),b=fd(h,{relative:v.relative}),x=bn(),S=p.useContext(R0),{navigator:C,basename:w}=p.useContext(bs),N=S!=null&&mR(b)&&f===!0,_=C.encodeLocation?C.encodeLocation(b).pathname:b.pathname,j=x.pathname,T=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;o||(j=j.toLowerCase(),T=T?T.toLowerCase():null,_=_.toLowerCase()),T&&w&&(T=Ja(T,w)||T);const R=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let A=j===_||!c&&j.startsWith(_)&&j.charAt(R)==="/",I=T!=null&&(T===_||!c&&T.startsWith(_)&&T.charAt(_.length)==="/"),L={isActive:A,isPending:I,isTransitioning:N},Z=A?s:void 0,M;typeof l=="function"?M=l(L):M=[l,A?"active":null,I?"pending":null,N?"transitioning":null].filter(Boolean).join(" ");let U=typeof u=="function"?u(L):u;return p.createElement(dR,Fc({},v,{"aria-current":Z,className:M,ref:n,style:U,to:h,viewTransition:f}),typeof g=="function"?g(L):g)});var xf;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(xf||(xf={}));var Dy;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Dy||(Dy={}));function hR(e){let t=p.useContext(dd);return t||wt(!1),t}function fR(e,t){let{target:n,replace:s,state:o,preventScrollReset:l,relative:c,viewTransition:u}=t===void 0?{}:t,h=rt(),f=bn(),g=fd(e,{relative:c});return p.useCallback(v=>{if(eR(v,n)){v.preventDefault();let b=s!==void 0?s:$c(f)===$c(g);h(e,{replace:b,state:o,preventScrollReset:l,relative:c,viewTransition:u})}},[f,h,g,s,o,n,e,l,c,u])}function F0(e){let t=p.useRef(wf(e)),n=p.useRef(!1),s=bn(),o=p.useMemo(()=>tR(s.search,n.current?null:t.current),[s.search]),l=rt(),c=p.useCallback((u,h)=>{const f=wf(typeof u=="function"?u(o):u);n.current=!0,l("?"+f,h)},[l,o]);return[o,c]}function mR(e,t){t===void 0&&(t={});let n=p.useContext(aR);n==null&&wt(!1);let{basename:s}=hR(xf.useViewTransitionState),o=fd(e,{relative:t.relative});if(!n.isTransitioning)return!1;let l=Ja(n.currentLocation.pathname,s)||n.currentLocation.pathname,c=Ja(n.nextLocation.pathname,s)||n.nextLocation.pathname;return vf(o.pathname,c)!=null||vf(o.pathname,l)!=null}const pR=({children:e,className:t,withTopInset:n=!0,withBottomInset:s=!0})=>i.jsx("div",{className:Ce("safe-area-layout min-h-[100dvh] w-full overflow-x-hidden",{"safe-area-top":n,"safe-area-bottom":s},t),children:e});var bf=function(e,t){return bf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},bf(e,t)};function U0(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");bf(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Tn=function(){return Tn=Object.assign||function(t){for(var n,s=1,o=arguments.length;s<o;s++){n=arguments[s];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(t[l]=n[l])}return t},Tn.apply(this,arguments)};function Ss(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]]);return n}function B0(e,t,n,s){var o=arguments.length,l=o<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,n):s,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(e,t,n,s);else for(var u=e.length-1;u>=0;u--)(c=e[u])&&(l=(o<3?c(l):o>3?c(t,n,l):c(t,n))||l);return o>3&&l&&Object.defineProperty(t,n,l),l}function z0(e,t){return function(n,s){t(n,s,e)}}function H0(e,t,n,s,o,l){function c(N){if(N!==void 0&&typeof N!="function")throw new TypeError("Function expected");return N}for(var u=s.kind,h=u==="getter"?"get":u==="setter"?"set":"value",f=!t&&e?s.static?e:e.prototype:null,g=t||(f?Object.getOwnPropertyDescriptor(f,s.name):{}),v,b=!1,x=n.length-1;x>=0;x--){var S={};for(var C in s)S[C]=C==="access"?{}:s[C];for(var C in s.access)S.access[C]=s.access[C];S.addInitializer=function(N){if(b)throw new TypeError("Cannot add initializers after decoration has completed");l.push(c(N||null))};var w=(0,n[x])(u==="accessor"?{get:g.get,set:g.set}:g[h],S);if(u==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(v=c(w.get))&&(g.get=v),(v=c(w.set))&&(g.set=v),(v=c(w.init))&&o.unshift(v)}else(v=c(w))&&(u==="field"?o.unshift(v):g[h]=v)}f&&Object.defineProperty(f,s.name,g),b=!0}function V0(e,t,n){for(var s=arguments.length>2,o=0;o<t.length;o++)n=s?t[o].call(e,n):t[o].call(e);return s?n:void 0}function q0(e){return typeof e=="symbol"?e:"".concat(e)}function W0(e,t,n){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function G0(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function Te(e,t,n,s){function o(l){return l instanceof n?l:new n(function(c){c(l)})}return new(n||(n=Promise))(function(l,c){function u(g){try{f(s.next(g))}catch(v){c(v)}}function h(g){try{f(s.throw(g))}catch(v){c(v)}}function f(g){g.done?l(g.value):o(g.value).then(u,h)}f((s=s.apply(e,t||[])).next())})}function K0(e,t){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},s,o,l,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=u(0),c.throw=u(1),c.return=u(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(f){return function(g){return h([f,g])}}function h(f){if(s)throw new TypeError("Generator is already executing.");for(;c&&(c=0,f[0]&&(n=0)),n;)try{if(s=1,o&&(l=f[0]&2?o.return:f[0]?o.throw||((l=o.return)&&l.call(o),0):o.next)&&!(l=l.call(o,f[1])).done)return l;switch(o=0,l&&(f=[f[0]&2,l.value]),f[0]){case 0:case 1:l=f;break;case 4:return n.label++,{value:f[1],done:!1};case 5:n.label++,o=f[1],f=[0];continue;case 7:f=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(f[0]===6||f[0]===2)){n=0;continue}if(f[0]===3&&(!l||f[1]>l[0]&&f[1]<l[3])){n.label=f[1];break}if(f[0]===6&&n.label<l[1]){n.label=l[1],l=f;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(f);break}l[2]&&n.ops.pop(),n.trys.pop();continue}f=t.call(e,n)}catch(g){f=[6,g],o=0}finally{s=l=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}var md=Object.create?(function(e,t,n,s){s===void 0&&(s=n);var o=Object.getOwnPropertyDescriptor(t,n);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,o)}):(function(e,t,n,s){s===void 0&&(s=n),e[s]=t[n]});function Y0(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&md(t,e,n)}function Uc(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function bm(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var s=n.call(e),o,l=[],c;try{for(;(t===void 0||t-- >0)&&!(o=s.next()).done;)l.push(o.value)}catch(u){c={error:u}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(c)throw c.error}}return l}function J0(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(bm(arguments[t]));return e}function Q0(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var s=Array(e),o=0,t=0;t<n;t++)for(var l=arguments[t],c=0,u=l.length;c<u;c++,o++)s[o]=l[c];return s}function Cm(e,t,n){if(n||arguments.length===2)for(var s=0,o=t.length,l;s<o;s++)(l||!(s in t))&&(l||(l=Array.prototype.slice.call(t,0,s)),l[s]=t[s]);return e.concat(l||Array.prototype.slice.call(t))}function Qa(e){return this instanceof Qa?(this.v=e,this):new Qa(e)}function X0(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(e,t||[]),o,l=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",c),o[Symbol.asyncIterator]=function(){return this},o;function c(x){return function(S){return Promise.resolve(S).then(x,v)}}function u(x,S){s[x]&&(o[x]=function(C){return new Promise(function(w,N){l.push([x,C,w,N])>1||h(x,C)})},S&&(o[x]=S(o[x])))}function h(x,S){try{f(s[x](S))}catch(C){b(l[0][3],C)}}function f(x){x.value instanceof Qa?Promise.resolve(x.value.v).then(g,v):b(l[0][2],x)}function g(x){h("next",x)}function v(x){h("throw",x)}function b(x,S){x(S),l.shift(),l.length&&h(l[0][0],l[0][1])}}function Z0(e){var t,n;return t={},s("next"),s("throw",function(o){throw o}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(o,l){t[o]=e[o]?function(c){return(n=!n)?{value:Qa(e[o](c)),done:!1}:l?l(c):c}:l}}function eb(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof Uc=="function"?Uc(e):e[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(l){n[l]=e[l]&&function(c){return new Promise(function(u,h){c=e[l](c),o(u,h,c.done,c.value)})}}function o(l,c,u,h){Promise.resolve(h).then(function(f){l({value:f,done:u})},c)}}function tb(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var gR=Object.create?(function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}):function(e,t){e.default=t},Cf=function(e){return Cf=Object.getOwnPropertyNames||function(t){var n=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[n.length]=s);return n},Cf(e)};function nb(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n=Cf(e),s=0;s<n.length;s++)n[s]!=="default"&&md(t,e,n[s]);return gR(t,e),t}function rb(e){return e&&e.__esModule?e:{default:e}}function sb(e,t,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(e):s?s.value:t.get(e)}function ab(e,t,n,s,o){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?o.call(e,n):o?o.value=n:t.set(e,n),n}function ib(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function ob(e,t,n){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var s,o;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=t[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=t[Symbol.dispose],n&&(o=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");o&&(s=function(){try{o.call(this)}catch(l){return Promise.reject(l)}}),e.stack.push({value:t,dispose:s,async:n})}else n&&e.stack.push({async:!0});return t}var vR=typeof SuppressedError=="function"?SuppressedError:function(e,t,n){var s=new Error(n);return s.name="SuppressedError",s.error=e,s.suppressed=t,s};function lb(e){function t(l){e.error=e.hasError?new vR(l,e.error,"An error was suppressed during disposal."):l,e.hasError=!0}var n,s=0;function o(){for(;n=e.stack.pop();)try{if(!n.async&&s===1)return s=0,e.stack.push(n),Promise.resolve().then(o);if(n.dispose){var l=n.dispose.call(n.value);if(n.async)return s|=2,Promise.resolve(l).then(o,function(c){return t(c),o()})}else s|=1}catch(c){t(c)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return o()}function cb(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,s,o,l,c){return s?t?".jsx":".js":o&&(!l||!c)?n:o+l+"."+c.toLowerCase()+"js"}):e}const yR={__extends:U0,__assign:Tn,__rest:Ss,__decorate:B0,__param:z0,__esDecorate:H0,__runInitializers:V0,__propKey:q0,__setFunctionName:W0,__metadata:G0,__awaiter:Te,__generator:K0,__createBinding:md,__exportStar:Y0,__values:Uc,__read:bm,__spread:J0,__spreadArrays:Q0,__spreadArray:Cm,__await:Qa,__asyncGenerator:X0,__asyncDelegator:Z0,__asyncValues:eb,__makeTemplateObject:tb,__importStar:nb,__importDefault:rb,__classPrivateFieldGet:sb,__classPrivateFieldSet:ab,__classPrivateFieldIn:ib,__addDisposableResource:ob,__disposeResources:lb,__rewriteRelativeImportExtension:cb},wR=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:ob,get __assign(){return Tn},__asyncDelegator:Z0,__asyncGenerator:X0,__asyncValues:eb,__await:Qa,__awaiter:Te,__classPrivateFieldGet:sb,__classPrivateFieldIn:ib,__classPrivateFieldSet:ab,__createBinding:md,__decorate:B0,__disposeResources:lb,__esDecorate:H0,__exportStar:Y0,__extends:U0,__generator:K0,__importDefault:rb,__importStar:nb,__makeTemplateObject:tb,__metadata:G0,__param:z0,__propKey:q0,__read:bm,__rest:Ss,__rewriteRelativeImportExtension:cb,__runInitializers:V0,__setFunctionName:W0,__spread:J0,__spreadArray:Cm,__spreadArrays:Q0,__values:Uc,default:yR},Symbol.toStringTag,{value:"Module"})),xR=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class Sm extends Error{constructor(t,n="FunctionsError",s){super(t),this.name=n,this.context=s}}class bR extends Sm{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Oy extends Sm{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Ly extends Sm{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Sf;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(Sf||(Sf={}));class CR{constructor(t,{headers:n={},customFetch:s,region:o=Sf.Any}={}){this.url=t,this.headers=n,this.region=o,this.fetch=xR(s)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Te(this,arguments,void 0,function*(n,s={}){var o;let l,c;try{const{headers:u,method:h,body:f,signal:g,timeout:v}=s;let b={},{region:x}=s;x||(x=this.region);const S=new URL(`${this.url}/${n}`);x&&x!=="any"&&(b["x-region"]=x,S.searchParams.set("forceFunctionRegion",x));let C;f&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&f instanceof Blob||f instanceof ArrayBuffer?(b["Content-Type"]="application/octet-stream",C=f):typeof f=="string"?(b["Content-Type"]="text/plain",C=f):typeof FormData<"u"&&f instanceof FormData?C=f:(b["Content-Type"]="application/json",C=JSON.stringify(f)):C=f;let w=g;v&&(c=new AbortController,l=setTimeout(()=>c.abort(),v),g?(w=c.signal,g.addEventListener("abort",()=>c.abort())):w=c.signal);const N=yield this.fetch(S.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},b),this.headers),u),body:C,signal:w}).catch(R=>{throw new bR(R)}),_=N.headers.get("x-relay-error");if(_&&_==="true")throw new Oy(N);if(!N.ok)throw new Ly(N);let j=((o=N.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),T;return j==="application/json"?T=yield N.json():j==="application/octet-stream"||j==="application/pdf"?T=yield N.blob():j==="text/event-stream"?T=N:j==="multipart/form-data"?T=yield N.formData():T=yield N.text(),{data:T,error:null,response:N}}catch(u){return{data:null,error:u,response:u instanceof Ly||u instanceof Oy?u.context:void 0}}finally{l&&clearTimeout(l)}})}}var Wt={};const oi=lN(wR);var rc={},sc={},ac={},ic={},oc={},lc={},My;function db(){if(My)return lc;My=1,Object.defineProperty(lc,"__esModule",{value:!0});class e extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return lc.default=e,lc}var $y;function ub(){if($y)return oc;$y=1,Object.defineProperty(oc,"__esModule",{value:!0});const t=oi.__importDefault(db());class n{constructor(o){var l,c;this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=new Headers(o.headers),this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=(l=o.shouldThrowOnError)!==null&&l!==void 0?l:!1,this.signal=o.signal,this.isMaybeSingle=(c=o.isMaybeSingle)!==null&&c!==void 0?c:!1,o.fetch?this.fetch=o.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(o,l){return this.headers=new Headers(this.headers),this.headers.set(o,l),this}then(o,l){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const c=this.fetch;let u=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async h=>{var f,g,v,b;let x=null,S=null,C=null,w=h.status,N=h.statusText;if(h.ok){if(this.method!=="HEAD"){const R=await h.text();R===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((f=this.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?S=R:S=JSON.parse(R))}const j=(g=this.headers.get("Prefer"))===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),T=(v=h.headers.get("content-range"))===null||v===void 0?void 0:v.split("/");j&&T&&T.length>1&&(C=parseInt(T[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(S)&&(S.length>1?(x={code:"PGRST116",details:`Results contain ${S.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},S=null,C=null,w=406,N="Not Acceptable"):S.length===1?S=S[0]:S=null)}else{const j=await h.text();try{x=JSON.parse(j),Array.isArray(x)&&h.status===404&&(S=[],x=null,w=200,N="OK")}catch{h.status===404&&j===""?(w=204,N="No Content"):x={message:j}}if(x&&this.isMaybeSingle&&(!((b=x?.details)===null||b===void 0)&&b.includes("0 rows"))&&(x=null,w=200,N="OK"),x&&this.shouldThrowOnError)throw new t.default(x)}return{error:x,data:S,count:C,status:w,statusText:N}});return this.shouldThrowOnError||(u=u.catch(h=>{var f,g,v,b,x,S;let C="";const w=h?.cause;if(w){const N=(f=w?.message)!==null&&f!==void 0?f:"",_=(g=w?.code)!==null&&g!==void 0?g:"";C=`${(v=h?.name)!==null&&v!==void 0?v:"FetchError"}: ${h?.message}`,C+=`

Caused by: ${(b=w?.name)!==null&&b!==void 0?b:"Error"}: ${N}`,_&&(C+=` (${_})`),w?.stack&&(C+=`
${w.stack}`)}else C=(x=h?.stack)!==null&&x!==void 0?x:"";return{error:{message:`${(S=h?.name)!==null&&S!==void 0?S:"FetchError"}: ${h?.message}`,details:C,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),u.then(o,l)}returns(){return this}overrideTypes(){return this}}return oc.default=n,oc}var Fy;function hb(){if(Fy)return ic;Fy=1,Object.defineProperty(ic,"__esModule",{value:!0});const t=oi.__importDefault(ub());class n extends t.default{select(o){let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(o,{ascending:l=!0,nullsFirst:c,foreignTable:u,referencedTable:h=u}={}){const f=h?`${h}.order`:"order",g=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${g?`${g},`:""}${o}.${l?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:l,referencedTable:c=l}={}){const u=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(u,`${o}`),this}range(o,l,{foreignTable:c,referencedTable:u=c}={}){const h=typeof u>"u"?"offset":`${u}.offset`,f=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${o}`),this.url.searchParams.set(f,`${l-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:o=!1,verbose:l=!1,settings:c=!1,buffers:u=!1,wal:h=!1,format:f="text"}={}){var g;const v=[o?"analyze":null,l?"verbose":null,c?"settings":null,u?"buffers":null,h?"wal":null].filter(Boolean).join("|"),b=(g=this.headers.get("Accept"))!==null&&g!==void 0?g:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${b}"; options=${v};`),f==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(o){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${o}`),this}}return ic.default=n,ic}var Uy;function Em(){if(Uy)return ac;Uy=1,Object.defineProperty(ac,"__esModule",{value:!0});const t=oi.__importDefault(hb()),n=new RegExp("[,()]");class s extends t.default{eq(l,c){return this.url.searchParams.append(l,`eq.${c}`),this}neq(l,c){return this.url.searchParams.append(l,`neq.${c}`),this}gt(l,c){return this.url.searchParams.append(l,`gt.${c}`),this}gte(l,c){return this.url.searchParams.append(l,`gte.${c}`),this}lt(l,c){return this.url.searchParams.append(l,`lt.${c}`),this}lte(l,c){return this.url.searchParams.append(l,`lte.${c}`),this}like(l,c){return this.url.searchParams.append(l,`like.${c}`),this}likeAllOf(l,c){return this.url.searchParams.append(l,`like(all).{${c.join(",")}}`),this}likeAnyOf(l,c){return this.url.searchParams.append(l,`like(any).{${c.join(",")}}`),this}ilike(l,c){return this.url.searchParams.append(l,`ilike.${c}`),this}ilikeAllOf(l,c){return this.url.searchParams.append(l,`ilike(all).{${c.join(",")}}`),this}ilikeAnyOf(l,c){return this.url.searchParams.append(l,`ilike(any).{${c.join(",")}}`),this}is(l,c){return this.url.searchParams.append(l,`is.${c}`),this}in(l,c){const u=Array.from(new Set(c)).map(h=>typeof h=="string"&&n.test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(l,`in.(${u})`),this}contains(l,c){return typeof c=="string"?this.url.searchParams.append(l,`cs.${c}`):Array.isArray(c)?this.url.searchParams.append(l,`cs.{${c.join(",")}}`):this.url.searchParams.append(l,`cs.${JSON.stringify(c)}`),this}containedBy(l,c){return typeof c=="string"?this.url.searchParams.append(l,`cd.${c}`):Array.isArray(c)?this.url.searchParams.append(l,`cd.{${c.join(",")}}`):this.url.searchParams.append(l,`cd.${JSON.stringify(c)}`),this}rangeGt(l,c){return this.url.searchParams.append(l,`sr.${c}`),this}rangeGte(l,c){return this.url.searchParams.append(l,`nxl.${c}`),this}rangeLt(l,c){return this.url.searchParams.append(l,`sl.${c}`),this}rangeLte(l,c){return this.url.searchParams.append(l,`nxr.${c}`),this}rangeAdjacent(l,c){return this.url.searchParams.append(l,`adj.${c}`),this}overlaps(l,c){return typeof c=="string"?this.url.searchParams.append(l,`ov.${c}`):this.url.searchParams.append(l,`ov.{${c.join(",")}}`),this}textSearch(l,c,{config:u,type:h}={}){let f="";h==="plain"?f="pl":h==="phrase"?f="ph":h==="websearch"&&(f="w");const g=u===void 0?"":`(${u})`;return this.url.searchParams.append(l,`${f}fts${g}.${c}`),this}match(l){return Object.entries(l).forEach(([c,u])=>{this.url.searchParams.append(c,`eq.${u}`)}),this}not(l,c,u){return this.url.searchParams.append(l,`not.${c}.${u}`),this}or(l,{foreignTable:c,referencedTable:u=c}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${l})`),this}filter(l,c,u){return this.url.searchParams.append(l,`${c}.${u}`),this}}return ac.default=s,ac}var By;function fb(){if(By)return sc;By=1,Object.defineProperty(sc,"__esModule",{value:!0});const t=oi.__importDefault(Em());class n{constructor(o,{headers:l={},schema:c,fetch:u}){this.url=o,this.headers=new Headers(l),this.schema=c,this.fetch=u}select(o,l){const{head:c=!1,count:u}=l??{},h=c?"HEAD":"GET";let f=!1;const g=(o??"*").split("").map(v=>/\s/.test(v)&&!f?"":(v==='"'&&(f=!f),v)).join("");return this.url.searchParams.set("select",g),u&&this.headers.append("Prefer",`count=${u}`),new t.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(o,{count:l,defaultToNull:c=!0}={}){var u;const h="POST";if(l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const f=o.reduce((g,v)=>g.concat(Object.keys(v)),[]);if(f.length>0){const g=[...new Set(f)].map(v=>`"${v}"`);this.url.searchParams.set("columns",g.join(","))}}return new t.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}upsert(o,{onConflict:l,ignoreDuplicates:c=!1,count:u,defaultToNull:h=!0}={}){var f;const g="POST";if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),u&&this.headers.append("Prefer",`count=${u}`),h||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const v=o.reduce((b,x)=>b.concat(Object.keys(x)),[]);if(v.length>0){const b=[...new Set(v)].map(x=>`"${x}"`);this.url.searchParams.set("columns",b.join(","))}}return new t.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}update(o,{count:l}={}){var c;const u="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new t.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:o}={}){var l;const c="DELETE";return o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return sc.default=n,sc}var zy;function SR(){if(zy)return rc;zy=1,Object.defineProperty(rc,"__esModule",{value:!0});const e=oi,t=e.__importDefault(fb()),n=e.__importDefault(Em());class s{constructor(l,{headers:c={},schema:u,fetch:h}={}){this.url=l,this.headers=new Headers(c),this.schemaName=u,this.fetch=h}from(l){const c=new URL(`${this.url}/${l}`);return new t.default(c,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new s(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,c={},{head:u=!1,get:h=!1,count:f}={}){var g;let v;const b=new URL(`${this.url}/rpc/${l}`);let x;u||h?(v=u?"HEAD":"GET",Object.entries(c).filter(([C,w])=>w!==void 0).map(([C,w])=>[C,Array.isArray(w)?`{${w.join(",")}}`:`${w}`]).forEach(([C,w])=>{b.searchParams.append(C,w)})):(v="POST",x=c);const S=new Headers(this.headers);return f&&S.set("Prefer",`count=${f}`),new n.default({method:v,url:b,headers:S,schema:this.schemaName,body:x,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}}return rc.default=s,rc}var Hy;function ER(){if(Hy)return Wt;Hy=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.PostgrestError=Wt.PostgrestBuilder=Wt.PostgrestTransformBuilder=Wt.PostgrestFilterBuilder=Wt.PostgrestQueryBuilder=Wt.PostgrestClient=void 0;const e=oi,t=e.__importDefault(SR());Wt.PostgrestClient=t.default;const n=e.__importDefault(fb());Wt.PostgrestQueryBuilder=n.default;const s=e.__importDefault(Em());Wt.PostgrestFilterBuilder=s.default;const o=e.__importDefault(hb());Wt.PostgrestTransformBuilder=o.default;const l=e.__importDefault(ub());Wt.PostgrestBuilder=l.default;const c=e.__importDefault(db());return Wt.PostgrestError=c.default,Wt.default={PostgrestClient:t.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:l.default,PostgrestError:c.default},Wt}var mb=ER();const pb=Yf(mb),_R=Yw({__proto__:null,default:pb},[mb]),{PostgrestClient:NR,PostgrestQueryBuilder:N$,PostgrestFilterBuilder:j$,PostgrestTransformBuilder:k$,PostgrestBuilder:T$,PostgrestError:A$}=pb||_R;class jR{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const s=n.node,o=parseInt(s.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let n=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(n+=`

Suggested solution: ${t.workaround}`),new Error(n)}static createWebSocket(t,n){const s=this.getWebSocketConstructor();return new s(t,n)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const kR="2.83.0",TR=`realtime-js/${kR}`,gb="1.0.0",AR="2.0.0",Vy=gb,Ef=1e4,PR=1e3,RR=100;var qs;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(qs||(qs={}));var kt;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(kt||(kt={}));var kn;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(kn||(kn={}));var _f;(function(e){e.websocket="websocket"})(_f||(_f={}));var Ws;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Ws||(Ws={}));class IR{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(t,n){if(this._isArrayBuffer(t.payload))return n(this._binaryEncodePush(t));if(t.event===this.BROADCAST&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(t));let s=[t.join_ref,t.ref,t.topic,t.event,t.payload];return n(JSON.stringify(s))}_binaryEncodePush(t){var n,s;const{event:o,topic:l,payload:c}=t,u=(n=t.ref)!==null&&n!==void 0?n:"",h=(s=t.join_ref)!==null&&s!==void 0?s:"",f=this.META_LENGTH+h.length+u.length+l.length+o.length,g=new ArrayBuffer(this.HEADER_LENGTH+f);let v=new DataView(g),b=0;v.setUint8(b++,this.KINDS.push),v.setUint8(b++,h.length),v.setUint8(b++,u.length),v.setUint8(b++,l.length),v.setUint8(b++,o.length),Array.from(h,S=>v.setUint8(b++,S.charCodeAt(0))),Array.from(u,S=>v.setUint8(b++,S.charCodeAt(0))),Array.from(l,S=>v.setUint8(b++,S.charCodeAt(0))),Array.from(o,S=>v.setUint8(b++,S.charCodeAt(0)));var x=new Uint8Array(g.byteLength+c.byteLength);return x.set(new Uint8Array(g),0),x.set(new Uint8Array(c),g.byteLength),x.buffer}_binaryEncodeUserBroadcastPush(t){var n;return this._isArrayBuffer((n=t.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var n,s,o,l;const c=t.topic,u=(n=t.ref)!==null&&n!==void 0?n:"",h=(s=t.join_ref)!==null&&s!==void 0?s:"",f=t.payload.event,g=(l=(o=t.payload)===null||o===void 0?void 0:o.payload)!==null&&l!==void 0?l:new ArrayBuffer(0),v=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+u.length+c.length+f.length,b=new ArrayBuffer(this.HEADER_LENGTH+v);let x=new DataView(b),S=0;x.setUint8(S++,this.KINDS.userBroadcastPush),x.setUint8(S++,h.length),x.setUint8(S++,u.length),x.setUint8(S++,c.length),x.setUint8(S++,f.length),x.setUint8(S++,this.BINARY_ENCODING),Array.from(h,w=>x.setUint8(S++,w.charCodeAt(0))),Array.from(u,w=>x.setUint8(S++,w.charCodeAt(0))),Array.from(c,w=>x.setUint8(S++,w.charCodeAt(0))),Array.from(f,w=>x.setUint8(S++,w.charCodeAt(0)));var C=new Uint8Array(b.byteLength+g.byteLength);return C.set(new Uint8Array(b),0),C.set(new Uint8Array(g),b.byteLength),C.buffer}_encodeJsonUserBroadcastPush(t){var n,s,o,l;const c=t.topic,u=(n=t.ref)!==null&&n!==void 0?n:"",h=(s=t.join_ref)!==null&&s!==void 0?s:"",f=t.payload.event,g=(l=(o=t.payload)===null||o===void 0?void 0:o.payload)!==null&&l!==void 0?l:{},b=new TextEncoder().encode(JSON.stringify(g)).buffer,x=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+u.length+c.length+f.length,S=new ArrayBuffer(this.HEADER_LENGTH+x);let C=new DataView(S),w=0;C.setUint8(w++,this.KINDS.userBroadcastPush),C.setUint8(w++,h.length),C.setUint8(w++,u.length),C.setUint8(w++,c.length),C.setUint8(w++,f.length),C.setUint8(w++,this.JSON_ENCODING),Array.from(h,_=>C.setUint8(w++,_.charCodeAt(0))),Array.from(u,_=>C.setUint8(w++,_.charCodeAt(0))),Array.from(c,_=>C.setUint8(w++,_.charCodeAt(0))),Array.from(f,_=>C.setUint8(w++,_.charCodeAt(0)));var N=new Uint8Array(S.byteLength+b.byteLength);return N.set(new Uint8Array(S),0),N.set(new Uint8Array(b),S.byteLength),N.buffer}decode(t,n){if(this._isArrayBuffer(t)){let s=this._binaryDecode(t);return n(s)}if(typeof t=="string"){const s=JSON.parse(t),[o,l,c,u,h]=s;return n({join_ref:o,ref:l,topic:c,event:u,payload:h})}return n({})}_binaryDecode(t){const n=new DataView(t),s=n.getUint8(0),o=new TextDecoder;switch(s){case this.KINDS.push:return this._decodePush(t,n,o);case this.KINDS.reply:return this._decodeReply(t,n,o);case this.KINDS.broadcast:return this._decodeBroadcast(t,n,o);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,n,o)}}_decodePush(t,n,s){const o=n.getUint8(1),l=n.getUint8(2),c=n.getUint8(3);let u=this.HEADER_LENGTH+this.META_LENGTH-1;const h=s.decode(t.slice(u,u+o));u=u+o;const f=s.decode(t.slice(u,u+l));u=u+l;const g=s.decode(t.slice(u,u+c));u=u+c;const v=JSON.parse(s.decode(t.slice(u,t.byteLength)));return{join_ref:h,ref:null,topic:f,event:g,payload:v}}_decodeReply(t,n,s){const o=n.getUint8(1),l=n.getUint8(2),c=n.getUint8(3),u=n.getUint8(4);let h=this.HEADER_LENGTH+this.META_LENGTH;const f=s.decode(t.slice(h,h+o));h=h+o;const g=s.decode(t.slice(h,h+l));h=h+l;const v=s.decode(t.slice(h,h+c));h=h+c;const b=s.decode(t.slice(h,h+u));h=h+u;const x=JSON.parse(s.decode(t.slice(h,t.byteLength))),S={status:b,response:x};return{join_ref:f,ref:g,topic:v,event:kn.reply,payload:S}}_decodeBroadcast(t,n,s){const o=n.getUint8(1),l=n.getUint8(2);let c=this.HEADER_LENGTH+2;const u=s.decode(t.slice(c,c+o));c=c+o;const h=s.decode(t.slice(c,c+l));c=c+l;const f=JSON.parse(s.decode(t.slice(c,t.byteLength)));return{join_ref:null,ref:null,topic:u,event:h,payload:f}}_decodeUserBroadcast(t,n,s){const o=n.getUint8(1),l=n.getUint8(2),c=n.getUint8(3),u=n.getUint8(4);let h=this.HEADER_LENGTH+4;const f=s.decode(t.slice(h,h+o));h=h+o;const g=s.decode(t.slice(h,h+l));h=h+l;const v=s.decode(t.slice(h,h+c));h=h+c;const b=t.slice(h,t.byteLength),x=u===this.JSON_ENCODING?JSON.parse(s.decode(b)):b,S={type:this.BROADCAST,event:g,payload:x};return c>0&&(S.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:f,event:this.BROADCAST,payload:S}}_isArrayBuffer(t){var n;return t instanceof ArrayBuffer||((n=t?.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}}class vb{constructor(t,n){this.callback=t,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var it;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(it||(it={}));const qy=(e,t,n={})=>{var s;const o=(s=n.skipTypes)!==null&&s!==void 0?s:[];return t?Object.keys(t).reduce((l,c)=>(l[c]=DR(c,e,t,o),l),{}):{}},DR=(e,t,n,s)=>{const o=t.find(u=>u.name===e),l=o?.type,c=n[e];return l&&!s.includes(l)?yb(l,c):Nf(c)},yb=(e,t)=>{if(e.charAt(0)==="_"){const n=e.slice(1,e.length);return $R(t,n)}switch(e){case it.bool:return OR(t);case it.float4:case it.float8:case it.int2:case it.int4:case it.int8:case it.numeric:case it.oid:return LR(t);case it.json:case it.jsonb:return MR(t);case it.timestamp:return FR(t);case it.abstime:case it.date:case it.daterange:case it.int4range:case it.int8range:case it.money:case it.reltime:case it.text:case it.time:case it.timestamptz:case it.timetz:case it.tsrange:case it.tstzrange:return Nf(t);default:return Nf(t)}},Nf=e=>e,OR=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},LR=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},MR=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},$R=(e,t)=>{if(typeof e!="string")return e;const n=e.length-1,s=e[n];if(e[0]==="{"&&s==="}"){let l;const c=e.slice(1,n);try{l=JSON.parse("["+c+"]")}catch{l=c?c.split(","):[]}return l.map(u=>yb(t,u))}return e},FR=e=>typeof e=="string"?e.replace(" ","T"):e,wb=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Ah{constructor(t,n,s={},o=Ef){this.channel=t,this.event=n,this.payload=s,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,n){var s;return this._hasReceived(t)&&n((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:t,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:n}){this.recHooks.filter(s=>s.status===t).forEach(s=>s.callback(n))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Wy;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(Wy||(Wy={}));class ao{constructor(t,n){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},o=>{const{onJoin:l,onLeave:c,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ao.syncState(this.state,o,l,c),this.pendingDiffs.forEach(h=>{this.state=ao.syncDiff(this.state,h,l,c)}),this.pendingDiffs=[],u()}),this.channel._on(s.diff,{},o=>{const{onJoin:l,onLeave:c,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=ao.syncDiff(this.state,o,l,c),u())}),this.onJoin((o,l,c)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:l,newPresences:c})}),this.onLeave((o,l,c)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:l,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,n,s,o){const l=this.cloneDeep(t),c=this.transformState(n),u={},h={};return this.map(l,(f,g)=>{c[f]||(h[f]=g)}),this.map(c,(f,g)=>{const v=l[f];if(v){const b=g.map(w=>w.presence_ref),x=v.map(w=>w.presence_ref),S=g.filter(w=>x.indexOf(w.presence_ref)<0),C=v.filter(w=>b.indexOf(w.presence_ref)<0);S.length>0&&(u[f]=S),C.length>0&&(h[f]=C)}else u[f]=g}),this.syncDiff(l,{joins:u,leaves:h},s,o)}static syncDiff(t,n,s,o){const{joins:l,leaves:c}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return s||(s=()=>{}),o||(o=()=>{}),this.map(l,(u,h)=>{var f;const g=(f=t[u])!==null&&f!==void 0?f:[];if(t[u]=this.cloneDeep(h),g.length>0){const v=t[u].map(x=>x.presence_ref),b=g.filter(x=>v.indexOf(x.presence_ref)<0);t[u].unshift(...b)}s(u,g,h)}),this.map(c,(u,h)=>{let f=t[u];if(!f)return;const g=h.map(v=>v.presence_ref);f=f.filter(v=>g.indexOf(v.presence_ref)<0),t[u]=f,o(u,f,h),f.length===0&&delete t[u]}),t}static map(t,n){return Object.getOwnPropertyNames(t).map(s=>n(s,t[s]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((n,s)=>{const o=t[s];return"metas"in o?n[s]=o.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):n[s]=o,n},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Gy;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(Gy||(Gy={}));var io;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(io||(io={}));var Dr;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Dr||(Dr={}));class _m{constructor(t,n={config:{}},s){var o,l;if(this.topic=t,this.params=n,this.socket=s,this.bindings={},this.state=kt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Ah(this,kn.join,this.params,this.timeout),this.rejoinTimer=new vb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=kt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=kt.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=kt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=kt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=kt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(kn.reply,{},(c,u)=>{this._trigger(this._replyEventName(u),c)}),this.presence=new ao(this),this.broadcastEndpointURL=wb(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((l=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,n=this.timeout){var s,o,l;if(this.socket.isConnected()||this.socket.connect(),this.state==kt.closed){const{config:{broadcast:c,presence:u,private:h}}=this.params,f=(o=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(x=>x.filter))!==null&&o!==void 0?o:[],g=!!this.bindings[io.PRESENCE]&&this.bindings[io.PRESENCE].length>0||((l=this.params.config.presence)===null||l===void 0?void 0:l.enabled)===!0,v={},b={broadcast:c,presence:Object.assign(Object.assign({},u),{enabled:g}),postgres_changes:f,private:h};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(x=>t?.(Dr.CHANNEL_ERROR,x)),this._onClose(()=>t?.(Dr.CLOSED)),this.updateJoinPayload(Object.assign({config:b},v)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:x})=>{var S;if(this.socket.setAuth(),x===void 0){t?.(Dr.SUBSCRIBED);return}else{const C=this.bindings.postgres_changes,w=(S=C?.length)!==null&&S!==void 0?S:0,N=[];for(let _=0;_<w;_++){const j=C[_],{filter:{event:T,schema:R,table:A,filter:I}}=j,L=x&&x[_];if(L&&L.event===T&&L.schema===R&&L.table===A&&L.filter===I)N.push(Object.assign(Object.assign({},j),{id:L.id}));else{this.unsubscribe(),this.state=kt.errored,t?.(Dr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=N,t&&t(Dr.SUBSCRIBED);return}}).receive("error",x=>{this.state=kt.errored,t?.(Dr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(x).join(", ")||"error")))}).receive("timeout",()=>{t?.(Dr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,n={}){return await this.send({type:"presence",event:"track",payload:t},n.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,n,s){return this.state===kt.joined&&t===io.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,n,s)}async httpSend(t,n,s={}){var o;const l=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const c={method:"POST",headers:{Authorization:l,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:n,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(o=s.timeout)!==null&&o!==void 0?o:this.timeout);if(u.status===202)return{success:!0};let h=u.statusText;try{const f=await u.json();h=f.error||f.message||h}catch{}return Promise.reject(new Error(h))}async send(t,n={}){var s,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:l,payload:c}=t,h={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:c,private:this.private}]})};try{const f=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);return await((o=f.body)===null||o===void 0?void 0:o.cancel()),f.ok?"ok":"error"}catch(f){return f.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var c,u,h;const f=this._push(t.type,t,n.timeout||this.timeout);t.type==="broadcast"&&!(!((h=(u=(c=this.params)===null||c===void 0?void 0:c.config)===null||u===void 0?void 0:u.broadcast)===null||h===void 0)&&h.ack)&&l("ok"),f.receive("ok",()=>l("ok")),f.receive("error",()=>l("error")),f.receive("timeout",()=>l("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=kt.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(kn.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(o=>{s=new Ah(this,kn.leave,{},t),s.receive("ok",()=>{n(),o("ok")}).receive("timeout",()=>{n(),o("timed out")}).receive("error",()=>{o("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=kt.closed,this.bindings={}}async _fetchWithTimeout(t,n,s){const o=new AbortController,l=setTimeout(()=>o.abort(),s),c=await this.socket.fetch(t,Object.assign(Object.assign({},n),{signal:o.signal}));return clearTimeout(l),c}_push(t,n,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Ah(this,t,n,s);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>RR){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(t,n,s){return n}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,n,s){var o,l;const c=t.toLocaleLowerCase(),{close:u,error:h,leave:f,join:g}=kn;if(s&&[u,h,f,g].indexOf(c)>=0&&s!==this._joinRef())return;let b=this._onMessage(c,n,s);if(n&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(x=>{var S,C,w;return((S=x.filter)===null||S===void 0?void 0:S.event)==="*"||((w=(C=x.filter)===null||C===void 0?void 0:C.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===c}).map(x=>x.callback(b,s)):(l=this.bindings[c])===null||l===void 0||l.filter(x=>{var S,C,w,N,_,j;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in x){const T=x.id,R=(S=x.filter)===null||S===void 0?void 0:S.event;return T&&((C=n.ids)===null||C===void 0?void 0:C.includes(T))&&(R==="*"||R?.toLocaleLowerCase()===((w=n.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const T=(_=(N=x?.filter)===null||N===void 0?void 0:N.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return T==="*"||T===((j=n?.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return x.type.toLocaleLowerCase()===c}).map(x=>{if(typeof b=="object"&&"ids"in b){const S=b.data,{schema:C,table:w,commit_timestamp:N,type:_,errors:j}=S;b=Object.assign(Object.assign({},{schema:C,table:w,commit_timestamp:N,eventType:_,new:{},old:{},errors:j}),this._getPayloadRecords(S))}x.callback(b,s)})}_isClosed(){return this.state===kt.closed}_isJoined(){return this.state===kt.joined}_isJoining(){return this.state===kt.joining}_isLeaving(){return this.state===kt.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,n,s){const o=t.toLocaleLowerCase(),l={type:o,filter:n,callback:s};return this.bindings[o]?this.bindings[o].push(l):this.bindings[o]=[l],this}_off(t,n){const s=t.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(o=>{var l;return!(((l=o.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===s&&_m.isEqual(o.filter,n))})),this}static isEqual(t,n){if(Object.keys(t).length!==Object.keys(n).length)return!1;for(const s in t)if(t[s]!==n[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(kn.close,{},t)}_onError(t){this._on(kn.error,{},n=>t(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=kt.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const n={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(n.new=qy(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(n.old=qy(t.columns,t.old_record)),n}}const Ph=()=>{},cc={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},UR=[1e3,2e3,5e3,1e4],BR=1e4,zR=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class HR{constructor(t,n){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ef,this.transport=null,this.heartbeatIntervalMs=cc.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ph,this.ref=0,this.reconnectTimer=null,this.vsn=Vy,this.logger=Ph,this.conn=null,this.sendBuffer=[],this.serializer=new IR,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>o?(...l)=>o(...l):(...l)=>fetch(...l),!(!((s=n?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${t}/${_f.websocket}`,this.httpEndpoint=wb(t),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=jR.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const n=t.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const n=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const t=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,n,s){this.logger(t,n,s)}connectionState(){switch(this.conn&&this.conn.readyState){case qs.connecting:return Ws.Connecting;case qs.open:return Ws.Open;case qs.closing:return Ws.Closing;default:return Ws.Closed}}isConnected(){return this.connectionState()===Ws.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,n={config:{}}){const s=`realtime:${t}`,o=this.getChannels().find(l=>l.topic===s);if(o)return o;{const l=new _m(`realtime:${t}`,n,this);return this.channels.push(l),l}}push(t){const{topic:n,event:s,payload:o,ref:l}=t,c=()=>{this.encode(t,u=>{var h;(h=this.conn)===null||h===void 0||h.send(u)})};this.log("push",`${n} ${s} (${l})`,o),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(PR,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},cc.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let n=this.channels.find(s=>s.topic===t&&(s._isJoined()||s._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${t}"`),n.unsubscribe())}_remove(t){this.channels=this.channels.filter(n=>n.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(f){this.log("error","error in heartbeat callback",f)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:o,payload:l,ref:c}=n,u=c?`(${c})`:"",h=l.status||"";this.log("receive",`${h} ${s} ${o} ${u}`.trim(),l),this.channels.filter(f=>f._isMember(s)).forEach(f=>f._trigger(o,l,c)),this._triggerStateCallbacks("message",n)})}_clearTimer(t){var n;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){if(this.conn){if(this.conn.readyState===qs.open||this.conn.readyState===qs.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var n;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(kn.error))}_appendParams(t,n){if(Object.keys(n).length===0)return t;const s=t.match(/\?/)?"&":"?",o=new URLSearchParams(n);return`${t}${s}${o}`}_workerObjectUrl(t){let n;if(t)n=t;else{const s=new Blob([zR],{type:"application/javascript"});n=URL.createObjectURL(s)}return n}_setConnectionState(t,n=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(t=null){let n;t?n=t:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(s=>{const o={access_token:n,version:TR};n&&s.updateJoinPayload(o),s.joinedOnce&&s._isJoined()&&s._push(kn.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${t}`,n)})}_triggerStateCallbacks(t,n){try{this.stateChangeCallbacks[t].forEach(s=>{try{s(n)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(s){this.log("error",`error triggering ${t} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new vb(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},cc.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var n,s,o,l,c,u,h,f,g,v,b,x;switch(this.transport=(n=t?.transport)!==null&&n!==void 0?n:null,this.timeout=(s=t?.timeout)!==null&&s!==void 0?s:Ef,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:cc.HEARTBEAT_INTERVAL,this.worker=(l=t?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(c=t?.accessToken)!==null&&c!==void 0?c:null,this.heartbeatCallback=(u=t?.heartbeatCallback)!==null&&u!==void 0?u:Ph,this.vsn=(h=t?.vsn)!==null&&h!==void 0?h:Vy,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=t?.reconnectAfterMs)!==null&&f!==void 0?f:(S=>UR[S-1]||BR),this.vsn){case gb:this.encode=(g=t?.encode)!==null&&g!==void 0?g:((S,C)=>C(JSON.stringify(S))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((S,C)=>C(JSON.parse(S)));break;case AR:this.encode=(b=t?.encode)!==null&&b!==void 0?b:this.serializer.encode.bind(this.serializer),this.decode=(x=t?.decode)!==null&&x!==void 0?x:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}class Nm extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function mt(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class VR extends Nm{constructor(t,n,s){super(t),this.name="StorageApiError",this.status=n,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class jf extends Nm{constructor(t,n){super(t),this.name="StorageUnknownError",this.originalError=n}}const jm=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),qR=()=>Response,kf=e=>{if(Array.isArray(e))return e.map(n=>kf(n));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([n,s])=>{const o=n.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));t[o]=kf(s)}),t},WR=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Rh=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},GR=(e,t,n)=>Te(void 0,void 0,void 0,function*(){const s=yield qR();e instanceof s&&!n?.noResolveJson?e.json().then(o=>{const l=e.status||500,c=o?.statusCode||l+"";t(new VR(Rh(o),l,c))}).catch(o=>{t(new jf(Rh(o),o))}):t(new jf(Rh(e),e))}),KR=(e,t,n,s)=>{const o={method:e,headers:t?.headers||{}};return e==="GET"||!s?o:(WR(s)?(o.headers=Object.assign({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(s)):o.body=s,t?.duplex&&(o.duplex=t.duplex),Object.assign(Object.assign({},o),n))};function Ro(e,t,n,s,o,l){return Te(this,void 0,void 0,function*(){return new Promise((c,u)=>{e(n,KR(t,s,o,l)).then(h=>{if(!h.ok)throw h;return s?.noResolveJson?h:h.json()}).then(h=>c(h)).catch(h=>GR(h,u,s))})})}function vo(e,t,n,s){return Te(this,void 0,void 0,function*(){return Ro(e,"GET",t,n,s)})}function Zn(e,t,n,s,o){return Te(this,void 0,void 0,function*(){return Ro(e,"POST",t,s,o,n)})}function Tf(e,t,n,s,o){return Te(this,void 0,void 0,function*(){return Ro(e,"PUT",t,s,o,n)})}function YR(e,t,n,s){return Te(this,void 0,void 0,function*(){return Ro(e,"HEAD",t,Object.assign(Object.assign({},n),{noResolveJson:!0}),s)})}function km(e,t,n,s,o){return Te(this,void 0,void 0,function*(){return Ro(e,"DELETE",t,s,o,n)})}class JR{constructor(t,n){this.downloadFn=t,this.shouldThrowOnError=n}then(t,n){return this.execute().then(t,n)}execute(){return Te(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(mt(t))return{data:null,error:t};throw t}})}}var xb;class QR{constructor(t,n){this.downloadFn=t,this.shouldThrowOnError=n,this[xb]="BlobDownloadBuilder",this.promise=null}asStream(){return new JR(this.downloadFn,this.shouldThrowOnError)}then(t,n){return this.getPromise().then(t,n)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Te(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(mt(t))return{data:null,error:t};throw t}})}}xb=Symbol.toStringTag;const XR={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ky={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ZR{constructor(t,n={},s,o){this.shouldThrowOnError=!1,this.url=t,this.headers=n,this.bucketId=s,this.fetch=jm(o)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,n,s,o){return Te(this,void 0,void 0,function*(){try{let l;const c=Object.assign(Object.assign({},Ky),o);let u=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(c.upsert)});const h=c.metadata;typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),h&&l.append("metadata",this.encodeMetadata(h)),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.has("cacheControl")||l.append("cacheControl",c.cacheControl),h&&!l.has("metadata")&&l.append("metadata",this.encodeMetadata(h))):(l=s,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType,h&&(u["x-metadata"]=this.toBase64(this.encodeMetadata(h))),(typeof ReadableStream<"u"&&l instanceof ReadableStream||l&&typeof l=="object"&&"pipe"in l&&typeof l.pipe=="function")&&!c.duplex&&(c.duplex="half")),o?.headers&&(u=Object.assign(Object.assign({},u),o.headers));const f=this._removeEmptyFolders(n),g=this._getFinalPath(f),v=yield(t=="PUT"?Tf:Zn)(this.fetch,`${this.url}/object/${g}`,l,Object.assign({headers:u},c?.duplex?{duplex:c.duplex}:{}));return{data:{path:f,id:v.Id,fullPath:v.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(mt(l))return{data:null,error:l};throw l}})}upload(t,n,s){return Te(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,n,s)})}uploadToSignedUrl(t,n,s,o){return Te(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=new URL(this.url+`/object/upload/sign/${c}`);u.searchParams.set("token",n);try{let h;const f=Object.assign({upsert:Ky.upsert},o),g=Object.assign(Object.assign({},this.headers),{"x-upsert":String(f.upsert)});typeof Blob<"u"&&s instanceof Blob?(h=new FormData,h.append("cacheControl",f.cacheControl),h.append("",s)):typeof FormData<"u"&&s instanceof FormData?(h=s,h.append("cacheControl",f.cacheControl)):(h=s,g["cache-control"]=`max-age=${f.cacheControl}`,g["content-type"]=f.contentType);const v=yield Tf(this.fetch,u.toString(),h,{headers:g});return{data:{path:l,fullPath:v.Key},error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(mt(h))return{data:null,error:h};throw h}})}createSignedUploadUrl(t,n){return Te(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t);const o=Object.assign({},this.headers);n?.upsert&&(o["x-upsert"]="true");const l=yield Zn(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:o}),c=new URL(this.url+l.url),u=c.searchParams.get("token");if(!u)throw new Nm("No token returned by API");return{data:{signedUrl:c.toString(),path:t,token:u},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(mt(s))return{data:null,error:s};throw s}})}update(t,n,s){return Te(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,n,s)})}move(t,n,s){return Te(this,void 0,void 0,function*(){try{return{data:yield Zn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:n,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(mt(o))return{data:null,error:o};throw o}})}copy(t,n,s){return Te(this,void 0,void 0,function*(){try{return{data:{path:(yield Zn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:n,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(mt(o))return{data:null,error:o};throw o}})}createSignedUrl(t,n,s){return Te(this,void 0,void 0,function*(){try{let o=this._getFinalPath(t),l=yield Zn(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:n},s?.transform?{transform:s.transform}:{}),{headers:this.headers});const c=s?.download?`&download=${s.download===!0?"":s.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${c}`)},{data:l,error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(mt(o))return{data:null,error:o};throw o}})}createSignedUrls(t,n,s){return Te(this,void 0,void 0,function*(){try{const o=yield Zn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:t},{headers:this.headers}),l=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:o.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${l}`):null})),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(mt(o))return{data:null,error:o};throw o}})}download(t,n){const o=typeof n?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(n?.transform||{}),c=l?`?${l}`:"",u=this._getFinalPath(t),h=()=>vo(this.fetch,`${this.url}/${o}/${u}${c}`,{headers:this.headers,noResolveJson:!0});return new QR(h,this.shouldThrowOnError)}info(t){return Te(this,void 0,void 0,function*(){const n=this._getFinalPath(t);try{const s=yield vo(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:kf(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(mt(s))return{data:null,error:s};throw s}})}exists(t){return Te(this,void 0,void 0,function*(){const n=this._getFinalPath(t);try{return yield YR(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(mt(s)&&s instanceof jf){const o=s.originalError;if([400,404].includes(o?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(t,n){const s=this._getFinalPath(t),o=[],l=n?.download?`download=${n.download===!0?"":n.download}`:"";l!==""&&o.push(l);const u=typeof n?.transform<"u"?"render/image":"object",h=this.transformOptsToQueryString(n?.transform||{});h!==""&&o.push(h);let f=o.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${s}${f}`)}}}remove(t){return Te(this,void 0,void 0,function*(){try{return{data:yield km(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mt(n))return{data:null,error:n};throw n}})}list(t,n,s){return Te(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},XR),n),{prefix:t||""});return{data:yield Zn(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},s),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(mt(o))return{data:null,error:o};throw o}})}listV2(t,n){return Te(this,void 0,void 0,function*(){try{const s=Object.assign({},t);return{data:yield Zn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(mt(s))return{data:null,error:s};throw s}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const n=[];return t.width&&n.push(`width=${t.width}`),t.height&&n.push(`height=${t.height}`),t.resize&&n.push(`resize=${t.resize}`),t.format&&n.push(`format=${t.format}`),t.quality&&n.push(`quality=${t.quality}`),n.join("&")}}const bb="2.83.0",Cb={"X-Client-Info":`storage-js/${bb}`};class e2{constructor(t,n={},s,o){this.shouldThrowOnError=!1;const l=new URL(t);o?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Cb),n),this.fetch=jm(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return Te(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(t);return{data:yield vo(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mt(n))return{data:null,error:n};throw n}})}getBucket(t){return Te(this,void 0,void 0,function*(){try{return{data:yield vo(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mt(n))return{data:null,error:n};throw n}})}createBucket(t){return Te(this,arguments,void 0,function*(n,s={public:!1}){try{return{data:yield Zn(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(mt(o))return{data:null,error:o};throw o}})}updateBucket(t,n){return Te(this,void 0,void 0,function*(){try{return{data:yield Tf(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(mt(s))return{data:null,error:s};throw s}})}emptyBucket(t){return Te(this,void 0,void 0,function*(){try{return{data:yield Zn(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mt(n))return{data:null,error:n};throw n}})}deleteBucket(t){return Te(this,void 0,void 0,function*(){try{return{data:yield km(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mt(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(t){const n={};return t&&("limit"in t&&(n.limit=String(t.limit)),"offset"in t&&(n.offset=String(t.offset)),t.search&&(n.search=t.search),t.sortColumn&&(n.sortColumn=t.sortColumn),t.sortOrder&&(n.sortOrder=t.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}class t2{constructor(t,n={},s){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Cb),n),this.fetch=jm(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Te(this,void 0,void 0,function*(){try{return{data:yield Zn(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mt(n))return{data:null,error:n};throw n}})}listBuckets(t){return Te(this,void 0,void 0,function*(){try{const n=new URLSearchParams;t?.limit!==void 0&&n.set("limit",t.limit.toString()),t?.offset!==void 0&&n.set("offset",t.offset.toString()),t?.sortColumn&&n.set("sortColumn",t.sortColumn),t?.sortOrder&&n.set("sortOrder",t.sortOrder),t?.search&&n.set("search",t.search);const s=n.toString(),o=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield vo(this.fetch,o,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mt(n))return{data:null,error:n};throw n}})}deleteBucket(t){return Te(this,void 0,void 0,function*(){try{return{data:yield km(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mt(n))return{data:null,error:n};throw n}})}}const Tm={"X-Client-Info":`storage-js/${bb}`,"Content-Type":"application/json"};class Sb extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function yn(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class Ih extends Sb{constructor(t,n,s){super(t),this.name="StorageVectorsApiError",this.status=n,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class n2 extends Sb{constructor(t,n){super(t),this.name="StorageVectorsUnknownError",this.originalError=n}}var Yy;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(Yy||(Yy={}));const Am=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),r2=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Jy=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),s2=(e,t,n)=>Te(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!n?.noResolveJson){const o=e.status||500,l=e;if(typeof l.json=="function")l.json().then(c=>{const u=c?.statusCode||c?.code||o+"";t(new Ih(Jy(c),o,u))}).catch(()=>{const c=o+"",u=l.statusText||`HTTP ${o} error`;t(new Ih(u,o,c))});else{const c=o+"",u=l.statusText||`HTTP ${o} error`;t(new Ih(u,o,c))}}else t(new n2(Jy(e),e))}),a2=(e,t,n,s)=>{const o={method:e,headers:t?.headers||{}};return s?(r2(s)?(o.headers=Object.assign({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(s)):o.body=s,Object.assign(Object.assign({},o),n)):o};function i2(e,t,n,s,o,l){return Te(this,void 0,void 0,function*(){return new Promise((c,u)=>{e(n,a2(t,s,o,l)).then(h=>{if(!h.ok)throw h;if(s?.noResolveJson)return h;const f=h.headers.get("content-type");return!f||!f.includes("application/json")?{}:h.json()}).then(h=>c(h)).catch(h=>s2(h,u,s))})})}function wn(e,t,n,s,o){return Te(this,void 0,void 0,function*(){return i2(e,"POST",t,s,o,n)})}class o2{constructor(t,n={},s){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Tm),n),this.fetch=Am(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return Te(this,void 0,void 0,function*(){try{return{data:(yield wn(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}getIndex(t,n){return Te(this,void 0,void 0,function*(){try{return{data:yield wn(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:n},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(yn(s))return{data:null,error:s};throw s}})}listIndexes(t){return Te(this,void 0,void 0,function*(){try{return{data:yield wn(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}deleteIndex(t,n){return Te(this,void 0,void 0,function*(){try{return{data:(yield wn(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:n},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(yn(s))return{data:null,error:s};throw s}})}}class l2{constructor(t,n={},s){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Tm),n),this.fetch=Am(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return Te(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield wn(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}getVectors(t){return Te(this,void 0,void 0,function*(){try{return{data:yield wn(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}listVectors(t){return Te(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield wn(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}queryVectors(t){return Te(this,void 0,void 0,function*(){try{return{data:yield wn(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}deleteVectors(t){return Te(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield wn(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}}class c2{constructor(t,n={},s){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Tm),n),this.fetch=Am(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Te(this,void 0,void 0,function*(){try{return{data:(yield wn(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}getBucket(t){return Te(this,void 0,void 0,function*(){try{return{data:yield wn(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}listBuckets(){return Te(this,arguments,void 0,function*(t={}){try{return{data:yield wn(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}deleteBucket(t){return Te(this,void 0,void 0,function*(){try{return{data:(yield wn(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yn(n))return{data:null,error:n};throw n}})}}class d2 extends c2{constructor(t,n={}){super(t,n.headers||{},n.fetch)}from(t){return new u2(this.url,this.headers,t,this.fetch)}}class u2 extends o2{constructor(t,n,s,o){super(t,n,o),this.vectorBucketName=s}createIndex(t){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Te(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Te(this,arguments,void 0,function*(n={}){return t.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Te(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Te(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new h2(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class h2 extends l2{constructor(t,n,s,o,l){super(t,n,l),this.vectorBucketName=s,this.indexName=o}putVectors(t){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Te(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Te(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Te(this,arguments,void 0,function*(n={}){return t.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Te(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Te(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class f2 extends e2{constructor(t,n={},s,o){super(t,n,s,o)}from(t){return new ZR(this.url,this.headers,t,this.fetch)}get vectors(){return new d2(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new t2(this.url+"/iceberg",this.headers,this.fetch)}}const m2="2.83.0";let Xi="";typeof Deno<"u"?Xi="deno":typeof document<"u"?Xi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Xi="react-native":Xi="node";const p2={"X-Client-Info":`supabase-js-${Xi}/${m2}`},g2={headers:p2},v2={schema:"public"},y2={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},w2={},x2=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),b2=()=>Headers,C2=(e,t,n)=>{const s=x2(n),o=b2();return async(l,c)=>{var u;const h=(u=await t())!==null&&u!==void 0?u:e;let f=new o(c?.headers);return f.has("apikey")||f.set("apikey",e),f.has("Authorization")||f.set("Authorization",`Bearer ${h}`),s(l,Object.assign(Object.assign({},c),{headers:f}))}};function S2(e){return e.endsWith("/")?e:e+"/"}function E2(e,t){var n,s;const{db:o,auth:l,realtime:c,global:u}=e,{db:h,auth:f,realtime:g,global:v}=t,b={db:Object.assign(Object.assign({},h),o),auth:Object.assign(Object.assign({},f),l),realtime:Object.assign(Object.assign({},g),c),storage:{},global:Object.assign(Object.assign(Object.assign({},v),u),{headers:Object.assign(Object.assign({},(n=v?.headers)!==null&&n!==void 0?n:{}),(s=u?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return e.accessToken?b.accessToken=e.accessToken:delete b.accessToken,b}function _2(e){const t=e?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(S2(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Eb="2.83.0",Fa=30*1e3,Af=3,Dh=Af*Fa,N2="http://localhost:9999",j2="supabase.auth.token",k2={"X-Client-Info":`gotrue-js/${Eb}`},Pf="X-Supabase-Api-Version",_b={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},T2=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,A2=600*1e3;class yo extends Error{constructor(t,n,s){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=s}}function Pe(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class P2 extends yo{constructor(t,n,s){super(t,n,s),this.name="AuthApiError",this.status=n,this.code=s}}function R2(e){return Pe(e)&&e.name==="AuthApiError"}class Gs extends yo{constructor(t,n){super(t),this.name="AuthUnknownError",this.originalError=n}}class Es extends yo{constructor(t,n,s,o){super(t,s,o),this.name=n,this.status=s}}class gn extends Es{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function I2(e){return Pe(e)&&e.name==="AuthSessionMissingError"}class Aa extends Es{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class dc extends Es{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class uc extends Es{constructor(t,n=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function D2(e){return Pe(e)&&e.name==="AuthImplicitGrantRedirectError"}class Qy extends Es{constructor(t,n=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Rf extends Es{constructor(t,n){super(t,"AuthRetryableFetchError",n,void 0)}}function Oh(e){return Pe(e)&&e.name==="AuthRetryableFetchError"}class Xy extends Es{constructor(t,n,s){super(t,"AuthWeakPasswordError",n,"weak_password"),this.reasons=s}}class If extends Es{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Bc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Zy=` 	
\r=`.split(""),O2=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Zy.length;t+=1)e[Zy[t].charCodeAt(0)]=-2;for(let t=0;t<Bc.length;t+=1)e[Bc[t].charCodeAt(0)]=t;return e})();function ew(e,t,n){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;n(Bc[s]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;n(Bc[s]),t.queuedBits-=6}}function Nb(e,t,n){const s=O2[e];if(s>-1)for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function tw(e){const t=[],n=c=>{t.push(String.fromCodePoint(c))},s={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},l=c=>{$2(c,s,n)};for(let c=0;c<e.length;c+=1)Nb(e.charCodeAt(c),o,l);return t.join("")}function L2(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function M2(e,t){for(let n=0;n<e.length;n+=1){let s=e.charCodeAt(n);if(s>55295&&s<=56319){const o=(s-55296)*1024&65535;s=(e.charCodeAt(n+1)-56320&65535|o)+65536,n+=1}L2(s,t)}}function $2(e,t,n){if(t.utf8seq===0){if(e<=127){n(e);return}for(let s=1;s<6;s+=1)if((e>>7-s&1)===0){t.utf8seq=s;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&n(t.codepoint)}}function Va(e){const t=[],n={queue:0,queuedBits:0},s=o=>{t.push(o)};for(let o=0;o<e.length;o+=1)Nb(e.charCodeAt(o),n,s);return new Uint8Array(t)}function F2(e){const t=[];return M2(e,n=>t.push(n)),new Uint8Array(t)}function Ys(e){const t=[],n={queue:0,queuedBits:0},s=o=>{t.push(o)};return e.forEach(o=>ew(o,n,s)),ew(null,n,s),t.join("")}function U2(e){return Math.round(Date.now()/1e3)+e}function B2(){return Symbol("auth-callback")}const Lt=()=>typeof window<"u"&&typeof document<"u",Bs={tested:!1,writable:!1},jb=()=>{if(!Lt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Bs.tested)return Bs.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Bs.tested=!0,Bs.writable=!0}catch{Bs.tested=!0,Bs.writable=!1}return Bs.writable};function z2(e){const t={},n=new URL(e);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((o,l)=>{t[l]=o})}catch{}return n.searchParams.forEach((s,o)=>{t[o]=s}),t}const kb=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),H2=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Ua=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},zs=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch{return n}},ds=async(e,t)=>{await e.removeItem(t)};class pd{constructor(){this.promise=new pd.promiseConstructor((t,n)=>{this.resolve=t,this.reject=n})}}pd.promiseConstructor=Promise;function Lh(e){const t=e.split(".");if(t.length!==3)throw new If("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!T2.test(t[s]))throw new If("JWT not in base64url format");return{header:JSON.parse(tw(t[0])),payload:JSON.parse(tw(t[1])),signature:Va(t[2]),raw:{header:t[0],payload:t[1]}}}async function V2(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function q2(e,t){return new Promise((s,o)=>{(async()=>{for(let l=0;l<1/0;l++)try{const c=await e(l);if(!t(l,null,c)){s(c);return}}catch(c){if(!t(l,c)){o(c);return}}})()})}function W2(e){return("0"+e.toString(16)).substr(-2)}function G2(){const t=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=n.length;let o="";for(let l=0;l<56;l++)o+=n.charAt(Math.floor(Math.random()*s));return o}return crypto.getRandomValues(t),Array.from(t,W2).join("")}async function K2(e){const n=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",n),o=new Uint8Array(s);return Array.from(o).map(l=>String.fromCharCode(l)).join("")}async function Y2(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const n=await K2(e);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Pa(e,t,n=!1){const s=G2();let o=s;n&&(o+="/PASSWORD_RECOVERY"),await Ua(e,`${t}-code-verifier`,o);const l=await Y2(s);return[l,s===l?"plain":"s256"]}const J2=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Q2(e){const t=e.headers.get(Pf);if(!t||!t.match(J2))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function X2(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Z2(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const eI=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ra(e){if(!eI.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Mh(){const e={};return new Proxy(e,{get:(t,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const s=n.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function tI(e,t){return new Proxy(e,{get:(n,s,o)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const l=s.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)"||l==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,s,o)}return!t.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(n,s,o)}})}function nw(e){return JSON.parse(JSON.stringify(e))}const Hs=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),nI=[502,503,504];async function rw(e){var t;if(!H2(e))throw new Rf(Hs(e),0);if(nI.includes(e.status))throw new Rf(Hs(e),e.status);let n;try{n=await e.json()}catch(l){throw new Gs(Hs(l),l)}let s;const o=Q2(e);if(o&&o.getTime()>=_b["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?s=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(s=n.error_code),s){if(s==="weak_password")throw new Xy(Hs(n),e.status,((t=n.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(s==="session_not_found")throw new gn}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((l,c)=>l&&typeof c=="string",!0))throw new Xy(Hs(n),e.status,n.weak_password.reasons);throw new P2(Hs(n),e.status||500,s)}const rI=(e,t,n,s)=>{const o={method:e,headers:t?.headers||{}};return e==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(s),Object.assign(Object.assign({},o),n))};async function Le(e,t,n,s){var o;const l=Object.assign({},s?.headers);l[Pf]||(l[Pf]=_b["2024-01-01"].name),s?.jwt&&(l.Authorization=`Bearer ${s.jwt}`);const c=(o=s?.query)!==null&&o!==void 0?o:{};s?.redirectTo&&(c.redirect_to=s.redirectTo);const u=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",h=await sI(e,t,n+u,{headers:l,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(h):{data:Object.assign({},h),error:null}}async function sI(e,t,n,s,o,l){const c=rI(t,s,o,l);let u;try{u=await e(n,Object.assign({},c))}catch(h){throw console.error(h),new Rf(Hs(h),0)}if(u.ok||await rw(u),s?.noResolveJson)return u;try{return await u.json()}catch(h){await rw(h)}}function Jn(e){var t;let n=null;oI(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=U2(e.expires_in)));const s=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:n,user:s},error:null}}function sw(e){const t=Jn(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((n,s)=>n&&typeof s=="string",!0)&&(t.data.weak_password=e.weak_password),t}function hs(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function aI(e){return{data:e,error:null}}function iI(e){const{action_link:t,email_otp:n,hashed_token:s,redirect_to:o,verification_type:l}=e,c=Ss(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:t,email_otp:n,hashed_token:s,redirect_to:o,verification_type:l},h=Object.assign({},c);return{data:{properties:u,user:h},error:null}}function aw(e){return e}function oI(e){return e.access_token&&e.refresh_token&&e.expires_in}const $h=["global","local","others"];class lI{constructor({url:t="",headers:n={},fetch:s}){this.url=t,this.headers=n,this.fetch=kb(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,n=$h[0]){if($h.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${$h.join(", ")}`);try{return await Le(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Pe(s))return{data:null,error:s};throw s}}async inviteUserByEmail(t,n={}){try{return await Le(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:hs})}catch(s){if(Pe(s))return{data:{user:null},error:s};throw s}}async generateLink(t){try{const{options:n}=t,s=Ss(t,["options"]),o=Object.assign(Object.assign({},s),n);return"newEmail"in s&&(o.new_email=s?.newEmail,delete o.newEmail),await Le(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:iI,redirectTo:n?.redirectTo})}catch(n){if(Pe(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(t){try{return await Le(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:hs})}catch(n){if(Pe(n))return{data:{user:null},error:n};throw n}}async listUsers(t){var n,s,o,l,c,u,h;try{const f={nextPage:null,lastPage:0,total:0},g=await Le(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=t?.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(l=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:""},xform:aw});if(g.error)throw g.error;const v=await g.json(),b=(c=g.headers.get("x-total-count"))!==null&&c!==void 0?c:0,x=(h=(u=g.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&h!==void 0?h:[];return x.length>0&&(x.forEach(S=>{const C=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(S.split(";")[1].split("=")[1]);f[`${w}Page`]=C}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},v),f),error:null}}catch(f){if(Pe(f))return{data:{users:[]},error:f};throw f}}async getUserById(t){Ra(t);try{return await Le(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:hs})}catch(n){if(Pe(n))return{data:{user:null},error:n};throw n}}async updateUserById(t,n){Ra(t);try{return await Le(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:n,headers:this.headers,xform:hs})}catch(s){if(Pe(s))return{data:{user:null},error:s};throw s}}async deleteUser(t,n=!1){Ra(t);try{return await Le(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:n},xform:hs})}catch(s){if(Pe(s))return{data:{user:null},error:s};throw s}}async _listFactors(t){Ra(t.userId);try{const{data:n,error:s}=await Le(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:n,error:s}}catch(n){if(Pe(n))return{data:null,error:n};throw n}}async _deleteFactor(t){Ra(t.userId),Ra(t.id);try{return{data:await Le(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(n){if(Pe(n))return{data:null,error:n};throw n}}async _listOAuthClients(t){var n,s,o,l,c,u,h;try{const f={nextPage:null,lastPage:0,total:0},g=await Le(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=t?.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(l=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:""},xform:aw});if(g.error)throw g.error;const v=await g.json(),b=(c=g.headers.get("x-total-count"))!==null&&c!==void 0?c:0,x=(h=(u=g.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&h!==void 0?h:[];return x.length>0&&(x.forEach(S=>{const C=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(S.split(";")[1].split("=")[1]);f[`${w}Page`]=C}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},v),f),error:null}}catch(f){if(Pe(f))return{data:{clients:[]},error:f};throw f}}async _createOAuthClient(t){try{return await Le(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Pe(n))return{data:null,error:n};throw n}}async _getOAuthClient(t){try{return await Le(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Pe(n))return{data:null,error:n};throw n}}async _updateOAuthClient(t,n){try{return await Le(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:n,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Pe(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(t){try{return await Le(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Pe(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(t){try{return await Le(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Pe(n))return{data:null,error:n};throw n}}}function iw(e={}){return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const Ia={debug:!!(globalThis&&jb()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Tb extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class cI extends Tb{}async function dI(e,t,n){Ia.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),Ia.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async o=>{if(o){Ia.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,o.name);try{return await n()}finally{Ia.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,o.name)}}else{if(t===0)throw Ia.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new cI(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Ia.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function uI(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Ab(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function hI(e){return parseInt(e,16)}function fI(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,s=>s.toString(16).padStart(2,"0")).join("")}function mI(e){var t;const{chainId:n,domain:s,expirationTime:o,issuedAt:l=new Date,nonce:c,notBefore:u,requestId:h,resources:f,scheme:g,uri:v,version:b}=e;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(c&&c.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${c}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const x=Ab(e.address),S=g?`${g}://${s}`:s,C=e.statement?`${e.statement}
`:"",w=`${S} wants you to sign in with your Ethereum account:
${x}

${C}`;let N=`URI: ${v}
Version: ${b}
Chain ID: ${n}${c?`
Nonce: ${c}`:""}
Issued At: ${l.toISOString()}`;if(o&&(N+=`
Expiration Time: ${o.toISOString()}`),u&&(N+=`
Not Before: ${u.toISOString()}`),h&&(N+=`
Request ID: ${h}`),f){let _=`
Resources:`;for(const j of f){if(!j||typeof j!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${j}`);_+=`
- ${j}`}N+=_}return`${w}
${N}`}class Et extends Error{constructor({message:t,code:n,cause:s,name:o}){var l;super(t,{cause:s}),this.__isWebAuthnError=!0,this.name=(l=o??(s instanceof Error?s.name:void 0))!==null&&l!==void 0?l:"Unknown Error",this.code=n}}class zc extends Et{constructor(t,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:t}),this.name="WebAuthnUnknownError",this.originalError=n}}function pI({error:e,options:t}){var n,s,o;const{publicKey:l}=t;if(!l)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Et({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((n=l.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new Et({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((s=l.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Et({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((o=l.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Et({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Et({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Et({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return l.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new Et({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Et({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const c=window.location.hostname;if(Pb(c)){if(l.rp.id!==c)return new Et({message:`The RP ID "${l.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Et({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(l.user.id.byteLength<1||l.user.id.byteLength>64)return new Et({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Et({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Et({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function gI({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Et({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Et({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const s=window.location.hostname;if(Pb(s)){if(n.rpId!==s)return new Et({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Et({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Et({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Et({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class vI{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const yI=new vI;function wI(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:n,excludeCredentials:s}=e,o=Ss(e,["challenge","user","excludeCredentials"]),l=Va(t).buffer,c=Object.assign(Object.assign({},n),{id:Va(n.id).buffer}),u=Object.assign(Object.assign({},o),{challenge:l,user:c});if(s&&s.length>0){u.excludeCredentials=new Array(s.length);for(let h=0;h<s.length;h++){const f=s[h];u.excludeCredentials[h]=Object.assign(Object.assign({},f),{id:Va(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function xI(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:n}=e,s=Ss(e,["challenge","allowCredentials"]),o=Va(t).buffer,l=Object.assign(Object.assign({},s),{challenge:o});if(n&&n.length>0){l.allowCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const u=n[c];l.allowCredentials[c]=Object.assign(Object.assign({},u),{id:Va(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return l}function bI(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e;return{id:e.id,rawId:e.id,response:{attestationObject:Ys(new Uint8Array(e.response.attestationObject)),clientDataJSON:Ys(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function CI(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e,s=e.getClientExtensionResults(),o=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Ys(new Uint8Array(o.authenticatorData)),clientDataJSON:Ys(new Uint8Array(o.clientDataJSON)),signature:Ys(new Uint8Array(o.signature)),userHandle:o.userHandle?Ys(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Pb(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function ow(){var e,t;return!!(Lt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function SI(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new zc("Browser returned unexpected credential type",t)}:{data:null,error:new zc("Empty credential response",t)}}catch(t){return{data:null,error:pI({error:t,options:e})}}}async function EI(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new zc("Browser returned unexpected credential type",t)}:{data:null,error:new zc("Empty credential response",t)}}catch(t){return{data:null,error:gI({error:t,options:e})}}}const _I={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},NI={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Hc(...e){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),n=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),s={};for(const o of e)if(o)for(const l in o){const c=o[l];if(c!==void 0)if(Array.isArray(c))s[l]=c;else if(n(c))s[l]=c;else if(t(c)){const u=s[l];t(u)?s[l]=Hc(u,c):s[l]=Hc(c)}else s[l]=c}return s}function jI(e,t){return Hc(_I,e,t||{})}function kI(e,t){return Hc(NI,e,t||{})}class TI{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:n,friendlyName:s,signal:o},l){try{const{data:c,error:u}=await this.client.mfa.challenge({factorId:t,webauthn:n});if(!c)return{data:null,error:u};const h=o??yI.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:f}=c.webauthn.credential_options.publicKey;f.name||(f.name=`${f.id}:${s}`),f.displayName||(f.displayName=f.name)}switch(c.webauthn.type){case"create":{const f=jI(c.webauthn.credential_options.publicKey,l?.create),{data:g,error:v}=await SI({publicKey:f,signal:h});return g?{data:{factorId:t,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:g}},error:null}:{data:null,error:v}}case"request":{const f=kI(c.webauthn.credential_options.publicKey,l?.request),{data:g,error:v}=await EI(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:f,signal:h}));return g?{data:{factorId:t,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:g}},error:null}:{data:null,error:v}}}}catch(c){return Pe(c)?{data:null,error:c}:{data:null,error:new Gs("Unexpected error in challenge",c)}}}async _verify({challengeId:t,factorId:n,webauthn:s}){return this.client.mfa.verify({factorId:n,challengeId:t,webauthn:s})}async _authenticate({factorId:t,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},l){if(!n)return{data:null,error:new yo("rpId is required for WebAuthn authentication")};try{if(!ow())return{data:null,error:new Gs("Browser does not support WebAuthn",null)};const{data:c,error:u}=await this.challenge({factorId:t,webauthn:{rpId:n,rpOrigins:s},signal:o},{request:l});if(!c)return{data:null,error:u};const{webauthn:h}=c;return this._verify({factorId:t,challengeId:c.challengeId,webauthn:{type:h.type,rpId:n,rpOrigins:s,credential_response:h.credential_response}})}catch(c){return Pe(c)?{data:null,error:c}:{data:null,error:new Gs("Unexpected error in authenticate",c)}}}async _register({friendlyName:t,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},l){if(!n)return{data:null,error:new yo("rpId is required for WebAuthn registration")};try{if(!ow())return{data:null,error:new Gs("Browser does not support WebAuthn",null)};const{data:c,error:u}=await this._enroll({friendlyName:t});if(!c)return await this.client.mfa.listFactors().then(g=>{var v;return(v=g.data)===null||v===void 0?void 0:v.all.find(b=>b.factor_type==="webauthn"&&b.friendly_name===t&&b.status!=="unverified")}).then(g=>g?this.client.mfa.unenroll({factorId:g?.id}):void 0),{data:null,error:u};const{data:h,error:f}=await this._challenge({factorId:c.id,friendlyName:c.friendly_name,webauthn:{rpId:n,rpOrigins:s},signal:o},{create:l});return h?this._verify({factorId:c.id,challengeId:h.challengeId,webauthn:{rpId:n,rpOrigins:s,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:f}}catch(c){return Pe(c)?{data:null,error:c}:{data:null,error:new Gs("Unexpected error in register",c)}}}}uI();const AI={url:N2,storageKey:j2,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:k2,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function lw(e,t,n){return await n()}const Da={};class wo{get jwks(){var t,n;return(n=(t=Da[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(t){Da[this.storageKey]=Object.assign(Object.assign({},Da[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,n;return(n=(t=Da[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Da[this.storageKey]=Object.assign(Object.assign({},Da[this.storageKey]),{cachedAt:t})}constructor(t){var n,s,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const l=Object.assign(Object.assign({},AI),t);if(this.storageKey=l.storageKey,this.instanceID=(n=wo.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,wo.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!l.debug,typeof l.debug=="function"&&(this.logger=l.debug),this.instanceID>0&&Lt()){const c=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(c),this.logDebugMessages&&console.trace(c)}if(this.persistSession=l.persistSession,this.autoRefreshToken=l.autoRefreshToken,this.admin=new lI({url:l.url,headers:l.headers,fetch:l.fetch}),this.url=l.url,this.headers=l.headers,this.fetch=kb(l.fetch),this.lock=l.lock||lw,this.detectSessionInUrl=l.detectSessionInUrl,this.flowType=l.flowType,this.hasCustomAuthorizationHeader=l.hasCustomAuthorizationHeader,this.throwOnError=l.throwOnError,l.lock?this.lock=l.lock:Lt()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=dI:this.lock=lw,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new TI(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(l.storage?this.storage=l.storage:jb()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=iw(this.memoryStorage)),l.userStorage&&(this.userStorage=l.userStorage)):(this.memoryStorage={},this.storage=iw(this.memoryStorage)),Lt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(c){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",c)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async c=>{this._debug("received broadcast notification from other tab or client",c),await this._notifyAllSubscribers(c.data.event,c.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Eb}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let n={},s="none";if(Lt()&&(n=z2(window.location.href),this._isImplicitGrantCallback(n)?s="implicit":await this._isPKCECallback(n)&&(s="pkce")),Lt()&&this.detectSessionInUrl&&s!=="none"){const{data:o,error:l}=await this._getSessionFromURL(n,s);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),D2(l)){const h=(t=l.details)===null||t===void 0?void 0:t.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:c,redirectType:u}=o;return this._debug("#_initialize()","detected session in URL",c,"redirect type",u),await this._saveSession(c),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Pe(n)?this._returnResult({error:n}):this._returnResult({error:new Gs("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var n,s,o;try{const l=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(n=t?.options)===null||n===void 0?void 0:n.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:Jn}),{data:c,error:u}=l;if(u||!c)return this._returnResult({data:{user:null,session:null},error:u});const h=c.session,f=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:f,session:h},error:null})}catch(l){if(Pe(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signUp(t){var n,s,o;try{let l;if("email"in t){const{email:g,password:v,options:b}=t;let x=null,S=null;this.flowType==="pkce"&&([x,S]=await Pa(this.storage,this.storageKey)),l=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:b?.emailRedirectTo,body:{email:g,password:v,data:(n=b?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:b?.captchaToken},code_challenge:x,code_challenge_method:S},xform:Jn})}else if("phone"in t){const{phone:g,password:v,options:b}=t;l=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:g,password:v,data:(s=b?.data)!==null&&s!==void 0?s:{},channel:(o=b?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:b?.captchaToken}},xform:Jn})}else throw new dc("You must provide either an email or phone number and a password");const{data:c,error:u}=l;if(u||!c)return this._returnResult({data:{user:null,session:null},error:u});const h=c.session,f=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:f,session:h},error:null})}catch(l){if(Pe(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithPassword(t){try{let n;if("email"in t){const{email:l,password:c,options:u}=t;n=await Le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:c,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:sw})}else if("phone"in t){const{phone:l,password:c,options:u}=t;n=await Le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:c,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:sw})}else throw new dc("You must provide either an email or phone number and a password");const{data:s,error:o}=n;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!s||!s.session||!s.user){const l=new Aa;return this._returnResult({data:{user:null,session:null},error:l})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:o})}catch(n){if(Pe(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(t){var n,s,o,l;return await this._handleProviderSignIn(t.provider,{redirectTo:(n=t.options)===null||n===void 0?void 0:n.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(l=t.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:n}=t;switch(n){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(t){var n,s,o,l,c,u,h,f,g,v,b;let x,S;if("message"in t)x=t.message,S=t.signature;else{const{chain:C,wallet:w,statement:N,options:_}=t;let j;if(Lt())if(typeof w=="object")j=w;else{const Z=window;if("ethereum"in Z&&typeof Z.ethereum=="object"&&"request"in Z.ethereum&&typeof Z.ethereum.request=="function")j=Z.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=w}const T=new URL((n=_?.url)!==null&&n!==void 0?n:window.location.href),R=await j.request({method:"eth_requestAccounts"}).then(Z=>Z).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!R||R.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const A=Ab(R[0]);let I=(s=_?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!I){const Z=await j.request({method:"eth_chainId"});I=hI(Z)}const L={domain:T.host,address:A,statement:N,uri:T.href,version:"1",chainId:I,nonce:(o=_?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(c=(l=_?.signInWithEthereum)===null||l===void 0?void 0:l.issuedAt)!==null&&c!==void 0?c:new Date,expirationTime:(u=_?.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(h=_?.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(f=_?.signInWithEthereum)===null||f===void 0?void 0:f.requestId,resources:(g=_?.signInWithEthereum)===null||g===void 0?void 0:g.resources};x=mI(L),S=await j.request({method:"personal_sign",params:[fI(x),A]})}try{const{data:C,error:w}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:x,signature:S},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(b=t.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:Jn});if(w)throw w;if(!C||!C.session||!C.user){const N=new Aa;return this._returnResult({data:{user:null,session:null},error:N})}return C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",C.session)),this._returnResult({data:Object.assign({},C),error:w})}catch(C){if(Pe(C))return this._returnResult({data:{user:null,session:null},error:C});throw C}}async signInWithSolana(t){var n,s,o,l,c,u,h,f,g,v,b,x;let S,C;if("message"in t)S=t.message,C=t.signature;else{const{chain:w,wallet:N,statement:_,options:j}=t;let T;if(Lt())if(typeof N=="object")T=N;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))T=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!j?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=N}const R=new URL((n=j?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in T&&T.signIn){const A=await T.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},j?.signInWithSolana),{version:"1",domain:R.host,uri:R.href}),_?{statement:_}:null));let I;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")I=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)I=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in I&&"signature"in I&&(typeof I.signedMessage=="string"||I.signedMessage instanceof Uint8Array)&&I.signature instanceof Uint8Array)S=typeof I.signedMessage=="string"?I.signedMessage:new TextDecoder().decode(I.signedMessage),C=I.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in T)||typeof T.signMessage!="function"||!("publicKey"in T)||typeof T!="object"||!T.publicKey||!("toBase58"in T.publicKey)||typeof T.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");S=[`${R.host} wants you to sign in with your Solana account:`,T.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${R.href}`,`Issued At: ${(o=(s=j?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((l=j?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${j.signInWithSolana.notBefore}`]:[],...!((c=j?.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${j.signInWithSolana.expirationTime}`]:[],...!((u=j?.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${j.signInWithSolana.chainId}`]:[],...!((h=j?.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${j.signInWithSolana.nonce}`]:[],...!((f=j?.signInWithSolana)===null||f===void 0)&&f.requestId?[`Request ID: ${j.signInWithSolana.requestId}`]:[],...!((v=(g=j?.signInWithSolana)===null||g===void 0?void 0:g.resources)===null||v===void 0)&&v.length?["Resources",...j.signInWithSolana.resources.map(I=>`- ${I}`)]:[]].join(`
`);const A=await T.signMessage(new TextEncoder().encode(S),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");C=A}}try{const{data:w,error:N}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:S,signature:Ys(C)},!((b=t.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Jn});if(N)throw N;if(!w||!w.session||!w.user){const _=new Aa;return this._returnResult({data:{user:null,session:null},error:_})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:N})}catch(w){if(Pe(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async _exchangeCodeForSession(t){const n=await zs(this.storage,`${this.storageKey}-code-verifier`),[s,o]=(n??"").split("/");try{const{data:l,error:c}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:s},xform:Jn});if(await ds(this.storage,`${this.storageKey}-code-verifier`),c)throw c;if(!l||!l.session||!l.user){const u=new Aa;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign(Object.assign({},l),{redirectType:o??null}),error:c})}catch(l){if(Pe(l))return this._returnResult({data:{user:null,session:null,redirectType:null},error:l});throw l}}async signInWithIdToken(t){try{const{options:n,provider:s,token:o,access_token:l,nonce:c}=t,u=await Le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:o,access_token:l,nonce:c,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:Jn}),{data:h,error:f}=u;if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!h||!h.session||!h.user){const g=new Aa;return this._returnResult({data:{user:null,session:null},error:g})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:f})}catch(n){if(Pe(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(t){var n,s,o,l,c;try{if("email"in t){const{email:u,options:h}=t;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await Pa(this.storage,this.storageKey));const{error:v}=await Le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(n=h?.data)!==null&&n!==void 0?n:{},create_user:(s=h?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:f,code_challenge_method:g},redirectTo:h?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:u,options:h}=t,{data:f,error:g}=await Le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(o=h?.data)!==null&&o!==void 0?o:{},create_user:(l=h?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},channel:(c=h?.channel)!==null&&c!==void 0?c:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:f?.message_id},error:g})}throw new dc("You must provide either an email or phone number.")}catch(u){if(Pe(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(t){var n,s;try{let o,l;"options"in t&&(o=(n=t.options)===null||n===void 0?void 0:n.redirectTo,l=(s=t.options)===null||s===void 0?void 0:s.captchaToken);const{data:c,error:u}=await Le(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:l}}),redirectTo:o,xform:Jn});if(u)throw u;if(!c)throw new Error("An error occurred on token verification.");const h=c.session,f=c.user;return h?.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:f,session:h},error:null})}catch(o){if(Pe(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var n,s,o,l,c;try{let u=null,h=null;this.flowType==="pkce"&&([u,h]=await Pa(this.storage,this.storageKey));const f=await Le(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(s=(n=t.options)===null||n===void 0?void 0:n.redirectTo)!==null&&s!==void 0?s:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:h}),headers:this.headers,xform:aI});return!((l=f.data)===null||l===void 0)&&l.url&&Lt()&&!(!((c=t.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(f.data.url),this._returnResult(f)}catch(u){if(Pe(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;if(s)throw s;if(!n)throw new gn;const{error:o}=await Le(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(Pe(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const n=`${this.url}/resend`;if("email"in t){const{email:s,type:o,options:l}=t,{error:c}=await Le(this.fetch,"POST",n,{headers:this.headers,body:{email:s,type:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}else if("phone"in t){const{phone:s,type:o,options:l}=t,{data:c,error:u}=await Le(this.fetch,"POST",n,{headers:this.headers,body:{phone:s,type:o,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:u})}throw new dc("You must provide either an email or phone number and a type")}catch(n){if(Pe(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(t,n){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await s,await n()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=n();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await t(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const n=await zs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?t=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const s=t.expires_at?t.expires_at*1e3-Date.now()<Dh:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(this.userStorage){const c=await zs(this.userStorage,this.storageKey+"-user");c?.user?t.user=c.user:t.user=Mh()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const c={value:this.suppressGetSessionWarning};t.user=tI(t.user,c),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{session:null},error:l}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await Le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:hs}):await this._useSession(async n=>{var s,o,l;const{data:c,error:u}=n;if(u)throw u;return!(!((s=c.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new gn}:await Le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(o=c.session)===null||o===void 0?void 0:o.access_token)!==null&&l!==void 0?l:void 0,xform:hs})})}catch(n){if(Pe(n))return I2(n)&&(await this._removeSession(),await ds(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(t,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,n))}async _updateUser(t,n={}){try{return await this._useSession(async s=>{const{data:o,error:l}=s;if(l)throw l;if(!o.session)throw new gn;const c=o.session;let u=null,h=null;this.flowType==="pkce"&&t.email!=null&&([u,h]=await Pa(this.storage,this.storageKey));const{data:f,error:g}=await Le(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:u,code_challenge_method:h}),jwt:c.access_token,xform:hs});if(g)throw g;return c.user=f.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),this._returnResult({data:{user:c.user},error:null})})}catch(s){if(Pe(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new gn;const n=Date.now()/1e3;let s=n,o=!0,l=null;const{payload:c}=Lh(t.access_token);if(c.exp&&(s=c.exp,o=s<=n),o){const{data:u,error:h}=await this._callRefreshToken(t.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!u)return{data:{user:null,session:null},error:null};l=u}else{const{data:u,error:h}=await this._getUser(t.access_token);if(h)throw h;l={access_token:t.access_token,refresh_token:t.refresh_token,user:u.user,token_type:"bearer",expires_in:s-n,expires_at:s},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return this._returnResult({data:{user:l.user,session:l},error:null})}catch(n){if(Pe(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async n=>{var s;if(!t){const{data:c,error:u}=n;if(u)throw u;t=(s=c.session)!==null&&s!==void 0?s:void 0}if(!t?.refresh_token)throw new gn;const{data:o,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{user:null,session:null},error:l}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Pe(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(t,n){try{if(!Lt())throw new uc("No browser detected.");if(t.error||t.error_description||t.error_code)throw new uc(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Qy("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new uc("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Qy("No code detected.");const{data:_,error:j}=await this._exchangeCodeForSession(t.code);if(j)throw j;const T=new URL(window.location.href);return T.searchParams.delete("code"),window.history.replaceState(window.history.state,"",T.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:o,access_token:l,refresh_token:c,expires_in:u,expires_at:h,token_type:f}=t;if(!l||!u||!c||!f)throw new uc("No session defined in URL");const g=Math.round(Date.now()/1e3),v=parseInt(u);let b=g+v;h&&(b=parseInt(h));const x=b-g;x*1e3<=Fa&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${x}s, should have been closer to ${v}s`);const S=b-v;g-S>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",S,b,g):g-S<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",S,b,g);const{data:C,error:w}=await this._getUser(l);if(w)throw w;const N={provider_token:s,provider_refresh_token:o,access_token:l,expires_in:v,expires_at:b,refresh_token:c,token_type:f,user:C.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:N,redirectType:t.type},error:null})}catch(s){if(Pe(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const n=await zs(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&n)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async n=>{var s;const{data:o,error:l}=n;if(l)return this._returnResult({error:l});const c=(s=o.session)===null||s===void 0?void 0:s.access_token;if(c){const{error:u}=await this.admin.signOut(c,t);if(u&&!(R2(u)&&(u.status===404||u.status===401||u.status===403)))return this._returnResult({error:u})}return t!=="others"&&(await this._removeSession(),await ds(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const n=B2(),s={id:n,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:s}}}async _emitInitialSession(t){return await this._useSession(async n=>{var s,o;try{const{data:{session:l},error:c}=n;if(c)throw c;await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",t,"session",l)}catch(l){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",l),console.error(l)}})}async resetPasswordForEmail(t,n={}){let s=null,o=null;this.flowType==="pkce"&&([s,o]=await Pa(this.storage,this.storageKey,!0));try{return await Le(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:s,code_challenge_method:o,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(l){if(Pe(l))return this._returnResult({data:null,error:l});throw l}}async getUserIdentities(){var t;try{const{data:n,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(t=n.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(n){if(Pe(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var n;try{const{data:s,error:o}=await this._useSession(async l=>{var c,u,h,f,g;const{data:v,error:b}=l;if(b)throw b;const x=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(c=t.options)===null||c===void 0?void 0:c.redirectTo,scopes:(u=t.options)===null||u===void 0?void 0:u.scopes,queryParams:(h=t.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await Le(this.fetch,"GET",x,{headers:this.headers,jwt:(g=(f=v.session)===null||f===void 0?void 0:f.access_token)!==null&&g!==void 0?g:void 0})});if(o)throw o;return Lt()&&!(!((n=t.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:t.provider,url:s?.url},error:null})}catch(s){if(Pe(s))return this._returnResult({data:{provider:t.provider,url:null},error:s});throw s}}async linkIdentityIdToken(t){return await this._useSession(async n=>{var s;try{const{error:o,data:{session:l}}=n;if(o)throw o;const{options:c,provider:u,token:h,access_token:f,nonce:g}=t,v=await Le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=l?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:u,id_token:h,access_token:f,nonce:g,link_identity:!0,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Jn}),{data:b,error:x}=v;return x?this._returnResult({data:{user:null,session:null},error:x}):!b||!b.session||!b.user?this._returnResult({data:{user:null,session:null},error:new Aa}):(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("USER_UPDATED",b.session)),this._returnResult({data:b,error:x}))}catch(o){if(Pe(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async n=>{var s,o;const{data:l,error:c}=n;if(c)throw c;return await Le(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(s=l.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0})})}catch(n){if(Pe(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(t){const n=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{const s=Date.now();return await q2(async o=>(o>0&&await V2(200*Math.pow(2,o-1)),this._debug(n,"refreshing attempt",o),await Le(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Jn})),(o,l)=>{const c=200*Math.pow(2,o);return l&&Oh(l)&&Date.now()+c-s<Fa})}catch(s){if(this._debug(n,"error",s),Pe(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(n,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,n){const s=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",n,"url",s),Lt()&&!n.skipBrowserRedirect&&window.location.assign(s),{data:{provider:t,url:s},error:null}}async _recoverAndRefresh(){var t,n;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const o=await zs(this.storage,this.storageKey);if(o&&this.userStorage){let c=await zs(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:o.user},await Ua(this.userStorage,this.storageKey+"-user",c)),o.user=(t=c?.user)!==null&&t!==void 0?t:Mh()}else if(o&&!o.user&&!o.user){const c=await zs(this.storage,this.storageKey+"-user");c&&c?.user?(o.user=c.user,await ds(this.storage,this.storageKey+"-user"),await Ua(this.storage,this.storageKey,o)):o.user=Mh()}if(this._debug(s,"session from storage",o),!this._isValidSession(o)){this._debug(s,"session is not valid"),o!==null&&await this._removeSession();return}const l=((n=o.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Dh;if(this._debug(s,`session has${l?"":" not"} expired with margin of ${Dh}s`),l){if(this.autoRefreshToken&&o.refresh_token){const{error:c}=await this._callRefreshToken(o.refresh_token);c&&(console.error(c),Oh(c)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:u}=await this._getUser(o.access_token);!u&&c?.user?(o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(s,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(s,"error",o),console.error(o);return}finally{this._debug(s,"end")}}async _callRefreshToken(t){var n,s;if(!t)throw new gn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new pd;const{data:l,error:c}=await this._refreshAccessToken(t);if(c)throw c;if(!l.session)throw new gn;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const u={data:l.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(l){if(this._debug(o,"error",l),Pe(l)){const c={data:null,error:l};return Oh(l)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(c),c}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(l),l}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,n,s=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",n,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:t,session:n});const l=[],c=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(t,n)}catch(h){l.push(h)}});if(await Promise.all(c),l.length>0){for(let u=0;u<l.length;u+=1)console.error(l[u]);throw l[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const n=Object.assign({},t),s=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&n.user&&await Ua(this.userStorage,this.storageKey+"-user",{user:n.user});const o=Object.assign({},n);delete o.user;const l=nw(o);await Ua(this.storage,this.storageKey,l)}else{const o=nw(n);await Ua(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await ds(this.storage,this.storageKey),await ds(this.storage,this.storageKey+"-code-verifier"),await ds(this.storage,this.storageKey+"-user"),this.userStorage&&await ds(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Lt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Fa);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async n=>{const{data:{session:s}}=n;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((s.expires_at*1e3-t)/Fa);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Fa}ms, refresh threshold is ${Af} ticks`),o<=Af&&await this._callRefreshToken(s.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Tb)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Lt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const n=`#_onVisibilityChanged(${t})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,n,s){const o=[`provider=${encodeURIComponent(n)}`];if(s?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&o.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[l,c]=await Pa(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(c)}`});o.push(u.toString())}if(s?.queryParams){const l=new URLSearchParams(s.queryParams);o.push(l.toString())}return s?.skipBrowserRedirect&&o.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async n=>{var s;const{data:o,error:l}=n;return l?this._returnResult({data:null,error:l}):await Le(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(s=o?.session)===null||s===void 0?void 0:s.access_token})})}catch(n){if(Pe(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(t){try{return await this._useSession(async n=>{var s,o;const{data:l,error:c}=n;if(c)return this._returnResult({data:null,error:c});const u=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:h,error:f}=await Le(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(s=l?.session)===null||s===void 0?void 0:s.access_token});return f?this._returnResult({data:null,error:f}):(t.factorType==="totp"&&h.type==="totp"&&(!((o=h?.totp)===null||o===void 0)&&o.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(n){if(Pe(n))return this._returnResult({data:null,error:n});throw n}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var s;const{data:o,error:l}=n;if(l)return this._returnResult({data:null,error:l});const c=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?bI(t.webauthn.credential_response):CI(t.webauthn.credential_response)})}:{code:t.code}),{data:u,error:h}=await Le(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:c,headers:this.headers,jwt:(s=o?.session)===null||s===void 0?void 0:s.access_token});return h?this._returnResult({data:null,error:h}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:h}))})}catch(n){if(Pe(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var s;const{data:o,error:l}=n;if(l)return this._returnResult({data:null,error:l});const c=await Le(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(s=o?.session)===null||s===void 0?void 0:s.access_token});if(c.error)return c;const{data:u}=c;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:wI(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:xI(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Pe(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(t){const{data:n,error:s}=await this._challenge({factorId:t.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:t.factorId,challengeId:n.id,code:t.code})}async _listFactors(){var t;const{data:{user:n},error:s}=await this.getUser();if(s)return{data:null,error:s};const o={all:[],phone:[],totp:[],webauthn:[]};for(const l of(t=n?.factors)!==null&&t!==void 0?t:[])o.all.push(l),l.status==="verified"&&o[l.factor_type].push(l);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(){var t,n;const{data:{session:s},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=Lh(s.access_token);let c=null;l.aal&&(c=l.aal);let u=c;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(g=>g.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(u="aal2");const f=l.amr||[];return{data:{currentLevel:c,nextLevel:u,currentAuthenticationMethods:f},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;return o?this._returnResult({data:null,error:o}):s?await Le(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:s.access_token,xform:l=>({data:l,error:null})}):this._returnResult({data:null,error:new gn})})}catch(n){if(Pe(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(t,n){try{return await this._useSession(async s=>{const{data:{session:o},error:l}=s;if(l)return this._returnResult({data:null,error:l});if(!o)return this._returnResult({data:null,error:new gn});const c=await Le(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return c.data&&c.data.redirect_url&&Lt()&&!n?.skipBrowserRedirect&&window.location.assign(c.data.redirect_url),c})}catch(s){if(Pe(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(t,n){try{return await this._useSession(async s=>{const{data:{session:o},error:l}=s;if(l)return this._returnResult({data:null,error:l});if(!o)return this._returnResult({data:null,error:new gn});const c=await Le(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return c.data&&c.data.redirect_url&&Lt()&&!n?.skipBrowserRedirect&&window.location.assign(c.data.redirect_url),c})}catch(s){if(Pe(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;return s?this._returnResult({data:null,error:s}):n?await Le(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new gn})})}catch(t){if(Pe(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;return o?this._returnResult({data:null,error:o}):s?await Le(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:t.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new gn})})}catch(n){if(Pe(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(t,n={keys:[]}){let s=n.keys.find(u=>u.kid===t);if(s)return s;const o=Date.now();if(s=this.jwks.keys.find(u=>u.kid===t),s&&this.jwks_cached_at+A2>o)return s;const{data:l,error:c}=await Le(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=o,s=l.keys.find(u=>u.kid===t),!s)?null:s}async getClaims(t,n={}){try{let s=t;if(!s){const{data:x,error:S}=await this.getSession();if(S||!x.session)return this._returnResult({data:null,error:S});s=x.session.access_token}const{header:o,payload:l,signature:c,raw:{header:u,payload:h}}=Lh(s);n?.allowExpired||X2(l.exp);const f=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!f){const{error:x}=await this.getUser(s);if(x)throw x;return{data:{claims:l,header:o,signature:c},error:null}}const g=Z2(o.alg),v=await crypto.subtle.importKey("jwk",f,g,!0,["verify"]);if(!await crypto.subtle.verify(g,v,c,F2(`${u}.${h}`)))throw new If("Invalid JWT signature");return{data:{claims:l,header:o,signature:c},error:null}}catch(s){if(Pe(s))return this._returnResult({data:null,error:s});throw s}}}wo.nextInstanceID={};const PI=wo;class RI extends PI{constructor(t){super(t)}}class II{constructor(t,n,s){var o,l,c;this.supabaseUrl=t,this.supabaseKey=n;const u=_2(t);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const h=`sb-${u.hostname.split(".")[0]}-auth-token`,f={db:v2,realtime:w2,auth:Object.assign(Object.assign({},y2),{storageKey:h}),global:g2},g=E2(s??{},f);this.storageKey=(o=g.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(l=g.global.headers)!==null&&l!==void 0?l:{},g.accessToken?(this.accessToken=g.accessToken,this.auth=new Proxy({},{get:(v,b)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(b)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=g.auth)!==null&&c!==void 0?c:{},this.headers,g.global.fetch),this.fetch=C2(n,this._getAccessToken.bind(this),g.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},g.realtime)),this.accessToken&&this.accessToken().then(v=>this.realtime.setAuth(v)).catch(v=>console.warn("Failed to set initial Realtime auth token:",v)),this.rest=new NR(new URL("rest/v1",u).href,{headers:this.headers,schema:g.db.schema,fetch:this.fetch}),this.storage=new f2(this.storageUrl.href,this.headers,this.fetch,s?.storage),g.accessToken||this._listenForAuthEvents()}get functions(){return new CR(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,n={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,n,s)}channel(t,n={config:{}}){return this.realtime.channel(t,n)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,n;if(this.accessToken)return await this.accessToken();const{data:s}=await this.auth.getSession();return(n=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:n,detectSessionInUrl:s,storage:o,userStorage:l,storageKey:c,flowType:u,lock:h,debug:f,throwOnError:g},v,b){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new RI({url:this.authUrl.href,headers:Object.assign(Object.assign({},x),v),storageKey:c,autoRefreshToken:t,persistSession:n,detectSessionInUrl:s,storage:o,userStorage:l,flowType:u,lock:h,debug:f,throwOnError:g,fetch:b,hasCustomAuthorizationHeader:Object.keys(this.headers).some(S=>S.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new HR(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,s)=>{this._handleTokenChanged(n,"CLIENT",s?.access_token)})}_handleTokenChanged(t,n,s){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const DI=(e,t,n)=>new II(e,t,n);function OI(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}OI()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Rb="https://itmhojbjfacocrpmslmt.supabase.co",Ib="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0bWhvamJqZmFjb2NycG1zbG10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODExMDIsImV4cCI6MjA3NDQ1NzEwMn0.i8cdSYaeY7u4YaDqGI_92KmMwEpyEYt3ZZ9GuKxXVPk";console.log(" [SUPABASE CLIENT] Environment check:",{hasUrl:!0,hasKey:!0,urlLength:Rb?.length||0,keyLength:Ib?.length||0,mode:"production",dev:!1,prod:!0});const Y=DI(Rb,Ib,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}},global:{headers:{"x-client-info":"kidscallhome-web"}}}),Pm=nd("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-base font-semibold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),de=p.forwardRef(({className:e,variant:t,size:n,asChild:s=!1,...o},l)=>{const c=s?EN:"button";return i.jsx(c,{className:Ce(Pm({variant:t,size:n,className:e})),ref:l,...o})});de.displayName="Button";const Ae=p.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,className:Ce("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Ae.displayName="Card";const LI=p.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,className:Ce("flex flex-col space-y-1.5 p-6",e),...t}));LI.displayName="CardHeader";const MI=p.forwardRef(({className:e,...t},n)=>i.jsx("h3",{ref:n,className:Ce("text-2xl font-semibold leading-none tracking-tight",e),...t}));MI.displayName="CardTitle";const $I=p.forwardRef(({className:e,...t},n)=>i.jsx("p",{ref:n,className:Ce("text-sm text-muted-foreground",e),...t}));$I.displayName="CardDescription";const FI=p.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,className:Ce("p-6 pt-0",e),...t}));FI.displayName="CardContent";const UI=p.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,className:Ce("flex items-center p-6 pt-0",e),...t}));UI.displayName="CardFooter";class BI extends p.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,n){console.error(" [ERROR BOUNDARY] Caught error:",t,n),this.setState({error:t,errorInfo:n})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const t=this.state.error?.message?.includes("VITE_SUPABASE")||this.state.error?.message?.includes("environment variable");return i.jsx("div",{className:"min-h-[100dvh] flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-secondary/5 p-4",children:i.jsxs(Ae,{className:"max-w-2xl w-full p-8 space-y-6",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Ks,{className:"h-12 w-12 text-destructive"}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold",children:"Something went wrong"}),i.jsx("p",{className:"text-muted-foreground mt-1",children:t?"Missing required configuration":"An unexpected error occurred"})]})]}),t?i.jsxs("div",{className:"space-y-4",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"The app is missing required environment variables. Please check:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-2 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"VITE_SUPABASE_URL"}),i.jsx("li",{children:"VITE_SUPABASE_PUBLISHABLE_KEY"})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Set these in your Vercel project settings (Settings  Environment Variables) or in a .env file for local development."})]}):i.jsx("div",{className:"space-y-4",children:this.state.error&&i.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[i.jsx("p",{className:"font-mono text-sm text-destructive break-all",children:this.state.error.toString()}),this.state.errorInfo&&i.jsxs("details",{className:"mt-4",children:[i.jsx("summary",{className:"cursor-pointer text-sm text-muted-foreground",children:"Stack trace"}),i.jsx("pre",{className:"mt-2 text-xs text-muted-foreground overflow-auto max-h-48",children:this.state.errorInfo.componentStack})]})]})}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx(de,{onClick:this.handleReset,className:"flex-1",children:"Reload Page"}),i.jsx(de,{variant:"outline",onClick:()=>window.location.href="/",className:"flex-1",children:"Go Home"})]})]})})}return this.props.children}}const zI=()=>{const e=rt();return i.jsx("div",{className:"min-h-[100dvh] bg-gradient-to-b from-primary/10 to-background",children:i.jsxs("div",{className:"container mx-auto px-4 py-16",children:[i.jsxs("div",{className:"text-center space-y-6 mb-16",children:[i.jsx("div",{className:"aspect-square w-20 mx-auto",children:i.jsx("img",{src:"/icon-192x192.png",alt:"Kids Call Home",className:"w-full h-full object-contain",width:"192",height:"192"})}),i.jsx("h1",{className:"text-5xl md:text-6xl font-bold text-primary",children:"Kids Call Home"}),i.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Stay connected with your family through simple video calls and messaging"})]}),i.jsxs("div",{className:"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:[i.jsxs(Ae,{className:"p-8 cursor-pointer hover:shadow-xl transition-all border-4 border-primary/20 hover:border-primary/40",onClick:()=>e("/parent/auth"),children:[i.jsx(co,{className:"h-16 w-16 text-primary mb-4"}),i.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Parents"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Create an account and add your children. Manage their access and stay connected."}),i.jsx(de,{className:"w-full",size:"lg",children:"Parent Sign In"})]}),i.jsxs(Ae,{className:"p-8 cursor-pointer hover:shadow-xl transition-all border-4 border-secondary/20 hover:border-secondary/40",onClick:()=>e("/child/login"),children:[i.jsx(ko,{className:"h-16 w-16 text-secondary mb-4"}),i.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Kids"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Enter your special code to call and message your parents!"}),i.jsx(de,{className:"w-full",size:"lg",variant:"secondary",children:"Kid Login"})]})]}),i.jsxs("div",{className:"mt-16 grid md:grid-cols-3 gap-8 max-w-4xl mx-auto",children:[i.jsxs("div",{className:"text-center space-y-3",children:[i.jsx("div",{className:"text-4xl",children:""}),i.jsx("h3",{className:"font-bold text-xl",children:"Video Calls"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Face-to-face conversations anytime"})]}),i.jsxs("div",{className:"text-center space-y-3",children:[i.jsx("div",{className:"text-4xl",children:""}),i.jsx("h3",{className:"font-bold text-xl",children:"Messaging"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Send messages instantly"})]}),i.jsxs("div",{className:"text-center space-y-3",children:[i.jsx("div",{className:"text-4xl",children:""}),i.jsx("h3",{className:"font-bold text-xl",children:"Safe & Secure"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Private family connections only"})]})]}),i.jsx("div",{className:"mt-16 pt-8 border-t text-center",children:i.jsx(de,{variant:"ghost",onClick:()=>e("/info"),className:"text-muted-foreground hover:text-foreground",children:"App Information & Legal"})})]})})},HI=()=>{const e=bn(),t=rt();return p.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),i.jsx("div",{className:"flex min-h-[100dvh] items-center justify-center bg-gradient-to-br from-primary/5 via-background to-secondary/5 p-4",children:i.jsxs("div",{className:"text-center space-y-8 max-w-md w-full",children:[i.jsxs("div",{className:"relative",children:[i.jsxs("div",{className:"text-9xl font-bold text-primary/20 select-none",children:[i.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0s",animationDuration:"2s"},children:"4"}),i.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.2s",animationDuration:"2s"},children:"0"}),i.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.4s",animationDuration:"2s"},children:"4"})]}),i.jsx(Js,{className:"absolute top-0 left-1/4 w-6 h-6 text-kid-purple animate-pulse",style:{animationDelay:"0.5s"}}),i.jsx(Js,{className:"absolute top-4 right-1/4 w-5 h-5 text-kid-pink animate-pulse",style:{animationDelay:"1s"}}),i.jsx(Js,{className:"absolute bottom-0 left-1/3 w-4 h-4 text-kid-green animate-pulse",style:{animationDelay:"1.5s"}})]}),i.jsxs("div",{className:"space-y-4 animate-fade-in",children:[i.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"Oops! This page went on an adventure! "}),i.jsx("p",{className:"text-xl text-muted-foreground",children:"We couldn't find the page you're looking for. Maybe it's playing hide and seek?"})]}),i.jsx("div",{className:"flex justify-center",children:i.jsxs("div",{className:"relative",children:[i.jsx(Ij,{className:"w-24 h-24 text-primary/30 animate-spin-slow"}),i.jsx("div",{className:"absolute inset-0 border-4 border-primary/20 rounded-full animate-ping"})]})}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center pt-4",children:[i.jsxs(de,{onClick:()=>t("/"),size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.3s"},children:[i.jsx(Xs,{className:"mr-2 h-5 w-5"}),"Go Home"]}),i.jsx(de,{onClick:()=>t(-1),variant:"outline",size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.5s"},children:"Go Back"})]}),i.jsxs("div",{className:"flex justify-center gap-4 text-2xl pt-4",children:[i.jsx("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:""}),i.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:""}),i.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.4s"},children:""})]})]})})},VI=()=>{const e=rt(),t=()=>{window.location.reload()};return i.jsx("div",{className:"flex min-h-[100dvh] items-center justify-center bg-gradient-to-br from-destructive/5 via-background to-secondary/5 p-4",children:i.jsxs("div",{className:"text-center space-y-8 max-w-md w-full",children:[i.jsxs("div",{className:"relative",children:[i.jsxs("div",{className:"text-9xl font-bold text-destructive/20 select-none",children:[i.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0s",animationDuration:"2s"},children:"5"}),i.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.2s",animationDuration:"2s"},children:"0"}),i.jsx("span",{className:"inline-block animate-bounce",style:{animationDelay:"0.4s",animationDuration:"2s"},children:"0"})]}),i.jsx(Ax,{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 text-destructive/40 animate-pulse"})]}),i.jsxs("div",{className:"space-y-4 animate-fade-in",children:[i.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"Oops! Something went wrong! "}),i.jsx("p",{className:"text-xl text-muted-foreground",children:"Our servers are taking a little break. Don't worry, we're working on fixing it!"})]}),i.jsx("div",{className:"flex justify-center",children:i.jsx(fs,{className:"w-24 h-24 text-destructive/30 animate-spin-slow"})}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center pt-4",children:[i.jsxs(de,{onClick:t,size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.3s"},children:[i.jsx(fs,{className:"mr-2 h-5 w-5"}),"Try Again"]}),i.jsxs(de,{onClick:()=>e("/"),variant:"outline",size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.5s"},children:[i.jsx(Xs,{className:"mr-2 h-5 w-5"}),"Go Home"]})]}),i.jsxs("div",{className:"flex justify-center gap-4 text-2xl pt-4",children:[i.jsx("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:""}),i.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:""}),i.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.4s"},children:""})]})]})})},qI=()=>{const e=rt(),t=()=>{window.location.reload()};return i.jsx("div",{className:"flex min-h-[100dvh] items-center justify-center bg-gradient-to-br from-secondary/5 via-background to-primary/5 p-4",children:i.jsxs("div",{className:"text-center space-y-8 max-w-md w-full",children:[i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"text-9xl font-bold text-secondary/20 select-none flex items-center justify-center",children:i.jsx(ay,{className:"w-32 h-32 text-secondary/30"})}),i.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:i.jsxs("div",{className:"relative w-40 h-40",children:[i.jsx("div",{className:"absolute inset-0 border-4 border-secondary/20 rounded-full animate-ping"}),i.jsx("div",{className:"absolute inset-0 border-4 border-secondary/20 rounded-full animate-ping",style:{animationDelay:"0.5s"}}),i.jsx("div",{className:"absolute inset-0 border-4 border-secondary/20 rounded-full animate-ping",style:{animationDelay:"1s"}})]})})]}),i.jsxs("div",{className:"space-y-4 animate-fade-in",children:[i.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"Oops! No internet connection! "}),i.jsx("p",{className:"text-xl text-muted-foreground",children:"It looks like you're not connected to the internet. Check your connection and try again!"})]}),i.jsx("div",{className:"flex justify-center",children:i.jsxs("div",{className:"relative",children:[i.jsx(Fj,{className:"w-24 h-24 text-secondary/30 animate-pulse"}),i.jsx(ay,{className:"absolute inset-0 w-24 h-24 text-destructive/30 animate-pulse",style:{animationDelay:"0.5s"}})]})}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center pt-4",children:[i.jsxs(de,{onClick:t,size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.3s"},children:[i.jsx(fs,{className:"mr-2 h-5 w-5"}),"Try Again"]}),i.jsxs(de,{onClick:()=>e("/"),variant:"outline",size:"lg",className:"w-full sm:w-auto animate-fade-in-up",style:{animationDelay:"0.5s"},children:[i.jsx(Xs,{className:"mr-2 h-5 w-5"}),"Go Home"]})]}),i.jsxs("div",{className:"flex justify-center gap-4 text-2xl pt-4",children:[i.jsx("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:""}),i.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:""}),i.jsx("span",{className:"animate-bounce",style:{animationDelay:"0.4s"},children:""})]})]})})},WI="modulepreload",GI=function(e){return"/"+e},cw={},xr=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){let h=function(f){return Promise.all(f.map(g=>Promise.resolve(g).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=c?.nonce||c?.getAttribute("nonce");o=h(n.map(f=>{if(f=GI(f),f in cw)return;cw[f]=!0;const g=f.endsWith(".css"),v=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${v}`))return;const b=document.createElement("link");if(b.rel=g?"stylesheet":WI,g||(b.as="script"),b.crossOrigin="",b.href=f,u&&b.setAttribute("nonce",u),document.head.appendChild(b),g)return new Promise((x,S)=>{b.addEventListener("load",x),b.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${f}`)))})}))}function l(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return o.then(c=>{for(const u of c||[])u.status==="rejected"&&l(u.reason);return t().catch(l)})};function Db(e){const t=p.useRef({value:e,previous:e});return p.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var gd="Checkbox",[KI]=Mn(gd),[YI,Rm]=KI(gd);function JI(e){const{__scopeCheckbox:t,checked:n,children:s,defaultChecked:o,disabled:l,form:c,name:u,onCheckedChange:h,required:f,value:g="on",internal_do_not_use_render:v}=e,[b,x]=ys({prop:n,defaultProp:o??!1,onChange:h,caller:gd}),[S,C]=p.useState(null),[w,N]=p.useState(null),_=p.useRef(!1),j=S?!!c||!!S.closest("form"):!0,T={checked:b,disabled:l,setChecked:x,control:S,setControl:C,name:u,form:c,value:g,hasConsumerStoppedPropagationRef:_,required:f,defaultChecked:vs(o)?!1:o,isFormControl:j,bubbleInput:w,setBubbleInput:N};return i.jsx(YI,{scope:t,...T,children:QI(v)?v(T):s})}var Ob="CheckboxTrigger",Lb=p.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:n,...s},o)=>{const{control:l,value:c,disabled:u,checked:h,required:f,setControl:g,setChecked:v,hasConsumerStoppedPropagationRef:b,isFormControl:x,bubbleInput:S}=Rm(Ob,e),C=Ye(o,g),w=p.useRef(h);return p.useEffect(()=>{const N=l?.form;if(N){const _=()=>v(w.current);return N.addEventListener("reset",_),()=>N.removeEventListener("reset",_)}},[l,v]),i.jsx(Me.button,{type:"button",role:"checkbox","aria-checked":vs(h)?"mixed":h,"aria-required":f,"data-state":Bb(h),"data-disabled":u?"":void 0,disabled:u,value:c,...s,ref:C,onKeyDown:we(t,N=>{N.key==="Enter"&&N.preventDefault()}),onClick:we(n,N=>{v(_=>vs(_)?!0:!_),S&&x&&(b.current=N.isPropagationStopped(),b.current||N.stopPropagation())})})});Lb.displayName=Ob;var Im=p.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:s,checked:o,defaultChecked:l,required:c,disabled:u,value:h,onCheckedChange:f,form:g,...v}=e;return i.jsx(JI,{__scopeCheckbox:n,checked:o,defaultChecked:l,disabled:u,required:c,onCheckedChange:f,name:s,form:g,value:h,internal_do_not_use_render:({isFormControl:b})=>i.jsxs(i.Fragment,{children:[i.jsx(Lb,{...v,ref:t,__scopeCheckbox:n}),b&&i.jsx(Ub,{__scopeCheckbox:n})]})})});Im.displayName=gd;var Mb="CheckboxIndicator",$b=p.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:s,...o}=e,l=Rm(Mb,n);return i.jsx($n,{present:s||vs(l.checked)||l.checked===!0,children:i.jsx(Me.span,{"data-state":Bb(l.checked),"data-disabled":l.disabled?"":void 0,...o,ref:t,style:{pointerEvents:"none",...e.style}})})});$b.displayName=Mb;var Fb="CheckboxBubbleInput",Ub=p.forwardRef(({__scopeCheckbox:e,...t},n)=>{const{control:s,hasConsumerStoppedPropagationRef:o,checked:l,defaultChecked:c,required:u,disabled:h,name:f,value:g,form:v,bubbleInput:b,setBubbleInput:x}=Rm(Fb,e),S=Ye(n,x),C=Db(l),w=e0(s);p.useEffect(()=>{const _=b;if(!_)return;const j=window.HTMLInputElement.prototype,R=Object.getOwnPropertyDescriptor(j,"checked").set,A=!o.current;if(C!==l&&R){const I=new Event("click",{bubbles:A});_.indeterminate=vs(l),R.call(_,vs(l)?!1:l),_.dispatchEvent(I)}},[b,C,l,o]);const N=p.useRef(vs(l)?!1:l);return i.jsx(Me.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??N.current,required:u,disabled:h,name:f,value:g,form:v,...t,tabIndex:-1,ref:S,style:{...t.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Ub.displayName=Fb;function QI(e){return typeof e=="function"}function vs(e){return e==="indeterminate"}function Bb(e){return vs(e)?"indeterminate":e?"checked":"unchecked"}const zb=p.forwardRef(({className:e,...t},n)=>i.jsx(Im,{ref:n,className:Ce("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:i.jsx($b,{className:Ce("flex items-center justify-center text-current"),children:i.jsx(er,{className:"h-4 w-4"})})}));zb.displayName=Im.displayName;const vr=p.forwardRef(({className:e,type:t,...n},s)=>i.jsx("input",{type:t,className:Ce("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-base file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...n}));vr.displayName="Input";var XI="Label",Hb=p.forwardRef((e,t)=>i.jsx(Me.label,{...e,ref:t,onMouseDown:n=>{n.target.closest("button, input, select, textarea")||(e.onMouseDown?.(n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));Hb.displayName=XI;var Vb=Hb;const ZI=nd("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Dm=p.forwardRef(({className:e,...t},n)=>i.jsx(Vb,{ref:n,className:Ce(ZI(),e),...t}));Dm.displayName=Vb.displayName;function Yn(e,t={}){const n={type:e,userId:t.userId,email:t.email,ip:void 0,userAgent:navigator.userAgent,timestamp:Date.now(),metadata:t.metadata,severity:t.severity||nD(e)};try{const s=tD();s.push(n),s.length>100&&s.shift(),localStorage.setItem("kch_audit_logs",JSON.stringify(s))}catch{}eD().catch(()=>{})}async function eD(e){}function tD(){try{const e=localStorage.getItem("kch_audit_logs");return e?JSON.parse(e):[]}catch{return[]}}function nD(e){switch(e){case"login_attempt":case"logout":case"signup":return"low";case"login_failed":case"rate_limit_exceeded":case"data_access":return"medium";case"login_locked":case"account_locked":case"bot_detected":case"permission_denied":return"high";case"suspicious_activity":return"critical";default:return"medium"}}function dw(){const e=[];let t=0;const n=navigator.userAgent.toLowerCase();["headless","phantom","selenium","webdriver","puppeteer","playwright","scrapy","bot","crawler","spider"].some(l=>n.includes(l))&&(e.push("Bot user agent detected"),t+=50),!window.chrome&&!window.safari&&!window.firefox&&(e.push("Missing browser vendor object"),t+=20),navigator.webdriver&&(e.push("WebDriver property detected"),t+=40),navigator.plugins.length===0&&(e.push("No browser plugins detected"),t+=15),navigator.languages.length===0&&(e.push("No browser languages detected"),t+=10),navigator.permissions||(e.push("Permissions API missing"),t+=10),(window.screen.width===0||window.screen.height===0)&&(e.push("Invalid screen dimensions"),t+=20);try{const l=document.createElement("canvas");l.getContext("webgl")||l.getContext("experimental-webgl")||(e.push("WebGL not supported"),t+=10)}catch{e.push("WebGL check failed"),t+=5}return(window.__nightmare||window.__phantomas)&&(e.push("Automation framework detected"),t+=30),{isBot:t>=30,confidence:Math.min(100,t),reasons:e}}class rD{mouseMovements=[];clicks=[];keystrokes=[];scrolls=[];pageViews=[];startTime=Date.now();constructor(){this.setupTracking()}setupTracking(){document.addEventListener("mousemove",()=>{this.mouseMovements.push(Date.now()),this.mouseMovements.length>100&&this.mouseMovements.shift()}),document.addEventListener("click",()=>{this.clicks.push(Date.now()),this.clicks.length>50&&this.clicks.shift()}),document.addEventListener("keydown",()=>{this.keystrokes.push(Date.now()),this.keystrokes.length>100&&this.keystrokes.shift()});let t;window.addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(()=>{this.scrolls.push(Date.now()),this.scrolls.length>50&&this.scrolls.shift()},100)})}analyzeBehavior(){const t=[];let n=0;const l=(Date.now()-this.startTime)/6e4;if(this.mouseMovements.length===0&&l>.5&&(t.push("No mouse movement detected"),n+=30),this.pageViews.length>10&&l<1&&(t.push("Rapid page switching"),n+=25),this.mouseMovements.length+this.clicks.length+this.keystrokes.length===0&&l>1&&(t.push("No user interactions"),n+=40),this.clicks.length>5){const u=[];for(let g=1;g<this.clicks.length;g++)u.push(this.clicks[g]-this.clicks[g-1]);const h=u.reduce((g,v)=>g+v,0)/u.length;u.reduce((g,v)=>g+Math.pow(v-h,2),0)/u.length<100&&(t.push("Mechanical timing pattern"),n+=20)}return{isSuspicious:n>=30,score:Math.min(100,n),reasons:t}}recordPageView(){this.pageViews.push(Date.now()),this.pageViews.length>20&&this.pageViews.shift()}getInteractionScore(){const t=this.mouseMovements.length+this.clicks.length+this.keystrokes.length+this.scrolls.length,n=(Date.now()-this.startTime)/6e4;return Math.min(100,t/Math.max(1,n)*10)}}let _c=null;function sD(){return _c||(_c=new rD),_c}function aD(){return _c}const qb="kch_csrf_token",iD=3600*1e3;function oD(){const e=new Uint8Array(32);crypto.getRandomValues(e);const t=Array.from(e,s=>s.toString(16).padStart(2,"0")).join(""),n={token:t,expiresAt:Date.now()+iD};try{sessionStorage.setItem(qb,JSON.stringify(n))}catch{window.__csrfToken=n}return t}function lD(){try{const e=sessionStorage.getItem(qb);if(e){const t=JSON.parse(e);if(t.expiresAt>Date.now())return t.token}}catch{const e=window.__csrfToken;if(e&&e.expiresAt>Date.now())return e.token}return oD()}function Fh(e){return typeof e!="string"?String(e):e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim()}function Nc(e){return!e||typeof e!="string"?!1:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())}const cD=["password","123456","12345678","123456789","1234567890","qwerty","abc123","password1","password123","admin","letmein","welcome","monkey","1234567","sunshine","princess","qwerty123","solo","passw0rd","starwars","abcdef","qwertyuiop","asdfgh","zxcvbn","123qwe","qwerty12","1qaz2wsx","qazwsxedc","1q2w3e4r","qwe123","1234qwer","qwer1234","abcd1234","1234abcd","qwerty1","Password1","Welcome123","Admin123","Test1234","Password123","Passw0rd","P@ssw0rd","P@ssword1","Pass1234","Admin1234","Welcome1","Test123","Password12","Admin1","Welcome12","iloveyou","trustno1","dragon","master","hello","freedom","whatever","qazwsx","michael","football","baseball","shadow","superman","qwertyui","michael1","jordan23","harley","hunter","buster","thomas","tigger","robert","soccer","batman","taylor","killer","hockey","jordan","michelle","charlie","andrew","joshua","matthew","jessica","daniel","anthony","jennifer","joshua1","liverpool","chelsea","james123","robert1","michael1","william1","david1","richard1","joseph1","thomas1","charles1","christopher1","daniel1","matthew1","anthony1","mark1","donald1","steven1","paul1","andrew1","joshua1","kenneth1","kevin1","brian1","george1","timothy1","ronald1","jason1","edward1","jeffrey1","ryan1","jacob1","gary1","nicholas1","eric1","jonathan1","stephen1","larry1","justin1","scott1","brandon1","benjamin1","samuel1","frank1","gregory1","raymond1","alexander1","patrick1","jack1","dennis1","jerry1","tyler1","aaron1","jose1","henry1","adam1","douglas1","nathan1","zachary1","kyle1","noah1","alan1","arsenal","manchester","liverpool","chelsea","barcelona","real","madrid","juventus","milan","bayern","dortmund","psg","atletico","valencia","sevilla","111111","222222","333333","444444","555555","666666","777777","888888","999999","000000","aaaaaa","bbbbbb","cccccc","dddddd","eeeeee","ffffff","gggggg","hhhhhh","iiiiii","jjjjjj","password2020","password2021","password2022","password2023","password2024","welcome2020","welcome2021","welcome2022","welcome2023","welcome2024","admin2020","admin2021","admin2022","admin2023","admin2024","1q2w3e4r","qwertyui","asdfghjk","zxcvbnm","qwerty1","asdf1234","zxcv1234","qwer1234","asdfqwer","qwertyuiop","p@ssw0rd","p@ssword","p@55w0rd","p@55word","p@ssw0rd1","w3lc0m3","w3lcome","welc0me","welcome1","welc0me1","adm1n","admin1","admin1","adm1n1","admin123","123abc","abc123","123abc123","abc123abc","1234abcd","abcd1234","12345a","a12345","12345ab","ab12345","iloveyou1","iloveyou123","trustno1","trustno11","trustno123","letmein1","letmein123","welcome1","welcome123","hello123","changeme","changeme1","changeme123","default","default1","newpassword","newpassword1","newpassword123","temp","temp123","test","test1","test123","testing","testing123","ninja","mustang","access","flower","55555","michael","shadow","master","jennifer","jordan","superman","harley","hunter","buster","soccer","tigger","batman","thomas","hockey","killer","ranger","daniel","hannah","maggie","jessie","charlie","summer","winter","spring","autumn","qwerty1","qwerty12","qwerty123","qwerty1234","qwertyui","asdfgh1","asdfgh12","zxcvbn1","zxcvbn12","123456a","a123456","123456ab","ab123456","123456abc","abc123456"];function dD(e){const t=[];if(!e||typeof e!="string")return{valid:!1,errors:["Password is required"]};e.length<8&&t.push("Password must be at least 8 characters"),e.length>128&&t.push("Password must be less than 128 characters");const n=/[A-Z]/.test(e),s=/[a-z]/.test(e),o=/[0-9]/.test(e),l=/[[\]!@#$%^&*()_+\-={};':"|<>?,./`~]/.test(e);return n||t.push("Password must contain at least one uppercase letter"),s||t.push("Password must contain at least one lowercase letter"),o||t.push("Password must contain at least one digit"),l||t.push("Password must contain at least one symbol (!@#$%^&*()_+-=[]{};':\"|<>?,./`~)"),cD.includes(e.toLowerCase())&&t.push("Password is too common. Please choose a more unique password."),{valid:t.length===0,errors:t}}function uD(e){return!e||typeof e!="string"?!1:/^[A-Z0-9]{3,6}-[a-z]+-\d{1,2}$/i.test(e.trim())}function hD(e){const t={},n={};if(e.email!==void 0){const s=Fh(e.email);n.email=s,Nc(s)||(t.email=["Invalid email format"])}if(e.password!==void 0){const s=e.password;n.password=s;const o=dD(s);o.valid||(t.password=o.errors)}if(e.name!==void 0){const s=Fh(e.name);n.name=s,s.length<1&&(t.name=["Name is required"]),s.length>100&&(t.name=["Name must be less than 100 characters"])}if(e.code!==void 0){const s=Fh(e.code);n.code=s,uD(s)||(t.code=["Invalid login code format"])}return{valid:Object.keys(t).length===0,errors:t,sanitized:n}}async function fD(e){const n=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-1",n);return Array.from(new Uint8Array(s)).map(l=>l.toString(16).padStart(2,"0")).join("").toUpperCase()}async function mD(e){try{const t=await fD(e),n=t.substring(0,5),s=t.substring(5),o=await fetch(`https://api.pwnedpasswords.com/range/${n}`,{method:"GET",headers:{"User-Agent":"KidsCallHome-PasswordChecker/1.0"}});if(!o.ok)return console.warn("HaveIBeenPwned API unavailable, skipping breach check"),!1;const c=(await o.text()).split(/\r?\n/);for(const u of c){const h=u.trim();if(!h)continue;const[f]=h.split(":");if(f&&f.toUpperCase()===s)return!0}return!1}catch(t){return console.warn("Error checking password breach status:",t),!1}}const pD=["password","123456","12345678","123456789","1234567890","qwerty","abc123","password1","password123","admin","letmein","welcome","monkey","1234567","sunshine","princess","qwerty123","solo","passw0rd","starwars","abcdef","qwertyuiop","asdfgh","zxcvbn","123qwe","qwerty12","1qaz2wsx","qazwsxedc","1q2w3e4r","qwe123","1234qwer","qwer1234","abcd1234","1234abcd","qwerty1","Password1","Welcome123","Admin123","Test1234","Password123","Passw0rd","P@ssw0rd","P@ssword1","Pass1234","Admin1234","Welcome1","Test123","Password12","Admin1","Welcome12","iloveyou","trustno1","dragon","master","hello","freedom","whatever","qazwsx","michael","football","baseball","shadow","superman","qwertyui","michael1","jordan23","harley","hunter","buster","thomas","tigger","robert","soccer","batman","taylor","killer","hockey","jordan","michelle","charlie","andrew","joshua","matthew","jessica","daniel","anthony","jennifer","joshua1","liverpool","chelsea","james123","robert1","michael1","william1","david1","richard1","joseph1","thomas1","charles1","christopher1","daniel1","matthew1","anthony1","mark1","donald1","steven1","paul1","andrew1","joshua1","kenneth1","kevin1","brian1","george1","timothy1","ronald1","jason1","edward1","jeffrey1","ryan1","jacob1","gary1","nicholas1","eric1","jonathan1","stephen1","larry1","justin1","scott1","brandon1","benjamin1","samuel1","frank1","gregory1","raymond1","alexander1","patrick1","jack1","dennis1","jerry1","tyler1","aaron1","jose1","henry1","adam1","douglas1","nathan1","zachary1","kyle1","noah1","alan1","arsenal","manchester","liverpool","chelsea","barcelona","real","madrid","juventus","milan","bayern","dortmund","psg","atletico","valencia","sevilla","111111","222222","333333","444444","555555","666666","777777","888888","999999","000000","aaaaaa","bbbbbb","cccccc","dddddd","eeeeee","ffffff","gggggg","hhhhhh","iiiiii","jjjjjj","password2020","password2021","password2022","password2023","password2024","welcome2020","welcome2021","welcome2022","welcome2023","welcome2024","admin2020","admin2021","admin2022","admin2023","admin2024","1q2w3e4r","qwertyui","asdfghjk","zxcvbnm","qwerty1","asdf1234","zxcv1234","qwer1234","asdfqwer","qwertyuiop","p@ssw0rd","p@ssword","p@55w0rd","p@55word","p@ssw0rd1","w3lc0m3","w3lcome","welc0me","welcome1","welc0me1","adm1n","admin1","admin1","adm1n1","admin123","123abc","abc123","123abc123","abc123abc","1234abcd","abcd1234","12345a","a12345","12345ab","ab12345","iloveyou1","iloveyou123","trustno1","trustno11","trustno123","letmein1","letmein123","welcome1","welcome123","hello123","changeme","changeme1","changeme123","default","default1","newpassword","newpassword1","newpassword123","temp","temp123","test","test1","test123","testing","testing123","ninja","mustang","access","flower","55555","michael","shadow","master","jennifer","jordan","superman","harley","hunter","buster","soccer","tigger","batman","thomas","hockey","killer","ranger","daniel","hannah","maggie","jessie","charlie","summer","winter","spring","autumn","qwerty1","qwerty12","qwerty123","qwerty1234","qwertyui","asdfgh1","asdfgh12","zxcvbn1","zxcvbn12","123456a","a123456","123456ab","ab123456","123456abc","abc123456"];async function uw(e,t=!0){const n=[];if(!e||typeof e!="string")return{valid:!1,errors:["Password is required"]};e.length<8&&n.push("Password must be at least 8 characters"),e.length>128&&n.push("Password must be less than 128 characters");const s=/[A-Z]/.test(e),o=/[a-z]/.test(e),l=/[0-9]/.test(e),c=/[[\]!@#$%^&*()_+\-={};':"|<>?,./`~]/.test(e);if(s||n.push("Password must contain at least one uppercase letter"),o||n.push("Password must contain at least one lowercase letter"),l||n.push("Password must contain at least one digit"),c||n.push("Password must contain at least one symbol (!@#$%^&*()_+-=[]{};':\"|<>?,./`~)"),pD.includes(e.toLowerCase())&&n.push("Password is too common. Please choose a more unique password."),n.length>0)return{valid:!1,errors:n};if(t)try{if(await mD(e))return n.push("This password has been found in data breaches. Please choose a different password."),{valid:!1,errors:n,isPwned:!0}}catch(u){console.warn("Breach check failed, allowing password:",u)}return{valid:n.length===0,errors:n,isPwned:!1}}async function gD(e,t){try{if(!e||typeof e!="string")return{isPwned:!1};const n=encodeURIComponent(e.trim().toLowerCase()),s={"User-Agent":"KidsCallHome-EmailChecker/1.0"},o=await fetch(`https://haveibeenpwned.com/api/v3/breachedaccount/${n}?truncateResponse=false`,{method:"GET",headers:s});if(o.status===404)return{isPwned:!1};if(o.status===429)return console.warn("HaveIBeenPwned rate limit reached - allowing signup to proceed"),{isPwned:!1};if(o.status===400)return{isPwned:!1};if(!o.ok)return console.warn("HaveIBeenPwned API error:",o.status,o.statusText,"- allowing signup"),{isPwned:!1};const l=await o.json();return Array.isArray(l)&&l.length>0?{isPwned:!0,breachCount:l.length,breaches:l.map(c=>({Name:c.Name||"Unknown",BreachDate:c.BreachDate||"Unknown",AddedDate:c.AddedDate||"Unknown"}))}:{isPwned:!1}}catch(n){return console.warn("Email breach check failed (network/error) - allowing signup:",n),{isPwned:!1}}}const Wb="kch_rate_limits",Gb="kch_failed_logins",vd={login:{maxAttempts:5,windowMs:60*1e3,lockoutDurationMs:900*1e3},childLogin:{maxAttempts:10,windowMs:60*1e3,lockoutDurationMs:300*1e3},apiCall:{maxAttempts:100,windowMs:60*1e3}};function Om(){try{const e=localStorage.getItem(Wb);return e?JSON.parse(e):{}}catch{return{}}}function Lm(e){try{localStorage.setItem(Wb,JSON.stringify(e))}catch{}}function Mm(){try{const e=localStorage.getItem(Gb);return e?JSON.parse(e):{}}catch{return{}}}function Kb(e){try{localStorage.setItem(Gb,JSON.stringify(e))}catch{}}function vD(e,t="apiCall"){const n=vd[t],s=Om(),o=Date.now(),l=s[e];if(l?.lockedUntil&&l.lockedUntil>o)return{allowed:!1,lockedUntil:l.lockedUntil};if(!l||l.resetAt<o)return{allowed:!0};if(l.count>=n.maxAttempts){if(t==="login"&&n.lockoutDurationMs){const c=o+n.lockoutDurationMs;return s[e]={count:l.count,resetAt:l.resetAt,lockedUntil:c},Lm(s),{allowed:!1,lockedUntil:c}}return{allowed:!1,resetAt:l.resetAt}}return{allowed:!0}}function yD(e,t="apiCall"){const n=vd[t],s=Om(),o=Date.now(),l=s[e];!l||l.resetAt<o?s[e]={count:1,resetAt:o+n.windowMs}:s[e]={...l,count:l.count+1},Lm(s)}function wD(e){const t=Mm(),n=Date.now(),s=vd.login,o=t[e];let l=1,c;return!o||n-o.lastAttempt>s.windowMs?l=1:l=o.attempts+1,l>=s.maxAttempts&&s.lockoutDurationMs&&(c=n+s.lockoutDurationMs),t[e]={email:e,attempts:l,lastAttempt:n,lockedUntil:c},Kb(t),{attempts:l,locked:!!c,lockedUntil:c}}function xD(e){const t=Mm();delete t[e],Kb(t);const n=Om();delete n[`login:${e}`],Lm(n)}function hw(e){const n=Mm()[e],s=Date.now(),o=vd.login;if(!n)return{locked:!1};if(n.lockedUntil&&n.lockedUntil>s)return{locked:!0,lockedUntil:n.lockedUntil,attemptsRemaining:0};if(s-n.lastAttempt>o.windowMs)return{locked:!1};const l=o.maxAttempts-n.attempts;return{locked:!1,attemptsRemaining:Math.max(0,l)}}function bD(e,t){return`${t}:${e}`}const CD=["password","Password","PASSWORD","passwd","pwd","secret","Secret","SECRET","token","Token","TOKEN","apiKey","api_key","apikey","accessToken","access_token","refreshToken","refresh_token","authToken","auth_token","sessionToken","session_token","privateKey","private_key","privatekey","secretKey","secret_key","secretkey","authorization","Authorization","AUTHORIZATION","cookie","Cookie","COOKIE","session","Session","SESSION","credential","credentials","Credential","Credentials","CREDENTIALS"],Yb=[/password/i,/passwd/i,/secret/i,/token/i,/key/i,/credential/i,/auth/i,/session/i,/cookie/i];function Mt(e,t={}){const{maskValue:n=!0,removeField:s=!1}=t;if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map(l=>Mt(l,t));if(e instanceof Date)return e;if(e instanceof Error)return{name:e.name,message:e.message,stack:"[REDACTED]"};const o={};for(const[l,c]of Object.entries(e))if(CD.includes(l)||Yb.some(h=>h.test(l))){if(s)continue;n&&(o[l]="[REDACTED]")}else c&&typeof c=="object"?o[l]=Mt(c,t):o[l]=c;return o}function Uh(e){return!e||typeof e!="string"?e:Yb.some(n=>n.test(e))&&e.length>20?"[REDACTED]":e}const k={log:(...e)=>{{const t=e.map(n=>typeof n=="object"&&n!==null?Mt(n,{maskValue:!0,removeField:!1}):typeof n=="string"?Uh(n):n);console.log(...t)}},error:(...e)=>{const t=e.map(n=>n instanceof Error?{name:n.name,message:n.message,stack:"[REDACTED]"}:typeof n=="object"&&n!==null?Mt(n,{maskValue:!0,removeField:!1}):typeof n=="string"?Uh(n):n);console.error(...t)},warn:(...e)=>{const t=e.map(n=>typeof n=="object"&&n!==null?Mt(n,{maskValue:!0,removeField:!1}):typeof n=="string"?Uh(n):n);console.warn(...t)},debug:(...e)=>{}};function Ge(e){return e instanceof Error?{name:e.name,message:e.message,stack:void 0,...e.code&&{code:e.code},...e.details&&{details:Mt(e.details)}}:typeof e=="object"&&e!==null?{message:"Unknown error",...Mt(e)}:{message:String(e)}}const fw=(e,t,n=365)=>{const s=new Date;s.setTime(s.getTime()+n*24*60*60*1e3),document.cookie=`${e}=${t};expires=${s.toUTCString()};path=/`},SD=e=>{const t=e+"=",n=document.cookie.split(";");for(let s=0;s<n.length;s++){let o=n[s];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(t)===0)return o.substring(t.length,o.length)}return null},ED=()=>{const[e,t]=p.useState(!0),[n,s]=p.useState(""),[o,l]=p.useState(""),[c,u]=p.useState(""),[h,f]=p.useState(!0),[g,v]=p.useState(!1),[b,x]=p.useState(null),[S,C]=p.useState(null),[w,N]=p.useState(!1),[_,j]=p.useState(null),[T,R]=p.useState(!1),[A,I]=p.useState(null),[L,Z]=p.useState(!1),[M,U]=p.useState(null),D=rt(),{toast:B}=_t(),z=p.useRef(null),q="";p.useEffect(()=>{sD();const Q=dw();Q.isBot&&(k.warn("Bot detected:",Q),Yn("bot_detected",{metadata:{reasons:Q.reasons,confidence:Q.confidence},severity:"high"}));const $=localStorage.getItem("staySignedIn");$!==null&&f($==="true");const O=SD("parentName");O&&x(O)},[]),p.useEffect(()=>{if(e&&n){const Q=hw(n);j(Q),Q.attemptsRemaining!==void 0&&Q.attemptsRemaining<=3&&N(!0)}else j(null),N(!1)},[n,e]),p.useEffect(()=>{if(e||!o||o.length<8){I(null);return}const Q=setTimeout(async()=>{R(!0),I("checking");try{const $=await uw(o);R(!1),$.isPwned?I("breached"):$.valid?I("safe"):I(null)}catch{R(!1),I(null)}},800);return()=>clearTimeout(Q)},[o,e]),p.useEffect(()=>{if(e||!n||!Nc(n)){U(null);return}const Q=setTimeout(async()=>{Z(!0);try{const O=await gD(n,void 0);Z(!1),O.isPwned?U({isPwned:!0,breachCount:O.breachCount,breaches:O.breaches}):U({isPwned:!1})}catch{Z(!1),U(null)}},2e3);return()=>clearTimeout(Q)},[n,e]);const H=async Q=>{Q.preventDefault(),v(!0),C(null);try{const $=hD({email:e?n:void 0,password:o,name:e?void 0:c});if(!$.valid){const K=Object.values($.errors)[0]?.[0];B({title:"Validation Error",description:K||"Please check your input",variant:"destructive"});return}const O=$.sanitized.email||n,J=$.sanitized.password||o;if(!e){if(A==="breached"){B({title:"Password Security Issue",description:"This password has been found in data breaches and is unsafe to use. Please choose a unique password with a mix of letters, numbers, and symbols.",variant:"destructive",duration:8e3});return}if(A!=="safe"){R(!0),I("checking");try{const K=await uw(J);if(R(!1),K.valid)I("safe");else{if(K.isPwned)I("breached"),B({title:"Password Security Issue",description:"This password has been found in data breaches and is unsafe to use. Please choose a unique password with a mix of letters, numbers, and symbols.",variant:"destructive",duration:8e3});else{const W=K.errors[0];B({title:"Password Validation Error",description:W||"Please choose a stronger password",variant:"destructive"})}return}}catch(K){R(!1),I(null),k.warn("Breach check failed:",Ge(K))}}}const F=bD(O,"login"),ee=vD(F,"login");if(!ee.allowed)if(ee.lockedUntil){const K=Math.ceil((ee.lockedUntil-Date.now())/6e4);B({title:"Account Temporarily Locked",description:`Too many login attempts. Please try again in ${K} minute(s).`,variant:"destructive"}),Yn("login_locked",{email:O,severity:"high"});return}else{B({title:"Too Many Attempts",description:"Please wait before trying again.",variant:"destructive"}),Yn("rate_limit_exceeded",{email:O,severity:"medium"});return}if(e){const K=hw(O);if(K.locked&&K.lockedUntil){const W=Math.ceil((K.lockedUntil-Date.now())/6e4);B({title:"Account Locked",description:`Account is locked due to multiple failed attempts. Try again in ${W} minute(s).`,variant:"destructive"}),j(K),Yn("account_locked",{email:O,severity:"high"});return}}const ce=dw();if(ce.isBot&&ce.confidence>50){const W=aD()?.analyzeBehavior();if(W?.isSuspicious){B({title:"Security Check Failed",description:"Unable to verify you're human. Please try again.",variant:"destructive"}),Yn("bot_detected",{email:O,metadata:{botReasons:ce.reasons,behaviorReasons:W.reasons},severity:"high"});return}}if(yD(F,"login"),localStorage.setItem("staySignedIn",h.toString()),h?sessionStorage.removeItem("clearSessionOnClose"):sessionStorage.setItem("clearSessionOnClose","true"),e){Yn("login_attempt",{email:O,severity:"low"});const{data:{user:K},error:W}=await Y.auth.signInWithPassword({email:O,password:J});if(W){const ne=wD(O);if(k.error("Auth error:",Ge(W)),Yn("login_failed",{email:O,metadata:{attempts:ne.attempts},severity:"medium"}),ne.locked&&ne.lockedUntil){const G=Math.ceil((ne.lockedUntil-Date.now())/6e4);B({title:"Account Locked",description:`Too many failed attempts. Account locked for ${G} minute(s).`,variant:"destructive"}),j({locked:!0,lockedUntil:ne.lockedUntil}),Yn("account_locked",{email:O,severity:"high"})}else{const G=5-ne.attempts;B({title:"Login Failed",description:G>0?`Invalid credentials. ${G} attempt(s) remaining.`:"Invalid credentials.",variant:"destructive"}),ne.attempts>=2&&N(!0)}throw W}if(xD(O),Yn("login_success",{userId:K?.id,email:O,severity:"low"}),K){const{data:ne}=await Y.from("parents").select("name").eq("id",K.id).maybeSingle();ne?.name&&fw("parentName",ne.name,365);try{const{generateDeviceIdentifierAsync:G,detectDeviceType:ae,getDeviceName:fe,getClientIP:ve,getDeviceMacAddress:xe,getCountryFromIP:Ie}=await xr(async()=>{const{generateDeviceIdentifierAsync:je,detectDeviceType:ze,getDeviceName:dt,getClientIP:Je,getDeviceMacAddress:pt,getCountryFromIP:st}=await Promise.resolve().then(()=>Ff);return{generateDeviceIdentifierAsync:je,detectDeviceType:ze,getDeviceName:dt,getClientIP:Je,getDeviceMacAddress:pt,getCountryFromIP:st}},void 0),$e=await G(),Ke=ae(),Ve=fe(),ie=navigator.userAgent,Re=await ve(),le=await xe(),ye=await Ie(Re);await Y.rpc("update_device_login",{p_parent_id:K.id,p_device_identifier:$e,p_device_name:Ve,p_device_type:Ke,p_user_agent:ie,p_ip_address:Re||null,p_mac_address:le||null,p_country_code:ye||null,p_child_id:null})}catch(G){console.warn("Device tracking failed:",G)}}B({title:"Welcome back!"}),D("/parent/children")}else{Yn("signup",{email:O,severity:"low"});const{error:K}=await Y.auth.signUp({email:O,password:J,options:{data:{name:$.sanitized.name||c},emailRedirectTo:`${window.location.origin}/parent/children`}});if(K)throw k.error("Signup error:",Ge(K)),Yn("signup",{email:O,metadata:{error:K.message},severity:"medium"}),K;($.sanitized.name||c)&&fw("parentName",$.sanitized.name||c,365),B({title:"Account created! Welcome!"}),D("/parent/children")}}catch($){const O=Ge($);k.error("Auth operation failed:",O),$ instanceof Error&&$.message.includes("locked")||B({title:"Error",description:$ instanceof Error?$.message:"An unexpected error occurred",variant:"destructive"})}finally{v(!1),R(!1),l(""),I(null),C(null)}};return i.jsx("div",{className:"min-h-[100dvh] flex items-center justify-center bg-background p-4",children:i.jsxs(Ae,{className:"w-full max-w-md p-8 space-y-6",children:[i.jsxs("div",{className:"text-center space-y-2",children:[i.jsx("div",{className:"flex justify-center",children:i.jsx("img",{src:"/icon-192x192.png",alt:"Kids Call Home",className:"h-12 w-12"})}),i.jsx("h1",{className:"text-3xl font-bold",children:"Kids Call Home"}),i.jsx("p",{className:"text-muted-foreground",children:e?b?`Welcome back, ${b}!`:"Welcome back, parent!":"Create your parent account"})]}),i.jsxs("form",{onSubmit:H,className:"space-y-4",children:[!e&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Your Name"}),i.jsx(vr,{type:"text",placeholder:"Mom / Dad / Guardian",value:c,onChange:Q=>u(Q.target.value),required:!e})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Email"}),i.jsxs("div",{className:"relative",children:[i.jsx(vr,{type:"email",placeholder:"parent@email.com",value:n,onChange:Q=>s(Q.target.value),required:!0}),!e&&i.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:[L&&i.jsx(fr,{className:"h-4 w-4 animate-spin text-muted-foreground"}),!L&&M?.isPwned&&i.jsx(Ks,{className:"h-4 w-4 text-amber-500"}),!L&&M?.isPwned===!1&&Nc(n)&&i.jsx(Zl,{className:"h-4 w-4 text-green-500"})]})]}),!e&&L&&i.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[i.jsx(fr,{className:"h-3 w-3 animate-spin"}),"Checking email security..."]}),!e&&M?.isPwned&&i.jsxs("div",{className:"text-xs text-amber-600 dark:text-amber-400 space-y-1",children:[i.jsxs("p",{className:"flex items-start gap-1",children:[i.jsx(Ks,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),i.jsxs("span",{className:"font-medium",children:["This email was found in"," ",M.breachCount||"multiple"," data breach(es)."]})]}),i.jsxs("p",{className:"pl-4 text-muted-foreground",children:["Your email was exposed in:"," ",M.breaches?.slice(0,3).map(Q=>Q.Name).join(", "),M.breachCount&&M.breachCount>3?` and ${M.breachCount-3} more`:""]}),i.jsxs("p",{className:"pl-4 text-muted-foreground",children:[i.jsx("strong",{children:"Security tip:"})," Use a strong, unique password and consider enabling two-factor authentication if available."]})]}),!e&&M?.isPwned===!1&&Nc(n)&&i.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:[i.jsx(Zl,{className:"h-3 w-3"}),"Email not found in known breaches"]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Password"}),i.jsxs("div",{className:"relative",children:[i.jsx(vr,{ref:z,type:"password",placeholder:"",value:o,onChange:Q=>{l(Q.target.value),e||I(null)},required:!0,minLength:6,autoComplete:e?"current-password":"new-password",className:!e&&A==="breached"?"pr-10 border-destructive focus-visible:ring-destructive":!e&&A==="safe"?"pr-10 border-green-500 focus-visible:ring-green-500":"",onBlur:()=>{}}),!e&&i.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:[T&&i.jsx(fr,{className:"h-4 w-4 animate-spin text-muted-foreground"}),!T&&A==="breached"&&i.jsx(Ks,{className:"h-4 w-4 text-destructive"}),!T&&A==="safe"&&o.length>=8&&i.jsx(Zl,{className:"h-4 w-4 text-green-500"})]})]}),!e&&T&&i.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[i.jsx(fr,{className:"h-3 w-3 animate-spin"}),"Checking password security..."]}),!e&&A==="breached"&&i.jsxs("p",{className:"text-xs text-destructive flex items-start gap-1",children:[i.jsx(Ks,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),"This password has been compromised in data breaches. Choose a unique password that you haven't used elsewhere."]}),!e&&A==="safe"&&o.length>=8&&i.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:[i.jsx(Zl,{className:"h-3 w-3"}),"Password looks secure!"]})]}),e&&i.jsxs(i.Fragment,{children:[_?.locked&&_.lockedUntil&&i.jsxs("div",{className:"flex items-start gap-2 p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[i.jsx(Ax,{className:"h-5 w-5 text-destructive mt-0.5"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-destructive",children:"Account Locked"}),i.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Too many failed login attempts. Please try again in"," ",Math.ceil((_.lockedUntil-Date.now())/6e4)," ","minute(s)."]})]})]}),_&&!_.locked&&_.attemptsRemaining!==void 0&&_.attemptsRemaining<5&&i.jsxs("div",{className:"flex items-start gap-2 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:[i.jsx(lo,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-yellow-700",children:"Security Notice"}),i.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[_.attemptsRemaining," attempt(s) remaining before account lockout."]})]})]}),w&&q,i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(zb,{id:"staySignedIn",checked:h,onCheckedChange:Q=>f(Q===!0)}),i.jsx(Dm,{htmlFor:"staySignedIn",className:"text-sm font-normal cursor-pointer",children:"Stay signed in"})]})]}),i.jsx("input",{type:"hidden",name:"csrf_token",value:lD()}),i.jsx(de,{type:"submit",className:"w-full",disabled:g||e&&_?.locked,children:g?"Processing...":e?i.jsxs(i.Fragment,{children:[i.jsx(Ej,{className:"mr-2 h-4 w-4"}),"Sign In"]}):i.jsxs(i.Fragment,{children:[i.jsx(Mj,{className:"mr-2 h-4 w-4"}),"Create Account"]})})]}),i.jsx("div",{className:"text-center",children:i.jsx("button",{type:"button",onClick:()=>t(!e),className:"text-sm text-primary hover:underline",children:e?"Need an account? Sign up":"Already have an account? Sign in"})})]})})};var Bh="focusScope.autoFocusOnMount",zh="focusScope.autoFocusOnUnmount",mw={bubbles:!1,cancelable:!0},_D="FocusScope",yd=p.forwardRef((e,t)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:o,onUnmountAutoFocus:l,...c}=e,[u,h]=p.useState(null),f=un(o),g=un(l),v=p.useRef(null),b=Ye(t,C=>h(C)),x=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(s){let C=function(j){if(x.paused||!u)return;const T=j.target;u.contains(T)?v.current=T:us(v.current,{select:!0})},w=function(j){if(x.paused||!u)return;const T=j.relatedTarget;T!==null&&(u.contains(T)||us(v.current,{select:!0}))},N=function(j){if(document.activeElement===document.body)for(const R of j)R.removedNodes.length>0&&us(u)};document.addEventListener("focusin",C),document.addEventListener("focusout",w);const _=new MutationObserver(N);return u&&_.observe(u,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",C),document.removeEventListener("focusout",w),_.disconnect()}}},[s,u,x.paused]),p.useEffect(()=>{if(u){gw.add(x);const C=document.activeElement;if(!u.contains(C)){const N=new CustomEvent(Bh,mw);u.addEventListener(Bh,f),u.dispatchEvent(N),N.defaultPrevented||(ND(PD(Jb(u)),{select:!0}),document.activeElement===C&&us(u))}return()=>{u.removeEventListener(Bh,f),setTimeout(()=>{const N=new CustomEvent(zh,mw);u.addEventListener(zh,g),u.dispatchEvent(N),N.defaultPrevented||us(C??document.body,{select:!0}),u.removeEventListener(zh,g),gw.remove(x)},0)}}},[u,f,g,x]);const S=p.useCallback(C=>{if(!n&&!s||x.paused)return;const w=C.key==="Tab"&&!C.altKey&&!C.ctrlKey&&!C.metaKey,N=document.activeElement;if(w&&N){const _=C.currentTarget,[j,T]=jD(_);j&&T?!C.shiftKey&&N===T?(C.preventDefault(),n&&us(j,{select:!0})):C.shiftKey&&N===j&&(C.preventDefault(),n&&us(T,{select:!0})):N===_&&C.preventDefault()}},[n,s,x.paused]);return i.jsx(Me.div,{tabIndex:-1,...c,ref:b,onKeyDown:S})});yd.displayName=_D;function ND(e,{select:t=!1}={}){const n=document.activeElement;for(const s of e)if(us(s,{select:t}),document.activeElement!==n)return}function jD(e){const t=Jb(e),n=pw(t,e),s=pw(t.reverse(),e);return[n,s]}function Jb(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const o=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||o?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function pw(e,t){for(const n of e)if(!kD(n,{upTo:t}))return n}function kD(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function TD(e){return e instanceof HTMLInputElement&&"select"in e}function us(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&TD(e)&&t&&e.select()}}var gw=AD();function AD(){let e=[];return{add(t){const n=e[0];t!==n&&n?.pause(),e=vw(e,t),e.unshift(t)},remove(t){e=vw(e,t),e[0]?.resume()}}}function vw(e,t){const n=[...e],s=n.indexOf(t);return s!==-1&&n.splice(s,1),n}function PD(e){return e.filter(t=>t.tagName!=="A")}var Hh=0;function $m(){p.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??yw()),document.body.insertAdjacentElement("beforeend",e[1]??yw()),Hh++,()=>{Hh===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),Hh--}},[])}function yw(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var jc="right-scroll-bar-position",kc="width-before-scroll-bar",RD="with-scroll-bars-hidden",ID="--removed-body-scroll-bar-size";function Vh(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function DD(e,t){var n=p.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(s){var o=n.value;o!==s&&(n.value=s,n.callback(s,o))}}}})[0];return n.callback=t,n.facade}var OD=typeof window<"u"?p.useLayoutEffect:p.useEffect,ww=new WeakMap;function LD(e,t){var n=DD(null,function(s){return e.forEach(function(o){return Vh(o,s)})});return OD(function(){var s=ww.get(n);if(s){var o=new Set(s),l=new Set(e),c=n.current;o.forEach(function(u){l.has(u)||Vh(u,null)}),l.forEach(function(u){o.has(u)||Vh(u,c)})}ww.set(n,e)},[e]),n}function MD(e){return e}function $D(e,t){t===void 0&&(t=MD);var n=[],s=!1,o={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(l){var c=t(l,s);return n.push(c),function(){n=n.filter(function(u){return u!==c})}},assignSyncMedium:function(l){for(s=!0;n.length;){var c=n;n=[],c.forEach(l)}n={push:function(u){return l(u)},filter:function(){return n}}},assignMedium:function(l){s=!0;var c=[];if(n.length){var u=n;n=[],u.forEach(l),c=n}var h=function(){var g=c;c=[],g.forEach(l)},f=function(){return Promise.resolve().then(h)};f(),n={push:function(g){c.push(g),f()},filter:function(g){return c=c.filter(g),n}}}};return o}function FD(e){e===void 0&&(e={});var t=$D(null);return t.options=Tn({async:!0,ssr:!1},e),t}var Qb=function(e){var t=e.sideCar,n=Ss(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return p.createElement(s,Tn({},n))};Qb.isSideCarExport=!0;function UD(e,t){return e.useMedium(t),Qb}var Xb=FD(),qh=function(){},wd=p.forwardRef(function(e,t){var n=p.useRef(null),s=p.useState({onScrollCapture:qh,onWheelCapture:qh,onTouchMoveCapture:qh}),o=s[0],l=s[1],c=e.forwardProps,u=e.children,h=e.className,f=e.removeScrollBar,g=e.enabled,v=e.shards,b=e.sideCar,x=e.noRelative,S=e.noIsolation,C=e.inert,w=e.allowPinchZoom,N=e.as,_=N===void 0?"div":N,j=e.gapMode,T=Ss(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),R=b,A=LD([n,t]),I=Tn(Tn({},T),o);return p.createElement(p.Fragment,null,g&&p.createElement(R,{sideCar:Xb,removeScrollBar:f,shards:v,noRelative:x,noIsolation:S,inert:C,setCallbacks:l,allowPinchZoom:!!w,lockRef:n,gapMode:j}),c?p.cloneElement(p.Children.only(u),Tn(Tn({},I),{ref:A})):p.createElement(_,Tn({},I,{className:h,ref:A}),u))});wd.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};wd.classNames={fullWidth:kc,zeroRight:jc};var BD=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function zD(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=BD();return t&&e.setAttribute("nonce",t),e}function HD(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function VD(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var qD=function(){var e=0,t=null;return{add:function(n){e==0&&(t=zD())&&(HD(t,n),VD(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},WD=function(){var e=qD();return function(t,n){p.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},Zb=function(){var e=WD(),t=function(n){var s=n.styles,o=n.dynamic;return e(s,o),null};return t},GD={left:0,top:0,right:0,gap:0},Wh=function(e){return parseInt(e||"",10)||0},KD=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],s=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[Wh(n),Wh(s),Wh(o)]},YD=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return GD;var t=KD(e),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-n+t[2]-t[0])}},JD=Zb(),qa="data-scroll-locked",QD=function(e,t,n,s){var o=e.left,l=e.top,c=e.right,u=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(RD,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(u,"px ").concat(s,`;
  }
  body[`).concat(qa,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(l,`px;
    padding-right: `).concat(c,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(u,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(u,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(jc,` {
    right: `).concat(u,"px ").concat(s,`;
  }
  
  .`).concat(kc,` {
    margin-right: `).concat(u,"px ").concat(s,`;
  }
  
  .`).concat(jc," .").concat(jc,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(kc," .").concat(kc,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(qa,`] {
    `).concat(ID,": ").concat(u,`px;
  }
`)},xw=function(){var e=parseInt(document.body.getAttribute(qa)||"0",10);return isFinite(e)?e:0},XD=function(){p.useEffect(function(){return document.body.setAttribute(qa,(xw()+1).toString()),function(){var e=xw()-1;e<=0?document.body.removeAttribute(qa):document.body.setAttribute(qa,e.toString())}},[])},ZD=function(e){var t=e.noRelative,n=e.noImportant,s=e.gapMode,o=s===void 0?"margin":s;XD();var l=p.useMemo(function(){return YD(o)},[o]);return p.createElement(JD,{styles:QD(l,!t,o,n?"":"!important")})},Df=!1;if(typeof window<"u")try{var hc=Object.defineProperty({},"passive",{get:function(){return Df=!0,!0}});window.addEventListener("test",hc,hc),window.removeEventListener("test",hc,hc)}catch{Df=!1}var Oa=Df?{passive:!1}:!1,eO=function(e){return e.tagName==="TEXTAREA"},eC=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!eO(e)&&n[t]==="visible")},tO=function(e){return eC(e,"overflowY")},nO=function(e){return eC(e,"overflowX")},bw=function(e,t){var n=t.ownerDocument,s=t;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var o=tC(e,s);if(o){var l=nC(e,s),c=l[1],u=l[2];if(c>u)return!0}s=s.parentNode}while(s&&s!==n.body);return!1},rO=function(e){var t=e.scrollTop,n=e.scrollHeight,s=e.clientHeight;return[t,n,s]},sO=function(e){var t=e.scrollLeft,n=e.scrollWidth,s=e.clientWidth;return[t,n,s]},tC=function(e,t){return e==="v"?tO(t):nO(t)},nC=function(e,t){return e==="v"?rO(t):sO(t)},aO=function(e,t){return e==="h"&&t==="rtl"?-1:1},iO=function(e,t,n,s,o){var l=aO(e,window.getComputedStyle(t).direction),c=l*s,u=n.target,h=t.contains(u),f=!1,g=c>0,v=0,b=0;do{if(!u)break;var x=nC(e,u),S=x[0],C=x[1],w=x[2],N=C-w-l*S;(S||N)&&tC(e,u)&&(v+=N,b+=S);var _=u.parentNode;u=_&&_.nodeType===Node.DOCUMENT_FRAGMENT_NODE?_.host:_}while(!h&&u!==document.body||h&&(t.contains(u)||t===u));return(g&&Math.abs(v)<1||!g&&Math.abs(b)<1)&&(f=!0),f},fc=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Cw=function(e){return[e.deltaX,e.deltaY]},Sw=function(e){return e&&"current"in e?e.current:e},oO=function(e,t){return e[0]===t[0]&&e[1]===t[1]},lO=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},cO=0,La=[];function dO(e){var t=p.useRef([]),n=p.useRef([0,0]),s=p.useRef(),o=p.useState(cO++)[0],l=p.useState(Zb)[0],c=p.useRef(e);p.useEffect(function(){c.current=e},[e]),p.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var C=Cm([e.lockRef.current],(e.shards||[]).map(Sw),!0).filter(Boolean);return C.forEach(function(w){return w.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),C.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var u=p.useCallback(function(C,w){if("touches"in C&&C.touches.length===2||C.type==="wheel"&&C.ctrlKey)return!c.current.allowPinchZoom;var N=fc(C),_=n.current,j="deltaX"in C?C.deltaX:_[0]-N[0],T="deltaY"in C?C.deltaY:_[1]-N[1],R,A=C.target,I=Math.abs(j)>Math.abs(T)?"h":"v";if("touches"in C&&I==="h"&&A.type==="range")return!1;var L=bw(I,A);if(!L)return!0;if(L?R=I:(R=I==="v"?"h":"v",L=bw(I,A)),!L)return!1;if(!s.current&&"changedTouches"in C&&(j||T)&&(s.current=R),!R)return!0;var Z=s.current||R;return iO(Z,w,C,Z==="h"?j:T)},[]),h=p.useCallback(function(C){var w=C;if(!(!La.length||La[La.length-1]!==l)){var N="deltaY"in w?Cw(w):fc(w),_=t.current.filter(function(R){return R.name===w.type&&(R.target===w.target||w.target===R.shadowParent)&&oO(R.delta,N)})[0];if(_&&_.should){w.cancelable&&w.preventDefault();return}if(!_){var j=(c.current.shards||[]).map(Sw).filter(Boolean).filter(function(R){return R.contains(w.target)}),T=j.length>0?u(w,j[0]):!c.current.noIsolation;T&&w.cancelable&&w.preventDefault()}}},[]),f=p.useCallback(function(C,w,N,_){var j={name:C,delta:w,target:N,should:_,shadowParent:uO(N)};t.current.push(j),setTimeout(function(){t.current=t.current.filter(function(T){return T!==j})},1)},[]),g=p.useCallback(function(C){n.current=fc(C),s.current=void 0},[]),v=p.useCallback(function(C){f(C.type,Cw(C),C.target,u(C,e.lockRef.current))},[]),b=p.useCallback(function(C){f(C.type,fc(C),C.target,u(C,e.lockRef.current))},[]);p.useEffect(function(){return La.push(l),e.setCallbacks({onScrollCapture:v,onWheelCapture:v,onTouchMoveCapture:b}),document.addEventListener("wheel",h,Oa),document.addEventListener("touchmove",h,Oa),document.addEventListener("touchstart",g,Oa),function(){La=La.filter(function(C){return C!==l}),document.removeEventListener("wheel",h,Oa),document.removeEventListener("touchmove",h,Oa),document.removeEventListener("touchstart",g,Oa)}},[]);var x=e.removeScrollBar,S=e.inert;return p.createElement(p.Fragment,null,S?p.createElement(l,{styles:lO(o)}):null,x?p.createElement(ZD,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function uO(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const hO=UD(Xb,dO);var xd=p.forwardRef(function(e,t){return p.createElement(wd,Tn({},e,{ref:t,sideCar:hO}))});xd.classNames=wd.classNames;var fO=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Ma=new WeakMap,mc=new WeakMap,pc={},Gh=0,rC=function(e){return e&&(e.host||rC(e.parentNode))},mO=function(e,t){return t.map(function(n){if(e.contains(n))return n;var s=rC(n);return s&&e.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},pO=function(e,t,n,s){var o=mO(t,Array.isArray(e)?e:[e]);pc[n]||(pc[n]=new WeakMap);var l=pc[n],c=[],u=new Set,h=new Set(o),f=function(v){!v||u.has(v)||(u.add(v),f(v.parentNode))};o.forEach(f);var g=function(v){!v||h.has(v)||Array.prototype.forEach.call(v.children,function(b){if(u.has(b))g(b);else try{var x=b.getAttribute(s),S=x!==null&&x!=="false",C=(Ma.get(b)||0)+1,w=(l.get(b)||0)+1;Ma.set(b,C),l.set(b,w),c.push(b),C===1&&S&&mc.set(b,!0),w===1&&b.setAttribute(n,"true"),S||b.setAttribute(s,"true")}catch(N){console.error("aria-hidden: cannot operate on ",b,N)}})};return g(t),u.clear(),Gh++,function(){c.forEach(function(v){var b=Ma.get(v)-1,x=l.get(v)-1;Ma.set(v,b),l.set(v,x),b||(mc.has(v)||v.removeAttribute(s),mc.delete(v)),x||v.removeAttribute(n)}),Gh--,Gh||(Ma=new WeakMap,Ma=new WeakMap,mc=new WeakMap,pc={})}},Fm=function(e,t,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(e)?e:[e]),o=fO(e);return o?(s.push.apply(s,Array.from(o.querySelectorAll("[aria-live]"))),pO(s,o,n,"aria-hidden")):function(){return null}},bd="Dialog",[sC,aC]=Mn(bd),[gO,sr]=sC(bd),iC=e=>{const{__scopeDialog:t,children:n,open:s,defaultOpen:o,onOpenChange:l,modal:c=!0}=e,u=p.useRef(null),h=p.useRef(null),[f,g]=ys({prop:s,defaultProp:o??!1,onChange:l,caller:bd});return i.jsx(gO,{scope:t,triggerRef:u,contentRef:h,contentId:pr(),titleId:pr(),descriptionId:pr(),open:f,onOpenChange:g,onOpenToggle:p.useCallback(()=>g(v=>!v),[g]),modal:c,children:n})};iC.displayName=bd;var oC="DialogTrigger",lC=p.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=sr(oC,n),l=Ye(t,o.triggerRef);return i.jsx(Me.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":zm(o.open),...s,ref:l,onClick:we(e.onClick,o.onOpenToggle)})});lC.displayName=oC;var Um="DialogPortal",[vO,cC]=sC(Um,{forceMount:void 0}),dC=e=>{const{__scopeDialog:t,forceMount:n,children:s,container:o}=e,l=sr(Um,t);return i.jsx(vO,{scope:t,forceMount:n,children:p.Children.map(s,c=>i.jsx($n,{present:n||l.open,children:i.jsx(No,{asChild:!0,container:o,children:c})}))})};dC.displayName=Um;var Vc="DialogOverlay",uC=p.forwardRef((e,t)=>{const n=cC(Vc,e.__scopeDialog),{forceMount:s=n.forceMount,...o}=e,l=sr(Vc,e.__scopeDialog);return l.modal?i.jsx($n,{present:s||l.open,children:i.jsx(wO,{...o,ref:t})}):null});uC.displayName=Vc;var yO=Qs("DialogOverlay.RemoveScroll"),wO=p.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=sr(Vc,n);return i.jsx(xd,{as:yO,allowPinchZoom:!0,shards:[o.contentRef],children:i.jsx(Me.div,{"data-state":zm(o.open),...s,ref:t,style:{pointerEvents:"auto",...s.style}})})}),ea="DialogContent",hC=p.forwardRef((e,t)=>{const n=cC(ea,e.__scopeDialog),{forceMount:s=n.forceMount,...o}=e,l=sr(ea,e.__scopeDialog);return i.jsx($n,{present:s||l.open,children:l.modal?i.jsx(xO,{...o,ref:t}):i.jsx(bO,{...o,ref:t})})});hC.displayName=ea;var xO=p.forwardRef((e,t)=>{const n=sr(ea,e.__scopeDialog),s=p.useRef(null),o=Ye(t,n.contentRef,s);return p.useEffect(()=>{const l=s.current;if(l)return Fm(l)},[]),i.jsx(fC,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:we(e.onCloseAutoFocus,l=>{l.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:we(e.onPointerDownOutside,l=>{const c=l.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0;(c.button===2||u)&&l.preventDefault()}),onFocusOutside:we(e.onFocusOutside,l=>l.preventDefault())})}),bO=p.forwardRef((e,t)=>{const n=sr(ea,e.__scopeDialog),s=p.useRef(!1),o=p.useRef(!1);return i.jsx(fC,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{e.onCloseAutoFocus?.(l),l.defaultPrevented||(s.current||n.triggerRef.current?.focus(),l.preventDefault()),s.current=!1,o.current=!1},onInteractOutside:l=>{e.onInteractOutside?.(l),l.defaultPrevented||(s.current=!0,l.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const c=l.target;n.triggerRef.current?.contains(c)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&o.current&&l.preventDefault()}})}),fC=p.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:l,...c}=e,u=sr(ea,n),h=p.useRef(null),f=Ye(t,h);return $m(),i.jsxs(i.Fragment,{children:[i.jsx(yd,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:o,onUnmountAutoFocus:l,children:i.jsx(ti,{role:"dialog",id:u.contentId,"aria-describedby":u.descriptionId,"aria-labelledby":u.titleId,"data-state":zm(u.open),...c,ref:f,onDismiss:()=>u.onOpenChange(!1)})}),i.jsxs(i.Fragment,{children:[i.jsx(SO,{titleId:u.titleId}),i.jsx(_O,{contentRef:h,descriptionId:u.descriptionId})]})]})}),Bm="DialogTitle",mC=p.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=sr(Bm,n);return i.jsx(Me.h2,{id:o.titleId,...s,ref:t})});mC.displayName=Bm;var pC="DialogDescription",gC=p.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=sr(pC,n);return i.jsx(Me.p,{id:o.descriptionId,...s,ref:t})});gC.displayName=pC;var vC="DialogClose",yC=p.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=sr(vC,n);return i.jsx(Me.button,{type:"button",...s,ref:t,onClick:we(e.onClick,()=>o.onOpenChange(!1))})});yC.displayName=vC;function zm(e){return e?"open":"closed"}var wC="DialogTitleWarning",[CO,xC]=CN(wC,{contentName:ea,titleName:Bm,docsSlug:"dialog"}),SO=({titleId:e})=>{const t=xC(wC),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return p.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},EO="DialogDescriptionWarning",_O=({contentRef:e,descriptionId:t})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${xC(EO).contentName}}.`;return p.useEffect(()=>{const o=e.current?.getAttribute("aria-describedby");t&&o&&(document.getElementById(t)||console.warn(s))},[s,e,t]),null},Hm=iC,bC=lC,Vm=dC,Io=uC,Do=hC,Oo=mC,Lo=gC,Cd=yC;const qc=Hm,NO=Vm,CC=p.forwardRef(({className:e,...t},n)=>i.jsx(Io,{ref:n,className:Ce("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));CC.displayName=Io.displayName;const xo=p.forwardRef(({className:e,children:t,...n},s)=>i.jsxs(NO,{children:[i.jsx(CC,{}),i.jsxs(Do,{ref:s,className:Ce("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...n,children:[t,i.jsxs(Cd,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[i.jsx(Or,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));xo.displayName=Do.displayName;const bo=({className:e,...t})=>i.jsx("div",{className:Ce("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});bo.displayName="DialogHeader";const Of=({className:e,...t})=>i.jsx("div",{className:Ce("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Of.displayName="DialogFooter";const Co=p.forwardRef(({className:e,...t},n)=>i.jsx(Oo,{ref:n,className:Ce("text-lg font-semibold leading-none tracking-tight",e),...t}));Co.displayName=Oo.displayName;const Wc=p.forwardRef(({className:e,...t},n)=>i.jsx(Lo,{ref:n,className:Ce("text-sm text-muted-foreground",e),...t}));Wc.displayName=Lo.displayName;const Kh=["#3B82F6","#F97316","#10B981","#A855F7","#EC4899"],Ew=[{name:"red",color:"#EF4444"},{name:"blue",color:"#3B82F6"},{name:"green",color:"#10B981"},{name:"yellow",color:"#FBBF24"},{name:"orange",color:"#F97316"},{name:"purple",color:"#A855F7"},{name:"pink",color:"#EC4899"},{name:"brown",color:"#92400E"},{name:"black",color:"#1F2937"},{name:"white",color:"#F3F4F6"}],jO=[{name:"cat",emoji:""},{name:"dog",emoji:""},{name:"bird",emoji:""},{name:"fish",emoji:""},{name:"bear",emoji:""},{name:"lion",emoji:""},{name:"tiger",emoji:""},{name:"elephant",emoji:""},{name:"monkey",emoji:""},{name:"rabbit",emoji:""},{name:"horse",emoji:""},{name:"duck",emoji:""},{name:"cow",emoji:""},{name:"pig",emoji:""},{name:"sheep",emoji:""}],SC=({open:e,onOpenChange:t,onChildAdded:n})=>{const[s,o]=p.useState(""),[l,c]=p.useState(Kh[0]),[u,h]=p.useState("color"),[f,g]=p.useState(""),[v,b]=p.useState(""),[x,S]=p.useState(""),[C,w]=p.useState(""),[N,_]=p.useState(!1),[j,T]=p.useState(!1),{toast:R}=_t();p.useEffect(()=>{e&&(A(),I())},[e]);const A=async()=>{try{const{data:{user:B}}=await Y.auth.getUser();if(!B)return;let{data:z,error:q}=await Y.from("parents").select("family_code").eq("id",B.id).single();if(q&&q.code==="PGRST116"){k.log(" [FAMILY CODE] Parent record not found, creating it...");const{error:H}=await Y.from("parents").upsert({id:B.id,email:B.email||"",name:B.user_metadata?.name||""},{onConflict:"id"});if(H)throw k.error(" [FAMILY CODE] Failed to create parent record:",Ge(H)),H;const{data:Q,error:$}=await Y.from("parents").select("family_code").eq("id",B.id).single();if($)throw $;z=Q}else if(q){if(q.code==="42703"||q.message?.includes("does not exist")){R({title:"Database Migration Required",description:"The family_code column doesn't exist yet. Please run the migration in Supabase: supabase/migrations/20250121000000_add_family_code.sql",variant:"destructive",duration:1e4}),k.error(" [FAMILY CODE] Migration not run. Error:",Ge(q));return}throw q}if(z?.family_code)w(z.family_code);else{k.warn(" [FAMILY CODE] Parent exists but family_code is null, attempting to generate...");try{const{data:H,error:Q}=await Y.rpc("generate_unique_family_code");if(!Q&&H){const{error:$}=await Y.from("parents").update({family_code:H}).eq("id",B.id);if($)k.error(" [FAMILY CODE] Failed to update parent with family code:",Ge($));else{w(H),k.log(" [FAMILY CODE] Generated and set family code (code redacted)");return}}else k.error(" [FAMILY CODE] RPC call failed:",Ge(Q))}catch(H){k.error(" [FAMILY CODE] Exception calling RPC:",Ge(H))}R({title:"Family Code Missing",description:"Your account doesn't have a family code yet. The system will attempt to generate one. Please refresh the page in a moment.",variant:"destructive",duration:8e3})}}catch(B){k.error("Failed to fetch family code:",Ge(B)),R({title:"Error Loading Family Code",description:B.message||"Please refresh and try again. If the problem persists, ensure the database migration has been run.",variant:"destructive",duration:8e3})}},I=async()=>{T(!0);try{const{data:B,error:z}=await Y.rpc("generate_kid_friendly_login_code");if(z)throw z;S(B);const[q,H]=B.split("-");g(q),b(H);const Q=Ew.some($=>$.name===q);h(Q?"color":"animal")}catch{R({title:"Error",description:"Failed to generate code. Please try again.",variant:"destructive"})}finally{T(!1)}},L=(B,z)=>{g(B),h(z),M(B,v)},Z=B=>{const z=parseInt(B);(B===""||z>=1&&z<=99)&&(b(B),f&&M(f,B))},M=(B,z)=>{B&&z&&C?S(`${C}-${B}-${z}`):B&&z&&S(`${B}-${z}`)},U=async B=>{try{const{data:z,error:q}=await Y.from("children").select("id").eq("login_code",B).maybeSingle();if(q)throw q;return!z}catch{return!1}};p.useEffect(()=>{C&&f&&v?S(`${C}-${f}-${v}`):f&&v&&S(`${f}-${v}`)},[C,f,v]);const D=async B=>{if(B.preventDefault(),!s.trim()){R({title:"Error",description:"Please enter a name",variant:"destructive"});return}if(!C){R({title:"Family Code Required",description:"Family code not loaded. This may mean the database migration hasn't been run. Please check the console for details.",variant:"destructive",duration:8e3});return}if(!x||!f||!v){R({title:"Error",description:"Please select a color/animal and number",variant:"destructive"});return}_(!0);try{const{data:{user:z}}=await Y.auth.getUser();if(!z)throw new Error("Not authenticated");const{data:q,error:H}=await Y.rpc("can_add_child",{p_parent_id:z.id});if(H)k.error("Error checking subscription limit:",Ge(H));else if(q===!1){R({title:"Subscription Limit Reached",description:"You've reached your subscription limit. Please upgrade your plan to add more children.",variant:"destructive",duration:8e3}),_(!1);return}if(!await U(x)){R({title:"Code already taken",description:"Please generate a new code or choose different options",variant:"destructive"}),_(!1);return}const{error:$}=await Y.from("children").insert({parent_id:z.id,name:s.trim(),login_code:x,avatar_color:l});if($)throw $;R({title:"Child added successfully!",description:`Full login code: ${x}`}),o(""),c(Kh[0]),g(""),b(""),S(""),t(!1),n()}catch(z){R({title:"Error",description:z.message,variant:"destructive"})}finally{_(!1)}};return i.jsx(qc,{open:e,onOpenChange:t,children:i.jsxs(xo,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsx(bo,{children:i.jsx(Co,{children:"Add a Child"})}),i.jsxs("form",{onSubmit:D,className:"space-y-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Child's Name"}),i.jsx(vr,{type:"text",placeholder:"Enter name",value:s,onChange:B=>o(B.target.value),required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Pick an Avatar Color"}),i.jsx("div",{className:"flex gap-2 flex-wrap",children:Kh.map(B=>i.jsx("button",{type:"button",onClick:()=>c(B),className:"w-12 h-12 rounded-full border-4 transition-all",style:{backgroundColor:B,borderColor:l===B?B:"transparent",opacity:l===B?1:.6}},B))})]}),i.jsxs("div",{className:"space-y-4 border-t pt-4",children:[i.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[i.jsx("p",{className:"text-xs font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Your Family Code"}),i.jsx("p",{className:"text-xl font-mono font-bold text-blue-700 dark:text-blue-300 text-center",children:C||"Loading..."}),i.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-2 text-center",children:"Share this code with your child for login"})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("label",{className:"text-sm font-medium",children:"Child's Login Code"}),i.jsxs(de,{type:"button",variant:"outline",size:"sm",onClick:I,disabled:j||!C,children:[i.jsx(fs,{className:`h-4 w-4 mr-2 ${j?"animate-spin":""}`}),"Generate New"]})]}),i.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Full Login Code"}),i.jsx("p",{className:"text-2xl font-mono font-bold text-center break-all",children:x||(C?"Select color/animal and number":"Loading...")})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx(de,{type:"button",variant:u==="color"?"default":"outline",onClick:()=>h("color"),className:"flex-1",children:"Colors"}),i.jsx(de,{type:"button",variant:u==="animal"?"default":"outline",onClick:()=>h("animal"),className:"flex-1",children:"Animals"})]}),u==="color"?i.jsx("div",{className:"grid grid-cols-5 gap-2",children:Ew.map(B=>i.jsx("button",{type:"button",onClick:()=>L(B.name,"color"),className:`h-16 rounded-lg border-2 transition-all flex items-center justify-center ${f===B.name?"border-primary scale-105":"border-transparent opacity-60 hover:opacity-100"}`,style:{backgroundColor:B.color},children:i.jsx("span",{className:"text-white font-bold text-sm capitalize",children:B.name})},B.name))}):i.jsx("div",{className:"grid grid-cols-5 gap-2",children:jO.map(B=>i.jsxs("button",{type:"button",onClick:()=>L(B.name,"animal"),className:`h-16 rounded-lg border-2 transition-all flex flex-col items-center justify-center ${f===B.name?"border-primary scale-105 bg-primary/10":"border-transparent opacity-60 hover:opacity-100 hover:bg-muted"}`,children:[i.jsx("span",{className:"text-2xl",children:B.emoji}),i.jsx("span",{className:"text-xs font-medium capitalize mt-1",children:B.name})]},B.name))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Number (1-99)"}),i.jsx(vr,{type:"number",min:"1",max:"99",placeholder:"Enter number",value:v,onChange:B=>Z(B.target.value),className:"text-center text-2xl font-bold"})]}),x&&C&&i.jsxs("div",{className:"bg-green-50 dark:bg-green-950 p-3 rounded-lg flex items-center gap-2",children:[i.jsx(er,{className:"h-5 w-5 text-green-600"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-green-800 dark:text-green-200 font-medium",children:"Code ready!"}),i.jsxs("p",{className:"text-xs text-green-700 dark:text-green-300 mt-1",children:["Your child will use: ",i.jsx("span",{className:"font-mono font-bold",children:x})]})]})]})]}),i.jsx(de,{type:"submit",className:"w-full",disabled:N||!x||!C,children:N?"Creating...":"Add Child"})]})]})})},Vs=p.forwardRef(({className:e,activeClassName:t,pendingClassName:n,to:s,...o},l)=>i.jsx(uR,{ref:l,to:s,className:({isActive:c,isPending:u})=>Ce(e,c&&t,u&&n),...o}));Vs.displayName="NavLink";const _w=e=>{let t;const n=new Set,s=(f,g)=>{const v=typeof f=="function"?f(t):f;if(!Object.is(v,t)){const b=t;t=g??(typeof v!="object"||v===null)?v:Object.assign({},t,v),n.forEach(x=>x(t,b))}},o=()=>t,u={setState:s,getState:o,getInitialState:()=>h,subscribe:f=>(n.add(f),()=>n.delete(f))},h=t=e(s,o,u);return u},kO=(e=>e?_w(e):_w),TO=e=>e;function AO(e,t=TO){const n=ge.useSyncExternalStore(e.subscribe,ge.useCallback(()=>t(e.getState()),[e,t]),ge.useCallback(()=>t(e.getInitialState()),[e,t]));return ge.useDebugValue(n),n}const Nw=e=>{const t=kO(e),n=s=>AO(t,s);return Object.assign(n,t),n},PO=(e=>e?Nw(e):Nw),Gc="kidscallhome_badge_state",EC=1;function Mo(){try{const e=localStorage.getItem(Gc);if(!e)return{unreadMessagesByChild:{},missedCallsByChild:{},lastClearedTimestamps:{messages:{},calls:{}}};const t=JSON.parse(e);return t.version!==EC?(console.log(" [BADGE STORAGE] Version mismatch, clearing old data"),localStorage.removeItem(Gc),{unreadMessagesByChild:{},missedCallsByChild:{},lastClearedTimestamps:{messages:{},calls:{}}}):{unreadMessagesByChild:t.unreadMessagesByChild||{},missedCallsByChild:t.missedCallsByChild||{},lastClearedTimestamps:t.lastClearedTimestamps||{messages:{},calls:{}}}}catch(e){return console.error(" [BADGE STORAGE] Error loading badge state:",e),{unreadMessagesByChild:{},missedCallsByChild:{},lastClearedTimestamps:{messages:{},calls:{}}}}}function Ir(e,t,n){try{const s=Mo(),o=n||s.lastClearedTimestamps,l={version:EC,unreadMessagesByChild:e,missedCallsByChild:t,lastUpdated:new Date().toISOString(),lastClearedTimestamps:o};localStorage.setItem(Gc,JSON.stringify(l))}catch(s){console.error(" [BADGE STORAGE] Error saving badge state:",s)}}function jw(e,t){try{const n=Mo(),s=new Date().toISOString(),o={...n.lastClearedTimestamps};(t==="messages"||t==="both")&&(o.messages[e]=s),(t==="calls"||t==="both")&&(o.calls[e]=s),Ir(n.unreadMessagesByChild,n.missedCallsByChild,o),console.log(` [BADGE STORAGE] Marked ${t} badges as cleared for child ${e} at ${s}`)}catch(n){console.error(" [BADGE STORAGE] Error marking badges as cleared:",n)}}function Ba(e,t){try{return Mo().lastClearedTimestamps[t][e]||null}catch(n){return console.error(" [BADGE STORAGE] Error getting last cleared timestamp:",n),null}}function RO(){try{localStorage.removeItem(Gc)}catch(e){console.error(" [BADGE STORAGE] Error clearing badge state:",e)}}const kw=Mo(),tt=PO((e,t)=>({unreadMessagesByChild:kw.unreadMessagesByChild,missedCallsByChild:kw.missedCallsByChild,setInitialUnread:n=>{e({unreadMessagesByChild:n}),Ir(t().unreadMessagesByChild,t().missedCallsByChild)},setInitialMissed:n=>{e({missedCallsByChild:n}),Ir(t().unreadMessagesByChild,t().missedCallsByChild)},incrementUnread:n=>e(s=>{const o={unreadMessagesByChild:{...s.unreadMessagesByChild,[n]:(s.unreadMessagesByChild[n]??0)+1}};return Ir(o.unreadMessagesByChild,s.missedCallsByChild),o}),decrementUnread:(n,s=1)=>e(o=>{const l={unreadMessagesByChild:{...o.unreadMessagesByChild,[n]:Math.max(0,(o.unreadMessagesByChild[n]??0)-s)}};return Ir(l.unreadMessagesByChild,o.missedCallsByChild),l}),clearUnreadForChild:n=>e(s=>{const o={unreadMessagesByChild:{...s.unreadMessagesByChild,[n]:0}};return Ir(o.unreadMessagesByChild,s.missedCallsByChild),jw(n,"messages"),o}),incrementMissed:n=>e(s=>{const o={missedCallsByChild:{...s.missedCallsByChild,[n]:(s.missedCallsByChild[n]??0)+1}};return Ir(s.unreadMessagesByChild,o.missedCallsByChild),o}),decrementMissed:(n,s=1)=>e(o=>{const l={missedCallsByChild:{...o.missedCallsByChild,[n]:Math.max(0,(o.missedCallsByChild[n]??0)-s)}};return Ir(o.unreadMessagesByChild,l.missedCallsByChild),l}),clearMissedForChild:n=>e(s=>{const o={missedCallsByChild:{...s.missedCallsByChild,[n]:0}};return Ir(s.unreadMessagesByChild,o.missedCallsByChild),jw(n,"calls"),o}),reset:()=>{e({unreadMessagesByChild:{},missedCallsByChild:{}}),RO()}}));function _C(){const e=tt(t=>t.unreadMessagesByChild);return Object.values(e).reduce((t,n)=>t+n,0)}function NC(){const e=tt(t=>t.missedCallsByChild);return Object.values(e).reduce((t,n)=>t+n,0)}function qm(e){return tt(t=>e?t.unreadMessagesByChild[e]??0:0)}function jC(e){return tt(t=>e?t.missedCallsByChild[e]??0:0)}var IO=p.createContext(void 0);function Sd(e){const t=p.useContext(IO);return e||t||"ltr"}var Yh="rovingFocusGroup.onEntryFocus",DO={bubbles:!1,cancelable:!0},$o="RovingFocusGroup",[Lf,kC,OO]=Zc($o),[LO,Ed]=Mn($o,[OO]),[MO,$O]=LO($o),TC=p.forwardRef((e,t)=>i.jsx(Lf.Provider,{scope:e.__scopeRovingFocusGroup,children:i.jsx(Lf.Slot,{scope:e.__scopeRovingFocusGroup,children:i.jsx(FO,{...e,ref:t})})}));TC.displayName=$o;var FO=p.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:o=!1,dir:l,currentTabStopId:c,defaultCurrentTabStopId:u,onCurrentTabStopIdChange:h,onEntryFocus:f,preventScrollOnEntryFocus:g=!1,...v}=e,b=p.useRef(null),x=Ye(t,b),S=Sd(l),[C,w]=ys({prop:c,defaultProp:u??null,onChange:h,caller:$o}),[N,_]=p.useState(!1),j=un(f),T=kC(n),R=p.useRef(!1),[A,I]=p.useState(0);return p.useEffect(()=>{const L=b.current;if(L)return L.addEventListener(Yh,j),()=>L.removeEventListener(Yh,j)},[j]),i.jsx(MO,{scope:n,orientation:s,dir:S,loop:o,currentTabStopId:C,onItemFocus:p.useCallback(L=>w(L),[w]),onItemShiftTab:p.useCallback(()=>_(!0),[]),onFocusableItemAdd:p.useCallback(()=>I(L=>L+1),[]),onFocusableItemRemove:p.useCallback(()=>I(L=>L-1),[]),children:i.jsx(Me.div,{tabIndex:N||A===0?-1:0,"data-orientation":s,...v,ref:x,style:{outline:"none",...e.style},onMouseDown:we(e.onMouseDown,()=>{R.current=!0}),onFocus:we(e.onFocus,L=>{const Z=!R.current;if(L.target===L.currentTarget&&Z&&!N){const M=new CustomEvent(Yh,DO);if(L.currentTarget.dispatchEvent(M),!M.defaultPrevented){const U=T().filter(H=>H.focusable),D=U.find(H=>H.active),B=U.find(H=>H.id===C),q=[D,B,...U].filter(Boolean).map(H=>H.ref.current);RC(q,g)}}R.current=!1}),onBlur:we(e.onBlur,()=>_(!1))})})}),AC="RovingFocusGroupItem",PC=p.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:o=!1,tabStopId:l,children:c,...u}=e,h=pr(),f=l||h,g=$O(AC,n),v=g.currentTabStopId===f,b=kC(n),{onFocusableItemAdd:x,onFocusableItemRemove:S,currentTabStopId:C}=g;return p.useEffect(()=>{if(s)return x(),()=>S()},[s,x,S]),i.jsx(Lf.ItemSlot,{scope:n,id:f,focusable:s,active:o,children:i.jsx(Me.span,{tabIndex:v?0:-1,"data-orientation":g.orientation,...u,ref:t,onMouseDown:we(e.onMouseDown,w=>{s?g.onItemFocus(f):w.preventDefault()}),onFocus:we(e.onFocus,()=>g.onItemFocus(f)),onKeyDown:we(e.onKeyDown,w=>{if(w.key==="Tab"&&w.shiftKey){g.onItemShiftTab();return}if(w.target!==w.currentTarget)return;const N=zO(w,g.orientation,g.dir);if(N!==void 0){if(w.metaKey||w.ctrlKey||w.altKey||w.shiftKey)return;w.preventDefault();let j=b().filter(T=>T.focusable).map(T=>T.ref.current);if(N==="last")j.reverse();else if(N==="prev"||N==="next"){N==="prev"&&j.reverse();const T=j.indexOf(w.currentTarget);j=g.loop?HO(j,T+1):j.slice(T+1)}setTimeout(()=>RC(j))}}),children:typeof c=="function"?c({isCurrentTabStop:v,hasTabStop:C!=null}):c})})});PC.displayName=AC;var UO={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function BO(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function zO(e,t,n){const s=BO(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return UO[s]}function RC(e,t=!1){const n=document.activeElement;for(const s of e)if(s===n||(s.focus({preventScroll:t}),document.activeElement!==n))return}function HO(e,t){return e.map((n,s)=>e[(t+s)%e.length])}var IC=TC,DC=PC,Mf=["Enter"," "],VO=["ArrowDown","PageUp","Home"],OC=["ArrowUp","PageDown","End"],qO=[...VO,...OC],WO={ltr:[...Mf,"ArrowRight"],rtl:[...Mf,"ArrowLeft"]},GO={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Fo="Menu",[So,KO,YO]=Zc(Fo),[sa,LC]=Mn(Fo,[YO,ai,Ed]),_d=ai(),MC=Ed(),[JO,aa]=sa(Fo),[QO,Uo]=sa(Fo),$C=e=>{const{__scopeMenu:t,open:n=!1,children:s,dir:o,onOpenChange:l,modal:c=!0}=e,u=_d(t),[h,f]=p.useState(null),g=p.useRef(!1),v=un(l),b=Sd(o);return p.useEffect(()=>{const x=()=>{g.current=!0,document.addEventListener("pointerdown",S,{capture:!0,once:!0}),document.addEventListener("pointermove",S,{capture:!0,once:!0})},S=()=>g.current=!1;return document.addEventListener("keydown",x,{capture:!0}),()=>{document.removeEventListener("keydown",x,{capture:!0}),document.removeEventListener("pointerdown",S,{capture:!0}),document.removeEventListener("pointermove",S,{capture:!0})}},[]),i.jsx(d0,{...u,children:i.jsx(JO,{scope:t,open:n,onOpenChange:v,content:h,onContentChange:f,children:i.jsx(QO,{scope:t,onClose:p.useCallback(()=>v(!1),[v]),isUsingKeyboardRef:g,dir:b,modal:c,children:s})})})};$C.displayName=Fo;var XO="MenuAnchor",Wm=p.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e,o=_d(n);return i.jsx(pm,{...o,...s,ref:t})});Wm.displayName=XO;var Gm="MenuPortal",[ZO,FC]=sa(Gm,{forceMount:void 0}),UC=e=>{const{__scopeMenu:t,forceMount:n,children:s,container:o}=e,l=aa(Gm,t);return i.jsx(ZO,{scope:t,forceMount:n,children:i.jsx($n,{present:n||l.open,children:i.jsx(No,{asChild:!0,container:o,children:s})})})};UC.displayName=Gm;var Ln="MenuContent",[eL,Km]=sa(Ln),BC=p.forwardRef((e,t)=>{const n=FC(Ln,e.__scopeMenu),{forceMount:s=n.forceMount,...o}=e,l=aa(Ln,e.__scopeMenu),c=Uo(Ln,e.__scopeMenu);return i.jsx(So.Provider,{scope:e.__scopeMenu,children:i.jsx($n,{present:s||l.open,children:i.jsx(So.Slot,{scope:e.__scopeMenu,children:c.modal?i.jsx(tL,{...o,ref:t}):i.jsx(nL,{...o,ref:t})})})})}),tL=p.forwardRef((e,t)=>{const n=aa(Ln,e.__scopeMenu),s=p.useRef(null),o=Ye(t,s);return p.useEffect(()=>{const l=s.current;if(l)return Fm(l)},[]),i.jsx(Ym,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:we(e.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),nL=p.forwardRef((e,t)=>{const n=aa(Ln,e.__scopeMenu);return i.jsx(Ym,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),rL=Qs("MenuContent.ScrollLock"),Ym=p.forwardRef((e,t)=>{const{__scopeMenu:n,loop:s=!1,trapFocus:o,onOpenAutoFocus:l,onCloseAutoFocus:c,disableOutsidePointerEvents:u,onEntryFocus:h,onEscapeKeyDown:f,onPointerDownOutside:g,onFocusOutside:v,onInteractOutside:b,onDismiss:x,disableOutsideScroll:S,...C}=e,w=aa(Ln,n),N=Uo(Ln,n),_=_d(n),j=MC(n),T=KO(n),[R,A]=p.useState(null),I=p.useRef(null),L=Ye(t,I,w.onContentChange),Z=p.useRef(0),M=p.useRef(""),U=p.useRef(0),D=p.useRef(null),B=p.useRef("right"),z=p.useRef(0),q=S?xd:p.Fragment,H=S?{as:rL,allowPinchZoom:!0}:void 0,Q=O=>{const J=M.current+O,F=T().filter(G=>!G.disabled),ee=document.activeElement,ce=F.find(G=>G.ref.current===ee)?.textValue,K=F.map(G=>G.textValue),W=pL(K,J,ce),ne=F.find(G=>G.textValue===W)?.ref.current;(function G(ae){M.current=ae,window.clearTimeout(Z.current),ae!==""&&(Z.current=window.setTimeout(()=>G(""),1e3))})(J),ne&&setTimeout(()=>ne.focus())};p.useEffect(()=>()=>window.clearTimeout(Z.current),[]),$m();const $=p.useCallback(O=>B.current===D.current?.side&&vL(O,D.current?.area),[]);return i.jsx(eL,{scope:n,searchRef:M,onItemEnter:p.useCallback(O=>{$(O)&&O.preventDefault()},[$]),onItemLeave:p.useCallback(O=>{$(O)||(I.current?.focus(),A(null))},[$]),onTriggerLeave:p.useCallback(O=>{$(O)&&O.preventDefault()},[$]),pointerGraceTimerRef:U,onPointerGraceIntentChange:p.useCallback(O=>{D.current=O},[]),children:i.jsx(q,{...H,children:i.jsx(yd,{asChild:!0,trapped:o,onMountAutoFocus:we(l,O=>{O.preventDefault(),I.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:c,children:i.jsx(ti,{asChild:!0,disableOutsidePointerEvents:u,onEscapeKeyDown:f,onPointerDownOutside:g,onFocusOutside:v,onInteractOutside:b,onDismiss:x,children:i.jsx(IC,{asChild:!0,...j,dir:N.dir,orientation:"vertical",loop:s,currentTabStopId:R,onCurrentTabStopIdChange:A,onEntryFocus:we(h,O=>{N.isUsingKeyboardRef.current||O.preventDefault()}),preventScrollOnEntryFocus:!0,children:i.jsx(gm,{role:"menu","aria-orientation":"vertical","data-state":rS(w.open),"data-radix-menu-content":"",dir:N.dir,..._,...C,ref:L,style:{outline:"none",...C.style},onKeyDown:we(C.onKeyDown,O=>{const F=O.target.closest("[data-radix-menu-content]")===O.currentTarget,ee=O.ctrlKey||O.altKey||O.metaKey,ce=O.key.length===1;F&&(O.key==="Tab"&&O.preventDefault(),!ee&&ce&&Q(O.key));const K=I.current;if(O.target!==K||!qO.includes(O.key))return;O.preventDefault();const ne=T().filter(G=>!G.disabled).map(G=>G.ref.current);OC.includes(O.key)&&ne.reverse(),fL(ne)}),onBlur:we(e.onBlur,O=>{O.currentTarget.contains(O.target)||(window.clearTimeout(Z.current),M.current="")}),onPointerMove:we(e.onPointerMove,Eo(O=>{const J=O.target,F=z.current!==O.clientX;if(O.currentTarget.contains(J)&&F){const ee=O.clientX>z.current?"right":"left";B.current=ee,z.current=O.clientX}}))})})})})})})});BC.displayName=Ln;var sL="MenuGroup",Jm=p.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e;return i.jsx(Me.div,{role:"group",...s,ref:t})});Jm.displayName=sL;var aL="MenuLabel",zC=p.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e;return i.jsx(Me.div,{...s,ref:t})});zC.displayName=aL;var Kc="MenuItem",Tw="menu.itemSelect",Nd=p.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:s,...o}=e,l=p.useRef(null),c=Uo(Kc,e.__scopeMenu),u=Km(Kc,e.__scopeMenu),h=Ye(t,l),f=p.useRef(!1),g=()=>{const v=l.current;if(!n&&v){const b=new CustomEvent(Tw,{bubbles:!0,cancelable:!0});v.addEventListener(Tw,x=>s?.(x),{once:!0}),Xf(v,b),b.defaultPrevented?f.current=!1:c.onClose()}};return i.jsx(HC,{...o,ref:h,disabled:n,onClick:we(e.onClick,g),onPointerDown:v=>{e.onPointerDown?.(v),f.current=!0},onPointerUp:we(e.onPointerUp,v=>{f.current||v.currentTarget?.click()}),onKeyDown:we(e.onKeyDown,v=>{const b=u.searchRef.current!=="";n||b&&v.key===" "||Mf.includes(v.key)&&(v.currentTarget.click(),v.preventDefault())})})});Nd.displayName=Kc;var HC=p.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:s=!1,textValue:o,...l}=e,c=Km(Kc,n),u=MC(n),h=p.useRef(null),f=Ye(t,h),[g,v]=p.useState(!1),[b,x]=p.useState("");return p.useEffect(()=>{const S=h.current;S&&x((S.textContent??"").trim())},[l.children]),i.jsx(So.ItemSlot,{scope:n,disabled:s,textValue:o??b,children:i.jsx(DC,{asChild:!0,...u,focusable:!s,children:i.jsx(Me.div,{role:"menuitem","data-highlighted":g?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...l,ref:f,onPointerMove:we(e.onPointerMove,Eo(S=>{s?c.onItemLeave(S):(c.onItemEnter(S),S.defaultPrevented||S.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:we(e.onPointerLeave,Eo(S=>c.onItemLeave(S))),onFocus:we(e.onFocus,()=>v(!0)),onBlur:we(e.onBlur,()=>v(!1))})})})}),iL="MenuCheckboxItem",VC=p.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:s,...o}=e;return i.jsx(YC,{scope:e.__scopeMenu,checked:n,children:i.jsx(Nd,{role:"menuitemcheckbox","aria-checked":Yc(n)?"mixed":n,...o,ref:t,"data-state":Xm(n),onSelect:we(o.onSelect,()=>s?.(Yc(n)?!0:!n),{checkForDefaultPrevented:!1})})})});VC.displayName=iL;var qC="MenuRadioGroup",[oL,lL]=sa(qC,{value:void 0,onValueChange:()=>{}}),WC=p.forwardRef((e,t)=>{const{value:n,onValueChange:s,...o}=e,l=un(s);return i.jsx(oL,{scope:e.__scopeMenu,value:n,onValueChange:l,children:i.jsx(Jm,{...o,ref:t})})});WC.displayName=qC;var GC="MenuRadioItem",KC=p.forwardRef((e,t)=>{const{value:n,...s}=e,o=lL(GC,e.__scopeMenu),l=n===o.value;return i.jsx(YC,{scope:e.__scopeMenu,checked:l,children:i.jsx(Nd,{role:"menuitemradio","aria-checked":l,...s,ref:t,"data-state":Xm(l),onSelect:we(s.onSelect,()=>o.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});KC.displayName=GC;var Qm="MenuItemIndicator",[YC,cL]=sa(Qm,{checked:!1}),JC=p.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:s,...o}=e,l=cL(Qm,n);return i.jsx($n,{present:s||Yc(l.checked)||l.checked===!0,children:i.jsx(Me.span,{...o,ref:t,"data-state":Xm(l.checked)})})});JC.displayName=Qm;var dL="MenuSeparator",QC=p.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e;return i.jsx(Me.div,{role:"separator","aria-orientation":"horizontal",...s,ref:t})});QC.displayName=dL;var uL="MenuArrow",XC=p.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e,o=_d(n);return i.jsx(vm,{...o,...s,ref:t})});XC.displayName=uL;var hL="MenuSub",[P$,ZC]=sa(hL),Zi="MenuSubTrigger",eS=p.forwardRef((e,t)=>{const n=aa(Zi,e.__scopeMenu),s=Uo(Zi,e.__scopeMenu),o=ZC(Zi,e.__scopeMenu),l=Km(Zi,e.__scopeMenu),c=p.useRef(null),{pointerGraceTimerRef:u,onPointerGraceIntentChange:h}=l,f={__scopeMenu:e.__scopeMenu},g=p.useCallback(()=>{c.current&&window.clearTimeout(c.current),c.current=null},[]);return p.useEffect(()=>g,[g]),p.useEffect(()=>{const v=u.current;return()=>{window.clearTimeout(v),h(null)}},[u,h]),i.jsx(Wm,{asChild:!0,...f,children:i.jsx(HC,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":o.contentId,"data-state":rS(n.open),...e,ref:Xc(t,o.onTriggerChange),onClick:v=>{e.onClick?.(v),!(e.disabled||v.defaultPrevented)&&(v.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:we(e.onPointerMove,Eo(v=>{l.onItemEnter(v),!v.defaultPrevented&&!e.disabled&&!n.open&&!c.current&&(l.onPointerGraceIntentChange(null),c.current=window.setTimeout(()=>{n.onOpenChange(!0),g()},100))})),onPointerLeave:we(e.onPointerLeave,Eo(v=>{g();const b=n.content?.getBoundingClientRect();if(b){const x=n.content?.dataset.side,S=x==="right",C=S?-5:5,w=b[S?"left":"right"],N=b[S?"right":"left"];l.onPointerGraceIntentChange({area:[{x:v.clientX+C,y:v.clientY},{x:w,y:b.top},{x:N,y:b.top},{x:N,y:b.bottom},{x:w,y:b.bottom}],side:x}),window.clearTimeout(u.current),u.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(v),v.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:we(e.onKeyDown,v=>{const b=l.searchRef.current!=="";e.disabled||b&&v.key===" "||WO[s.dir].includes(v.key)&&(n.onOpenChange(!0),n.content?.focus(),v.preventDefault())})})})});eS.displayName=Zi;var tS="MenuSubContent",nS=p.forwardRef((e,t)=>{const n=FC(Ln,e.__scopeMenu),{forceMount:s=n.forceMount,...o}=e,l=aa(Ln,e.__scopeMenu),c=Uo(Ln,e.__scopeMenu),u=ZC(tS,e.__scopeMenu),h=p.useRef(null),f=Ye(t,h);return i.jsx(So.Provider,{scope:e.__scopeMenu,children:i.jsx($n,{present:s||l.open,children:i.jsx(So.Slot,{scope:e.__scopeMenu,children:i.jsx(Ym,{id:u.contentId,"aria-labelledby":u.triggerId,...o,ref:f,align:"start",side:c.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:g=>{c.isUsingKeyboardRef.current&&h.current?.focus(),g.preventDefault()},onCloseAutoFocus:g=>g.preventDefault(),onFocusOutside:we(e.onFocusOutside,g=>{g.target!==u.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:we(e.onEscapeKeyDown,g=>{c.onClose(),g.preventDefault()}),onKeyDown:we(e.onKeyDown,g=>{const v=g.currentTarget.contains(g.target),b=GO[c.dir].includes(g.key);v&&b&&(l.onOpenChange(!1),u.trigger?.focus(),g.preventDefault())})})})})})});nS.displayName=tS;function rS(e){return e?"open":"closed"}function Yc(e){return e==="indeterminate"}function Xm(e){return Yc(e)?"indeterminate":e?"checked":"unchecked"}function fL(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function mL(e,t){return e.map((n,s)=>e[(t+s)%e.length])}function pL(e,t,n){const o=t.length>1&&Array.from(t).every(f=>f===t[0])?t[0]:t,l=n?e.indexOf(n):-1;let c=mL(e,Math.max(l,0));o.length===1&&(c=c.filter(f=>f!==n));const h=c.find(f=>f.toLowerCase().startsWith(o.toLowerCase()));return h!==n?h:void 0}function gL(e,t){const{x:n,y:s}=e;let o=!1;for(let l=0,c=t.length-1;l<t.length;c=l++){const u=t[l],h=t[c],f=u.x,g=u.y,v=h.x,b=h.y;g>s!=b>s&&n<(v-f)*(s-g)/(b-g)+f&&(o=!o)}return o}function vL(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return gL(n,t)}function Eo(e){return t=>t.pointerType==="mouse"?e(t):void 0}var yL=$C,wL=Wm,xL=UC,bL=BC,CL=Jm,SL=zC,EL=Nd,_L=VC,NL=WC,jL=KC,kL=JC,TL=QC,AL=XC,PL=eS,RL=nS,jd="DropdownMenu",[IL]=Mn(jd,[LC]),Zt=LC(),[DL,sS]=IL(jd),aS=e=>{const{__scopeDropdownMenu:t,children:n,dir:s,open:o,defaultOpen:l,onOpenChange:c,modal:u=!0}=e,h=Zt(t),f=p.useRef(null),[g,v]=ys({prop:o,defaultProp:l??!1,onChange:c,caller:jd});return i.jsx(DL,{scope:t,triggerId:pr(),triggerRef:f,contentId:pr(),open:g,onOpenChange:v,onOpenToggle:p.useCallback(()=>v(b=>!b),[v]),modal:u,children:i.jsx(yL,{...h,open:g,onOpenChange:v,dir:s,modal:u,children:n})})};aS.displayName=jd;var iS="DropdownMenuTrigger",oS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:s=!1,...o}=e,l=sS(iS,n),c=Zt(n);return i.jsx(wL,{asChild:!0,...c,children:i.jsx(Me.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...o,ref:Xc(t,l.triggerRef),onPointerDown:we(e.onPointerDown,u=>{!s&&u.button===0&&u.ctrlKey===!1&&(l.onOpenToggle(),l.open||u.preventDefault())}),onKeyDown:we(e.onKeyDown,u=>{s||(["Enter"," "].includes(u.key)&&l.onOpenToggle(),u.key==="ArrowDown"&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(u.key)&&u.preventDefault())})})})});oS.displayName=iS;var OL="DropdownMenuPortal",lS=e=>{const{__scopeDropdownMenu:t,...n}=e,s=Zt(t);return i.jsx(xL,{...s,...n})};lS.displayName=OL;var cS="DropdownMenuContent",dS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=sS(cS,n),l=Zt(n),c=p.useRef(!1);return i.jsx(bL,{id:o.contentId,"aria-labelledby":o.triggerId,...l,...s,ref:t,onCloseAutoFocus:we(e.onCloseAutoFocus,u=>{c.current||o.triggerRef.current?.focus(),c.current=!1,u.preventDefault()}),onInteractOutside:we(e.onInteractOutside,u=>{const h=u.detail.originalEvent,f=h.button===0&&h.ctrlKey===!0,g=h.button===2||f;(!o.modal||g)&&(c.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});dS.displayName=cS;var LL="DropdownMenuGroup",ML=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(CL,{...o,...s,ref:t})});ML.displayName=LL;var $L="DropdownMenuLabel",uS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(SL,{...o,...s,ref:t})});uS.displayName=$L;var FL="DropdownMenuItem",hS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(EL,{...o,...s,ref:t})});hS.displayName=FL;var UL="DropdownMenuCheckboxItem",fS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(_L,{...o,...s,ref:t})});fS.displayName=UL;var BL="DropdownMenuRadioGroup",zL=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(NL,{...o,...s,ref:t})});zL.displayName=BL;var HL="DropdownMenuRadioItem",mS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(jL,{...o,...s,ref:t})});mS.displayName=HL;var VL="DropdownMenuItemIndicator",pS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(kL,{...o,...s,ref:t})});pS.displayName=VL;var qL="DropdownMenuSeparator",gS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(TL,{...o,...s,ref:t})});gS.displayName=qL;var WL="DropdownMenuArrow",GL=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(AL,{...o,...s,ref:t})});GL.displayName=WL;var KL="DropdownMenuSubTrigger",vS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(PL,{...o,...s,ref:t})});vS.displayName=KL;var YL="DropdownMenuSubContent",yS=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,o=Zt(n);return i.jsx(RL,{...o,...s,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});yS.displayName=YL;var JL=aS,QL=oS,XL=lS,wS=dS,xS=uS,bS=hS,CS=fS,SS=mS,ES=pS,_S=gS,NS=vS,jS=yS;const Aw=JL,Pw=QL,ZL=p.forwardRef(({className:e,inset:t,children:n,...s},o)=>i.jsxs(NS,{ref:o,className:Ce("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...s,children:[n,i.jsx(nm,{className:"ml-auto h-4 w-4"})]}));ZL.displayName=NS.displayName;const eM=p.forwardRef(({className:e,...t},n)=>i.jsx(jS,{ref:n,className:Ce("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));eM.displayName=jS.displayName;const $f=p.forwardRef(({className:e,sideOffset:t=4,...n},s)=>i.jsx(XL,{children:i.jsx(wS,{ref:s,sideOffset:t,className:Ce("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));$f.displayName=wS.displayName;const eo=p.forwardRef(({className:e,inset:t,...n},s)=>i.jsx(bS,{ref:s,className:Ce("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...n}));eo.displayName=bS.displayName;const tM=p.forwardRef(({className:e,children:t,checked:n,...s},o)=>i.jsxs(CS,{ref:o,className:Ce("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:n,...s,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(ES,{children:i.jsx(er,{className:"h-4 w-4"})})}),t]}));tM.displayName=CS.displayName;const nM=p.forwardRef(({className:e,children:t,...n},s)=>i.jsxs(SS,{ref:s,className:Ce("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(ES,{children:i.jsx(xj,{className:"h-2 w-2 fill-current"})})}),t]}));nM.displayName=SS.displayName;const rM=p.forwardRef(({className:e,inset:t,...n},s)=>i.jsx(xS,{ref:s,className:Ce("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));rM.displayName=xS.displayName;const sM=p.forwardRef(({className:e,...t},n)=>i.jsx(_S,{ref:n,className:Ce("-mx-1 my-1 h-px bg-muted",e),...t}));sM.displayName=_S.displayName;var kS="AlertDialog",[aM]=Mn(kS,[aC]),$r=aC(),TS=e=>{const{__scopeAlertDialog:t,...n}=e,s=$r(t);return i.jsx(Hm,{...s,...n,modal:!0})};TS.displayName=kS;var iM="AlertDialogTrigger",oM=p.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...s}=e,o=$r(n);return i.jsx(bC,{...o,...s,ref:t})});oM.displayName=iM;var lM="AlertDialogPortal",AS=e=>{const{__scopeAlertDialog:t,...n}=e,s=$r(t);return i.jsx(Vm,{...s,...n})};AS.displayName=lM;var cM="AlertDialogOverlay",PS=p.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...s}=e,o=$r(n);return i.jsx(Io,{...o,...s,ref:t})});PS.displayName=cM;var Wa="AlertDialogContent",[dM,uM]=aM(Wa),hM=Zw("AlertDialogContent"),RS=p.forwardRef((e,t)=>{const{__scopeAlertDialog:n,children:s,...o}=e,l=$r(n),c=p.useRef(null),u=Ye(t,c),h=p.useRef(null);return i.jsx(CO,{contentName:Wa,titleName:IS,docsSlug:"alert-dialog",children:i.jsx(dM,{scope:n,cancelRef:h,children:i.jsxs(Do,{role:"alertdialog",...l,...o,ref:u,onOpenAutoFocus:we(o.onOpenAutoFocus,f=>{f.preventDefault(),h.current?.focus({preventScroll:!0})}),onPointerDownOutside:f=>f.preventDefault(),onInteractOutside:f=>f.preventDefault(),children:[i.jsx(hM,{children:s}),i.jsx(mM,{contentRef:c})]})})})});RS.displayName=Wa;var IS="AlertDialogTitle",DS=p.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...s}=e,o=$r(n);return i.jsx(Oo,{...o,...s,ref:t})});DS.displayName=IS;var OS="AlertDialogDescription",LS=p.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...s}=e,o=$r(n);return i.jsx(Lo,{...o,...s,ref:t})});LS.displayName=OS;var fM="AlertDialogAction",MS=p.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...s}=e,o=$r(n);return i.jsx(Cd,{...o,...s,ref:t})});MS.displayName=fM;var $S="AlertDialogCancel",FS=p.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...s}=e,{cancelRef:o}=uM($S,n),l=$r(n),c=Ye(t,o);return i.jsx(Cd,{...l,...s,ref:c})});FS.displayName=$S;var mM=({contentRef:e})=>{const t=`\`${Wa}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Wa}\` by passing a \`${OS}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Wa}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return p.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},pM=TS,gM=AS,US=PS,BS=RS,zS=MS,HS=FS,VS=DS,qS=LS;const tr=pM,vM=gM,WS=p.forwardRef(({className:e,...t},n)=>i.jsx(US,{className:Ce("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));WS.displayName=US.displayName;const An=p.forwardRef(({className:e,...t},n)=>i.jsxs(vM,{children:[i.jsx(WS,{}),i.jsx(BS,{ref:n,className:Ce("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));An.displayName=BS.displayName;const Pn=({className:e,...t})=>i.jsx("div",{className:Ce("flex flex-col space-y-2 text-center sm:text-left",e),...t});Pn.displayName="AlertDialogHeader";const Rn=({className:e,...t})=>i.jsx("div",{className:Ce("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Rn.displayName="AlertDialogFooter";const In=p.forwardRef(({className:e,...t},n)=>i.jsx(VS,{ref:n,className:Ce("text-lg font-semibold",e),...t}));In.displayName=VS.displayName;const Dn=p.forwardRef(({className:e,...t},n)=>i.jsx(qS,{ref:n,className:Ce("text-sm text-muted-foreground",e),...t}));Dn.displayName=qS.displayName;const yr=p.forwardRef(({className:e,...t},n)=>i.jsx(zS,{ref:n,className:Ce(Pm(),e),...t}));yr.displayName=zS.displayName;const On=p.forwardRef(({className:e,...t},n)=>i.jsx(HS,{ref:n,className:Ce(Pm({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));On.displayName=HS.displayName;const Ft=()=>{const e=bn(),t=rt(),{toast:n}=_t(),s=()=>{const C=e.pathname;if(C.includes("/child/"))return"child";if(C.includes("/parent/"))return null;if(document.cookie.includes("sb-")||localStorage.getItem("sb-"))return"parent";const N=localStorage.getItem("childSession");if(N)try{return JSON.parse(N),"child"}catch{}return null},[o,l]=p.useState(s),[c,u]=p.useState(!1),[h,f]=p.useState(!1),g=_C(),v=NC();p.useEffect(()=>{(async()=>{const w=e.pathname;if(w.includes("/child/")){const N=localStorage.getItem("childSession");if(N)try{JSON.parse(N),l("child");return}catch{}}if(w.includes("/parent/"))try{const{data:{session:N}}=await Y.auth.getSession();if(N){l("parent");return}}catch(N){console.error("Error checking parent session:",N)}try{const{data:{session:N}}=await Y.auth.getSession();if(N)l("parent");else{const _=localStorage.getItem("childSession");if(_)try{JSON.parse(_),l("child")}catch{l(null)}else l(null)}}catch(N){console.error("Error checking parent session:",N),l(null)}})()},[e.pathname]);const b=async()=>{if(o==="child"){const C=localStorage.getItem("childSession");if(C)try{const w=JSON.parse(C)}catch{}localStorage.removeItem("childSession"),tt.getState().reset(),n({title:"Logged out"}),t("/child/login")}else if(o==="parent"){const{data:{user:C}}=await Y.auth.getUser();await Y.auth.signOut(),tt.getState().reset(),n({title:"Logged out"}),t("/parent/auth")}};if(c||!o||e.pathname.includes("/auth")||e.pathname.includes("/login")||e.pathname.includes("/call/")||e.pathname.includes("/chat/"))return null;const x=({isActive:C})=>Ce("flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors relative",C?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent hover:text-accent-foreground"),S=({count:C})=>C===0?null:i.jsx("span",{className:"absolute -top-1 -right-1 bg-destructive text-destructive-foreground text-xs font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1 border-2 border-background",children:C>99?"99+":C});return o==="parent"?i.jsxs(i.Fragment,{children:[i.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 border-b bg-background w-full overflow-x-hidden",style:{paddingTop:"calc(var(--safe-area-inset-top) * 0.15)"},children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full",children:i.jsxs("div",{className:"flex items-center justify-between h-16 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-shrink","data-tour":"parent-menu",children:[i.jsxs(Vs,{to:"/parent",className:x,children:[i.jsx(Xs,{className:"h-4 w-4"}),i.jsx("span",{children:"Home"})]}),i.jsxs(Vs,{to:"/parent/dashboard",className:x,children:[i.jsxs("div",{className:"relative flex items-center justify-center",children:[i.jsx(ny,{className:"h-4 w-4"}),i.jsx(S,{count:v})]}),i.jsx("span",{children:"Dashboard"})]}),i.jsxs(Vs,{to:"/parent/children",className:x,children:[i.jsxs("div",{className:"relative flex items-center justify-center",children:[i.jsx(co,{className:"h-4 w-4"}),i.jsx(S,{count:g})]}),i.jsx("span",{children:"Children"})]}),i.jsxs(Aw,{children:[i.jsx(Pw,{asChild:!0,children:i.jsxs("button",{className:Ce("flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",e.pathname==="/parent/devices"||e.pathname==="/parent/settings"||e.pathname==="/info"?"bg-accent text-accent-foreground":"text-muted-foreground hover:bg-accent hover:text-accent-foreground"),children:[i.jsx(ey,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden sm:inline",children:"More"})]})}),i.jsxs($f,{align:"end",className:"w-48",children:[i.jsxs(eo,{onClick:()=>t("/parent/devices"),children:[i.jsx(Sc,{className:"mr-2 h-4 w-4"}),i.jsx("span",{children:"Devices"})]}),i.jsxs(eo,{onClick:()=>t("/parent/settings"),children:[i.jsx(Px,{className:"mr-2 h-4 w-4"}),i.jsx("span",{children:"Settings"})]}),i.jsxs(eo,{onClick:()=>t("/info"),children:[i.jsx(Rc,{className:"mr-2 h-4 w-4"}),i.jsx("span",{children:"App Information"})]})]})]})]}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>f(!0),className:"flex-shrink-0",children:[i.jsx(ry,{className:"h-4 w-4 md:mr-2"}),i.jsx("span",{className:"hidden md:inline",children:"Logout"})]})]})})}),i.jsx(tr,{open:h,onOpenChange:f,children:i.jsxs(An,{children:[i.jsxs(Pn,{children:[i.jsx(In,{children:"Confirm Logout"}),i.jsx(Dn,{children:"Are you sure you want to log out? You'll need to sign in again to access your account."})]}),i.jsxs(Rn,{children:[i.jsx(On,{children:"Cancel"}),i.jsx(yr,{onClick:b,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Logout"})]})]})})]}):o==="child"?i.jsxs(i.Fragment,{children:[i.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 border-b bg-background w-full overflow-x-hidden",style:{paddingTop:"calc(var(--safe-area-inset-top) * 0.15)"},children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full",children:i.jsxs("div",{className:"flex items-center justify-between h-16 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-shrink","data-tour":"child-help",children:[i.jsxs(Vs,{to:"/child",className:x,children:[i.jsx(Xs,{className:"h-4 w-4"}),i.jsx("span",{children:"Home"})]}),i.jsxs(Vs,{to:"/child/dashboard",className:x,children:[i.jsxs("div",{className:"relative flex items-center justify-center",children:[i.jsx(ny,{className:"h-4 w-4"}),i.jsx(S,{count:v})]}),i.jsx("span",{children:"Dashboard"})]}),i.jsxs(Vs,{to:"/child/parents",className:x,children:[i.jsxs("div",{className:"relative flex items-center justify-center",children:[i.jsx(co,{className:"h-4 w-4"}),i.jsx(S,{count:g})]}),i.jsx("span",{children:"Parents"})]}),i.jsxs(Aw,{children:[i.jsx(Pw,{asChild:!0,children:i.jsxs("button",{className:Ce("flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",e.pathname==="/info"?"bg-accent text-accent-foreground":"text-muted-foreground hover:bg-accent hover:text-accent-foreground"),children:[i.jsx(ey,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden sm:inline",children:"More"})]})}),i.jsx($f,{align:"end",className:"w-48",children:i.jsxs(eo,{onClick:()=>t("/info"),children:[i.jsx(Rc,{className:"mr-2 h-4 w-4"}),i.jsx("span",{children:"App Information"})]})})]})]}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>f(!0),className:"flex-shrink-0",children:[i.jsx(ry,{className:"h-4 w-4 md:mr-2"}),i.jsx("span",{className:"hidden md:inline",children:"Logout"})]})]})})}),i.jsx(tr,{open:h,onOpenChange:f,children:i.jsxs(An,{children:[i.jsxs(Pn,{children:[i.jsx(In,{children:"Confirm Logout"}),i.jsx(Dn,{children:"Are you sure you want to log out? You'll need to sign in again to access your account."})]}),i.jsxs(Rn,{children:[i.jsx(On,{children:"Cancel"}),i.jsx(yr,{onClick:b,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Logout"})]})]})})]}):null},yM=()=>{const[e,t]=p.useState(!document.hidden),[n,s]=p.useState(!document.hidden);return p.useEffect(()=>{const o=()=>{const u=!document.hidden;t(u),u&&s(!0)};t(!document.hidden),s(!document.hidden),document.addEventListener("visibilitychange",o);const l=()=>{t(!0),s(!0)},c=()=>{t(!1)};return window.addEventListener("focus",l),window.addEventListener("blur",c),()=>{document.removeEventListener("visibilitychange",o),window.removeEventListener("focus",l),window.removeEventListener("blur",c)}},[]),{isVisible:e,hasBeenVisible:n,isHidden:!e}},wM=()=>{const e=p.useRef(null),t=p.useRef(null);p.useEffect(()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.js").then(c=>{console.log(" [PUSH] Service Worker registered:",c),e.current=c,c.addEventListener("updatefound",()=>{console.log(" [PUSH] Service Worker update found");const u=c.installing;u&&u.addEventListener("statechange",()=>{u.state==="installed"&&navigator.serviceWorker.controller&&console.log(" [PUSH] New service worker installed, reload to activate")})})}).catch(c=>{console.error(" [PUSH] Service Worker registration failed:",c)}),navigator.serviceWorker.addEventListener("message",c=>{if(console.log(" [PUSH] Message from service worker:",c.data),c.data&&c.data.type==="NOTIFICATION_CLICKED"){const{callId:u,url:h}=c.data;t.current&&t.current({callId:u,url:h})}}))},[]);const n=p.useCallback(async()=>{if(!("Notification"in window))return console.warn(" [PUSH] This browser does not support notifications"),"denied";if(Notification.permission==="granted")return"granted";if(Notification.permission==="denied")return console.warn(" [PUSH] Notification permission denied"),"denied";const c=await Notification.requestPermission();return console.log(" [PUSH] Notification permission:",c),c},[]),s=p.useCallback(async c=>{if(!("Notification"in window)){console.warn(" [PUSH] Notifications not supported");return}if(await n()!=="granted"){console.warn(" [PUSH] Notification permission not granted");return}if(e.current)try{await e.current.showNotification(c.title,{body:c.body,icon:c.icon||"/icon-192x192.png",badge:c.badge||"/icon-96x96.png",tag:c.tag||"notification",requireInteraction:c.requireInteraction??!0,vibrate:c.vibrate||[200,100,200],data:c.data||{},actions:c.actions||[]}),console.log(" [PUSH] Notification sent via service worker")}catch(h){console.error(" [PUSH] Failed to send notification:",h)}else try{new Notification(c.title,{body:c.body,icon:c.icon||"/icon-192x192.png",tag:c.tag||"notification",requireInteraction:c.requireInteraction??!0,data:c.data||{}}),console.log(" [PUSH] Notification sent via Notification API")}catch(h){console.error(" [PUSH] Failed to send notification:",h)}},[n]),o=p.useCallback(async c=>{e.current&&(await e.current.getNotifications({tag:c})).forEach(h=>h.close())},[]),l=p.useCallback(c=>{t.current=c},[]);return{requestPermission:n,sendNotification:s,closeNotification:o,onNotificationClick:l,hasPermission:"Notification"in window&&Notification.permission==="granted",permission:"Notification"in window?Notification.permission:"default"}},Zm=(e={})=>{const{enabled:t=!0,volume:n=.7}=e,s=p.useRef(null),o=p.useRef(null),l=p.useRef(null),c=p.useRef({}),u=p.useRef([]);p.useEffect(()=>{if(!t)return;try{const _=window.AudioContext||window.webkitAudioContext;s.current=new _,k.log(" [AUDIO] AudioContext created, state:",s.current.state)}catch(_){k.error(" [AUDIO] Failed to create AudioContext:",_)}const w=async()=>{if(s.current&&s.current.state==="suspended")try{await s.current.resume(),k.log(" [AUDIO] AudioContext resumed via user interaction")}catch(_){k.error(" [AUDIO] Failed to resume AudioContext:",_)}};return["click","touchstart","keydown","mousedown"].forEach(_=>{document.addEventListener(_,w,{passive:!0}),u.current.push({event:_,handler:w})}),w(),()=>{if(c.current.ringtone&&(c.current.ringtone=!1),o.current&&(clearInterval(o.current),o.current=null),l.current&&(clearInterval(l.current),l.current=null),"vibrate"in navigator)try{navigator.vibrate(0)}catch{}u.current.forEach(({event:_,handler:j})=>{document.removeEventListener(_,j)}),u.current=[],s.current&&(s.current.close().catch(_=>k.error("Error:",_)),s.current=null)}},[t]);const h=p.useCallback(async()=>{if(!s.current)try{const w=window.AudioContext||window.webkitAudioContext;s.current=new w,k.log(" [AUDIO] AudioContext created, initial state:",s.current.state)}catch(w){return k.error(" [AUDIO] Failed to create AudioContext:",w),null}if(s.current.state==="suspended")try{k.log(" [AUDIO] AudioContext is suspended, attempting to resume..."),await s.current.resume(),k.log(" [AUDIO] AudioContext resumed successfully, state:",s.current.state)}catch(w){k.error(" [AUDIO] Failed to resume AudioContext:",w);try{await new Promise(N=>setTimeout(N,100)),s.current.state==="suspended"&&(await s.current.resume(),k.log(" [AUDIO] AudioContext resumed on retry, state:",s.current.state))}catch(N){return k.error(" [AUDIO] Failed to resume AudioContext on retry:",N),k.warn(" [AUDIO] AudioContext requires user interaction. Ringtone may not play until user interacts with page."),null}}return s.current},[]),f=p.useCallback(()=>{if(!(!t||!("vibrate"in navigator)))try{const w=()=>{if(c.current.ringtone&&"vibrate"in navigator)try{navigator.vibrate([200,100,200])}catch{}};w(),l.current=setInterval(()=>{c.current.ringtone&&w()},2e3),k.log(" [AUDIO] Vibration started")}catch{}},[t]),g=p.useCallback(async()=>{if(!t){k.log(" [AUDIO] Audio notifications disabled");return}if(c.current.ringtone){k.log(" [AUDIO] Ringtone already playing");return}const w=await h();if(!w){k.error(" [AUDIO] Cannot play ringtone - AudioContext not available");return}try{c.current.ringtone=!0,k.log(" [AUDIO] Ringtone started, AudioContext state:",w.state);const N=()=>{if(!(!c.current.ringtone||!s.current))try{const _=s.current.createOscillator(),j=s.current.createGain();_.connect(j),j.connect(s.current.destination),_.frequency.value=800,_.type="sine";const T=s.current.currentTime;j.gain.setValueAtTime(0,T),j.gain.linearRampToValueAtTime(n*.4,T+.05),j.gain.linearRampToValueAtTime(n*.4,T+.2),j.gain.linearRampToValueAtTime(0,T+.25),_.start(T),_.stop(T+.25)}catch(_){k.error(" [AUDIO] Error playing tone:",_)}};N(),f(),o.current=setInterval(()=>{c.current.ringtone&&(N(),setTimeout(()=>{c.current.ringtone&&N()},250))},2e3)}catch(N){k.error(" [AUDIO] Error playing ringtone:",N),c.current.ringtone=!1}},[t,n,h,f]),v=p.useCallback(()=>{if(l.current&&(clearInterval(l.current),l.current=null),"vibrate"in navigator)try{navigator.vibrate(0)}catch{}k.log(" [AUDIO] Vibration stopped")},[]),b=p.useCallback(()=>{c.current.ringtone&&(c.current.ringtone=!1,o.current&&(clearInterval(o.current),o.current=null),v(),k.log(" [AUDIO] Ringtone stopped"))},[v]),x=p.useCallback(async()=>{if(!t)return;const w=await h();if(w)try{const N=w.createOscillator(),_=w.createGain();N.connect(_),_.connect(w.destination),N.frequency.value=400,N.type="sine";const j=w.currentTime;_.gain.setValueAtTime(0,j),_.gain.linearRampToValueAtTime(n*.3,j+.05),_.gain.linearRampToValueAtTime(0,j+.2),N.start(j),N.stop(j+.2),k.log(" [AUDIO] Call ended sound played")}catch(N){k.error(" [AUDIO] Error playing call ended sound:",N)}},[t,n,h]),S=p.useCallback(async()=>{if(!t)return;const w=await h();if(w)try{[600,800].forEach((N,_)=>{const j=w.createOscillator(),T=w.createGain();j.connect(T),T.connect(w.destination),j.frequency.value=N,j.type="sine";const R=w.currentTime+_*.1;T.gain.setValueAtTime(0,R),T.gain.linearRampToValueAtTime(n*.4,R+.05),T.gain.linearRampToValueAtTime(0,R+.15),j.start(R),j.stop(R+.15)}),k.log(" [AUDIO] Call answered sound played")}catch(N){k.error(" [AUDIO] Error playing call answered sound:",N)}},[t,n,h]),C=p.useCallback(w=>{w==="ringtone"&&b()},[b]);return{playRingtone:g,stopRingtone:b,startVibration:f,stopVibration:v,playCallEnded:x,playCallAnswered:S,stopSound:C,isPlaying:c.current}},ep=(e={})=>{const{enabled:t=!0,volume:n=.7}=e,s=rt(),{isVisible:o,hasBeenVisible:l}=yM(),{sendNotification:c,closeNotification:u,onNotificationClick:h,hasPermission:f}=wM(),{playRingtone:g,stopRingtone:v}=Zm({enabled:t,volume:n}),b=p.useRef(null),x=p.useRef(!1);p.useEffect(()=>{h(w=>{console.log(" [CALL NOTIFICATIONS] Notification clicked, starting ringtone",w),u("incoming-call"),w.url&&s(w.url),w.callId===b.current&&g().catch(N=>{console.error(" [CALL NOTIFICATIONS] Failed to play ringtone after notification click:",N)})})},[h,u,s,g]);const S=p.useCallback(async w=>{t&&(b.current=w.callId,x.current=!1,console.log(" [CALL NOTIFICATIONS] Handling incoming call:",{callId:w.callId,isVisible:o,hasBeenVisible:l}),o&&l?(console.log(" [CALL NOTIFICATIONS] Tab is active, playing ringtone immediately"),g().catch(N=>{console.error(" [CALL NOTIFICATIONS] Failed to play ringtone:",N)})):(console.log(" [CALL NOTIFICATIONS] Tab is not active, showing push notification"),await c({title:"Incoming Call",body:w.callerName?`${w.callerName} is calling...`:"You have an incoming call",icon:"/icon-192x192.png",badge:"/icon-96x96.png",tag:"incoming-call",requireInteraction:!0,vibrate:[200,100,200,100,200],data:{callId:w.callId,callerName:w.callerName,callerId:w.callerId,url:w.url}}),x.current=!0))},[t,o,l,f,c,g]);p.useEffect(()=>{o&&b.current&&l&&x.current&&(console.log(" [CALL NOTIFICATIONS] Tab became visible, starting ringtone"),g().catch(w=>{console.error(" [CALL NOTIFICATIONS] Failed to play ringtone when tab became visible:",w)}))},[o,l,g]);const C=p.useCallback(async w=>{b.current===w&&(console.log(" [CALL NOTIFICATIONS] Stopping incoming call notifications:",w),v(),await u("incoming-call"),b.current=null,x.current=!1)},[v,u]);return p.useEffect(()=>()=>{b.current&&C(b.current)},[C]),{handleIncomingCall:S,stopIncomingCall:C,hasActiveCall:b.current!==null,activeCallId:b.current}};async function ta({callId:e,by:t,reason:n="hangup"}){k.log(" [CALL LIFECYCLE] End requested",{callId:e,by:t,reason:n,timestamp:new Date().toISOString()});let s=null;try{const{data:f,error:g}=await Y.from("calls").select("id, status, ended_at").eq("id",e).maybeSingle();g?k.warn(" [CALL LIFECYCLE] Error checking call status (will continue):",g):s=f}catch(f){k.warn(" [CALL LIFECYCLE] Exception checking call status (will continue):",f)}if(s&&(s.status==="ended"||s.ended_at))return k.log(" [CALL LIFECYCLE] Call already ended (idempotent)",{callId:e,status:s.status,ended_at:s.ended_at}),s;let o=null,l=null;const c={status:"ended",ended_at:new Date().toISOString(),ended_by:t,end_reason:n},{data:u,error:h}=await Y.from("calls").update(c).eq("id",e).select("id, status, ended_at, ended_by, end_reason").single();if(o=u,l=h,l&&(l.code==="PGRST204"||l.code==="406"||l.message?.includes("end_reason")||l.message?.includes("ended_by")||l.message?.includes("ended_at")||l.message?.includes("Not Acceptable"))){k.warn(" [CALL LIFECYCLE] Update failed (possibly schema issue), trying fallback",{callId:e,errorCode:l.code,errorMessage:l.message});let f=null;try{const{error:g}=await Y.rpc("ensure_call_ending_columns");f=g}catch{f={message:"RPC function not available"}}if(!f){k.log(" [CALL LIFECYCLE] Columns created, retrying update",{callId:e});const{data:g,error:v}=await Y.from("calls").update({status:"ended",ended_at:new Date().toISOString(),ended_by:t,end_reason:n}).eq("id",e).select("id, status, ended_at, ended_by, end_reason").single();v?l=v:(o=g,l=null,k.log(" [CALL LIFECYCLE] Call ended successfully after creating columns",{callId:e}))}if(l){k.warn(" [CALL LIFECYCLE] Column creation failed or retry failed, falling back to basic update",{callId:e});const{data:g,error:v}=await Y.from("calls").update({status:"ended"}).eq("id",e).select("id, status").single();if(!v)o={...g,ended_at:null},l=null,k.log(" [CALL LIFECYCLE] Call ended with simple update (columns not available)",{callId:e});else{const{data:b}=await Y.from("calls").select("id, status").eq("id",e).maybeSingle();if(b?.status==="ended")o={...b,ended_at:null},l=null,k.log(" [CALL LIFECYCLE] Call already ended (idempotent)",{callId:e});else return k.warn(" [CALL LIFECYCLE] Fallback update failed, but continuing",{callId:e,error:v,currentStatus:b?.status}),null}}}if(!l&&o)try{await Y.rpc("increment_call_version",{call_id:e})}catch{k.log(" [CALL LIFECYCLE] Version increment RPC not available (optional)",{callId:e})}if(l){if(l.code==="PGRST116"||l.message?.includes("No rows")){k.log(" [CALL LIFECYCLE] No rows updated - call may already be ended (idempotent)",{callId:e});const{data:f}=await Y.from("calls").select("id, status, ended_at").eq("id",e).maybeSingle();return f}if(l.code==="406"||l.message?.includes("Not Acceptable")){k.warn(" [CALL LIFECYCLE] 406 error detected, trying simple status update",{callId:e});const{data:f,error:g}=await Y.from("calls").update({status:"ended"}).eq("id",e).select("id, status").single();if(!g&&f)return k.log(" [CALL LIFECYCLE] Call ended with simple status update",{callId:e}),{...f,ended_at:null}}return k.error(" [CALL LIFECYCLE] Error ending call:",l),null}return o&&k.log(" [CALL LIFECYCLE] Call ended successfully",{callId:o.id,status:o.status,ended_at:o.ended_at,ended_by:o.ended_by,end_reason:o.end_reason}),o}function Xt(e){return e.status==="ended"||!!e.ended_at}const Jh=[{id:"parent-child-name-status",selector:'[data-tour="parent-child-name-status"]',title:"Child Status",description:"Your child's name and online status. Green dot means they're online and available to call.",placement:"bottom"},{id:"parent-login-code",selector:'[data-tour="parent-login-code"]',title:"Login Code",description:"This is your child's unique login code. Share this code with them so they can log in to their account.",placement:"bottom"},{id:"parent-copy-code",selector:'[data-tour="parent-copy-code"]',title:"Copy Code",description:"Tap this button to copy the login code to your clipboard. Easy way to share it via text or email.",placement:"bottom"},{id:"parent-copy-link",selector:'[data-tour="parent-copy-link"]',title:"Copy Link",description:"Copy a magic link that includes the login code. Your child can tap the link to log in automatically.",placement:"bottom"},{id:"parent-print-code",selector:'[data-tour="parent-print-code"]',title:"Print Code",description:"Print the login code on a card or paper. Great for giving to your child to keep handy.",placement:"bottom"},{id:"parent-view-qr",selector:'[data-tour="parent-view-qr"]',title:"View QR Code",description:"See a QR code version of the login code. Your child can scan it with their device camera to log in.",placement:"bottom"},{id:"parent-call-button",selector:'[data-tour="parent-call-button"]',title:"Start a Video Call",description:"Tap this button to start a video call with your child. Make sure they're online (green dot) for best results.",placement:"bottom"},{id:"parent-messages",selector:'[data-tour="parent-messages"]',title:"Send Messages",description:"Send text messages to your child. Perfect for quick notes when they can't answer a call.",placement:"bottom"},{id:"parent-delete-child",selector:'[data-tour="parent-delete-child"]',title:"Delete Child",description:"Remove this child from your account. Use with caution - this action cannot be undone.",placement:"bottom"},{id:"parent-upgrade-plan",selector:'[data-tour="parent-upgrade-plan"]',title:"Upgrade Plan",description:"Tap here to upgrade your subscription and add more children to your account. View available plans and pricing.",placement:"bottom"},{id:"parent-upgrade-limit",selector:'[data-tour="parent-upgrade-limit"]',title:"Upgrade When Limit Reached",description:"When you reach your subscription limit, tap this button to upgrade and add more children to your account.",placement:"bottom"},{id:"parent-menu",selector:'[data-tour="parent-menu"]',title:"Navigation Menu",description:"Use the menu at the top to navigate between pages: Home, Dashboard, Children, Devices, Settings, and App Information.",placement:"bottom"}],Qh=[{id:"child-answer-button",selector:'[data-tour="child-answer-button"]',description:"Tap this to talk to mom or dad. ",placement:"bottom"},{id:"child-messages",selector:'[data-tour="child-messages"]',description:"Tap here to see messages. ",placement:"bottom"},{id:"child-help",selector:'[data-tour="child-help"]',description:"Use the navigation menu to switch between pages.",placement:"bottom"}],xM=[{id:"parent-home-view-children",selector:'[data-tour="parent-home-view-children"]',title:"View Children",description:"Tap here to see all your children and their profiles.",placement:"bottom"},{id:"parent-home-dashboard",selector:'[data-tour="parent-home-dashboard"]',title:"Go to Dashboard",description:"Access the full dashboard to manage children, login codes, and more.",placement:"bottom"}],bM=[{id:"parent-children-list-card",selector:'[data-tour="parent-children-list-card"]',title:"Child Profile",description:"Each card shows your child's name, online status, and login code.",placement:"bottom"},{id:"parent-children-list-call",selector:'[data-tour="parent-children-list-call"]',title:"Call Your Child",description:"Tap the Call button to start a video call with your child.",placement:"bottom"},{id:"parent-children-list-message",selector:'[data-tour="parent-children-list-message"]',title:"Send Message",description:"Tap the Message button to send a text message to your child.",placement:"bottom"}],CM=[{id:"parent-devices-list",selector:'[data-tour="parent-devices-list"]',title:"Device Management",description:"View and manage all devices that can access your account. You can remove devices for security.",placement:"bottom"}],SM=[{id:"parent-upgrade-plans",selector:'[data-tour="parent-upgrade-plans"]',title:"Subscription Plans",description:"Choose a plan that fits your needs. Monthly or annual billing available.",placement:"bottom"}],EM=[{id:"parent-settings-account",selector:'[data-tour="parent-settings-account"]',title:"Account Settings",description:"Manage your account information, subscription, and children limit here.",placement:"bottom"},{id:"parent-settings-upgrade",selector:'[data-tour="parent-settings-upgrade"]',title:"Upgrade Subscription",description:"Tap here to upgrade your plan and add more children to your account.",placement:"bottom"}],_M=[{id:"child-home-parents",selector:'[data-tour="child-home-parents"]',description:"Tap here to see your parents and start a call. ",placement:"bottom"}],NM=[{id:"child-parents-list-card",selector:'[data-tour="child-parents-list-card"]',description:"Tap a parent's card to call them. ",placement:"bottom"}];function jM(e,t){if(t)switch(t){case"parent_home":return xM;case"parent_dashboard":return Jh;case"parent_children_list":return bM;case"parent_devices":return CM;case"parent_upgrade":return SM;case"parent_settings":return EM;case"child_home":return _M;case"child_dashboard":return Qh;case"child_parents_list":return NM;default:return e==="parent"?Jh:Qh}return e==="parent"?Jh:Qh}function kM(){if(typeof window<"u"&&window.Capacitor||typeof window<"u"&&window.cordova||typeof window<"u"&&window.ReactNativeWebView)return!0;const e=navigator.userAgent.toLowerCase();return!!(e.includes("capacitor")||e.includes("cordova")||e.includes("ionic"))}async function GS(){try{if(typeof window<"u"&&window.Capacitor?.Plugins?.MacAddress)try{const e=await window.Capacitor.Plugins.MacAddress.getMacAddress();if(e?.macAddress)return e.macAddress}catch{}if(typeof window<"u"&&window.Capacitor?.Plugins?.Network)try{const e=window.Capacitor.Plugins.Network;if(e.getMacAddress){const t=await e.getMacAddress();if(t)return t}}catch{}if(typeof window<"u"&&window.Capacitor?.Plugins?.DeviceInfo)try{const e=await window.Capacitor.Plugins.DeviceInfo.getMacAddress();if(e?.macAddress)return e.macAddress}catch{}if(typeof window<"u"&&window.device){const e=window.device;if(e.macAddress)return e.macAddress}typeof window<"u"&&window.ReactNativeWebView}catch(e){console.warn("Failed to get MAC address:",e)}return null}async function TM(){try{if(typeof window<"u"&&window.Capacitor?.Plugins?.Device){const e=await window.Capacitor.Plugins.Device.getInfo();if(e?.id)return`native-${e.id}`}if(typeof window<"u"&&window.device){const e=window.device;if(e?.uuid)return`cordova-${e.uuid}`}typeof window<"u"&&window.ReactNativeWebView}catch(e){console.warn("Failed to get native device ID:",e)}return null}function li(){return KS()}async function AM(){return kM()?await GS():null}async function PM(){const e=await GS();if(e)return`mac-${e.replace(/:/g,"").toLowerCase()}`;const t=await TM();return t||KS()}function KS(){const e=document.createElement("canvas");e.getContext("2d")?.fillText("DeviceID",2,2);const n=e.toDataURL(),s=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,screen.colorDepth||"unknown",new Date().getTimezoneOffset(),navigator.platform,navigator.vendor||"unknown",n.substring(0,50),navigator.hardwareConcurrency||"unknown",navigator.deviceMemory||"unknown",navigator.maxTouchPoints||"0",window.devicePixelRatio||"1",navigator.cookieEnabled?"1":"0",navigator.doNotTrack||"unknown"].join("|");let o=0;for(let l=0;l<s.length;l++){const c=s.charCodeAt(l);o=(o<<5)-o+c,o=o&o}return`web-${Math.abs(o).toString(36).substring(0,16)}`}function YS(){const e=navigator.userAgent.toLowerCase();return/tablet|ipad|playbook|silk/i.test(e)?"tablet":/mobile|iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(e)?"mobile":/desktop|windows|macintosh|linux/i.test(e)?"desktop":"other"}function RM(){const e=navigator.userAgent,t=YS();if(e.includes("iPad")){const n=e.match(/iPad(\d+,\d+)/i);return n?`iPad ${n[1]}`:"iPad"}if(e.includes("iPhone")){const n=e.match(/iPhone(\d+,\d+)/i);return n?`iPhone ${n[1]}`:"iPhone"}if(e.includes("Android")){const n=e.match(/Android.*?; ([^)]+)\)/);if(n){const s=n[1].trim();return s.startsWith("SM-")?`Samsung ${s.substring(3)}`:s.startsWith("LM-")?`LG ${s.substring(3)}`:s}return"Android Device"}if(e.includes("Macintosh")){const n=e.match(/Mac OS X ([\d_]+)/i);return n?`Mac (macOS ${n[1].replace(/_/g,".")})`:"Mac"}return e.includes("Windows")?e.includes("Windows NT 10.0")?"Windows PC (Windows 10/11)":e.includes("Windows NT 6.3")?"Windows PC (Windows 8.1)":e.includes("Windows NT 6.2")?"Windows PC (Windows 8)":e.includes("Windows NT 6.1")?"Windows PC (Windows 7)":"Windows PC":e.includes("Linux")?"Linux PC":t.charAt(0).toUpperCase()+t.slice(1)}async function IM(){try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip||null}catch{return null}}async function DM(e){if(!e)return null;try{const{getCountryFromIP:t}=await xr(async()=>{const{getCountryFromIP:s}=await Promise.resolve().then(()=>k4);return{getCountryFromIP:s}},void 0);return(await t(e)).countryCode||null}catch(t){return console.warn("Failed to get country from IP:",t),null}}const Ff=Object.freeze(Object.defineProperty({__proto__:null,detectDeviceType:YS,generateDeviceIdentifier:li,generateDeviceIdentifierAsync:PM,getClientIP:IM,getCountryFromIP:DM,getDeviceMacAddress:AM,getDeviceName:RM},Symbol.toStringTag,{value:"Module"})),JS="kch_tour_";function QS(e,t){return`${JS}${e}_${t}_done`}function XS(e,t){return`${JS}${e}_${t}_device`}function OM(e,t){const n=QS(e,t);return localStorage.getItem(n)==="true"}function Rw(e,t){const n=QS(e,t);localStorage.setItem(n,"true");const s=XS(e,t),o=li();localStorage.setItem(s,o)}function LM(e,t){const n=XS(e,t),s=localStorage.getItem(n);if(!s)return!0;const o=li();return s!==o}function ZS({role:e,pageKey:t}){const n=jM(e,t),[s,o]=p.useState(0),[l,c]=p.useState(!1);p.useEffect(()=>{!OM(e,t)&&LM(e,t)&&(c(!0),o(0))},[e,t]),p.useEffect(()=>{const x=S=>{S.detail.role===e&&S.detail.pageKey===t&&(c(!0),o(0))};return window.addEventListener("onboarding:restart",x),()=>{window.removeEventListener("onboarding:restart",x)}},[e,t]);const u=p.useCallback(()=>{c(!0),o(0)},[]),h=p.useCallback(()=>{s<n.length-1?o(s+1):v()},[s,n.length]),f=p.useCallback(()=>{s>0&&o(s-1)},[s]),g=p.useCallback(()=>{Rw(e,t),c(!1),o(0)},[e,t]),v=p.useCallback(()=>{Rw(e,t),c(!1),o(0)},[e,t]);return{activeStep:l&&s<n.length?n[s]:null,stepIndex:s,totalSteps:n.length,isRunning:l,start:u,next:h,back:f,skip:g,finish:v}}const eE="kch_tour_";function MM(e,t){return`${eE}${e}_${t}_done`}function Fr({role:e,pageKey:t}){const{isRunning:n}=ZS({role:e,pageKey:t}),s=()=>{const o=MM(e,t);localStorage.removeItem(o);const l=`${eE}${e}_${t}_device`;localStorage.removeItem(l),window.dispatchEvent(new CustomEvent("onboarding:restart",{detail:{role:e,pageKey:t}}))};return n?null:i.jsx(de,{onClick:s,className:"fixed right-4 sm:right-6 h-12 w-12 rounded-full shadow-lg z-50 safe-area-bottom",style:{bottom:"calc(1rem + var(--safe-area-inset-bottom))"},size:"icon",variant:"default","aria-label":"Show help tour",title:"Show me around",children:i.jsx(yj,{className:"h-5 w-5"})})}function Ur({role:e,pageKey:t}){const{activeStep:n,stepIndex:s,totalSteps:o,isRunning:l,next:c,back:u,skip:h,finish:f}=ZS({role:e,pageKey:t}),[g,v]=p.useState(null),[b,x]=p.useState(null),S=p.useRef(null);p.useEffect(()=>{if(!n||!l){x(null),v(null);return}const j=document.querySelector(n.selector);if(!j){console.warn(`Onboarding: Element not found for selector "${n.selector}"`),setTimeout(()=>{c()},100);return}x(j);const T=()=>{const R=j.getBoundingClientRect(),A=n.placement||"bottom",I=24,L=window.innerWidth,M=L<640?Math.min(L-32,320):320,U=140,D=16,B=window.innerHeight;let z=0,q=0;const H=R.top-8,Q=R.bottom+8,$=R.left-8,O=R.right+8;switch(A){case"top":z=H-U-I,q=R.left+R.width/2-M/2;break;case"bottom":z=Q+I,q=R.left+R.width/2-M/2;break;case"left":z=R.top+R.height/2-U/2,q=$-M-I;break;case"right":z=R.top+R.height/2-U/2,q=O+I;break}const J=q+M,F=z+U,ee=q,ce=z,K=ee<O&&J>$,W=ce<Q&&F>H;K&&W&&(A==="top"||A==="bottom"?O+I+M<L-D?(q=O+I,z=Math.max(D,Math.min(R.top+R.height/2-U/2,B-U-D))):$-I-M>D?(q=$-I-M,z=Math.max(D,Math.min(R.top+R.height/2-U/2,B-U-D))):A==="top"?(z=H-U-I*2,q=Math.max(D,Math.min(q,L-M-D))):(z=Q+I*2,q=Math.max(D,Math.min(q,L-M-D))):(A==="left"||A==="right")&&(Q+I+U<B-D?(z=Q+I,q=Math.max(D,Math.min(R.left+R.width/2-M/2,L-M-D))):H-I-U>D?(z=H-I-U,q=Math.max(D,Math.min(R.left+R.width/2-M/2,L-M-D))):A==="left"?(q=$-M-I*2,z=Math.max(D,Math.min(z,B-U-D))):(q=O+I*2,z=Math.max(D,Math.min(z,B-U-D))))),q<D&&(q=D),q+M>L-D&&(q=L-M-D),z<D&&(z=D),z+U>B-D&&(z=B-U-D);const G=q+M,ae=z+U;q<O&&G>$&&z<Q&&ae>H&&(z=H-U-I*2,q=Math.max(D,Math.min(R.left+R.width/2-M/2,L-M-D)),z<D&&(z=Q+I*2)),v({top:z,left:q,placement:A})};return T(),window.addEventListener("resize",T),window.addEventListener("scroll",T,!0),()=>{window.removeEventListener("resize",T),window.removeEventListener("scroll",T,!0)}},[n,l,c]);const[C,w]=p.useState(null);if(p.useEffect(()=>{if(!b){w(null);return}const j=()=>{const T=b.getBoundingClientRect();w(T)};return j(),window.addEventListener("resize",j),window.addEventListener("scroll",j,!0),()=>{window.removeEventListener("resize",j),window.removeEventListener("scroll",j,!0)}},[b]),p.useEffect(()=>{if(!b)return;const j=b.style.zIndex,T=b.style.position,R=b.style.outline,A=b.style.boxShadow;return b.style.zIndex="10002",getComputedStyle(b).position==="static"&&(b.style.position="relative"),b.style.outline="3px solid hsl(var(--primary))",b.style.outlineOffset="4px",b.style.borderRadius="8px",b.style.boxShadow="0 0 0 4px rgba(0, 0, 0, 0.1), 0 4px 12px rgba(0, 0, 0, 0.15)",b.style.pointerEvents="auto",()=>{b.style.zIndex=j,b.style.position=T,b.style.outline=R,b.style.outlineOffset="",b.style.borderRadius="",b.style.boxShadow=A}},[b]),!l||!n||!g)return null;const N=s===o-1,_=s===0;return i.jsxs(i.Fragment,{children:[C?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"fixed z-[10000] bg-black/50",style:{top:0,left:0,right:0,height:`${Math.max(0,C.top-8)}px`},onClick:h,"aria-hidden":"true"}),i.jsx("div",{className:"fixed z-[10000] bg-black/50",style:{top:`${C.bottom+8}px`,left:0,right:0,bottom:0},onClick:h,"aria-hidden":"true"}),i.jsx("div",{className:"fixed z-[10000] bg-black/50",style:{top:`${Math.max(0,C.top-8)}px`,left:0,width:`${Math.max(0,C.left-8)}px`,height:`${C.height+16}px`},onClick:h,"aria-hidden":"true"}),i.jsx("div",{className:"fixed z-[10000] bg-black/50",style:{top:`${Math.max(0,C.top-8)}px`,left:`${C.right+8}px`,right:0,height:`${C.height+16}px`},onClick:h,"aria-hidden":"true"})]}):i.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000]",onClick:h,"aria-hidden":"true"}),i.jsxs("div",{ref:S,className:"fixed z-[10003] bg-background border-2 border-primary rounded-lg shadow-xl p-4 max-w-[calc(100vw-2rem)] sm:max-w-[320px] mx-4 sm:mx-0 pointer-events-auto",style:{top:`${g.top}px`,left:`${g.left}px`},onClick:j=>j.stopPropagation(),children:[i.jsx("button",{onClick:h,className:"absolute top-2 right-2 text-muted-foreground hover:text-foreground transition-colors","aria-label":"Skip tour",children:i.jsx(Or,{className:"h-4 w-4"})}),i.jsxs("div",{className:Ce("pr-6 sm:pr-8",e==="child"&&"text-base sm:text-lg"),children:[n.title&&e==="parent"&&i.jsx("h3",{className:"font-bold text-base sm:text-lg mb-2",children:n.title}),i.jsx("p",{className:Ce("text-sm sm:text-base text-muted-foreground",e==="child"&&"text-base sm:text-lg"),children:n.description})]}),i.jsxs("div",{className:"flex items-center justify-between mt-4 gap-2 flex-wrap",children:[i.jsx("div",{className:"flex items-center gap-2",children:!_&&i.jsxs(de,{variant:"outline",size:"sm",onClick:u,className:"text-xs sm:text-sm",children:[i.jsx(Tx,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Back"})]})}),i.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[i.jsxs("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:[s+1," / ",o]}),i.jsxs(de,{onClick:N?f:c,size:"sm",className:"text-xs sm:text-sm",children:[N?"Got it!":"Next",!N&&i.jsx(nm,{className:"h-4 w-4 ml-1"})]})]})]})]})]})}const Iw={sm:"h-2 w-2",md:"h-3 w-3",lg:"h-4 w-4"};function Ga({isOnline:e,className:t,size:n="md",showPulse:s=!1}){return i.jsxs("div",{className:Ce("relative inline-flex items-center justify-center",t),children:[i.jsx("div",{className:Ce("rounded-full border-2 border-background",Iw[n],e?"bg-green-500 dark:bg-green-400":"bg-gray-400 dark:bg-gray-500"),"aria-label":e?"Online":"Offline",title:e?"Online":"Offline"}),e&&s&&i.jsx("div",{className:Ce("absolute inset-0 rounded-full animate-ping","bg-green-500 dark:bg-green-400 opacity-75",Iw[n])})]})}function tE({childIds:e,enabled:t=!0,onStatusChange:n}){const[s,o]=p.useState({}),l=p.useRef(new Map),c=p.useRef(n);p.useEffect(()=>{c.current=n},[n]);const u=p.useMemo(()=>[...e].sort().join(","),[e]);p.useEffect(()=>{if(!t)return;const f={};e.forEach(g=>{f[g]={isOnline:!1,lastSeen:null}}),o(f)},[e,t]),p.useEffect(()=>{if(!t||e.length===0)return;const f=l.current;f.size>0&&(f.forEach(v=>{Y.removeChannel(v)}),f.clear());const g=new Map;return e.forEach(v=>{const b=`presence:child:${v}`,x=Y.channel(b,{config:{presence:{key:v}}});x.on("presence",{event:"sync"},()=>{const S=x.presenceState(),C=v in S&&Array.isArray(S[v])&&S[v].length>0,w=S[v],N=w&&w.length>0?w[0]:void 0,_=C?N?.lastSeen||new Date().toISOString():null;o(j=>{const T=j[v]?.isOnline||!1,R=j[v]?.lastSeen||null;if(T===C&&R===_)return j;const A={...j,[v]:{isOnline:C,lastSeen:_||R}};return T!==C&&c.current&&j[v]!==void 0&&c.current(v,C),A})}).on("presence",{event:"join"},({key:S,newPresences:C})=>{if(S!==v)return;const w=C[0];o(N=>{const _=N[v]?.isOnline||!1,j={...N,[v]:{isOnline:!0,lastSeen:w?.lastSeen||new Date().toISOString()}};return!_&&c.current&&c.current(v,!0),j})}).on("presence",{event:"leave"},({key:S,leftPresences:C})=>{S===v&&o(w=>{const N=w[v]?.isOnline||!1,_={...w,[v]:{isOnline:!1,lastSeen:w[v]?.lastSeen||new Date().toISOString()}};return N&&c.current&&c.current(v,!1),_})}).subscribe((S,C)=>{S==="SUBSCRIBED"?setTimeout(()=>{const w=x.presenceState();if(v in w&&Array.isArray(w[v])&&w[v].length>0){const _=w[v],j=_&&_.length>0?_[0]:void 0;o(T=>({...T,[v]:{isOnline:!0,lastSeen:j?.lastSeen||new Date().toISOString()}}))}},500):(S==="CHANNEL_ERROR"||S==="TIMED_OUT")&&k.error(" [CHILDREN PRESENCE] Subscription error",{childId:v,status:S,error:C})}),g.set(v,x)}),l.current=g,()=>{g.forEach(v=>{Y.removeChannel(v)}),g.clear(),l.current.clear()}},[u,t,e]);const h=p.useCallback(f=>s[f]||{isOnline:!1,lastSeen:null},[s]);return{presence:s,getChildStatus:h,isChildOnline:f=>s[f]?.isOnline||!1}}function $M(){if(typeof window<"u"&&window.Capacitor||typeof window<"u"&&window.cordova||typeof window<"u"&&window.ReactNativeWebView)return!0;if(typeof window<"u"){const e=navigator.userAgent.toLowerCase();if(e.includes("capacitor")||e.includes("cordova")||e.includes("ionic"))return!0}return!1}function oo(){return!$M()}const FM=({childId:e,onCall:t})=>{const n=jC(e);return i.jsxs(de,{onClick:t,className:"flex-1 relative",variant:"secondary","data-tour":"parent-call-button",children:[i.jsx(sm,{className:"mr-2 h-4 w-4"}),"Call",i.jsx("span",{className:`ml-2 bg-destructive text-destructive-foreground text-xs font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1 ${n===0?"invisible":""}`,children:n>99?"99+":n})]})},UM=({childId:e,onChat:t})=>{const n=qm(e);return i.jsxs(de,{onClick:t,className:"flex-1 relative bg-chat-accent text-chat-accent-foreground hover:bg-chat-accent/90",variant:"default","data-tour":"parent-messages",children:[i.jsx(ko,{className:"mr-2 h-4 w-4"}),"Chat",i.jsx("span",{className:`ml-2 bg-destructive text-destructive-foreground text-xs font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1 ${n===0?"invisible":""}`,children:n>99?"99+":n})]})},BM=()=>{const[e,t]=p.useState([]),[n,s]=p.useState(!0),[o,l]=p.useState(!1),[c,u]=p.useState(null),[h,f]=p.useState(null),[g,v]=p.useState(null),[b,x]=p.useState(null),[S,C]=p.useState(!0),[w,N]=p.useState(null),[_,j]=p.useState(null),[T,R]=p.useState(null),[A,I]=p.useState(!1),[L,Z]=p.useState(null),M=p.useRef(null),U=p.useRef(null),D=p.useRef(!1),B=rt(),z=bn(),{toast:q}=_t(),{handleIncomingCall:H,stopIncomingCall:Q}=ep({enabled:!0,volume:.7}),$=p.useRef(H),O=p.useMemo(()=>e.map(le=>le.id),[e]),{isChildOnline:J}=tE({childIds:O,enabled:e.length>0}),F=_C(),ee=NC(),ce=F>0||ee>0,K=p.useCallback(async()=>{const{data:{session:le}}=await Y.auth.getSession();if(!le){B("/parent/auth");return}const{data:ye,error:je}=await Y.from("parents").select("name, family_code, allowed_children").eq("id",le.user.id).maybeSingle();je&&(je.code==="42703"||je.message?.includes("does not exist")?(console.error(" [PARENT DASHBOARD] Migration not run. Family code column doesn't exist."),console.error("Please run: supabase/migrations/20250121000000_add_family_code.sql")):console.error("Error fetching parent data:",je)),ye&&(f(ye?.name||null),v(ye?.family_code||null),x(ye?.allowed_children||1));try{const{data:ze}=await Y.rpc("can_add_child",{p_parent_id:le.user.id});C(ze===!0)}catch(ze){console.warn("Subscription check function not available:",ze),C(!0)}},[B]),W=p.useCallback(async()=>{try{const{data:{user:le}}=await Y.auth.getUser();if(le)try{const{data:ze}=await Y.rpc("can_add_child",{p_parent_id:le.id});C(ze===!0)}catch(ze){console.warn("Subscription check function not available:",ze)}const{data:ye,error:je}=await Y.from("children").select("*").order("created_at",{ascending:!1});if(je)throw je;t(ye||[])}catch(le){const ye=le instanceof Error?le.message:"Unknown error occurred";q({title:"Error loading children",description:ye,variant:"destructive"})}finally{s(!1)}},[q]);p.useEffect(()=>{localStorage.getItem("childSession")&&(console.log(" [PARENT DASHBOARD] Clearing childSession for parent user"),localStorage.removeItem("childSession")),K(),W();let ye=null,je=null;return(async()=>{const{data:{session:dt}}=await Y.auth.getSession();if(!dt?.user?.id)return;const Je=dt.user.id,pt=async We=>{if(We.id===ye||z.pathname.startsWith("/call/"))return;ye=We.id;const{data:Ue}=await Y.from("children").select("name, avatar_color").eq("id",We.child_id).single();Ue?(u({id:We.id,child_id:We.child_id,child_name:Ue.name,child_avatar_color:Ue.avatar_color}),$.current({callId:We.id,callerName:Ue.name,callerId:We.child_id,url:`/call/${We.child_id}?callId=${We.id}`})):console.error("Failed to fetch child data for call")},st=async()=>{const We=new Date(Date.now()-12e4).toISOString(),{data:Ue}=await Y.from("calls").select("*").eq("parent_id",Je).eq("caller_type","child").eq("status","ringing").gte("created_at",We).order("created_at",{ascending:!1}).limit(1);if(Ue&&Ue.length>0){const Bt=Ue[0];Bt.id!==ye&&await pt(Bt)}},gt=async()=>{const We=new Date(Date.now()-6e4).toISOString(),{data:Ue,error:Bt}=await Y.from("calls").select("*").eq("parent_id",Je).eq("caller_type","child").eq("status","ringing").gte("created_at",We).order("created_at",{ascending:!1}).limit(1);if(Bt){console.error(" [PARENT DASHBOARD] Polling error:",Bt);return}if(Ue&&Ue.length>0){const Rt=Ue[0];Rt.id!==ye&&await pt(Rt)}};await st(),je=setInterval(gt,6e4),U.current=Y.channel("parent-incoming-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:`parent_id=eq.${Je}`},async We=>{const Ue=We.new;Ue.caller_type==="child"&&Ue.parent_id===Je&&Ue.status==="ringing"&&await pt(Ue)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`parent_id=eq.${Je}`},async We=>{const Ue=We.new,Bt=We.old;Ue.caller_type!=="parent"&&(z.pathname.startsWith("/call/")||(M.current&&M.current.id===Ue.id&&(Ue.status==="active"||Ue.status==="ended")&&(u(null),M.current=null),Ue.caller_type==="child"&&Ue.parent_id===Je&&Ue.status==="ringing"&&Bt.status!=="ringing"&&await pt(Ue)))}).subscribe((We,Ue)=>{Ue&&console.error(" [PARENT DASHBOARD] Realtime subscription error:",Ue)})})(),()=>{U.current&&Y.removeChannel(U.current),je&&clearInterval(je)}},[K,W,z.pathname]),p.useEffect(()=>{M.current=c},[c]),p.useEffect(()=>{$.current=H},[H]),p.useEffect(()=>{!c&&M.current&&Q(M.current.id)},[c,Q]);const ne=le=>{B(`/chat/${le}`)},G=le=>{navigator.clipboard.writeText(le),q({title:"Copied!",description:"Login code copied to clipboard"})},ae=le=>{const ye=le.login_code.split("-");return ye.length===3&&g?le.login_code:ye.length===2&&g?`${g}-${le.login_code}`:le.login_code},fe=le=>{const ye=ae(le),je=encodeURIComponent(ye),ze=`${window.location.origin}/child/login?code=${je}`;navigator.clipboard.writeText(ze),q({title:"Copied!",description:"Magic link copied to clipboard"})},ve=le=>{Z(le)},xe=()=>{L&&window.print()},Ie=async le=>{try{const{acknowledgeMissedCalls:ye}=await xr(async()=>{const{acknowledgeMissedCalls:je}=await import("./acknowledgeMissedCalls-ChKxvIFx.js");return{acknowledgeMissedCalls:je}},[]);await ye(le,"child")}catch(ye){console.error("Error acknowledging missed calls:",ye)}B(`/call/${le}`)},$e=p.useCallback(async()=>{if(ce)try{const{acknowledgeMissedCalls:le}=await xr(async()=>{const{acknowledgeMissedCalls:st}=await import("./acknowledgeMissedCalls-ChKxvIFx.js");return{acknowledgeMissedCalls:st}},[]),ye=tt.getState();let je=0,ze=0;for(const st of O){if((ye.unreadMessagesByChild[st]??0)>0)try{const{data:Ue,error:Bt}=await Y.from("messages").select("id").eq("child_id",st).eq("sender_type","child").is("read_at",null);if(!Bt&&Ue&&Ue.length>0){const Rt=Ue.map(Br=>Br.id),Cr=new Date().toISOString(),{error:js}=await Y.from("messages").update({read_at:Cr}).in("id",Rt);js?console.error(`Error marking messages as read for child ${st}:`,js):(je+=Rt.length,console.log(` Marked ${Rt.length} messages as read for child ${st}`))}ye.clearUnreadForChild(st)}catch(Ue){console.error(`Error processing messages for child ${st}:`,Ue),ye.clearUnreadForChild(st)}const We=ye.missedCallsByChild[st]??0;if(We>0){ye.clearMissedForChild(st),ze+=We;try{await le(st,"child")}catch(Ue){console.error(`Error acknowledging missed calls for child ${st}:`,Ue)}}}const dt=je>0?`${je} unread message${je!==1?"s":""}`:"",Je=ze>0?`${ze} missed call${ze!==1?"s":""}`:"",pt=[dt,Je].filter(Boolean).join(" and ");q({title:"Notifications cleared",description:pt||"All notifications cleared."})}catch(le){console.error("Error clearing notifications:",le),q({title:"Error",description:"Failed to clear some notifications. Please try again.",variant:"destructive"})}},[ce,O,q]),Ke=async()=>{if(_)try{const{error:le}=await Y.from("children").delete().eq("id",_.id);if(le)throw le;q({title:"Child removed",description:`${_.name} has been removed.`}),j(null),W()}catch(le){const ye=le instanceof Error?le.message:"Unknown error occurred";q({title:"Error removing child",description:ye,variant:"destructive"})}},Ve=async()=>{if(T){I(!0);try{const{data:le,error:ye}=await Y.rpc("generate_unique_login_code");if(ye)throw ye;if(!le)throw new Error("Failed to generate new code");const{error:je}=await Y.from("children").update({login_code:le}).eq("id",T.id);if(je)throw je;q({title:"Login code updated",description:`${T.name}'s new login code is: ${le}`}),R(null),W()}catch(le){const ye=le instanceof Error?le.message:"Unknown error occurred";q({title:"Error updating login code",description:ye,variant:"destructive"})}finally{I(!1)}}},ie=()=>{if(c){Q(c.id),D.current=!0;const le=c.child_id,ye=c.id;u(null),B(`/call/${le}?callId=${ye}`),setTimeout(()=>{D.current=!1},2e3)}},Re=async()=>{if(c){if(D.current)return;try{await ta({callId:c.id,by:"parent",reason:"declined"})}catch(le){console.error(" [USER ACTION] Error declining call:",le);const ye=le instanceof Error?le.message:"Unknown error";q({title:"Error",description:"Failed to decline call: "+ye,variant:"destructive"})}Q(c.id),u(null)}};return n?i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx("div",{className:"p-4",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[i.jsxs("div",{className:"mt-2",children:[i.jsx("div",{className:"h-9 w-48 bg-muted rounded animate-pulse mb-2"}),i.jsx("div",{className:"h-6 w-96 bg-muted rounded animate-pulse"})]}),i.jsx("div",{className:"h-12 w-full bg-muted rounded animate-pulse"}),i.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:[1,2].map(le=>i.jsxs(Ae,{className:"p-6 space-y-4 min-h-[220px]",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-muted animate-pulse"}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"h-6 w-32 bg-muted rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"})]})]})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("div",{className:"h-10 flex-1 bg-muted rounded animate-pulse"}),i.jsx("div",{className:"h-10 flex-1 bg-muted rounded animate-pulse"})]})]},le))})]})})]}):i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx(Ur,{role:"parent",pageKey:"parent_dashboard"}),i.jsx(Fr,{role:"parent",pageKey:"parent_dashboard"}),i.jsx("div",{className:"px-4 pb-4",style:{paddingTop:"calc(0.5rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsx("div",{className:"max-w-4xl mx-auto",children:i.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Welcome back",h?`, ${h}`:"","!"]})})}),i.jsxs("div",{className:"p-4",children:[i.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[i.jsxs("div",{className:"mt-2 flex items-center justify-between flex-wrap gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"My Children"}),i.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage your children's profiles, login codes, and settings"})]}),oo()&&i.jsx(de,{variant:"outline",onClick:()=>B("/parent/upgrade"),className:"flex-shrink-0","data-tour":"parent-upgrade-plan",children:"Upgrade Plan"})]}),g&&i.jsx(Ae,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800 p-4",children:i.jsxs("div",{className:"flex items-center justify-between gap-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Your Family Code"}),i.jsx("p",{className:"text-2xl font-mono font-bold text-blue-700 dark:text-blue-300",children:g}),i.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:"Share this code with your children for login"})]}),i.jsxs(de,{onClick:()=>{navigator.clipboard.writeText(g),q({title:"Copied!",description:"Family code copied to clipboard"})},variant:"outline",size:"sm",className:"flex-shrink-0",children:[i.jsx(Ch,{className:"h-4 w-4 mr-2"}),"Copy"]})]})}),!S&&i.jsx(Ae,{className:"p-4 bg-yellow-50 dark:bg-yellow-950 border-yellow-200 dark:border-yellow-800 mb-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("p",{className:"text-sm text-yellow-900 dark:text-yellow-100",children:[i.jsx("strong",{children:"Subscription Limit Reached:"})," You have"," ",e.length," /"," ",b===999?"":b||1," ","children."]}),oo()?i.jsx(de,{onClick:()=>B("/parent/upgrade"),variant:"default",size:"sm",className:"w-full sm:w-auto","data-tour":"parent-upgrade-limit",children:"Upgrade Your Plan"}):i.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"Please upgrade through your app store to add more children."})]})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(de,{onClick:()=>l(!0),className:"flex-1",size:"lg",disabled:!S,children:[i.jsx(of,{className:"mr-2 h-5 w-5"}),"Add Child"]}),ce&&i.jsxs(de,{onClick:$e,variant:"outline",size:"lg",className:"flex-shrink-0",title:`Clear all notifications (${F} messages, ${ee} missed calls)`,children:[i.jsx(gj,{className:"mr-2 h-5 w-5"}),"Clear All"]})]}),e.length===0?i.jsxs(Ae,{className:"p-12 text-center min-h-[220px]",children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"You haven't added any children yet."}),i.jsx("p",{className:"text-sm text-muted-foreground",children:'Click "Add Child" above to create a profile and login code.'})]}):i.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.map((le,ye)=>i.jsxs(Ae,{className:"p-6 space-y-4 min-h-[220px]",style:{borderLeft:`4px solid ${le.avatar_color}`},children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2","data-tour":ye===0?"parent-child-name-status":void 0,children:[i.jsx("h3",{className:"text-2xl sm:text-3xl font-bold",children:le.name}),i.jsx(Ga,{isOnline:J(le.id),size:"md",showPulse:J(le.id)})]}),i.jsxs("div",{className:"bg-muted p-3 rounded-lg relative","data-tour":ye===0?"parent-login-code":void 0,children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Login Code"}),i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsx("p",{className:"text-xl sm:text-2xl font-mono font-bold tracking-wider flex-1",children:ae(le)}),i.jsx(de,{onClick:()=>R(le),variant:"ghost",size:"icon",className:"h-8 w-8",title:"Generate new login code",children:i.jsx(Oj,{className:"h-4 w-4"})})]})]}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsxs(de,{onClick:()=>G(ae(le)),variant:"outline",size:"sm",className:"flex-1","data-tour":ye===0?"parent-copy-code":void 0,children:[i.jsx(Ch,{className:"mr-2 h-4 w-4"}),"Copy Code"]}),i.jsxs(de,{onClick:()=>fe(le),variant:"outline",size:"sm",className:"flex-1","data-tour":ye===0?"parent-copy-link":void 0,children:[i.jsx(Pc,{className:"mr-2 h-4 w-4"}),"Copy Link"]}),i.jsxs(de,{onClick:()=>ve(le),variant:"outline",size:"sm",className:"flex-1","data-tour":ye===0?"parent-print-code":void 0,children:[i.jsx(Eh,{className:"mr-2 h-4 w-4"}),"Print"]}),i.jsxs(de,{onClick:()=>N({child:le}),variant:"outline",size:"sm",className:"flex-1","data-tour":ye===0?"parent-view-qr":void 0,children:[i.jsx(Rj,{className:"mr-2 h-4 w-4"}),"View QR"]})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(FM,{childId:le.id,onCall:()=>Ie(le.id)}),i.jsx(UM,{childId:le.id,onChat:()=>ne(le.id)}),i.jsx(de,{onClick:()=>j(le),variant:"destructive",size:"icon","data-tour":ye===0?"parent-delete-child":void 0,children:i.jsx(rm,{className:"h-4 w-4"})})]})]},le.id))})]}),i.jsx(SC,{open:o,onOpenChange:l,onChildAdded:W}),w&&i.jsx(tr,{open:!!w,onOpenChange:le=>!le&&N(null),children:i.jsxs(An,{className:"max-w-[calc(100vw-2rem)] sm:max-w-md",children:[i.jsxs("button",{onClick:()=>N(null),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[i.jsx(Or,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]}),i.jsxs(Pn,{children:[i.jsxs(In,{className:"text-lg sm:text-xl",children:[w.child.name,"'s Login Code"]}),i.jsx(Dn,{className:"text-sm",children:"Share this code or QR code with your child to log in"})]}),i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{className:"bg-muted p-3 sm:p-4 rounded-lg text-center",children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Login Code"}),i.jsx("p",{className:"text-2xl sm:text-3xl font-mono font-bold break-all",children:ae(w.child)})]}),i.jsx("div",{className:"flex justify-center",children:i.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(`${window.location.origin}/child/login?code=${encodeURIComponent(ae(w.child))}`)}`,alt:"QR Code",className:"border-2 border-muted rounded-lg w-[200px] h-[200px] sm:w-[250px] sm:h-[250px] object-contain"})}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[i.jsxs(de,{onClick:()=>G(ae(w.child)),variant:"outline",className:"flex-1 w-full sm:w-auto",children:[i.jsx(Ch,{className:"mr-2 h-4 w-4"}),"Copy Code"]}),i.jsxs(de,{onClick:()=>fe(w.child),variant:"outline",className:"flex-1 w-full sm:w-auto",children:[i.jsx(Pc,{className:"mr-2 h-4 w-4"}),"Copy Link"]}),i.jsxs(de,{onClick:()=>ve(w.child),variant:"outline",className:"flex-1 w-full sm:w-auto",children:[i.jsx(Eh,{className:"mr-2 h-4 w-4"}),"Print"]})]})]}),i.jsx(Rn,{children:i.jsx(On,{children:"Close"})})]})}),i.jsx(tr,{open:!!T,onOpenChange:le=>!le&&R(null),children:i.jsxs(An,{children:[i.jsxs("button",{onClick:()=>R(null),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",disabled:A,children:[i.jsx(Or,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]}),i.jsxs(Pn,{children:[i.jsx(In,{children:"Generate New Login Code"}),i.jsxs(Dn,{children:["Are you sure you want to generate a new login code for"," ",T?.name,"? The current code (",T?.login_code,") will no longer work. Make sure to share the new code with your child."]})]}),i.jsxs(Rn,{children:[i.jsx(On,{disabled:A,children:"Cancel"}),i.jsx(yr,{onClick:Ve,disabled:A,children:A?"Generating...":"Generate New Code"})]})]})}),i.jsx(tr,{open:!!_,onOpenChange:le=>!le&&j(null),children:i.jsxs(An,{children:[i.jsxs("button",{onClick:()=>j(null),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[i.jsx(Or,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]}),i.jsxs(Pn,{children:[i.jsx(In,{children:"Remove Child"}),i.jsxs(Dn,{children:["Are you sure you want to remove ",_?.name,"? This action cannot be undone and will delete all associated data including messages and call history."]})]}),i.jsxs(Rn,{children:[i.jsx(On,{children:"Cancel"}),i.jsx(yr,{onClick:Ke,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})}),i.jsx(tr,{open:!!c,onOpenChange:le=>{!le&&c&&!D.current&&Re()},children:i.jsxs(An,{className:"sm:max-w-md",children:[i.jsxs(Pn,{children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold text-white",style:{backgroundColor:c?.child_avatar_color||"#3B82F6"},children:c?.child_name[0]}),i.jsxs("div",{children:[i.jsx(In,{className:"text-xl",children:"Incoming Call"}),i.jsxs("p",{className:"text-base font-normal text-muted-foreground",children:[c?.child_name," is calling..."]})]})]}),i.jsxs("div",{className:"pt-4",children:[i.jsxs(Dn,{className:"sr-only",children:["Incoming call from ",c?.child_name]}),i.jsx("div",{className:"flex items-center justify-center gap-2 text-4xl animate-pulse",children:i.jsx(To,{className:"h-12 w-12"})})]})]}),i.jsxs(Rn,{className:"sm:justify-center gap-2",children:[i.jsx(On,{onClick:Re,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Decline"}),i.jsx(yr,{onClick:ie,className:"bg-green-600 hover:bg-green-700",children:"Answer"})]})]})}),L&&i.jsx(tr,{open:!!L,onOpenChange:le=>!le&&Z(null),children:i.jsxs(An,{className:"max-w-[calc(100vw-2rem)] sm:max-w-md print:hidden",children:[i.jsxs("button",{onClick:()=>Z(null),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none print:hidden",children:[i.jsx(Or,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]}),i.jsxs(Pn,{children:[i.jsxs(In,{className:"text-lg sm:text-xl",children:[L.name,"'s Login Code"]}),i.jsx(Dn,{className:"text-sm",children:"Print or share this code with your child"})]}),i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{className:"bg-muted p-3 sm:p-4 rounded-lg text-center print:border-2 print:border-gray-800",children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-2 print:text-gray-600",children:"Login Code"}),i.jsx("p",{className:"text-2xl sm:text-3xl font-mono font-bold break-all print:text-3xl",children:ae(L)})]}),i.jsx("div",{className:"flex justify-center print:my-4",children:i.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(`${window.location.origin}/child/login?code=${encodeURIComponent(ae(L))}`)}`,alt:"QR Code",className:"border-2 border-muted rounded-lg w-[250px] h-[250px] sm:w-[300px] sm:h-[300px] object-contain print:border-gray-800"})}),i.jsxs("div",{className:"instructions print:mt-4 print:text-sm print:text-gray-600",children:[i.jsx("p",{children:"Scan the QR code or use the code above to log in"}),i.jsxs("p",{children:["Visit: ",window.location.origin,"/child/login"]})]})]}),i.jsxs(Rn,{className:"print:hidden",children:[i.jsxs(de,{onClick:xe,variant:"default",className:"flex-1",children:[i.jsx(Eh,{className:"mr-2 h-4 w-4"}),"Print"]}),i.jsx(On,{children:"Close"})]})]})})]})]})},zM=()=>{const e=rt();return _t(),p.useEffect(()=>{(async()=>{const{data:{session:n}}=await Y.auth.getSession();n||e("/parent/auth")})()},[e]),i.jsxs("div",{className:"min-h-[100dvh] bg-background",children:[i.jsx(Ft,{}),i.jsx(Ur,{role:"parent",pageKey:"parent_home"}),i.jsx(Fr,{role:"parent",pageKey:"parent_home"}),i.jsx("div",{className:"p-4",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"mb-8 mt-8",children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Parent Home"}),i.jsx("p",{className:"text-muted-foreground mt-2",children:"Quick access to your children and calls"})]}),i.jsx(Ae,{className:"p-6",children:i.jsxs("div",{className:"space-y-4",children:[i.jsx("h2",{className:"text-xl font-semibold",children:"Quick Actions"}),i.jsxs(de,{className:"w-full",size:"lg",onClick:()=>e("/parent/children"),"data-tour":"parent-home-view-children",children:[i.jsx(co,{className:"mr-2 h-5 w-5"}),"View Children"]}),i.jsx(de,{className:"w-full",size:"lg",variant:"outline",onClick:()=>e("/parent/dashboard"),"data-tour":"parent-home-dashboard",children:"Go to Dashboard"})]})})]})})]})},HM=({child:e,onCall:t,onChat:n,isOnline:s,"data-tour":o})=>{const l=qm(e.id);return i.jsx(Ae,{className:"p-6","data-tour":o,children:i.jsxs("div",{className:"flex items-start justify-between flex-col sm:flex-row gap-4",children:[i.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[i.jsx("div",{className:"aspect-square w-12 rounded-full flex items-center justify-center text-white font-bold text-lg leading-none select-none flex-shrink-0",style:{backgroundColor:e.avatar_color||"#6366f1"},children:i.jsx("span",{className:"leading-none",children:e.name.charAt(0).toUpperCase()})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h3",{className:"text-xl font-semibold",children:e.name}),i.jsx(Ga,{isOnline:s,size:"md",showPulse:s})]}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Code: ",e.login_code]})]})]}),i.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[i.jsxs(de,{onClick:()=>t(e.id),variant:"secondary",className:"flex-1 sm:flex-none relative","data-tour":o?"parent-children-list-call":void 0,children:[i.jsx(To,{className:"mr-2 h-4 w-4"}),"Call"]}),i.jsxs(de,{onClick:()=>n(e.id),className:"flex-1 sm:flex-none relative bg-chat-accent text-chat-accent-foreground hover:bg-chat-accent/90","data-tour":o?"parent-children-list-message":void 0,children:[i.jsx(ko,{className:"mr-2 h-4 w-4"}),"Message",i.jsx("span",{className:`ml-2 bg-destructive text-destructive-foreground text-xs font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1 ${l===0?"invisible":""}`,children:l>99?"99+":l})]})]})]})})},VM=()=>{const[e,t]=p.useState([]),[n,s]=p.useState(!0),[o,l]=p.useState(!1),c=rt(),{toast:u}=_t(),h=p.useMemo(()=>e.map(x=>x.id),[e]),{isChildOnline:f}=tE({childIds:h,enabled:e.length>0});p.useEffect(()=>{(async()=>{const{data:{session:S}}=await Y.auth.getSession();if(!S){c("/parent/auth");return}g()})()},[c]);const g=async()=>{try{const{data:x,error:S}=await Y.from("children").select("*").order("created_at",{ascending:!1});if(S)throw S;t(x||[])}catch(x){const S=x instanceof Error?x.message:"Unknown error occurred";u({title:"Error loading children",description:S,variant:"destructive"})}finally{s(!1)}},v=x=>{c(`/call/${x}`)},b=x=>{c(`/chat/${x}`)};return n?i.jsxs("div",{className:"min-h-[100dvh] bg-background",children:[i.jsx(Ft,{}),i.jsx("div",{className:"p-4",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"mb-8 mt-8",children:[i.jsx("div",{className:"h-9 w-48 bg-muted rounded animate-pulse mb-2"}),i.jsx("div",{className:"h-6 w-64 bg-muted rounded animate-pulse"})]}),i.jsx("div",{className:"grid gap-4",children:[1,2,3].map(x=>i.jsx(Ae,{className:"p-6",children:i.jsxs("div",{className:"flex items-start justify-between flex-col sm:flex-row gap-4",children:[i.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-muted animate-pulse flex-shrink-0"}),i.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[i.jsx("div",{className:"h-6 w-32 bg-muted rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"})]})]}),i.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[i.jsx("div",{className:"h-10 w-20 bg-muted rounded animate-pulse flex-1 sm:flex-none"}),i.jsx("div",{className:"h-10 w-24 bg-muted rounded animate-pulse flex-1 sm:flex-none"})]})]})},x))})]})})]}):i.jsxs("div",{className:"min-h-[100dvh] bg-background",children:[i.jsx(Ft,{}),i.jsx(Ur,{role:"parent",pageKey:"parent_children_list"}),i.jsx(Fr,{role:"parent",pageKey:"parent_children_list"}),i.jsx("div",{className:"p-4",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"mb-8 mt-8 flex items-center justify-between flex-wrap gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Your Children"}),i.jsx("p",{className:"text-muted-foreground mt-2",children:"View and call your children"})]}),i.jsxs(de,{onClick:()=>l(!0),className:"flex-shrink-0",size:"lg","data-tour":"parent-children-list-add-child",children:[i.jsx(of,{className:"mr-2 h-5 w-5"}),"Add Child"]})]}),e.length===0?i.jsxs(Ae,{className:"p-12 text-center",children:[i.jsx("p",{className:"text-muted-foreground mb-4 text-lg",children:"No children added yet."}),i.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:'Click "Add Child" above to create a profile and login code for your child.'}),i.jsxs(de,{onClick:()=>l(!0),size:"lg",className:"mx-auto",children:[i.jsx(of,{className:"mr-2 h-5 w-5"}),"Add Your First Child"]})]}):i.jsx("div",{className:"grid gap-4",children:e.map((x,S)=>i.jsx(HM,{child:x,onCall:v,onChat:b,isOnline:f(x.id),"data-tour":S===0?"parent-children-list-card":void 0},x.id))})]})}),i.jsx(SC,{open:o,onOpenChange:l,onChildAdded:g})]})},qM=({isMuted:e,isVideoOff:t,onToggleMute:n,onToggleVideo:s,onEndCall:o})=>i.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-4",children:[i.jsx(de,{onClick:n,size:"lg",variant:e?"destructive":"secondary",className:"rounded-full w-16 h-16",children:e?i.jsx(jj,{className:"h-6 w-6"}):i.jsx(kj,{className:"h-6 w-6"})}),i.jsx(de,{onClick:s,size:"lg",variant:t?"destructive":"secondary",className:"rounded-full w-16 h-16",children:t?i.jsx($j,{className:"h-6 w-6"}):i.jsx(sm,{className:"h-6 w-6"})}),i.jsx(de,{onClick:o,size:"lg",variant:"destructive",className:"rounded-full w-16 h-16",children:i.jsx(Pj,{className:"h-6 w-6"})})]}),tp=({localVideoRef:e,remoteVideoRef:t,remoteStream:n,isConnecting:s,isMuted:o,isVideoOff:l,onToggleMute:c,onToggleVideo:u,onEndCall:h,peerConnection:f})=>{const[g,v]=p.useState("waiting"),b=p.useRef(!1);p.useEffect(()=>{if(!n||!t.current){v("waiting");return}const w=t.current;w.srcObject!==n&&(console.log(" [VIDEO UI] Setting remote stream to video element"),w.srcObject=n);const N={current:g},_=H=>{N.current=H,v(H)};_("loading");const j=async()=>{if(w.paused)try{console.log(" [VIDEO UI] Attempting to play video"),await w.play(),console.log(" [VIDEO UI] Video started playing"),b.current=!0,_("playing")}catch(H){if(console.log(" [VIDEO UI] Play error:",H.name),H.name==="NotAllowedError"){w.muted=!0;try{await w.play(),console.log(" [VIDEO UI] Playing muted - click to unmute"),_("playing")}catch(Q){console.error(" [VIDEO UI] Even muted play failed:",Q),_("error")}}else H.name==="NotSupportedError"&&(console.error(" [VIDEO UI] Media format not supported"),_("error"))}},T=()=>{console.log(" [VIDEO UI] Video metadata loaded"),_("loading"),j()},R=()=>{console.log(" [VIDEO UI] Video data loaded"),j()},A=()=>{console.log(" [VIDEO UI] Video can play"),j()},I=()=>{console.log(" [VIDEO UI] Video 'playing' event fired"),_("playing"),b.current=!0},L=()=>{console.log(" [VIDEO UI] Video can play through"),w.paused||_("playing")},Z=()=>{console.log(" [VIDEO UI] Video 'waiting' event - buffering"),w.paused&&N.current!=="error"&&_("loading")},M=()=>{console.log(" [VIDEO UI] Video paused")},U=H=>{const Q=H.target;console.error(" [VIDEO UI] Video error:",Q.error),_("error")};w.addEventListener("loadedmetadata",T),w.addEventListener("loadeddata",R),w.addEventListener("canplay",A),w.addEventListener("canplaythrough",L),w.addEventListener("playing",I),w.addEventListener("waiting",Z),w.addEventListener("pause",M),w.addEventListener("error",U);const D=n.getTracks(),B=new Map,z=()=>{const H=D.some($=>!$.muted&&$.readyState==="live"),Q=!w.paused;return H&&Q?(console.log(" [VIDEO UI] Tracks unmuted and video playing - marking as playing"),_("playing"),!0):!1};D.forEach(H=>{const Q=()=>{console.log(" [VIDEO UI] Track unmuted:",H.kind,"- ICE connected, media flowing"),w.paused?j():setTimeout(()=>{z()},100)},$=()=>{console.log(" [VIDEO UI] Track muted:",H.kind),D.every(F=>F.muted)&&N.current==="playing"&&(console.log(" [VIDEO UI] All tracks muted, setting to loading"),_("loading"))},O=()=>{console.log(" [VIDEO UI] Track ended:",H.kind)};H.addEventListener("unmute",Q),H.addEventListener("mute",$),H.addEventListener("ended",O),B.set(H,{handleUnmute:Q,handleMute:$,handleEnded:O})});const q=setInterval(()=>{w.paused||D.some(Q=>!Q.muted&&Q.readyState==="live")&&N.current==="loading"&&(console.log(" [VIDEO UI] Video playing with unmuted tracks - updating state"),_("playing"))},500);return j(),()=>{clearInterval(q),w.removeEventListener("loadedmetadata",T),w.removeEventListener("loadeddata",R),w.removeEventListener("canplay",A),w.removeEventListener("canplaythrough",L),w.removeEventListener("playing",I),w.removeEventListener("waiting",Z),w.removeEventListener("pause",M),w.removeEventListener("error",U),B.forEach((H,Q)=>{Q.removeEventListener("unmute",H.handleUnmute),Q.removeEventListener("mute",H.handleMute),Q.removeEventListener("ended",H.handleEnded)})}},[n,t]);const x=()=>{if(!t.current||!t.current.srcObject)return;const w=t.current;console.log(" [VIDEO UI] User clicked video area",{paused:w.paused,muted:w.muted,readyState:w.readyState}),w.muted&&(w.muted=!1,console.log(" [VIDEO UI] Video unmuted by user click")),w.paused&&w.play().then(()=>{console.log(" [VIDEO UI] Video started playing after click"),v("playing")}).catch(N=>{console.error(" [VIDEO UI] Click play failed:",N),w.muted=!0,w.play().catch(_=>console.error("Muted play also failed:",_))})},C=n?g==="error"?"Video error - click to retry":g==="loading"?"Connecting to other side...":t.current?.paused&&g!=="playing"?"Click to start video":t.current?.muted?"Video is muted - click to unmute":null:s?"Connecting...":"Waiting for other person...";return i.jsx("div",{className:"fixed inset-0 bg-black",onClick:x,children:i.jsxs("div",{className:"relative h-full w-full",children:[i.jsx("video",{ref:t,autoPlay:!0,playsInline:!0,muted:!1,volume:1,className:"w-full h-full object-cover",style:{backgroundColor:"#000"}}),C&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 cursor-pointer",onClick:x,children:i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx("div",{className:"text-6xl",children:g==="error"?"":g==="loading"?"":""}),i.jsx("p",{className:"text-white text-2xl",children:C}),n&&i.jsx("p",{className:"text-white text-sm opacity-75",children:g==="loading"?"Establishing connection...":g==="error"?"Check your connection":"Tap anywhere to interact"})]})}),!1,i.jsx("div",{className:"absolute top-4 right-4 w-48 h-36 rounded-2xl overflow-hidden shadow-xl border-2 border-white",children:i.jsx("video",{ref:e,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})}),i.jsx(qM,{isMuted:o,isVideoOff:l,onToggleMute:c,onToggleVideo:u,onEndCall:h})]})})},nE=(e,t,n,s=!1)=>{const[o,l]=p.useState(null),[c,u]=p.useState(null),[h,f]=p.useState(!0),[g,v]=p.useState(!1),b=p.useRef(null),x=p.useRef(null),S=p.useRef([]),C=p.useRef(null),w=p.useRef(new Set),N=p.useRef(e);p.useEffect(()=>{N.current=e,e&&k.log(" [CALL ID] CallId updated in useWebRTC:",e)},[e]);const _=p.useCallback(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){const M=/iPad|iPhone|iPod/.test(navigator.userAgent),U=window.location.protocol==="https:",D=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.startsWith("192.168.")||window.location.hostname.startsWith("10.")||window.location.hostname.startsWith("172.");let B="Camera and microphone access is not available.";throw M&&!U&&!D?B+=`

On iOS Safari, camera/microphone requires HTTPS when accessing via network IP. Options:
1. Use a tunneling service like ngrok (provides HTTPS)
2. Set up local HTTPS certificates
3. Test on the same device using localhost`:M&&!U?B+=`

Note: On iOS, getUserMedia may not work over HTTP on network IPs. Consider using ngrok or testing on the same device.`:M?B+=" On iOS, please use Safari and grant camera/microphone permissions in Settings.":B+=" Please use HTTPS or a modern browser that supports WebRTC.",new Error(B)}let R;try{k.log(" [MEDIA] Requesting camera and microphone access..."),R=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),k.log(" [MEDIA] Media stream obtained:",{audioTracks:R.getAudioTracks().map(U=>({id:U.id,enabled:U.enabled,muted:U.muted,readyState:U.readyState,settings:U.getSettings()})),videoTracks:R.getVideoTracks().map(U=>({id:U.id,enabled:U.enabled,muted:U.muted,readyState:U.readyState,settings:U.getSettings()}))});const M=s?"child":"parent";k.log("[KCH]",M,"media tracks",{audio:R.getAudioTracks().length,video:R.getVideoTracks().length}),R.getAudioTracks().forEach(U=>{U.muted&&k.warn(" [MEDIA] Local audio track is muted")}),R.getVideoTracks().forEach(U=>{U.muted&&k.warn(" [MEDIA] Local video track is muted")})}catch(M){const U=M;if(k.error(" [MEDIA] Media device access error:",{name:U.name,message:U.message,code:U.code}),U.name==="NotReadableError"||U.name==="NotAllowedError"){k.warn(" [MEDIA] Media device access denied or in use, trying audio-only fallback...");try{R=await navigator.mediaDevices.getUserMedia({video:!1,audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),k.log(" [MEDIA] Fell back to audio-only stream")}catch(D){const B=D;throw k.error(" [MEDIA] Audio-only fallback also failed:",{name:B.name,message:B.message}),new Error(`Unable to access camera/microphone: ${U.message}. This may happen if the device is in use by another application or browser tab. On iOS, make sure you've granted camera and microphone permissions in Settings. Error details: ${U.name} - ${U.message}`)}}else throw new Error(`Media access error: ${U.name} - ${U.message}. Please check your camera and microphone permissions.`)}l(R),x.current=R,t.current&&(t.current.srcObject=R,t.current.play().catch(M=>{k.error("Error playing local video:",M)}));const A=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"}],iceCandidatePoolSize:10});A.onconnectionstatechange=()=>{const M=A.connectionState,U=A.iceConnectionState,D=A.signalingState,B=s?"child":"parent";if(k.log("[KCH]",B,"connectionState",M),k.log(" [CONNECTION STATE] Peer connection state changed:",{connectionState:M,iceConnectionState:U,signalingState:D,timestamp:new Date().toISOString()}),M==="connected"){if(k.log(" [CONNECTION STATE] Peer connection is now connected!"),k.log(" [CONNECTION STATE] Connection details:",{connectionState:M,iceConnectionState:U,signalingState:D,localDescription:!!A.localDescription,remoteDescription:!!A.remoteDescription,remoteStream:!!C.current}),C.current){const z=C.current.getAudioTracks(),q=C.current.getVideoTracks();k.log(" [CONNECTION STATE] Remote stream tracks when connected:",{audioTracks:z.map(H=>({id:H.id,enabled:H.enabled,muted:H.muted,readyState:H.readyState})),videoTracks:q.map(H=>({id:H.id,enabled:H.enabled,muted:H.muted,readyState:H.readyState}))}),z.forEach(H=>{H.muted&&k.error(" [CONNECTION STATE] Audio track is muted when connected!")}),q.forEach(H=>{H.muted&&H.readyState==="live"&&k.warn(" [CONNECTION STATE] Video track is muted when connected (user may have muted it)",{trackId:H.id,readyState:H.readyState,enabled:H.enabled})})}}else if(M==="failed"||M==="closed"||M==="disconnected"){k.error(" [CONNECTION STATE] Connection problem detected:",{connectionState:M,iceConnectionState:U,signalingState:D,reason:"Connection state changed to problematic state",timestamp:new Date().toISOString()});const z=N.current;z&&(M==="failed"||M==="closed")&&ta({callId:z,by:s?"child":"parent",reason:M}).catch(()=>{})}};let I=Date.now();const L=3e4;A.oniceconnectionstatechange=()=>{const M=A.iceConnectionState,U=Date.now()-I,D=s?"child":"parent";if(k.log("[KCH]",D,"iceConnectionState",M),k.log(" [ICE STATE] ICE connection state changed:",{iceConnectionState:M,connectionState:A.connectionState,signalingState:A.signalingState,hasLocalDescription:!!A.localDescription,hasRemoteDescription:!!A.remoteDescription,iceGatheringState:A.iceGatheringState,timeInStateMs:U,timestamp:new Date().toISOString()}),I=Date.now(),M==="connected"||M==="completed"){if(k.log(" [ICE STATE] ICE connection established - media should flow now!"),v(!0),f(!1),C.current&&n.current){const B=C.current,z=n.current;z.srcObject!==B&&(k.log(" [ICE STATE] Setting remote stream to video element"),z.srcObject=B);const q=B.getAudioTracks(),H=B.getVideoTracks();k.log(" [ICE STATE] Tracks after ICE connected:",{audioTracks:q.length,videoTracks:H.length,audioMuted:q.filter(O=>O.muted).length,videoMuted:H.filter(O=>O.muted).length,videoReadyState:z.readyState,videoPaused:z.paused}),q.forEach(O=>{O.enabled=!0,O.muted&&k.warn(" [ICE STATE] Audio track is muted after ICE connected")}),H.forEach(O=>{O.enabled=!0,O.muted&&k.warn(" [ICE STATE] Video track is muted after ICE connected")});const Q=()=>{z&&z.srcObject&&z.paused&&(k.log(" [ICE STATE] Attempting to play video after ICE connection"),z.play().then(()=>{k.log(" [ICE STATE] Video started playing after ICE connected")}).catch(O=>{k.warn(" [ICE STATE] Play failed, will retry:",O.name),setTimeout(()=>{z&&z.srcObject&&z.paused&&z.play().catch(J=>{J.name!=="AbortError"&&k.error(" [ICE STATE] Retry play failed:",J)})},200)}))};Q();const $=()=>{z.paused&&Q()};z.addEventListener("canplay",$,{once:!0}),z.addEventListener("loadeddata",$,{once:!0}),z.addEventListener("canplaythrough",$,{once:!0}),setTimeout(()=>{const O=B.getAudioTracks().filter(F=>F.muted).length,J=B.getVideoTracks().filter(F=>F.muted).length;(O>0||J>0)&&k.error(" [ICE STATE] CRITICAL: Tracks still muted after ICE connected!",{mutedAudio:O,mutedVideo:J,totalAudio:q.length,totalVideo:H.length}),z.paused&&Q()},1e3)}}else if(M==="failed"||M==="disconnected"||M==="closed"){k.error(" [ICE STATE] ICE connection problem:",{iceConnectionState:M,connectionState:A.connectionState,reason:"ICE connection failed or disconnected",timestamp:new Date().toISOString()}),v(!1),f(!1);const B=N.current;B&&(M==="failed"||M==="closed")&&ta({callId:B,by:s?"child":"parent",reason:M}).catch(()=>{})}else M==="checking"?(v(!1),f(!0),k.log(" [ICE STATE] ICE connection checking - waiting for connection (this is normal)..."),setTimeout(()=>{if(A.iceConnectionState==="checking"&&A.signalingState!=="closed"){k.warn(" [ICE STATE] ICE stuck in 'checking' state for 30+ seconds - this may indicate:",{issue:"ICE candidates may not be exchanging properly or connection is failing",hasLocalDescription:!!A.localDescription,hasRemoteDescription:!!A.remoteDescription,iceGatheringState:A.iceGatheringState,connectionState:A.connectionState,suggestion:"Check that ICE candidates are being sent/received via database and that both peers have remote descriptions set"});const B=A.getSenders(),z=A.getReceivers();k.warn(" [ICE STATE] Current peer connection state:",{senders:B.length,receivers:z.length,localDescription:A.localDescription?{type:A.localDescription.type,sdp:A.localDescription.sdp.substring(0,100)+"..."}:null,remoteDescription:A.remoteDescription?{type:A.remoteDescription.type,sdp:A.remoteDescription.sdp.substring(0,100)+"..."}:null})}},L)):M==="new"&&(k.log(" [ICE STATE] ICE connection new - connection starting (this is normal)..."),v(!1),f(!0),setTimeout(()=>{A.iceConnectionState==="new"&&A.signalingState!=="closed"&&k.warn(" [ICE STATE] ICE stuck in 'new' state for 30+ seconds - this may indicate:",{issue:"ICE candidates may not be exchanging properly",hasLocalDescription:!!A.localDescription,hasRemoteDescription:!!A.remoteDescription,iceGatheringState:A.iceGatheringState,suggestion:"Check that ICE candidates are being sent/received via database"})},L))},A.onicegatheringstatechange=()=>{k.log(" [ICE GATHERING] ICE gathering state:",{iceGatheringState:A.iceGatheringState,timestamp:new Date().toISOString()})},A.onsignalingstatechange=()=>{k.log("Signaling state changed to:",A.signalingState),A.signalingState==="closed"&&k.error("Signaling state is closed!")},b.current=A,w.current.clear(),C.current=null,R.getTracks().forEach(M=>{A.addTrack(M,R)}),A.ontrack=M=>{if(k.log(" [REMOTE TRACK] Received remote track:",{kind:M.track.kind,id:M.track.id,enabled:M.track.enabled,readyState:M.track.readyState,muted:M.track.muted,streams:M.streams.length,connectionState:A.connectionState,iceConnectionState:A.iceConnectionState,timestamp:new Date().toISOString()}),M.track.onmute=()=>{k.warn(" [REMOTE TRACK] Track muted:",{kind:M.track.kind,id:M.track.id,reason:"Track is muted - no data being received",iceConnectionState:A.iceConnectionState,connectionState:A.connectionState})},M.track.onunmute=()=>{if(k.log(" [REMOTE TRACK] Track unmuted - MEDIA IS FLOWING!",{kind:M.track.kind,id:M.track.id,reason:"Track is receiving data - media should be visible/audible now",iceConnectionState:A.iceConnectionState,connectionState:A.connectionState}),M.track.kind==="video"&&n.current){const D=n.current;D.srcObject?(k.log(" [REMOTE TRACK] Video track unmuted - ensuring video plays",{readyState:D.readyState,paused:D.paused,muted:D.muted}),D.paused?D.play().then(()=>{k.log(" [REMOTE TRACK] Video started playing after track unmute")}).catch(B=>{B.name!=="AbortError"&&(k.error(" [REMOTE TRACK] Error playing video after track unmute:",B),setTimeout(()=>{D&&D.srcObject&&D.paused&&D.play().catch(z=>{z.name!=="AbortError"&&k.error(" [REMOTE TRACK] Retry play failed:",z)})},200))}):k.log(" [REMOTE TRACK] Video is already playing")):(k.warn(" [REMOTE TRACK] Video track unmuted but video element has no srcObject - setting it now"),n.current&&C.current&&(n.current.srcObject=C.current,setTimeout(()=>{n.current&&n.current.paused&&n.current.play().catch(B=>{B.name!=="AbortError"&&k.error(" [REMOTE TRACK] Error playing after setting srcObject:",B)})},100)))}},M.track.onended=()=>{k.log(" [REMOTE TRACK] Track ended (expected when call ends):",{kind:M.track.kind,id:M.track.id,reason:"Track has ended - this is normal when call is terminated"})},w.current.has(M.track.id)){k.log("Track already processed, skipping:",M.track.id);return}w.current.add(M.track.id),M.track.enabled=!0;let U=C.current;if(M.streams.length>0){const[D]=M.streams;!U||U.id!==D.id?(U=D,C.current=U):U.getTracks().find(z=>z.id===M.track.id)||(U.addTrack(M.track),k.log("Added track to existing stream:",M.track.kind))}else U?U.getTracks().find(B=>B.id===M.track.id)||(U.addTrack(M.track),k.log("Added track to existing stream:",M.track.kind)):(U=new MediaStream([M.track]),C.current=U,k.log("Created new stream for track:",M.track.kind));if(U){if(U.getAudioTracks().forEach(D=>{D.enabled=!0,D.muted&&A.iceConnectionState==="connected"&&k.warn(" [REMOTE TRACK] Audio track is muted even though ICE is connected - this may indicate no data"),k.log(" [REMOTE TRACK] Enabled remote audio track:",{id:D.id,enabled:D.enabled,muted:D.muted,readyState:D.readyState,iceConnectionState:A.iceConnectionState})}),U.getVideoTracks().forEach(D=>{D.enabled=!0,D.muted&&A.iceConnectionState==="connected"&&k.warn(" [REMOTE TRACK] Video track is muted even though ICE is connected - this may indicate no data"),k.log(" [REMOTE TRACK] Enabled remote video track:",{id:D.id,enabled:D.enabled,muted:D.muted,readyState:D.readyState,iceConnectionState:A.iceConnectionState})}),A.iceConnectionState==="connected"||A.iceConnectionState==="completed"){const D=U.getAudioTracks().filter(z=>z.muted).length,B=U.getVideoTracks().filter(z=>z.muted).length;(D>0||B>0)&&k.error(" [REMOTE TRACK] CRITICAL: Tracks are muted even though ICE is connected!",{mutedAudioTracks:D,mutedVideoTracks:B,totalAudioTracks:U.getAudioTracks().length,totalVideoTracks:U.getVideoTracks().length,iceConnectionState:A.iceConnectionState,connectionState:A.connectionState,signalingState:A.signalingState})}if(k.log("Remote stream updated:",{id:U.id,audioTracks:U.getAudioTracks().length,videoTracks:U.getVideoTracks().length}),u(U),n.current){const D=n.current;D.srcObject!==U?(D.srcObject=U,k.log(" [REMOTE STREAM] Remote stream srcObject set",{streamId:U.id,audioTracks:U.getAudioTracks().length,videoTracks:U.getVideoTracks().length,iceConnectionState:A.iceConnectionState,connectionState:A.connectionState})):k.log(" [REMOTE STREAM] Stream already set, ensuring playback",{streamId:U.id,audioTracks:U.getAudioTracks().length,videoTracks:U.getVideoTracks().length});const z=()=>{if(!D||!D.srcObject){k.warn(" [REMOTE STREAM] Video or srcObject not ready for play");return}k.log(" [REMOTE STREAM] Attempting to play video with tracks",{readyState:D.readyState,paused:D.paused,muted:D.muted,audioTracks:U.getAudioTracks().length,videoTracks:U.getVideoTracks().length,audioMuted:U.getAudioTracks().some(q=>q.muted),videoMuted:U.getVideoTracks().some(q=>q.muted),iceConnectionState:A.iceConnectionState}),D.paused?D.play().then(()=>{k.log(" [REMOTE STREAM] Video started playing"),setTimeout(()=>{const q=U.getAudioTracks().filter(Q=>Q.muted).length,H=U.getVideoTracks().filter(Q=>Q.muted).length;(q>0||H>0)&&k.warn(" [REMOTE STREAM] Some tracks still muted after play - they should unmute when media flows",{audioMuted:q,videoMuted:H,iceConnectionState:A.iceConnectionState})},1e3)}).catch(q=>{k.log(" [REMOTE STREAM] Play failed, will retry:",q.name),setTimeout(()=>{D&&D.srcObject&&D.paused&&D.play().catch(H=>{H.name!=="AbortError"&&k.log(" [REMOTE STREAM] Retry play failed:",H.name)})},200)}):k.log(" [REMOTE STREAM] Video is already playing")};requestAnimationFrame(()=>{z()}),setTimeout(()=>{D&&D.srcObject&&D.paused&&z()},100)}else k.warn(" [REMOTE STREAM] remoteVideoRef.current is null - video element not ready")}};const Z=new Set;A.onicecandidate=async M=>{const U=N.current;if(!U){k.warn(" [ICE CANDIDATE] No callId available yet, candidate will be queued");return}try{if(M.candidate===null){k.log(" [ICE CANDIDATE] ICE gathering complete (null candidate received)"),k.log(" [ICE CANDIDATE] Total candidates processed:",Z.size);return}if(M.candidate){const D=M.candidate.toJSON(),B=`${D.candidate}-${D.sdpMLineIndex}-${D.sdpMid}`;if(Z.has(B))return;Z.add(B);const z=Z.size,q=s?"child":"parent";z===1&&k.log(" [ICE CANDIDATE] ICE gathering started:",{role:q,callId:U,isChild:s,timestamp:new Date().toISOString()});const H=s?"child_ice_candidates":"parent_ice_candidates";z===1&&k.log(" [ICE CANDIDATE] Role verification:",{isChild:s,role:q,candidateField:H,expectedField:s?"child_ice_candidates":"parent_ice_candidates",matches:H===(s?"child_ice_candidates":"parent_ice_candidates")});const{data:Q,error:$}=await Y.from("calls").select(H).eq("id",U).maybeSingle();if($){k.error(` [ICE CANDIDATE] Error reading ${H}:`,$);return}if(Q){const O=Q[H]||[];if(!O.some(F=>F.candidate===D.candidate&&F.sdpMLineIndex===D.sdpMLineIndex&&F.sdpMid===D.sdpMid)){const F=[...O,D],{error:ee}=await Y.from("calls").update({[H]:F}).eq("id",U);if(ee)k.error(` [ICE CANDIDATE] Error updating ${H}:`,ee),(ee.message?.includes("column")||ee.code==="PGRST204")&&k.error(` [ICE CANDIDATE] Database column ${H} may not exist. Run fix_ice_candidates_schema.sql migration!`);else{const ce=F.length;(ce<=3||ce%20===0)&&k.log(` [ICE CANDIDATE] Candidate #${ce} sent to ${H}`)}}}else k.warn(` [ICE CANDIDATE] Call ${U} not found in database`)}}catch(D){k.error(" [ICE CANDIDATE] Error handling ICE candidate:",D)}}}catch(R){throw k.error("Error initializing WebRTC connection:",R),R}},[e,t,n,s]),j=p.useCallback((R=!1)=>{const A=b.current,I=A?.iceConnectionState,L=A?.connectionState;if(k.log(" [CLEANUP] Cleaning up WebRTC resources...",{timestamp:new Date().toISOString(),connectionState:L,iceConnectionState:I,signalingState:A?.signalingState,hasLocalStream:!!x.current,hasRemoteStream:!!C.current,force:R}),R)k.log(" [CLEANUP] Force cleanup requested (explicit hangup) - cleaning up regardless of ICE state");else{const M=A?Date.now()-A._iceStateStartTime||Date.now():0,U=I==="new"&&M<5e3;if(I==="new"&&U||I==="checking"){k.warn(" [CLEANUP] Skipping cleanup - ICE connection still establishing (state:",I,")"),k.warn(" [CLEANUP] Use force=true to cleanup during explicit hangup");return}I==="new"&&!U&&k.warn(" [CLEANUP] ICE stuck in 'new' for 5+ seconds - allowing cleanup (connection likely failed)")}const Z=x.current;Z&&(Z.getTracks().forEach(M=>{M.stop(),k.log("Stopped track:",M.kind)}),x.current=null,l(null)),t.current?.srcObject&&(t.current.srcObject.getTracks().forEach(U=>{U.stop(),k.log("Stopped track from video element:",U.kind)}),t.current.srcObject=null),n.current?.srcObject&&(n.current.srcObject=null),A&&(A.signalingState!=="closed"&&(k.log("Closing peer connection, current state:",A.signalingState),A.close()),b.current=null),u(null),C.current=null,w.current.clear()},[t,n]),T=p.useCallback(()=>{const R=n.current;if(!R){k.log("Video element not ready yet");return}const A=C.current||c;if(!A){k.log("Remote stream not available yet");return}k.log("playRemoteVideo called",{hasVideo:!!R,hasStream:!!A,currentSrcObject:!!R.srcObject,paused:R.paused,readyState:R.readyState,audioTracks:A.getAudioTracks().length,videoTracks:A.getVideoTracks().length}),R.srcObject!==A&&(k.log("Setting remote video srcObject"),R.srcObject=A);const I=()=>{if(k.log(" [VIDEO PLAY] Attempting to play video:",{hasSrcObject:!!R.srcObject,readyState:R.readyState,paused:R.paused,muted:R.muted,timestamp:new Date().toISOString()}),!R.srcObject){k.log(" [VIDEO PLAY] Video srcObject not set, retrying..."),setTimeout(I,50);return}const L=R.srcObject,Z=L&&(L.getAudioTracks().some(M=>!M.muted&&M.readyState==="live")||L.getVideoTracks().some(M=>!M.muted&&M.readyState==="live"));if(R.readyState<2&&!Z){k.log(" [VIDEO PLAY] Waiting for video readyState >= 2 or unmuted tracks (current:",R.readyState,")");const M=()=>{const U=L&&(L.getAudioTracks().some(D=>!D.muted&&D.readyState==="live")||L.getVideoTracks().some(D=>!D.muted&&D.readyState==="live"));(R.readyState>=2||U)&&(k.log(" [VIDEO PLAY] Video ready, readyState:",R.readyState,"- attempting play"),R.paused&&R.play().catch(D=>{k.error(" [VIDEO PLAY] Play failed after ready:",D)}))};if(R.addEventListener("loadeddata",M,{once:!0}),R.addEventListener("canplay",M,{once:!0}),R.addEventListener("canplaythrough",M,{once:!0}),L){const U=()=>{(L.getAudioTracks().some(B=>!B.muted&&B.readyState==="live")||L.getVideoTracks().some(B=>!B.muted&&B.readyState==="live"))&&R.paused&&(k.log(" [VIDEO PLAY] Tracks unmuted, attempting play"),R.play().catch(B=>{k.error(" [VIDEO PLAY] Play failed after track unmute:",B)}))};L.getTracks().forEach(D=>{D.addEventListener("unmute",U,{once:!0})})}return}if(Z&&R.readyState<2&&k.log(" [VIDEO PLAY] Tracks are unmuted, attempting play despite low readyState:",R.readyState),R.paused){k.log(" [VIDEO PLAY] Video ready (readyState:",R.readyState,"), attempting play");const M=R.play();M!==void 0&&M.then(()=>{k.log(" [VIDEO PLAY] Remote video playing successfully!"),k.log(" [VIDEO PLAY] Video state:",{paused:R.paused,muted:R.muted,volume:R.volume,readyState:R.readyState})}).catch(U=>{U.name==="NotAllowedError"?k.error(" [VIDEO PLAY] Autoplay not allowed - need user interaction"):U.name!=="AbortError"?(k.log(" [VIDEO PLAY] Play failed, retrying after delay:",U.name),setTimeout(()=>{R.readyState>=2&&R.paused&&R.play().catch(D=>{k.error(" [VIDEO PLAY] Retry play failed:",D)})},100)):k.log(" [VIDEO PLAY] Play was interrupted (likely by another play call) - this is OK")})}else k.log(" [VIDEO PLAY] Remote video is already playing")};requestAnimationFrame(()=>{I()})},[c]);return p.useEffect(()=>{if(c&&n.current){n.current.srcObject!==c&&(n.current.srcObject=c,k.log(" [REMOTE STREAM] Remote stream srcObject updated in useEffect"),requestAnimationFrame(()=>{n.current&&n.current.srcObject===c&&n.current.play().then(()=>{k.log(" [REMOTE STREAM] Video started playing in useEffect")}).catch(A=>{k.log(" [REMOTE STREAM] Play failed in useEffect (will retry):",A.name)})}));const R=setInterval(()=>{const A=n.current;if(!A||!A.srcObject)return;const I=A.srcObject,L=I.getAudioTracks(),Z=I.getVideoTracks(),M=b.current,U=L.some(Q=>Q.muted),D=Z.some(Q=>Q.muted),B=A.paused,z=M?.iceConnectionState,q=M?.connectionState;(z==="failed"||z==="disconnected"||z==="closed"||q==="failed"||q==="disconnected"||q==="closed")&&k.warn(" [MONITOR] Connection issue detected:",{iceConnectionState:z,connectionState:q,videoPaused:B,hasMutedAudio:U&&z==="connected",hasMutedVideo:D&&z==="connected"}),B&&z==="connected"&&A.play().catch(()=>{})},5e3);return k.log(" [REMOTE STREAM] Remote stream in useEffect:",{id:c.id,audioTracks:c.getAudioTracks().map(A=>({id:A.id,enabled:A.enabled,muted:A.muted,readyState:A.readyState})),videoTracks:c.getVideoTracks().map(A=>({id:A.id,enabled:A.enabled,muted:A.muted,readyState:A.readyState}))}),()=>{clearInterval(R)}}},[c]),{peerConnection:b.current,localStream:o,remoteStream:c,isConnecting:h,setIsConnecting:f,isConnected:g,initializeConnection:_,cleanup:j,iceCandidatesQueue:S,peerConnectionRef:b,playRemoteVideo:T}},rE=({role:e,localProfileId:t,remoteProfileId:n,localVideoRef:s,remoteVideoRef:o})=>{const[l,c]=p.useState("idle"),[u,h]=p.useState(null),[f,g]=p.useState(!1),[v,b]=p.useState(!1),x=rt(),{toast:S}=_t(),C=p.useRef(null),w=p.useRef(null),N=p.useRef(!1),{localStream:_,remoteStream:j,setIsConnecting:T,initializeConnection:R,cleanup:A,iceCandidatesQueue:I,peerConnectionRef:L}=nE(u,s,o,e==="child");p.useEffect(()=>{!N.current&&l==="idle"&&(N.current=!0,R().catch(q=>{console.error("Failed to initialize WebRTC:",q),S({title:"Connection Error",description:"Failed to initialize video connection",variant:"destructive"})}))},[l,R,S]),p.useEffect(()=>{l==="incoming"&&!_&&(console.log(" [CALL ENGINE] Pre-warming local media for incoming call"),R().catch(q=>{console.error("Failed to pre-warm media:",q)}))},[l,_,R]),p.useEffect(()=>{if(l!=="idle"||!t)return;const q=Y.channel(`incoming-calls:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:e==="parent"?`parent_id=eq.${t}`:`child_id=eq.${t}`},async H=>{const Q=H.new;Q.status==="ringing"&&Q.caller_type!==e&&Q.offer&&(console.log(" [CALL ENGINE] Incoming call detected:",Q.id),h(Q.id),c("incoming"))}).subscribe();return()=>{Y.removeChannel(q)}},[l,t,e]),p.useEffect(()=>{if(!u)return;const q=Y.channel(`call-status:${u}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${u}`},async H=>{const Q=H.new,$=H.old,O=L.current;if(l==="calling"&&Q.answer&&Q.status==="in_call"&&(console.log(" [CALL ENGINE] Answer received, setting remote description"),O&&O.remoteDescription===null)){const J=Q.answer;await O.setRemoteDescription(new RTCSessionDescription(J));for(const F of I.current)try{await O.addIceCandidate(new RTCIceCandidate(F))}catch(ee){const ce=ee;!ce.message?.includes("duplicate")&&!ce.message?.includes("already")&&console.error("Error adding queued ICE candidate:",ce.message)}I.current=[]}if((l==="calling"||l==="incoming"||l==="connecting")&&(Q.status==="rejected"||Q.status==="missed")&&(console.log(" [CALL ENGINE] Call rejected or missed"),c("ended"),A()),Xt(Q)&&$&&!Xt($)&&(console.log(" [CALL ENGINE] Call ended by remote party"),c("ended"),A(),S({title:"Call Ended",description:"The other person ended the call"})),Q.status==="in_call"&&(l==="calling"||l==="incoming"||l==="connecting")&&O){const J=()=>{const F=O.iceConnectionState,ee=O.connectionState;(F==="connected"||F==="completed")&&ee==="connected"&&j&&(console.log(" [CALL ENGINE] Connection established, transitioning to in_call"),c("in_call"),T(!1))};return J(),O.addEventListener("iceconnectionstatechange",J),O.addEventListener("connectionstatechange",J),()=>{O.removeEventListener("iceconnectionstatechange",J),O.removeEventListener("connectionstatechange",J)}}}).subscribe();return C.current=q,()=>{C.current&&(Y.removeChannel(C.current),C.current=null)}},[u,l,j,T,A,S]),p.useEffect(()=>{const q=L.current;if(!q||l!=="calling")return;const H=()=>{const Q=q.iceConnectionState,$=q.connectionState;(Q==="connected"||Q==="completed")&&$==="connected"&&j&&l==="calling"&&(console.log(" [CALL ENGINE] WebRTC connected, transitioning to in_call"),c("in_call"),T(!1))};return q.addEventListener("iceconnectionstatechange",H),q.addEventListener("connectionstatechange",H),()=>{q.removeEventListener("iceconnectionstatechange",H),q.removeEventListener("connectionstatechange",H)}},[l,j,T,L]),p.useEffect(()=>{if(l==="ended"){const q=setTimeout(()=>{x(e==="parent"?"/parent":"/child")},2e3);return()=>clearTimeout(q)}},[l,x,e]);const Z=p.useCallback(async q=>{if(l!=="idle"){console.warn("Cannot start call: not in idle state");return}try{c("calling"),T(!0);const H=L.current;if(!H)throw new Error("Peer connection not initialized");const Q=await H.createOffer();await H.setLocalDescription(Q);const $=e,O={[e==="parent"?"parent_id":"child_id"]:t,[e==="parent"?"child_id":"parent_id"]:q,caller_type:$,status:"ringing",offer:{type:Q.type,sdp:Q.sdp}},{data:J,error:F}=await Y.from("calls").insert(O).select().single();if(F)throw F;if(!J)throw new Error("Failed to create call");h(J.id),console.log(" [CALL ENGINE] Outgoing call created:",J.id),H.onicecandidate=async ce=>{if(ce.candidate&&J.id){const K=e==="parent"?"parent_ice_candidates":"child_ice_candidates",{data:W}=await Y.from("calls").select(K).eq("id",J.id).single(),G=[...W?.[K]||[],ce.candidate.toJSON()];await Y.from("calls").update({[K]:G}).eq("id",J.id)}};const ee=Y.channel(`call-answer:${J.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${J.id}`},async ce=>{const K=ce.new,W=L.current;if(K.answer&&K.status==="in_call"){if(!W)return;const ne=K.answer;await W.setRemoteDescription(new RTCSessionDescription(ne));const G=e==="parent"?"child_ice_candidates":"parent_ice_candidates",{data:ae}=await Y.from("calls").select(G).eq("id",J.id).single(),fe=ae?.[G]||[];if(W)for(const ve of fe)try{await W.addIceCandidate(new RTCIceCandidate(ve))}catch(xe){const Ie=xe;!Ie.message?.includes("duplicate")&&!Ie.message?.includes("already")&&console.error("Error adding remote ICE candidate:",Ie.message)}}}).subscribe();C.current=ee}catch(H){console.error("Error starting outgoing call:",H),S({title:"Call Failed",description:H instanceof Error?H.message:"Failed to start call",variant:"destructive"}),c("idle"),T(!1)}},[l,t,e,T,S]),M=p.useCallback(async q=>{if(l!=="incoming"){console.warn("Cannot accept call: not in incoming state");return}try{c("connecting"),T(!0);const H=L.current;if(!H)throw new Error("Peer connection not initialized");_||(console.log(" [CALL ENGINE] Local stream not ready, initializing now..."),await R());const{data:Q,error:$}=await Y.from("calls").select("*").eq("id",q).single();if($||!Q)throw new Error("Call not found");if(!Q.offer)throw new Error("Call offer not found");const O=Q.offer;await H.setRemoteDescription(new RTCSessionDescription(O));const J=await H.createAnswer();await H.setLocalDescription(J);const{error:F}=await Y.from("calls").update({answer:{type:J.type,sdp:J.sdp},status:"in_call"}).eq("id",q);if(F)throw F;h(q),console.log(" [CALL ENGINE] Call accepted:",q),H&&(H.onicecandidate=async K=>{if(K.candidate&&q){const W=e==="parent"?"parent_ice_candidates":"child_ice_candidates",{data:ne}=await Y.from("calls").select(W).eq("id",q).single(),ae=[...ne?.[W]||[],K.candidate.toJSON()];await Y.from("calls").update({[W]:ae}).eq("id",q)}});const ce=Q[e==="parent"?"child_ice_candidates":"parent_ice_candidates"]||[];for(const K of ce)try{await H.addIceCandidate(new RTCIceCandidate(K))}catch(W){const ne=W;!ne.message?.includes("duplicate")&&!ne.message?.includes("already")&&console.error("Error adding remote ICE candidate:",ne.message)}}catch(H){console.error("Error accepting call:",H),S({title:"Call Failed",description:H instanceof Error?H.message:"Failed to accept call",variant:"destructive"}),c("idle"),T(!1)}},[l,_,R,e,T,S,L]),U=p.useCallback(async q=>{if(l!=="incoming"){console.warn("Cannot reject call: not in incoming state");return}try{await Y.from("calls").update({status:"rejected"}).eq("id",q),c("ended"),console.log(" [CALL ENGINE] Call rejected:",q)}catch(H){console.error("Error rejecting call:",H),S({title:"Error",description:"Failed to reject call",variant:"destructive"})}},[l,S]),D=p.useCallback(async()=>{if(u)try{await ta({callId:u,by:e,reason:"hangup"}),c("ended"),A(),C.current&&(Y.removeChannel(C.current),C.current=null),w.current&&(Y.removeChannel(w.current),w.current=null),console.log(" [CALL ENGINE] Call ended:",u)}catch(q){console.error("Error ending call:",q),S({title:"Error",description:"Failed to end call",variant:"destructive"})}},[u,e,A,S]),B=p.useCallback(()=>{if(_){const q=!f;_.getAudioTracks().forEach(H=>{H.enabled=!q}),g(q)}},[_,f]),z=p.useCallback(()=>{if(_){const q=!v;_.getVideoTracks().forEach(H=>{H.enabled=!q}),b(q)}},[_,v]);return{state:l,callId:u,localStream:_,remoteStream:j,isMuted:f,isVideoOff:v,startOutgoingCall:Z,acceptIncomingCall:M,rejectIncomingCall:U,endCall:D,toggleMute:B,toggleVideo:z}},WM=()=>{const{childId:e}=hd(),t=rt(),{toast:n}=_t(),[s,o]=p.useState(null),[l,c]=p.useState(""),u=p.useRef(null),h=p.useRef(null);p.useEffect(()=>{(async()=>{const{data:{user:v}}=await Y.auth.getUser();if(!v){t("/parent/auth");return}if(o(v.id),e){const{data:b}=await Y.from("children").select("name").eq("id",e).single();b&&c(b.name)}})()},[e,t]);const f=rE({role:"parent",localProfileId:s||"",remoteProfileId:e||"",localVideoRef:u,remoteVideoRef:h});return p.useEffect(()=>{f.state==="idle"&&s&&e&&f.startOutgoingCall(e).catch(g=>{console.error("Failed to start call:",g),n({title:"Call Failed",description:"Failed to start call",variant:"destructive"})})},[f.state,s,e,f]),p.useEffect(()=>{f.state},[f.state]),!s||!e?i.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:i.jsx("div",{children:"Loading..."})}):f.state==="calling"?i.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:i.jsx(Ae,{className:"p-8",children:i.jsxs("div",{className:"text-center space-y-4",children:[i.jsxs("h2",{className:"text-2xl font-semibold",children:["Calling ",l,"..."]}),i.jsx("p",{className:"text-muted-foreground",children:"Waiting for answer"})]})})}):f.state==="incoming"?i.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:i.jsx(Ae,{className:"p-8",children:i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold",children:"Incoming Call"}),i.jsxs("div",{className:"flex gap-4 justify-center",children:[i.jsx(de,{onClick:()=>f.callId&&f.acceptIncomingCall(f.callId),children:"Accept"}),i.jsx(de,{variant:"destructive",onClick:()=>f.callId&&f.rejectIncomingCall(f.callId),children:"Reject"})]})]})})}):i.jsx(tp,{localVideoRef:u,remoteVideoRef:h,remoteStream:f.remoteStream,isConnecting:f.state==="calling"||f.state==="connecting",isMuted:f.isMuted,isVideoOff:f.isVideoOff,onToggleMute:f.toggleMute,onToggleVideo:f.toggleVideo,onEndCall:f.endCall})};function Dw(e,[t,n]){return Math.min(n,Math.max(t,e))}var GM=[" ","Enter","ArrowUp","ArrowDown"],KM=[" ","Enter"],na="Select",[kd,Td,YM]=Zc(na),[ci]=Mn(na,[YM,ai]),Ad=ai(),[JM,_s]=ci(na),[QM,XM]=ci(na),sE=e=>{const{__scopeSelect:t,children:n,open:s,defaultOpen:o,onOpenChange:l,value:c,defaultValue:u,onValueChange:h,dir:f,name:g,autoComplete:v,disabled:b,required:x,form:S}=e,C=Ad(t),[w,N]=p.useState(null),[_,j]=p.useState(null),[T,R]=p.useState(!1),A=Sd(f),[I,L]=ys({prop:s,defaultProp:o??!1,onChange:l,caller:na}),[Z,M]=ys({prop:c,defaultProp:u,onChange:h,caller:na}),U=p.useRef(null),D=w?S||!!w.closest("form"):!0,[B,z]=p.useState(new Set),q=Array.from(B).map(H=>H.props.value).join(";");return i.jsx(d0,{...C,children:i.jsxs(JM,{required:x,scope:t,trigger:w,onTriggerChange:N,valueNode:_,onValueNodeChange:j,valueNodeHasChildren:T,onValueNodeHasChildrenChange:R,contentId:pr(),value:Z,onValueChange:M,open:I,onOpenChange:L,dir:A,triggerPointerDownPosRef:U,disabled:b,children:[i.jsx(kd.Provider,{scope:t,children:i.jsx(QM,{scope:e.__scopeSelect,onNativeOptionAdd:p.useCallback(H=>{z(Q=>new Set(Q).add(H))},[]),onNativeOptionRemove:p.useCallback(H=>{z(Q=>{const $=new Set(Q);return $.delete(H),$})},[]),children:n})}),D?i.jsxs(kE,{"aria-hidden":!0,required:x,tabIndex:-1,name:g,autoComplete:v,value:Z,onChange:H=>M(H.target.value),disabled:b,form:S,children:[Z===void 0?i.jsx("option",{value:""}):null,Array.from(B)]},q):null]})})};sE.displayName=na;var aE="SelectTrigger",iE=p.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:s=!1,...o}=e,l=Ad(n),c=_s(aE,n),u=c.disabled||s,h=Ye(t,c.onTriggerChange),f=Td(n),g=p.useRef("touch"),[v,b,x]=AE(C=>{const w=f().filter(j=>!j.disabled),N=w.find(j=>j.value===c.value),_=PE(w,C,N);_!==void 0&&c.onValueChange(_.value)}),S=C=>{u||(c.onOpenChange(!0),x()),C&&(c.triggerPointerDownPosRef.current={x:Math.round(C.pageX),y:Math.round(C.pageY)})};return i.jsx(pm,{asChild:!0,...l,children:i.jsx(Me.button,{type:"button",role:"combobox","aria-controls":c.contentId,"aria-expanded":c.open,"aria-required":c.required,"aria-autocomplete":"none",dir:c.dir,"data-state":c.open?"open":"closed",disabled:u,"data-disabled":u?"":void 0,"data-placeholder":TE(c.value)?"":void 0,...o,ref:h,onClick:we(o.onClick,C=>{C.currentTarget.focus(),g.current!=="mouse"&&S(C)}),onPointerDown:we(o.onPointerDown,C=>{g.current=C.pointerType;const w=C.target;w.hasPointerCapture(C.pointerId)&&w.releasePointerCapture(C.pointerId),C.button===0&&C.ctrlKey===!1&&C.pointerType==="mouse"&&(S(C),C.preventDefault())}),onKeyDown:we(o.onKeyDown,C=>{const w=v.current!=="";!(C.ctrlKey||C.altKey||C.metaKey)&&C.key.length===1&&b(C.key),!(w&&C.key===" ")&&GM.includes(C.key)&&(S(),C.preventDefault())})})})});iE.displayName=aE;var oE="SelectValue",lE=p.forwardRef((e,t)=>{const{__scopeSelect:n,className:s,style:o,children:l,placeholder:c="",...u}=e,h=_s(oE,n),{onValueNodeHasChildrenChange:f}=h,g=l!==void 0,v=Ye(t,h.onValueNodeChange);return Ut(()=>{f(g)},[f,g]),i.jsx(Me.span,{...u,ref:v,style:{pointerEvents:"none"},children:TE(h.value)?i.jsx(i.Fragment,{children:c}):l})});lE.displayName=oE;var ZM="SelectIcon",cE=p.forwardRef((e,t)=>{const{__scopeSelect:n,children:s,...o}=e;return i.jsx(Me.span,{"aria-hidden":!0,...o,ref:t,children:s||""})});cE.displayName=ZM;var e4="SelectPortal",dE=e=>i.jsx(No,{asChild:!0,...e});dE.displayName=e4;var ra="SelectContent",uE=p.forwardRef((e,t)=>{const n=_s(ra,e.__scopeSelect),[s,o]=p.useState();if(Ut(()=>{o(new DocumentFragment)},[]),!n.open){const l=s;return l?ei.createPortal(i.jsx(hE,{scope:e.__scopeSelect,children:i.jsx(kd.Slot,{scope:e.__scopeSelect,children:i.jsx("div",{children:e.children})})}),l):null}return i.jsx(fE,{...e,ref:t})});uE.displayName=ra;var Qn=10,[hE,Ns]=ci(ra),t4="SelectContentImpl",n4=Qs("SelectContent.RemoveScroll"),fE=p.forwardRef((e,t)=>{const{__scopeSelect:n,position:s="item-aligned",onCloseAutoFocus:o,onEscapeKeyDown:l,onPointerDownOutside:c,side:u,sideOffset:h,align:f,alignOffset:g,arrowPadding:v,collisionBoundary:b,collisionPadding:x,sticky:S,hideWhenDetached:C,avoidCollisions:w,...N}=e,_=_s(ra,n),[j,T]=p.useState(null),[R,A]=p.useState(null),I=Ye(t,G=>T(G)),[L,Z]=p.useState(null),[M,U]=p.useState(null),D=Td(n),[B,z]=p.useState(!1),q=p.useRef(!1);p.useEffect(()=>{if(j)return Fm(j)},[j]),$m();const H=p.useCallback(G=>{const[ae,...fe]=D().map(Ie=>Ie.ref.current),[ve]=fe.slice(-1),xe=document.activeElement;for(const Ie of G)if(Ie===xe||(Ie?.scrollIntoView({block:"nearest"}),Ie===ae&&R&&(R.scrollTop=0),Ie===ve&&R&&(R.scrollTop=R.scrollHeight),Ie?.focus(),document.activeElement!==xe))return},[D,R]),Q=p.useCallback(()=>H([L,j]),[H,L,j]);p.useEffect(()=>{B&&Q()},[B,Q]);const{onOpenChange:$,triggerPointerDownPosRef:O}=_;p.useEffect(()=>{if(j){let G={x:0,y:0};const ae=ve=>{G={x:Math.abs(Math.round(ve.pageX)-(O.current?.x??0)),y:Math.abs(Math.round(ve.pageY)-(O.current?.y??0))}},fe=ve=>{G.x<=10&&G.y<=10?ve.preventDefault():j.contains(ve.target)||$(!1),document.removeEventListener("pointermove",ae),O.current=null};return O.current!==null&&(document.addEventListener("pointermove",ae),document.addEventListener("pointerup",fe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ae),document.removeEventListener("pointerup",fe,{capture:!0})}}},[j,$,O]),p.useEffect(()=>{const G=()=>$(!1);return window.addEventListener("blur",G),window.addEventListener("resize",G),()=>{window.removeEventListener("blur",G),window.removeEventListener("resize",G)}},[$]);const[J,F]=AE(G=>{const ae=D().filter(xe=>!xe.disabled),fe=ae.find(xe=>xe.ref.current===document.activeElement),ve=PE(ae,G,fe);ve&&setTimeout(()=>ve.ref.current.focus())}),ee=p.useCallback((G,ae,fe)=>{const ve=!q.current&&!fe;(_.value!==void 0&&_.value===ae||ve)&&(Z(G),ve&&(q.current=!0))},[_.value]),ce=p.useCallback(()=>j?.focus(),[j]),K=p.useCallback((G,ae,fe)=>{const ve=!q.current&&!fe;(_.value!==void 0&&_.value===ae||ve)&&U(G)},[_.value]),W=s==="popper"?Uf:mE,ne=W===Uf?{side:u,sideOffset:h,align:f,alignOffset:g,arrowPadding:v,collisionBoundary:b,collisionPadding:x,sticky:S,hideWhenDetached:C,avoidCollisions:w}:{};return i.jsx(hE,{scope:n,content:j,viewport:R,onViewportChange:A,itemRefCallback:ee,selectedItem:L,onItemLeave:ce,itemTextRefCallback:K,focusSelectedItem:Q,selectedItemText:M,position:s,isPositioned:B,searchRef:J,children:i.jsx(xd,{as:n4,allowPinchZoom:!0,children:i.jsx(yd,{asChild:!0,trapped:_.open,onMountAutoFocus:G=>{G.preventDefault()},onUnmountAutoFocus:we(o,G=>{_.trigger?.focus({preventScroll:!0}),G.preventDefault()}),children:i.jsx(ti,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:G=>G.preventDefault(),onDismiss:()=>_.onOpenChange(!1),children:i.jsx(W,{role:"listbox",id:_.contentId,"data-state":_.open?"open":"closed",dir:_.dir,onContextMenu:G=>G.preventDefault(),...N,...ne,onPlaced:()=>z(!0),ref:I,style:{display:"flex",flexDirection:"column",outline:"none",...N.style},onKeyDown:we(N.onKeyDown,G=>{const ae=G.ctrlKey||G.altKey||G.metaKey;if(G.key==="Tab"&&G.preventDefault(),!ae&&G.key.length===1&&F(G.key),["ArrowUp","ArrowDown","Home","End"].includes(G.key)){let ve=D().filter(xe=>!xe.disabled).map(xe=>xe.ref.current);if(["ArrowUp","End"].includes(G.key)&&(ve=ve.slice().reverse()),["ArrowUp","ArrowDown"].includes(G.key)){const xe=G.target,Ie=ve.indexOf(xe);ve=ve.slice(Ie+1)}setTimeout(()=>H(ve)),G.preventDefault()}})})})})})})});fE.displayName=t4;var r4="SelectItemAlignedPosition",mE=p.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:s,...o}=e,l=_s(ra,n),c=Ns(ra,n),[u,h]=p.useState(null),[f,g]=p.useState(null),v=Ye(t,I=>g(I)),b=Td(n),x=p.useRef(!1),S=p.useRef(!0),{viewport:C,selectedItem:w,selectedItemText:N,focusSelectedItem:_}=c,j=p.useCallback(()=>{if(l.trigger&&l.valueNode&&u&&f&&C&&w&&N){const I=l.trigger.getBoundingClientRect(),L=f.getBoundingClientRect(),Z=l.valueNode.getBoundingClientRect(),M=N.getBoundingClientRect();if(l.dir!=="rtl"){const xe=M.left-L.left,Ie=Z.left-xe,$e=I.left-Ie,Ke=I.width+$e,Ve=Math.max(Ke,L.width),ie=window.innerWidth-Qn,Re=Dw(Ie,[Qn,Math.max(Qn,ie-Ve)]);u.style.minWidth=Ke+"px",u.style.left=Re+"px"}else{const xe=L.right-M.right,Ie=window.innerWidth-Z.right-xe,$e=window.innerWidth-I.right-Ie,Ke=I.width+$e,Ve=Math.max(Ke,L.width),ie=window.innerWidth-Qn,Re=Dw(Ie,[Qn,Math.max(Qn,ie-Ve)]);u.style.minWidth=Ke+"px",u.style.right=Re+"px"}const U=b(),D=window.innerHeight-Qn*2,B=C.scrollHeight,z=window.getComputedStyle(f),q=parseInt(z.borderTopWidth,10),H=parseInt(z.paddingTop,10),Q=parseInt(z.borderBottomWidth,10),$=parseInt(z.paddingBottom,10),O=q+H+B+$+Q,J=Math.min(w.offsetHeight*5,O),F=window.getComputedStyle(C),ee=parseInt(F.paddingTop,10),ce=parseInt(F.paddingBottom,10),K=I.top+I.height/2-Qn,W=D-K,ne=w.offsetHeight/2,G=w.offsetTop+ne,ae=q+H+G,fe=O-ae;if(ae<=K){const xe=U.length>0&&w===U[U.length-1].ref.current;u.style.bottom="0px";const Ie=f.clientHeight-C.offsetTop-C.offsetHeight,$e=Math.max(W,ne+(xe?ce:0)+Ie+Q),Ke=ae+$e;u.style.height=Ke+"px"}else{const xe=U.length>0&&w===U[0].ref.current;u.style.top="0px";const $e=Math.max(K,q+C.offsetTop+(xe?ee:0)+ne)+fe;u.style.height=$e+"px",C.scrollTop=ae-K+C.offsetTop}u.style.margin=`${Qn}px 0`,u.style.minHeight=J+"px",u.style.maxHeight=D+"px",s?.(),requestAnimationFrame(()=>x.current=!0)}},[b,l.trigger,l.valueNode,u,f,C,w,N,l.dir,s]);Ut(()=>j(),[j]);const[T,R]=p.useState();Ut(()=>{f&&R(window.getComputedStyle(f).zIndex)},[f]);const A=p.useCallback(I=>{I&&S.current===!0&&(j(),_?.(),S.current=!1)},[j,_]);return i.jsx(a4,{scope:n,contentWrapper:u,shouldExpandOnScrollRef:x,onScrollButtonChange:A,children:i.jsx("div",{ref:h,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:T},children:i.jsx(Me.div,{...o,ref:v,style:{boxSizing:"border-box",maxHeight:"100%",...o.style}})})})});mE.displayName=r4;var s4="SelectPopperPosition",Uf=p.forwardRef((e,t)=>{const{__scopeSelect:n,align:s="start",collisionPadding:o=Qn,...l}=e,c=Ad(n);return i.jsx(gm,{...c,...l,ref:t,align:s,collisionPadding:o,style:{boxSizing:"border-box",...l.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Uf.displayName=s4;var[a4,np]=ci(ra,{}),Bf="SelectViewport",pE=p.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:s,...o}=e,l=Ns(Bf,n),c=np(Bf,n),u=Ye(t,l.onViewportChange),h=p.useRef(0);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),i.jsx(kd.Slot,{scope:n,children:i.jsx(Me.div,{"data-radix-select-viewport":"",role:"presentation",...o,ref:u,style:{position:"relative",flex:1,overflow:"hidden auto",...o.style},onScroll:we(o.onScroll,f=>{const g=f.currentTarget,{contentWrapper:v,shouldExpandOnScrollRef:b}=c;if(b?.current&&v){const x=Math.abs(h.current-g.scrollTop);if(x>0){const S=window.innerHeight-Qn*2,C=parseFloat(v.style.minHeight),w=parseFloat(v.style.height),N=Math.max(C,w);if(N<S){const _=N+x,j=Math.min(S,_),T=_-j;v.style.height=j+"px",v.style.bottom==="0px"&&(g.scrollTop=T>0?T:0,v.style.justifyContent="flex-end")}}}h.current=g.scrollTop})})})]})});pE.displayName=Bf;var gE="SelectGroup",[i4,o4]=ci(gE),l4=p.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e,o=pr();return i.jsx(i4,{scope:n,id:o,children:i.jsx(Me.div,{role:"group","aria-labelledby":o,...s,ref:t})})});l4.displayName=gE;var vE="SelectLabel",yE=p.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e,o=o4(vE,n);return i.jsx(Me.div,{id:o.id,...s,ref:t})});yE.displayName=vE;var Jc="SelectItem",[c4,wE]=ci(Jc),xE=p.forwardRef((e,t)=>{const{__scopeSelect:n,value:s,disabled:o=!1,textValue:l,...c}=e,u=_s(Jc,n),h=Ns(Jc,n),f=u.value===s,[g,v]=p.useState(l??""),[b,x]=p.useState(!1),S=Ye(t,_=>h.itemRefCallback?.(_,s,o)),C=pr(),w=p.useRef("touch"),N=()=>{o||(u.onValueChange(s),u.onOpenChange(!1))};if(s==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return i.jsx(c4,{scope:n,value:s,disabled:o,textId:C,isSelected:f,onItemTextChange:p.useCallback(_=>{v(j=>j||(_?.textContent??"").trim())},[]),children:i.jsx(kd.ItemSlot,{scope:n,value:s,disabled:o,textValue:g,children:i.jsx(Me.div,{role:"option","aria-labelledby":C,"data-highlighted":b?"":void 0,"aria-selected":f&&b,"data-state":f?"checked":"unchecked","aria-disabled":o||void 0,"data-disabled":o?"":void 0,tabIndex:o?void 0:-1,...c,ref:S,onFocus:we(c.onFocus,()=>x(!0)),onBlur:we(c.onBlur,()=>x(!1)),onClick:we(c.onClick,()=>{w.current!=="mouse"&&N()}),onPointerUp:we(c.onPointerUp,()=>{w.current==="mouse"&&N()}),onPointerDown:we(c.onPointerDown,_=>{w.current=_.pointerType}),onPointerMove:we(c.onPointerMove,_=>{w.current=_.pointerType,o?h.onItemLeave?.():w.current==="mouse"&&_.currentTarget.focus({preventScroll:!0})}),onPointerLeave:we(c.onPointerLeave,_=>{_.currentTarget===document.activeElement&&h.onItemLeave?.()}),onKeyDown:we(c.onKeyDown,_=>{h.searchRef?.current!==""&&_.key===" "||(KM.includes(_.key)&&N(),_.key===" "&&_.preventDefault())})})})})});xE.displayName=Jc;var to="SelectItemText",bE=p.forwardRef((e,t)=>{const{__scopeSelect:n,className:s,style:o,...l}=e,c=_s(to,n),u=Ns(to,n),h=wE(to,n),f=XM(to,n),[g,v]=p.useState(null),b=Ye(t,N=>v(N),h.onItemTextChange,N=>u.itemTextRefCallback?.(N,h.value,h.disabled)),x=g?.textContent,S=p.useMemo(()=>i.jsx("option",{value:h.value,disabled:h.disabled,children:x},h.value),[h.disabled,h.value,x]),{onNativeOptionAdd:C,onNativeOptionRemove:w}=f;return Ut(()=>(C(S),()=>w(S)),[C,w,S]),i.jsxs(i.Fragment,{children:[i.jsx(Me.span,{id:h.textId,...l,ref:b}),h.isSelected&&c.valueNode&&!c.valueNodeHasChildren?ei.createPortal(l.children,c.valueNode):null]})});bE.displayName=to;var CE="SelectItemIndicator",SE=p.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e;return wE(CE,n).isSelected?i.jsx(Me.span,{"aria-hidden":!0,...s,ref:t}):null});SE.displayName=CE;var zf="SelectScrollUpButton",EE=p.forwardRef((e,t)=>{const n=Ns(zf,e.__scopeSelect),s=np(zf,e.__scopeSelect),[o,l]=p.useState(!1),c=Ye(t,s.onScrollButtonChange);return Ut(()=>{if(n.viewport&&n.isPositioned){let u=function(){const f=h.scrollTop>0;l(f)};const h=n.viewport;return u(),h.addEventListener("scroll",u),()=>h.removeEventListener("scroll",u)}},[n.viewport,n.isPositioned]),o?i.jsx(NE,{...e,ref:c,onAutoScroll:()=>{const{viewport:u,selectedItem:h}=n;u&&h&&(u.scrollTop=u.scrollTop-h.offsetHeight)}}):null});EE.displayName=zf;var Hf="SelectScrollDownButton",_E=p.forwardRef((e,t)=>{const n=Ns(Hf,e.__scopeSelect),s=np(Hf,e.__scopeSelect),[o,l]=p.useState(!1),c=Ye(t,s.onScrollButtonChange);return Ut(()=>{if(n.viewport&&n.isPositioned){let u=function(){const f=h.scrollHeight-h.clientHeight,g=Math.ceil(h.scrollTop)<f;l(g)};const h=n.viewport;return u(),h.addEventListener("scroll",u),()=>h.removeEventListener("scroll",u)}},[n.viewport,n.isPositioned]),o?i.jsx(NE,{...e,ref:c,onAutoScroll:()=>{const{viewport:u,selectedItem:h}=n;u&&h&&(u.scrollTop=u.scrollTop+h.offsetHeight)}}):null});_E.displayName=Hf;var NE=p.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:s,...o}=e,l=Ns("SelectScrollButton",n),c=p.useRef(null),u=Td(n),h=p.useCallback(()=>{c.current!==null&&(window.clearInterval(c.current),c.current=null)},[]);return p.useEffect(()=>()=>h(),[h]),Ut(()=>{u().find(g=>g.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[u]),i.jsx(Me.div,{"aria-hidden":!0,...o,ref:t,style:{flexShrink:0,...o.style},onPointerDown:we(o.onPointerDown,()=>{c.current===null&&(c.current=window.setInterval(s,50))}),onPointerMove:we(o.onPointerMove,()=>{l.onItemLeave?.(),c.current===null&&(c.current=window.setInterval(s,50))}),onPointerLeave:we(o.onPointerLeave,()=>{h()})})}),d4="SelectSeparator",jE=p.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e;return i.jsx(Me.div,{"aria-hidden":!0,...s,ref:t})});jE.displayName=d4;var Vf="SelectArrow",u4=p.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e,o=Ad(n),l=_s(Vf,n),c=Ns(Vf,n);return l.open&&c.position==="popper"?i.jsx(vm,{...o,...s,ref:t}):null});u4.displayName=Vf;var h4="SelectBubbleInput",kE=p.forwardRef(({__scopeSelect:e,value:t,...n},s)=>{const o=p.useRef(null),l=Ye(s,o),c=Db(t);return p.useEffect(()=>{const u=o.current;if(!u)return;const h=window.HTMLSelectElement.prototype,g=Object.getOwnPropertyDescriptor(h,"value").set;if(c!==t&&g){const v=new Event("change",{bubbles:!0});g.call(u,t),u.dispatchEvent(v)}},[c,t]),i.jsx(Me.select,{...n,style:{...rx,...n.style},ref:l,defaultValue:t})});kE.displayName=h4;function TE(e){return e===""||e===void 0}function AE(e){const t=un(e),n=p.useRef(""),s=p.useRef(0),o=p.useCallback(c=>{const u=n.current+c;t(u),(function h(f){n.current=f,window.clearTimeout(s.current),f!==""&&(s.current=window.setTimeout(()=>h(""),1e3))})(u)},[t]),l=p.useCallback(()=>{n.current="",window.clearTimeout(s.current)},[]);return p.useEffect(()=>()=>window.clearTimeout(s.current),[]),[n,o,l]}function PE(e,t,n){const o=t.length>1&&Array.from(t).every(f=>f===t[0])?t[0]:t,l=n?e.indexOf(n):-1;let c=f4(e,Math.max(l,0));o.length===1&&(c=c.filter(f=>f!==n));const h=c.find(f=>f.textValue.toLowerCase().startsWith(o.toLowerCase()));return h!==n?h:void 0}function f4(e,t){return e.map((n,s)=>e[(t+s)%e.length])}var m4=sE,RE=iE,p4=lE,g4=cE,v4=dE,IE=uE,y4=pE,DE=yE,OE=xE,w4=bE,x4=SE,LE=EE,ME=_E,$E=jE;const gc=m4,vc=p4,no=p.forwardRef(({className:e,children:t,...n},s)=>i.jsxs(RE,{ref:s,className:Ce("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...n,children:[t,i.jsx(g4,{asChild:!0,children:i.jsx(kx,{className:"h-4 w-4 opacity-50"})})]}));no.displayName=RE.displayName;const FE=p.forwardRef(({className:e,...t},n)=>i.jsx(LE,{ref:n,className:Ce("flex cursor-default items-center justify-center py-1",e),...t,children:i.jsx(vj,{className:"h-4 w-4"})}));FE.displayName=LE.displayName;const UE=p.forwardRef(({className:e,...t},n)=>i.jsx(ME,{ref:n,className:Ce("flex cursor-default items-center justify-center py-1",e),...t,children:i.jsx(kx,{className:"h-4 w-4"})}));UE.displayName=ME.displayName;const ro=p.forwardRef(({className:e,children:t,position:n="popper",...s},o)=>i.jsx(v4,{children:i.jsxs(IE,{ref:o,className:Ce("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...s,children:[i.jsx(FE,{}),i.jsx(y4,{className:Ce("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),i.jsx(UE,{})]})}));ro.displayName=IE.displayName;const b4=p.forwardRef(({className:e,...t},n)=>i.jsx(DE,{ref:n,className:Ce("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));b4.displayName=DE.displayName;const Jt=p.forwardRef(({className:e,children:t,...n},s)=>i.jsxs(OE,{ref:s,className:Ce("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(x4,{children:i.jsx(er,{className:"h-4 w-4"})})}),i.jsx(w4,{children:t})]}));Jt.displayName=OE.displayName;const C4=p.forwardRef(({className:e,...t},n)=>i.jsx($E,{ref:n,className:Ce("-mx-1 my-1 h-px bg-muted",e),...t}));C4.displayName=$E.displayName;var Pd="Tabs",[S4]=Mn(Pd,[Ed]),BE=Ed(),[E4,rp]=S4(Pd),zE=p.forwardRef((e,t)=>{const{__scopeTabs:n,value:s,onValueChange:o,defaultValue:l,orientation:c="horizontal",dir:u,activationMode:h="automatic",...f}=e,g=Sd(u),[v,b]=ys({prop:s,onChange:o,defaultProp:l??"",caller:Pd});return i.jsx(E4,{scope:n,baseId:pr(),value:v,onValueChange:b,orientation:c,dir:g,activationMode:h,children:i.jsx(Me.div,{dir:g,"data-orientation":c,...f,ref:t})})});zE.displayName=Pd;var HE="TabsList",VE=p.forwardRef((e,t)=>{const{__scopeTabs:n,loop:s=!0,...o}=e,l=rp(HE,n),c=BE(n);return i.jsx(IC,{asChild:!0,...c,orientation:l.orientation,dir:l.dir,loop:s,children:i.jsx(Me.div,{role:"tablist","aria-orientation":l.orientation,...o,ref:t})})});VE.displayName=HE;var qE="TabsTrigger",WE=p.forwardRef((e,t)=>{const{__scopeTabs:n,value:s,disabled:o=!1,...l}=e,c=rp(qE,n),u=BE(n),h=YE(c.baseId,s),f=JE(c.baseId,s),g=s===c.value;return i.jsx(DC,{asChild:!0,...u,focusable:!o,active:g,children:i.jsx(Me.button,{type:"button",role:"tab","aria-selected":g,"aria-controls":f,"data-state":g?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:h,...l,ref:t,onMouseDown:we(e.onMouseDown,v=>{!o&&v.button===0&&v.ctrlKey===!1?c.onValueChange(s):v.preventDefault()}),onKeyDown:we(e.onKeyDown,v=>{[" ","Enter"].includes(v.key)&&c.onValueChange(s)}),onFocus:we(e.onFocus,()=>{const v=c.activationMode!=="manual";!g&&!o&&v&&c.onValueChange(s)})})})});WE.displayName=qE;var GE="TabsContent",KE=p.forwardRef((e,t)=>{const{__scopeTabs:n,value:s,forceMount:o,children:l,...c}=e,u=rp(GE,n),h=YE(u.baseId,s),f=JE(u.baseId,s),g=s===u.value,v=p.useRef(g);return p.useEffect(()=>{const b=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(b)},[]),i.jsx($n,{present:o||g,children:({present:b})=>i.jsx(Me.div,{"data-state":g?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":h,hidden:!b,id:f,tabIndex:0,...c,ref:t,style:{...e.style,animationDuration:v.current?"0s":void 0},children:b&&l})})});KE.displayName=GE;function YE(e,t){return`${e}-trigger-${t}`}function JE(e,t){return`${e}-content-${t}`}var _4=zE,QE=VE,XE=WE,ZE=KE;const N4=_4,e_=p.forwardRef(({className:e,...t},n)=>i.jsx(QE,{ref:n,className:Ce("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));e_.displayName=QE.displayName;const qf=p.forwardRef(({className:e,...t},n)=>i.jsx(XE,{ref:n,className:Ce("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));qf.displayName=XE.displayName;const Wf=p.forwardRef(({className:e,...t},n)=>i.jsx(ZE,{ref:n,className:Ce("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Wf.displayName=ZE.displayName;function _o(e){if(!e||e.length!==2)return null;const t=e.toUpperCase().split("").map(n=>127462+(n.charCodeAt(0)-65));return String.fromCodePoint(...t)}async function t_(e){if(!e)return{country:null,countryCode:null,countryFlag:null,city:null,region:null};try{const t=await fetch(`https://ip-api.com/json/${e}?fields=status,message,country,countryCode,city,regionName`,{method:"GET",headers:{Accept:"application/json"}});if(t.ok){const n=await t.json();if(n.status==="success"){const s=n.countryCode||null;return{country:n.country||null,countryCode:s,countryFlag:_o(s),city:n.city||null,region:n.regionName||null}}}}catch(t){t instanceof TypeError&&!t.message.includes("Failed to fetch")&&console.warn("ip-api.com geolocation failed, trying fallback:",t)}try{const t=await fetch(`https://ipapi.co/${e}/json/`,{method:"GET",headers:{Accept:"application/json"}});if(t.ok){const n=await t.json();if(n.country_code&&!n.error){const s=n.country_code||null;return{country:n.country_name||null,countryCode:s,countryFlag:_o(s),city:n.city||null,region:n.region||null}}}}catch(t){console.warn("ipapi.co geolocation failed:",t)}return{country:null,countryCode:null,countryFlag:null,city:null,region:null}}async function j4(e){const t=await t_(e);return{countryCode:t.countryCode,countryFlag:t.countryFlag,country:t.country}}const k4=Object.freeze(Object.defineProperty({__proto__:null,countryCodeToFlag:_o,getCountryFromIP:j4,getIPGeolocation:t_},Symbol.toStringTag,{value:"Module"}));function T4(e){const t=e.toLowerCase();if(t.includes("edg/")){const n=e.match(/edg\/([\d.]+)/i);return{name:"Edge",version:n?n[1]:null,fullName:n?`Edge ${n[1]}`:"Edge"}}if(t.includes("chrome/")&&!t.includes("edg/")){const n=e.match(/chrome\/([\d.]+)/i);return{name:"Chrome",version:n?n[1]:null,fullName:n?`Chrome ${n[1]}`:"Chrome"}}if(t.includes("safari/")&&!t.includes("chrome/")){const n=e.match(/version\/([\d.]+).*safari/i);return{name:"Safari",version:n?n[1]:null,fullName:n?`Safari ${n[1]}`:"Safari"}}if(t.includes("firefox/")){const n=e.match(/firefox\/([\d.]+)/i);return{name:"Firefox",version:n?n[1]:null,fullName:n?`Firefox ${n[1]}`:"Firefox"}}if(t.includes("opera/")||t.includes("opr/")){const n=e.match(/(?:opera|opr)\/([\d.]+)/i);return{name:"Opera",version:n?n[1]:null,fullName:n?`Opera ${n[1]}`:"Opera"}}if(t.includes("samsungbrowser/")){const n=e.match(/samsungbrowser\/([\d.]+)/i);return{name:"Samsung Internet",version:n?n[1]:null,fullName:n?`Samsung Internet ${n[1]}`:"Samsung Internet"}}if(t.includes("ucbrowser/")){const n=e.match(/ucbrowser\/([\d.]+)/i);return{name:"UC Browser",version:n?n[1]:null,fullName:n?`UC Browser ${n[1]}`:"UC Browser"}}return{name:"Unknown Browser",version:null,fullName:"Unknown Browser"}}function A4(e){const t=e.toLowerCase();if(t.includes("iphone")||t.includes("ipad")||t.includes("ipod")){const n=e.match(/os ([\d_]+)/i);if(n){const s=n[1].replace(/_/g,".");return{name:"iOS",version:s,fullName:`iOS ${s}`}}return{name:"iOS",version:null,fullName:"iOS"}}if(t.includes("android")){const n=e.match(/android ([\d.]+)/i);return n?{name:"Android",version:n[1],fullName:`Android ${n[1]}`}:{name:"Android",version:null,fullName:"Android"}}if(t.includes("windows")){if(t.includes("windows nt 10.0"))return{name:"Windows",version:"10/11",fullName:"Windows 10/11"};if(t.includes("windows nt 6.3"))return{name:"Windows",version:"8.1",fullName:"Windows 8.1"};if(t.includes("windows nt 6.2"))return{name:"Windows",version:"8",fullName:"Windows 8"};if(t.includes("windows nt 6.1"))return{name:"Windows",version:"7",fullName:"Windows 7"};const n=e.match(/windows nt ([\d.]+)/i);return n?{name:"Windows",version:n[1],fullName:`Windows NT ${n[1]}`}:{name:"Windows",version:null,fullName:"Windows"}}if(t.includes("mac os x")||t.includes("macintosh")){const n=e.match(/mac os x ([\d_]+)/i);if(n){const s=n[1].replace(/_/g,".");return{name:"macOS",version:s,fullName:`macOS ${s}`}}return{name:"macOS",version:null,fullName:"macOS"}}return t.includes("linux")?{name:"Linux",version:null,fullName:"Linux"}:{name:"Unknown OS",version:null,fullName:"Unknown OS"}}function P4(e){const t=e;if(t.includes("iPhone")){const n=t.match(/iPhone(\d+,\d+)/i);return n?`iPhone ${n[1]}`:"iPhone"}if(t.includes("iPad")){const n=t.match(/iPad(\d+,\d+)/i);return n?`iPad ${n[1]}`:"iPad"}if(t.includes("Android")){const n=t.match(/android [\d.]+; ([^)]+)\)/i);if(n)return n[1].trim().replace(/^SM-/,"Samsung ").replace(/^LM-/,"LG ")}return t.includes("Macintosh")?"Mac":null}function Ow(e){return e?{browser:T4(e),os:A4(e),deviceModel:P4(e)}:{browser:{name:"Unknown",version:null,fullName:"Unknown Browser"},os:{name:"Unknown",version:null,fullName:"Unknown OS"},deviceModel:null}}function $t(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function R4(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}const yc=43200,Lw=1440;let I4={};function D4(){return I4}function Mw(e){const t=$t(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function Tc(e,t){const n=$t(e),s=$t(t),o=n.getTime()-s.getTime();return o<0?-1:o>0?1:o}function O4(e){return R4(e,Date.now())}function L4(e,t){const n=$t(e),s=$t(t),o=n.getFullYear()-s.getFullYear(),l=n.getMonth()-s.getMonth();return o*12+l}function M4(e){return t=>{const s=(e?Math[e]:Math.trunc)(t);return s===0?0:s}}function $4(e,t){return+$t(e)-+$t(t)}function F4(e){const t=$t(e);return t.setHours(23,59,59,999),t}function U4(e){const t=$t(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function B4(e){const t=$t(e);return+F4(t)==+U4(t)}function z4(e,t){const n=$t(e),s=$t(t),o=Tc(n,s),l=Math.abs(L4(n,s));let c;if(l<1)c=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-o*l);let u=Tc(n,s)===-o;B4($t(e))&&l===1&&Tc(e,s)===1&&(u=!1),c=o*(l-Number(u))}return c===0?0:c}function H4(e,t,n){const s=$4(e,t)/1e3;return M4(n?.roundingMethod)(s)}const V4={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},q4=(e,t,n)=>{let s;const o=V4[e];return typeof o=="string"?s=o:t===1?s=o.one:s=o.other.replace("{{count}}",t.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+s:s+" ago":s};function Xh(e){return(t={})=>{const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const W4={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},G4={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},K4={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Y4={date:Xh({formats:W4,defaultWidth:"full"}),time:Xh({formats:G4,defaultWidth:"full"}),dateTime:Xh({formats:K4,defaultWidth:"full"})},J4={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Q4=(e,t,n,s)=>J4[e];function Ji(e){return(t,n)=>{const s=n?.context?String(n.context):"standalone";let o;if(s==="formatting"&&e.formattingValues){const c=e.defaultFormattingWidth||e.defaultWidth,u=n?.width?String(n.width):c;o=e.formattingValues[u]||e.formattingValues[c]}else{const c=e.defaultWidth,u=n?.width?String(n.width):e.defaultWidth;o=e.values[u]||e.values[c]}const l=e.argumentCallback?e.argumentCallback(t):t;return o[l]}}const X4={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Z4={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},e3={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},t3={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},n3={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},r3={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},s3=(e,t)=>{const n=Number(e),s=n%100;if(s>20||s<10)switch(s%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},a3={ordinalNumber:s3,era:Ji({values:X4,defaultWidth:"wide"}),quarter:Ji({values:Z4,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Ji({values:e3,defaultWidth:"wide"}),day:Ji({values:t3,defaultWidth:"wide"}),dayPeriod:Ji({values:n3,defaultWidth:"wide",formattingValues:r3,defaultFormattingWidth:"wide"})};function Qi(e){return(t,n={})=>{const s=n.width,o=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],l=t.match(o);if(!l)return null;const c=l[0],u=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],h=Array.isArray(u)?o3(u,v=>v.test(c)):i3(u,v=>v.test(c));let f;f=e.valueCallback?e.valueCallback(h):h,f=n.valueCallback?n.valueCallback(f):f;const g=t.slice(c.length);return{value:f,rest:g}}}function i3(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n}function o3(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n}function l3(e){return(t,n={})=>{const s=t.match(e.matchPattern);if(!s)return null;const o=s[0],l=t.match(e.parsePattern);if(!l)return null;let c=e.valueCallback?e.valueCallback(l[0]):l[0];c=n.valueCallback?n.valueCallback(c):c;const u=t.slice(o.length);return{value:c,rest:u}}}const c3=/^(\d+)(th|st|nd|rd)?/i,d3=/\d+/i,u3={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},h3={any:[/^b/i,/^(a|c)/i]},f3={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},m3={any:[/1/i,/2/i,/3/i,/4/i]},p3={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},g3={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},v3={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},y3={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},w3={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},x3={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},b3={ordinalNumber:l3({matchPattern:c3,parsePattern:d3,valueCallback:e=>parseInt(e,10)}),era:Qi({matchPatterns:u3,defaultMatchWidth:"wide",parsePatterns:h3,defaultParseWidth:"any"}),quarter:Qi({matchPatterns:f3,defaultMatchWidth:"wide",parsePatterns:m3,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Qi({matchPatterns:p3,defaultMatchWidth:"wide",parsePatterns:g3,defaultParseWidth:"any"}),day:Qi({matchPatterns:v3,defaultMatchWidth:"wide",parsePatterns:y3,defaultParseWidth:"any"}),dayPeriod:Qi({matchPatterns:w3,defaultMatchWidth:"any",parsePatterns:x3,defaultParseWidth:"any"})},C3={code:"en-US",formatDistance:q4,formatLong:Y4,formatRelative:Q4,localize:a3,match:b3,options:{weekStartsOn:0,firstWeekContainsDate:1}};function S3(e,t,n){const s=D4(),o=n?.locale??s.locale??C3,l=2520,c=Tc(e,t);if(isNaN(c))throw new RangeError("Invalid time value");const u=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:c});let h,f;c>0?(h=$t(t),f=$t(e)):(h=$t(e),f=$t(t));const g=H4(f,h),v=(Mw(f)-Mw(h))/1e3,b=Math.round((g-v)/60);let x;if(b<2)return n?.includeSeconds?g<5?o.formatDistance("lessThanXSeconds",5,u):g<10?o.formatDistance("lessThanXSeconds",10,u):g<20?o.formatDistance("lessThanXSeconds",20,u):g<40?o.formatDistance("halfAMinute",0,u):g<60?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",1,u):b===0?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",b,u);if(b<45)return o.formatDistance("xMinutes",b,u);if(b<90)return o.formatDistance("aboutXHours",1,u);if(b<Lw){const S=Math.round(b/60);return o.formatDistance("aboutXHours",S,u)}else{if(b<l)return o.formatDistance("xDays",1,u);if(b<yc){const S=Math.round(b/Lw);return o.formatDistance("xDays",S,u)}else if(b<yc*2)return x=Math.round(b/yc),o.formatDistance("aboutXMonths",x,u)}if(x=z4(f,h),x<12){const S=Math.round(b/yc);return o.formatDistance("xMonths",S,u)}else{const S=x%12,C=Math.trunc(x/12);return S<3?o.formatDistance("aboutXYears",C,u):S<9?o.formatDistance("overXYears",C,u):o.formatDistance("almostXYears",C+1,u)}}function wc(e,t){return S3(e,O4(e),t)}const E3=()=>{const[e,t]=p.useState([]),[n,s]=p.useState([]),[o,l]=p.useState([]),[c,u]=p.useState(!0),[h,f]=p.useState(!1),[g,v]=p.useState("active"),[b,x]=p.useState(null),[S,C]=p.useState(null),[w,N]=p.useState(""),[_,j]=p.useState(!1),[T,R]=p.useState(!1),[A,I]=p.useState(""),[L,Z]=p.useState("all"),[M,U]=p.useState("all"),[D,B]=p.useState(1),[z,q]=p.useState(!1),H=10,[Q,$]=p.useState("all"),[O,J]=p.useState("all"),{toast:F}=_t(),ee=p.useRef(null),ce=p.useRef(null),K=p.useCallback(async()=>{try{u(!0);const{data:{user:ie}}=await Y.auth.getUser();if(!ie)return;const{data:Re,error:le}=await Y.from("devices").select(`
          *,
          children:last_used_child_id (
            name
          )
        `).eq("parent_id",ie.id).eq("is_active",!0).order("last_login_at",{ascending:!1});if(le&&(le.code==="42P01"||le.message?.includes("does not exist"))){F({title:"Database Migration Required",description:"The devices table doesn't exist yet. Please run the migration: supabase/migrations/20250122000000_add_device_management.sql",variant:"destructive",duration:1e4}),k.error(" [DEVICE MANAGEMENT] Migration not run:",Ge(le));return}if(le)throw le;const ye=(Re||[]).map(je=>({...je,child_name:je.children?.name||null}));k.log(" [DEVICE MANAGEMENT] Fetched devices:",{count:ye.length,devices:ye.map(je=>({id:je.id,name:je.device_name,isActive:je.is_active}))}),t(ye)}catch(ie){k.error("Error fetching devices:",Ge(ie)),F({title:"Error",description:"Failed to load devices. Please try again.",variant:"destructive"})}finally{u(!1)}},[F]),W=p.useCallback(async()=>{try{const{data:{user:ie}}=await Y.auth.getUser();if(!ie)return;const{data:Re,error:le}=await Y.from("children").select("id, name").order("name",{ascending:!0});if(le)throw le;l(Re||[])}catch(ie){k.error("Error fetching children:",Ge(ie))}},[]),ne=p.useCallback(async()=>{try{f(!0);const{data:{user:ie}}=await Y.auth.getUser();if(!ie)return;const{data:Re,error:le}=await Y.from("devices").select(`
          *,
          children:last_used_child_id (
            name
          )
        `).eq("parent_id",ie.id).order("updated_at",{ascending:!1});if(le)throw le;const ye=(Re||[]).map(je=>({...je,child_name:je.children?.name||null}));k.log(" [DEVICE MANAGEMENT] Fetched device history:",{count:ye.length,active:ye.filter(je=>je.is_active).length,inactive:ye.filter(je=>!je.is_active).length}),s(ye)}catch(ie){k.error("Error fetching device history:",Ge(ie)),F({title:"Error",description:"Failed to load device history. Please try again.",variant:"destructive"})}finally{f(!1)}},[F]);p.useEffect(()=>(K(),W(),(async()=>{const{data:{user:Re}}=await Y.auth.getUser();Re&&(ee.current&&await Y.removeChannel(ee.current),ee.current=Y.channel("device-management-updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"devices",filter:`parent_id=eq.${Re.id}`},le=>{k.log(" [DEVICE MANAGEMENT] New device added:",Mt(le.new)),K(),g==="history"&&ne()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"devices",filter:`parent_id=eq.${Re.id}`},le=>{k.log(" [DEVICE MANAGEMENT] Device updated:",Mt({deviceId:le.new.id,deviceName:le.new.device_name,isActive:le.new.is_active,oldIsActive:le.old?.is_active})),K(),g==="history"&&ne()}).subscribe((le,ye)=>{ye?k.error(" [DEVICE MANAGEMENT] Subscription error:",Ge(ye)):le==="SUBSCRIBED"&&k.log(" [DEVICE MANAGEMENT] Subscribed to device updates")}))})(),()=>{ee.current&&(Y.removeChannel(ee.current),ee.current=null)}),[K,ne,W,g]),p.useEffect(()=>{g==="history"&&n.length===0&&!h&&ne()},[g,ne,n.length,h]),p.useEffect(()=>{if(g!=="history"){q(!1);return}const ie=()=>{if(ce.current){const le=ce.current.scrollTop;q(le>400)}},Re=ce.current;if(Re)return Re.addEventListener("scroll",ie),ie(),()=>Re.removeEventListener("scroll",ie)},[g]);const G=n.filter(ie=>!(L!=="all"&&ie.last_used_child_id!==L||M!=="all"&&ie.device_type!==M)),ae=Math.ceil(G.length/H),fe=G.slice((D-1)*H,D*H);p.useEffect(()=>{B(1)},[L,M]);const ve=()=>{ce.current&&ce.current.scrollTo({top:0,behavior:"smooth"})},xe=e.filter(ie=>!(Q!=="all"&&ie.last_used_child_id!==Q||O!=="all"&&ie.device_type!==O)),Ie=async()=>{if(!b){k.warn(" [DEVICE MANAGEMENT] No device selected for removal");return}if(k.log(" [DEVICE MANAGEMENT] Remove device initiated:",Mt({deviceId:b.id,deviceName:b.device_name,requireAuth:T})),!T){k.log(" [DEVICE MANAGEMENT] Showing password prompt");const ie=b.child_name?` (used by ${b.child_name})`:"";F({title:" Warning: Device Removal",description:`You are about to remove "${b.device_name}"${ie}. This action requires password confirmation and cannot be undone.`,variant:"destructive",duration:5e3}),setTimeout(()=>{R(!0)},100);return}if(!A.trim()){F({title:"Password Required",description:"Please enter your password to confirm device removal.",variant:"destructive"});return}try{const{data:{user:ie},error:Re}=await Y.auth.getUser();if(Re||!ie)throw k.error(" [DEVICE MANAGEMENT] User auth error:",Ge(Re)),new Error("Not authenticated");k.log(" [DEVICE MANAGEMENT] Verifying password for user:",Mt({email:ie.email}));const{error:le}=await Y.auth.signInWithPassword({email:ie.email||"",password:A});if(le){k.error(" [DEVICE MANAGEMENT] Password verification failed:",Ge(le)),F({title:"Authentication Failed",description:"Incorrect password. Please try again.",variant:"destructive"}),I("");return}k.log(" [DEVICE MANAGEMENT] Password verified, calling revoke_device RPC");const{data:ye,error:je}=await Y.rpc("revoke_device",{p_device_id:b.id,p_parent_id:ie.id});if(k.log(" [DEVICE MANAGEMENT] RPC response:",Mt({revokeResult:ye,error:je})),je)throw k.error(" [DEVICE MANAGEMENT] RPC error:",Ge(je)),je;if(ye===!1)throw k.warn(" [DEVICE MANAGEMENT] Device not found or permission denied"),new Error("Device not found or you don't have permission to remove it");k.log(" [DEVICE MANAGEMENT] Device revoked successfully:",Mt({deviceId:b.id,deviceName:b.device_name,revokeResult:ye}));const ze=b.device_name;x(null),R(!1),I(""),F({title:" Device Removed Successfully",description:`${ze} has been removed and will need to be re-authorized on next login.`,variant:"success",duration:5e3}),k.log(" [DEVICE MANAGEMENT] Refreshing devices list"),await K(),g==="history"&&await ne()}catch(ie){k.error(" [DEVICE MANAGEMENT] Error removing device:",Ge(ie));const Re=ie instanceof Error?ie.message:"Failed to remove device. Please try again.";F({title:"Error",description:Re,variant:"destructive"})}},$e=async()=>{if(!(!S||!w.trim()))try{const{data:{user:ie}}=await Y.auth.getUser();if(!ie)throw new Error("Not authenticated");const{error:Re}=await Y.from("devices").update({device_name:w.trim()}).eq("id",S.id).eq("parent_id",ie.id);if(Re)throw Re;F({title:"Device Renamed",description:`Device renamed to "${w.trim()}"`}),C(null),N(""),K()}catch(ie){k.error("Error renaming device:",Ge(ie));const Re=ie instanceof Error?ie.message:"Failed to rename device. Please try again.";F({title:"Error",description:Re,variant:"destructive"})}},Ke=ie=>{switch(ie){case"mobile":return i.jsx(Sc,{className:"h-5 w-5"});case"tablet":return i.jsx(Lj,{className:"h-5 w-5"});case"desktop":return i.jsx(Tj,{className:"h-5 w-5"});default:return i.jsx(Sc,{className:"h-5 w-5"})}},Ve=ie=>(Date.now()-new Date(ie).getTime())/864e5>30;return i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx(Ur,{role:"parent",pageKey:"parent_devices"}),i.jsx(Fr,{role:"parent",pageKey:"parent_devices"}),i.jsx("div",{className:"px-4 pb-4",style:{paddingTop:"calc(0.5rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[i.jsxs("div",{className:"mt-2",children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Device Management"}),i.jsx("p",{className:"text-muted-foreground mt-2",children:"View and manage all devices authorized to access your family account"})]}),i.jsx(Ae,{className:"p-4 bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(lo,{className:"h-5 w-5 text-blue-700 dark:text-blue-300 mt-0.5 flex-shrink-0"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-1",children:"About Device Management"}),i.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"This page shows all devices that have been used to access your family account. You can remove devices you no longer use or recognize. Removing a device will require re-authorization the next time someone tries to log in from that device."})]})]})}),i.jsxs(N4,{value:g,onValueChange:ie=>{v(ie),ie==="history"&&n.length===0&&ne()},children:[i.jsxs(e_,{className:"grid w-full grid-cols-2",children:[i.jsx(qf,{value:"active",children:"Active Devices"}),i.jsxs(qf,{value:"history",children:[i.jsx(Sh,{className:"h-4 w-4 mr-2"}),"History"]})]}),i.jsxs(Wf,{value:"active",className:"space-y-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[i.jsxs(de,{onClick:K,variant:"outline",size:"sm",children:[i.jsx(fs,{className:"h-4 w-4 mr-2"}),"Refresh"]}),i.jsxs("div",{className:"flex flex-1 gap-2",children:[i.jsxs(gc,{value:Q,onValueChange:$,children:[i.jsxs(no,{className:"w-full sm:w-[180px]",children:[i.jsx(ty,{className:"h-4 w-4 mr-2"}),i.jsx(vc,{placeholder:"Filter by child"})]}),i.jsxs(ro,{children:[i.jsx(Jt,{value:"all",children:"All Children"}),o.map(ie=>i.jsx(Jt,{value:ie.id,children:ie.name},ie.id))]})]}),i.jsxs(gc,{value:O,onValueChange:J,children:[i.jsx(no,{className:"w-full sm:w-[180px]",children:i.jsx(vc,{placeholder:"Filter by device type"})}),i.jsxs(ro,{children:[i.jsx(Jt,{value:"all",children:"All Types"}),i.jsx(Jt,{value:"mobile",children:"Mobile"}),i.jsx(Jt,{value:"tablet",children:"Tablet"}),i.jsx(Jt,{value:"desktop",children:"Desktop"}),i.jsx(Jt,{value:"other",children:"Other"})]})]})]})]}),xe.length!==e.length&&e.length>0&&i.jsx(Ae,{className:"p-3 bg-muted/50 border-muted",children:i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",xe.length," of ",e.length," ","active devices"]})}),i.jsx("div",{"data-tour":"parent-devices-list",children:c?i.jsxs(Ae,{className:"p-12 text-center",children:[i.jsx(fs,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground"}),i.jsx("p",{className:"text-muted-foreground",children:"Loading devices..."})]}):xe.length===0?i.jsxs(Ae,{className:"p-12 text-center",children:[i.jsx(Sc,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),i.jsx("p",{className:"text-muted-foreground mb-2",children:e.length===0?"No devices found":"No devices match your filters"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:e.length===0?"Devices will appear here after they're used to log in":"Try adjusting your filters"})]}):i.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:xe.map(ie=>{const Re=Ve(ie.last_login_at);return i.jsxs(Ae,{className:`p-4 space-y-3 ${ie.is_active?"":"opacity-60"} ${Re?"border-yellow-200 dark:border-yellow-800":""}`,children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[i.jsx("div",{className:"mt-1",children:Ke(ie.device_type)}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"font-semibold truncate",children:ie.device_name}),i.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:ie.device_type})]})]}),!ie.is_active&&i.jsx("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:"Revoked"})]}),Re&&i.jsxs("div",{className:"flex items-center gap-2 text-yellow-700 dark:text-yellow-300 text-sm",children:[i.jsx(Ks,{className:"h-4 w-4"}),i.jsx("span",{children:"Not used recently"})]}),i.jsxs("div",{className:"space-y-1 text-sm",children:[ie.child_name&&i.jsxs("p",{className:"text-muted-foreground",children:["Last used by:"," ",i.jsx("span",{className:"font-medium",children:ie.child_name})]}),i.jsxs("p",{className:"text-muted-foreground",children:["Last login:"," ",i.jsx("span",{className:"font-medium",children:wc(new Date(ie.last_login_at),{addSuffix:!0})})]}),ie.country_code&&i.jsxs("p",{className:"text-muted-foreground",children:["Country:"," ",i.jsxs("span",{className:"font-medium text-base",children:[_o(ie.country_code)||""," ",ie.country_code]})]}),ie.user_agent&&(()=>{const le=Ow(ie.user_agent);return i.jsxs(i.Fragment,{children:[i.jsxs("p",{className:"text-muted-foreground",children:["Browser:"," ",i.jsx("span",{className:"font-medium",children:le.browser.fullName})]}),i.jsxs("p",{className:"text-muted-foreground",children:["OS:"," ",i.jsx("span",{className:"font-medium",children:le.os.fullName})]}),le.deviceModel&&i.jsxs("p",{className:"text-muted-foreground",children:["Model:"," ",i.jsx("span",{className:"font-medium",children:le.deviceModel})]})]})})(),ie.mac_address&&i.jsxs("p",{className:"text-muted-foreground",children:["MAC:"," ",i.jsx("span",{className:"font-mono text-xs",children:ie.mac_address})]}),ie.last_ip_address&&i.jsxs("p",{className:"text-muted-foreground",children:["IP:"," ",i.jsx("span",{className:"font-mono text-xs",children:ie.last_ip_address})]}),ie.last_location&&i.jsxs("p",{className:"text-muted-foreground",children:["Location Details:"," ",i.jsx("span",{className:"font-medium",children:ie.last_location})]})]}),ie.is_active&&i.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[i.jsxs(de,{onClick:()=>{C(ie),N(ie.device_name)},variant:"outline",size:"sm",className:"flex-1",children:[i.jsx(Aj,{className:"h-4 w-4 mr-2"}),"Rename"]}),i.jsxs(de,{onClick:()=>x(ie),variant:"destructive",size:"sm",className:"flex-1",children:[i.jsx(rm,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]},ie.id)})})})]}),i.jsxs(Wf,{value:"history",className:"space-y-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[i.jsxs(de,{onClick:ne,variant:"outline",size:"sm",disabled:h,children:[i.jsx(fs,{className:`h-4 w-4 mr-2 ${h?"animate-spin":""}`}),"Refresh History"]}),i.jsxs("div",{className:"flex flex-1 gap-2",children:[i.jsxs(gc,{value:L,onValueChange:Z,children:[i.jsxs(no,{className:"w-full sm:w-[180px]",children:[i.jsx(ty,{className:"h-4 w-4 mr-2"}),i.jsx(vc,{placeholder:"Filter by child"})]}),i.jsxs(ro,{children:[i.jsx(Jt,{value:"all",children:"All Children"}),o.map(ie=>i.jsx(Jt,{value:ie.id,children:ie.name},ie.id))]})]}),i.jsxs(gc,{value:M,onValueChange:U,children:[i.jsx(no,{className:"w-full sm:w-[180px]",children:i.jsx(vc,{placeholder:"Filter by device type"})}),i.jsxs(ro,{children:[i.jsx(Jt,{value:"all",children:"All Types"}),i.jsx(Jt,{value:"mobile",children:"Mobile"}),i.jsx(Jt,{value:"tablet",children:"Tablet"}),i.jsx(Jt,{value:"desktop",children:"Desktop"}),i.jsx(Jt,{value:"other",children:"Other"})]})]})]})]}),i.jsx(Ae,{className:"p-4 bg-muted/50 border-muted",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Sh,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold text-foreground mb-1",children:"Device History"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["This is a read-only history of all devices that have accessed your account, including removed devices. This history cannot be modified and serves as a security audit trail.",G.length!==n.length&&i.jsxs("span",{className:"block mt-1 font-medium",children:["Showing ",G.length," of"," ",n.length," devices"]})]})]})]})}),i.jsx("div",{ref:ce,className:"max-h-[calc(100vh-400px)] overflow-y-auto space-y-4",style:{scrollBehavior:"smooth"},children:h?i.jsxs(Ae,{className:"p-12 text-center",children:[i.jsx(fs,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground"}),i.jsx("p",{className:"text-muted-foreground",children:"Loading device history..."})]}):G.length===0?i.jsxs(Ae,{className:"p-12 text-center",children:[i.jsx(Sh,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),i.jsx("p",{className:"text-muted-foreground mb-2",children:"No devices found"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:n.length===0?"Device history will appear here as devices are used or removed":"Try adjusting your filters"})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:fe.map(ie=>{const Re=Ve(ie.last_login_at),le=!ie.is_active;return i.jsxs(Ae,{className:`p-4 space-y-3 ${le?"opacity-75 border-destructive/20 bg-muted/30":""} ${Re?"border-yellow-200 dark:border-yellow-800":""}`,children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[i.jsx("div",{className:"mt-1",children:Ke(ie.device_type)}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"font-semibold truncate",children:ie.device_name}),i.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:ie.device_type})]})]}),le?i.jsx("span",{className:"text-xs text-destructive bg-destructive/10 px-2 py-1 rounded",children:"Removed"}):i.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-2 py-1 rounded",children:"Active"})]}),Re&&i.jsxs("div",{className:"flex items-center gap-2 text-yellow-700 dark:text-yellow-300 text-sm",children:[i.jsx(Ks,{className:"h-4 w-4"}),i.jsx("span",{children:"Not used recently"})]}),i.jsxs("div",{className:"space-y-1 text-sm",children:[i.jsxs("p",{className:"text-muted-foreground",children:["Created:"," ",i.jsx("span",{className:"font-medium",children:wc(new Date(ie.created_at),{addSuffix:!0})})]}),ie.child_name&&i.jsxs("p",{className:"text-muted-foreground",children:["Last used by:"," ",i.jsx("span",{className:"font-medium",children:ie.child_name})]}),i.jsxs("p",{className:"text-muted-foreground",children:["Last login:"," ",i.jsx("span",{className:"font-medium",children:wc(new Date(ie.last_login_at),{addSuffix:!0})})]}),le&&i.jsxs("p",{className:"text-muted-foreground",children:["Removed:"," ",i.jsx("span",{className:"font-medium",children:wc(new Date(ie.updated_at),{addSuffix:!0})})]}),ie.country_code&&i.jsxs("p",{className:"text-muted-foreground",children:["Country:"," ",i.jsxs("span",{className:"font-medium text-base",children:[_o(ie.country_code)||""," ",ie.country_code]})]}),ie.user_agent&&(()=>{const ye=Ow(ie.user_agent);return i.jsxs(i.Fragment,{children:[i.jsxs("p",{className:"text-muted-foreground",children:["Browser:"," ",i.jsx("span",{className:"font-medium",children:ye.browser.fullName})]}),i.jsxs("p",{className:"text-muted-foreground",children:["OS:"," ",i.jsx("span",{className:"font-medium",children:ye.os.fullName})]}),ye.deviceModel&&i.jsxs("p",{className:"text-muted-foreground",children:["Model:"," ",i.jsx("span",{className:"font-medium",children:ye.deviceModel})]})]})})(),ie.mac_address&&i.jsxs("p",{className:"text-muted-foreground",children:["MAC:"," ",i.jsx("span",{className:"font-mono text-xs",children:ie.mac_address})]}),ie.last_ip_address&&i.jsxs("p",{className:"text-muted-foreground",children:["IP:"," ",i.jsx("span",{className:"font-mono text-xs",children:ie.last_ip_address})]})]})]},ie.id)})}),ae>1&&i.jsxs("div",{className:"flex items-center justify-center gap-2 pt-4",children:[i.jsx(de,{variant:"outline",size:"sm",onClick:()=>B(ie=>Math.max(1,ie-1)),disabled:D===1,children:"Previous"}),i.jsxs("span",{className:"text-sm text-muted-foreground px-4",children:["Page ",D," of ",ae]}),i.jsx(de,{variant:"outline",size:"sm",onClick:()=>B(ie=>Math.min(ae,ie+1)),disabled:D===ae,children:"Next"})]})]})}),z&&i.jsxs(de,{onClick:ve,className:"fixed bottom-6 right-6 rounded-full shadow-lg z-50 h-12 w-12 p-0",size:"icon",variant:"default",children:[i.jsx(jx,{className:"h-5 w-5"}),i.jsx("span",{className:"sr-only",children:"Back to top"})]})]})]})]})}),i.jsx(tr,{open:!!b,onOpenChange:ie=>{ie||(x(null),R(!1),I(""))},children:i.jsxs(An,{children:[i.jsxs(Pn,{children:[i.jsx(In,{children:T?"Confirm Password":"Remove Device?"}),i.jsx(Dn,{children:T?i.jsxs(i.Fragment,{children:["For security, please enter your password to remove"," ",i.jsx("strong",{children:b?.device_name}),". This device will need to be re-authorized on next login."]}):i.jsxs(i.Fragment,{children:["Removing ",i.jsx("strong",{children:b?.device_name})," will revoke its access. You'll need to re-authorize this device the next time someone tries to log in from it. This action requires password confirmation."]})})]}),T&&i.jsx("div",{className:"space-y-2",children:i.jsx(vr,{type:"password",placeholder:"Enter your password",value:A,onChange:ie=>I(ie.target.value),onKeyDown:ie=>{ie.key==="Enter"&&Ie()},autoFocus:!0})}),i.jsxs(Rn,{children:[i.jsx(On,{children:"Cancel"}),i.jsx(yr,{onClick:async ie=>{if(!T){ie.preventDefault(),Ie();return}await Ie()},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:T?"Remove Device":"Continue"})]})]},T?"password":"confirm")}),i.jsx(qc,{open:!!S,onOpenChange:ie=>!ie&&C(null),children:i.jsxs(xo,{children:[i.jsxs(bo,{children:[i.jsx(Co,{children:"Rename Device"}),i.jsx(Wc,{children:"Give this device a friendly name to easily identify it."})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(vr,{placeholder:"Device name",value:w,onChange:ie=>N(ie.target.value),onKeyDown:ie=>{ie.key==="Enter"&&w.trim()&&$e()},autoFocus:!0}),i.jsxs("div",{className:"flex gap-2 justify-end",children:[i.jsx(de,{variant:"outline",onClick:()=>C(null),children:"Cancel"}),i.jsx(de,{onClick:$e,disabled:!w.trim(),children:"Save"})]})]})]})})]})},$w=[{id:"additional-kid-monthly",name:"Additional Kid Monthly",price:"$2.99",priceValue:2.99,interval:"month",kidsSupported:1,stripeLink:"https://buy.stripe.com/7sYaEX4tHdms9b9fpqfQI05",description:"Add one more child to your account",allowQuantity:!0},{id:"additional-kid-annual",name:"Additional Kid Annual",price:"$29.99",priceValue:29.99,interval:"year",kidsSupported:1,stripeLink:"https://buy.stripe.com/14AdR94tH0zGdrpcdefQI06",description:"Add one more child (save 17% vs monthly)",allowQuantity:!0},{id:"family-bundle-monthly",name:"Family Bundle Monthly",price:"$14.99",priceValue:14.99,interval:"month",kidsSupported:5,stripeLink:"https://buy.stripe.com/aFa00j8JXciogDB3GIfQI07",description:"Perfect for families with up to 5 kids"},{id:"annual-family-plan",name:"Annual Family Plan",price:"$99",priceValue:99,interval:"year",kidsSupported:"unlimited",stripeLink:"https://buy.stripe.com/8x24gz7FT3LS5YXgtufQI08",description:"Best value - unlimited kids for the whole family",recommended:!0}],_3=()=>{const e=rt(),{toast:t}=_t(),[n,s]=p.useState(!0),[o,l]=p.useState(0),[c,u]=p.useState(1),[h,f]=p.useState("free"),[g,v]=p.useState("active"),[b,x]=p.useState(!1),[S,C]=p.useState(!1),[w,N]=p.useState(null),[_,j]=p.useState(""),[T,R]=p.useState(!0),[A,I]=p.useState(!1),[L,Z]=p.useState(!1),[M,U]=p.useState("");p.useEffect(()=>{D(),oo()?B():s(!1);const $=new URLSearchParams(window.location.search),O=$.get("session_id"),J=$.get("canceled");O?(t({title:"Payment Successful!",description:"Your subscription is being activated. Please wait a moment...",variant:"default"}),setTimeout(async()=>{oo()&&await B(),Z(!0),U("Your subscription has been activated successfully!")},2e3),window.history.replaceState({},"","/parent/upgrade")):J&&(t({title:"Payment Cancelled",description:"Your payment was cancelled. You can try again anytime.",variant:"default"}),window.history.replaceState({},"","/parent/upgrade"))},[]);const D=async()=>{const{data:{session:$}}=await Y.auth.getSession();if(!$){e("/parent/auth");return}},B=async()=>{try{const{data:{user:$}}=await Y.auth.getUser();if(!$)return;const{data:O,error:J}=await Y.from("parents").select("email, allowed_children, subscription_type, subscription_status, subscription_expires_at").eq("id",$.id).single();if(J){if(J.code==="42703"||J.message?.includes("does not exist")){console.warn("Subscription columns don't exist yet. Migration not run:",J),t({title:"Database Migration Required",description:"Please run the subscription migration: supabase/migrations/20250122000007_add_subscription_system.sql",variant:"destructive",duration:1e4}),u(1),f("free"),j(O?.email||""),s(!1);return}console.error("Error loading subscription:",J),t({title:"Error",description:"Failed to load subscription information",variant:"destructive"}),s(!1);return}const F=O?.allowed_children||1,ee=O?.subscription_type||"free",ce=O?.subscription_status||"active",K=O?.subscription_expires_at;u(F),f(ee);const W=O?.email||$.email||"";j(W),v(ce);const ne=ce==="active"&&(K===null||new Date(K)>new Date)&&ee!=="free";x(ne);const{data:G,error:ae}=await Y.from("children").select("id",{count:"exact"}).eq("parent_id",$.id);!ae&&G&&l(G.length||0)}catch($){console.error("Error loading subscription info:",$)}finally{s(!1)}},z=$=>{if(b&&h===$.id){t({title:"Current Plan",description:"You are already subscribed to this plan.",variant:"default"});return}N($),C(!0)},q=async()=>{if(!w||!_.trim()){t({title:"Error",description:"Please enter your family account email",variant:"destructive"});return}I(!0);try{const{data:$,error:O}=await Y.functions.invoke("create-stripe-subscription",{body:{subscriptionType:w.id,quantity:1}});if(O||!$?.success)throw new Error(O?.message||$?.error||"Failed to create checkout session");const{url:J}=$;if(!J)throw new Error("No checkout URL returned from subscription creation");window.location.href=J}catch($){console.error("Error processing payment:",$),t({title:"Payment Error",description:$.message||"Failed to process payment. Please try again.",variant:"destructive"})}finally{I(!1)}},H=async()=>{if(w)try{I(!0);let $=c;w.id==="annual-family-plan"?$=999:w.id==="family-bundle-monthly"?$=5:(w.id==="additional-kid-monthly"||w.id==="additional-kid-annual")&&($=c+1);const{data:{user:O}}=await Y.auth.getUser();if(!O||O.email!==_.trim()){t({title:"Security Error",description:"Email must match your authenticated account. You can only upgrade your own account.",variant:"destructive"}),I(!1);return}const{data:J,error:F}=await Y.rpc("upgrade_family_subscription",{p_family_email:_.trim(),p_subscription_type:w.id,p_allowed_children:$,p_stripe_checkout_session_id:null});if(F)throw F.code==="PGRST202"||F.message?.includes("Could not find the function")?new Error("Database migration not run. Please run: supabase/migrations/20250122000007_add_subscription_system.sql"):F;if(J?.success)U(`Successfully upgraded! You can now add up to ${$===999?"unlimited":$} children.`),C(!1),Z(!0),await B();else throw new Error(J?.error||"Failed to upgrade subscription")}catch($){console.error("Error upgrading subscription:",$),t({title:"Upgrade Failed",description:$.message||"Failed to upgrade subscription. Please contact support.",variant:"destructive"})}finally{I(!1)}},Q=async()=>{await H()};return oo()?n?i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:i.jsx(fr,{className:"h-8 w-8 animate-spin text-muted-foreground"})})]}):i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx(Ur,{role:"parent",pageKey:"parent_upgrade"}),i.jsx(Fr,{role:"parent",pageKey:"parent_upgrade"}),i.jsx("div",{className:"px-4 pb-4",style:{paddingTop:"calc(0.5rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-6xl mx-auto",children:[i.jsxs("div",{className:"mt-4 mb-8",children:[i.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Upgrade Your Plan"}),i.jsx("p",{className:"text-muted-foreground",children:"Choose a plan that fits your family's needs"})]}),b&&i.jsx(Ae,{className:"p-6 mb-8 bg-primary/10 border-primary/20",children:i.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-primary mb-1",children:"Your Current Plan"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[$w.find($=>$.id===h)?.name||h,h==="annual-family-plan"&&" - Unlimited children"]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"text-sm font-semibold text-primary",children:"Active Subscription"}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[o," /"," ",c===999?"":c," children"]})]})]})}),!b&&i.jsx(Ae,{className:"p-6 mb-8 bg-muted/50",children:i.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Current Plan"}),i.jsx("p",{className:"text-lg font-semibold capitalize",children:"Free Tier"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Children Added"}),i.jsxs("p",{className:"text-lg font-semibold",children:[o," / 1"]})]})]})}),i.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-8","data-tour":"parent-upgrade-plans",children:$w.map($=>{const O=h===$.id,J=b&&($.id==="annual-family-plan"||$.id==="family-bundle-monthly"&&h!=="annual-family-plan"&&h!=="family-bundle-monthly"||$.id.includes("additional")&&!h.includes("additional")),F=b&&h==="annual-family-plan"&&$.id!=="annual-family-plan";return i.jsxs(Ae,{className:`p-6 relative ${O?"border-2 border-primary shadow-lg bg-primary/5":$.recommended?"border-2 border-primary/50 shadow-md":"border"}`,children:[$.recommended&&!O&&i.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:i.jsxs("span",{className:"bg-primary text-primary-foreground px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1",children:[i.jsx(Ac,{className:"h-3 w-3"}),"Best Value"]})}),O&&i.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:i.jsx("span",{className:"bg-primary text-primary-foreground px-3 py-1 rounded-full text-xs font-semibold",children:" Current Plan"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-bold mb-1",children:$.name}),i.jsx("p",{className:"text-sm text-muted-foreground",children:$.description})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-baseline gap-1",children:[i.jsx("span",{className:"text-3xl font-bold",children:$.price}),i.jsxs("span",{className:"text-muted-foreground",children:["/",$.interval==="month"?"mo":"yr"]})]}),i.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.jsx(er,{className:"h-4 w-4 text-primary"}),i.jsx("span",{children:$.kidsSupported==="unlimited"?"Unlimited children":`Up to ${$.kidsSupported} ${$.kidsSupported===1?"child":"children"}`})]})]}),i.jsx(de,{className:"w-full",variant:O?"secondary":$.recommended?"default":"outline",onClick:()=>z($),disabled:A||O,children:A?i.jsxs(i.Fragment,{children:[i.jsx(fr,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):O?"Current Plan":J?"Upgrade":F?"Downgrade":"Select Plan"}),F&&i.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Note: Downgrading will reduce your child limit"})]})]},$.id)})}),i.jsx(Ae,{className:"p-6 bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Js,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"How It Works"}),i.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1 list-disc list-inside",children:[i.jsx("li",{children:"Select a plan and complete payment through Stripe"}),i.jsx("li",{children:"Enter your family account email to link the subscription"}),i.jsx("li",{children:"Your account will be upgraded automatically"}),i.jsx("li",{children:"Start adding more children right away!"})]})]})]})})]})}),i.jsx(qc,{open:S,onOpenChange:C,children:i.jsxs(xo,{children:[i.jsxs(bo,{children:[i.jsx(Co,{children:"Complete Your Upgrade"}),i.jsx(Wc,{children:"Enter your family account email to link this subscription to your account."})]}),i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(Dm,{htmlFor:"email",children:"Family Account Email"}),i.jsx(vr,{id:"email",type:"email",placeholder:"your-email@example.com",value:_,onChange:$=>j($.target.value),disabled:A||T,readOnly:T,className:T?"bg-muted cursor-not-allowed":""}),T&&i.jsx("p",{className:"text-xs text-muted-foreground",children:"Email is locked to your authenticated account for security"})]}),w&&i.jsx(Ae,{className:"p-4 bg-muted",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"text-sm font-semibold",children:w.name}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[w.price,"/",w.interval==="month"?"month":"year"]})]})})]}),i.jsxs(Of,{className:"flex-col sm:flex-row gap-2",children:[i.jsx(de,{variant:"outline",onClick:()=>{C(!1),I(!1)},disabled:A,className:"w-full sm:w-auto",children:"Cancel"}),i.jsx(de,{onClick:q,disabled:A||!_.trim(),className:"w-full sm:w-auto",children:A?i.jsxs(i.Fragment,{children:[i.jsx(fr,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"Proceed to Payment"}),i.jsx(de,{variant:"secondary",onClick:Q,disabled:A||!_.trim(),className:"w-full sm:w-auto",children:A?i.jsxs(i.Fragment,{children:[i.jsx(fr,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"I Already Paid"})]})]})}),i.jsx(qc,{open:L,onOpenChange:Z,children:i.jsxs(xo,{children:[i.jsxs(bo,{children:[i.jsx(Co,{children:"Upgrade Successful!"}),i.jsx(Wc,{children:M})]}),i.jsx(Of,{children:i.jsx(de,{onClick:()=>{Z(!1),e("/parent/dashboard")},children:"Go to Dashboard"})})]})})]}):i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx("div",{className:"flex items-center justify-center min-h-[60vh] px-4",children:i.jsxs(Ae,{className:"p-8 max-w-md text-center",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"In-App Purchases"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"This app uses in-app purchases through the App Store or Play Store. Please upgrade your subscription through your device's app store."}),i.jsx(de,{onClick:()=>e("/parent/dashboard"),children:"Go to Dashboard"})]})})]})},N3=()=>{const e=rt(),{toast:t}=_t(),[n,s]=p.useState(!0),[o,l]=p.useState(null),[c,u]=p.useState(null),[h,f]=p.useState(null),[g,v]=p.useState("free"),[b,x]=p.useState("active"),[S,C]=p.useState(null),[w,N]=p.useState(1),[_,j]=p.useState(0),[T,R]=p.useState(!1),[A,I]=p.useState(!1);p.useEffect(()=>{L(),Z()},[]);const L=async()=>{const{data:{session:U}}=await Y.auth.getSession();if(!U){e("/parent/auth");return}},Z=async()=>{try{const{data:{user:U}}=await Y.auth.getUser();if(!U)return;const{data:D,error:B}=await Y.from("parents").select("name, email, family_code, subscription_type, subscription_status, subscription_expires_at, allowed_children").eq("id",U.id).single();if(B){if(B.code==="42703"||B.message?.includes("does not exist")){console.warn("Subscription columns don't exist yet. Migration not run:",B),D&&(l(D?.name||null),u(D?.email||null),f(D?.family_code||null)),v("free"),N(1),s(!1);return}console.error("Error loading account info:",B),t({title:"Error",description:"Failed to load account information",variant:"destructive"}),s(!1);return}l(D?.name||null),u(D?.email||null),f(D?.family_code||null),v(D?.subscription_type||"free"),x(D?.subscription_status||"active"),C(D?.subscription_expires_at||null),N(D?.allowed_children||1);const{data:z}=await Y.from("children").select("id",{count:"exact"}).eq("parent_id",U.id);z&&j(z.length||0)}catch(U){console.error("Error loading account info:",U),t({title:"Error",description:"Failed to load account information",variant:"destructive"})}finally{s(!1)}},M=async()=>{I(!0);try{const{data:{user:U}}=await Y.auth.getUser();if(!U){t({title:"Error",description:"Not authenticated",variant:"destructive"});return}const{data:D,error:B}=await Y.rpc("cancel_subscription",{p_parent_id:U.id,p_cancel_reason:"User requested cancellation"});if(B)throw B;if(D?.success)t({title:"Subscription Cancelled",description:D.message||"Your subscription has been cancelled. Access will continue until expiration."}),R(!1),await Z();else throw new Error(D?.error||"Failed to cancel subscription")}catch(U){console.error("Error cancelling subscription:",U),t({title:"Cancellation Failed",description:U.message||"Failed to cancel subscription. Please contact support.",variant:"destructive"})}finally{I(!1)}};return n?i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:i.jsx(fr,{className:"h-8 w-8 animate-spin text-muted-foreground"})})]}):i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx(Ur,{role:"parent",pageKey:"parent_settings"}),i.jsx(Fr,{role:"parent",pageKey:"parent_settings"}),i.jsx("div",{className:"px-4 pb-4",style:{paddingTop:"calc(0.5rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"mt-4 mb-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx(Px,{className:"h-6 w-6"}),i.jsx("h1",{className:"text-3xl font-bold",children:"Account Settings"})]}),i.jsx("p",{className:"text-muted-foreground",children:"Manage your account and subscription"})]}),i.jsxs(Ae,{className:"p-6 mb-6","data-tour":"parent-settings-account",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Account Information"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Name"}),i.jsx("p",{className:"text-base font-medium",children:o||"Not set"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Email"}),i.jsx("p",{className:"text-base font-medium",children:c||"Not set"})]}),h&&i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Family Code"}),i.jsx("p",{className:"text-base font-mono font-bold",children:h})]})]})]}),i.jsxs(Ae,{className:"p-6 mb-6",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Subscription"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Current Plan"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("p",{className:"text-base font-medium capitalize",children:g==="free"?"Free":g}),g!=="free"&&b==="active"&&i.jsx(Ac,{className:"h-4 w-4 text-primary"}),b==="cancelled"&&i.jsx("span",{className:"text-xs bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded",children:"Cancelled"}),b==="expired"&&i.jsx("span",{className:"text-xs bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 px-2 py-1 rounded",children:"Expired"})]}),b==="cancelled"&&S&&i.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Access until: ",new Date(S).toLocaleDateString()]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Children Limit"}),i.jsxs("p",{className:"text-base font-medium",children:[_," /"," ",w===999?" Unlimited":w]})]}),g!=="free"&&b==="active"&&i.jsx("div",{className:"pt-2 border-t",children:i.jsxs(de,{variant:"outline",onClick:()=>R(!0),className:"w-full",children:[i.jsx(Or,{className:"mr-2 h-4 w-4"}),"Cancel Subscription"]})})]})]}),(g==="free"||b==="expired"||b==="cancelled")&&i.jsx(Ae,{className:"p-6 bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20",children:i.jsx("div",{className:"flex items-start gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(Js,{className:"h-5 w-5 text-primary"}),i.jsx("h2",{className:"text-xl font-semibold",children:b==="cancelled"?"Resubscribe":"Upgrade Your Plan"})]}),i.jsx("p",{className:"text-muted-foreground mb-4",children:b==="cancelled"?"Your subscription is cancelled but you still have access. Resubscribe to continue after expiration.":"Unlock more features and add more children to your account. Choose from flexible monthly or annual plans."}),i.jsxs(de,{onClick:()=>e("/parent/upgrade"),className:"w-full sm:w-auto","data-tour":"parent-settings-upgrade",children:[b==="cancelled"?"Resubscribe":"View Plans",i.jsx(pj,{className:"ml-2 h-4 w-4"})]})]})})})]})}),i.jsx(tr,{open:T,onOpenChange:R,children:i.jsxs(An,{children:[i.jsxs(Pn,{children:[i.jsx(In,{children:"Cancel Subscription"}),i.jsxs(Dn,{children:["Are you sure you want to cancel your subscription? You'll continue to have access until"," ",S?new Date(S).toLocaleDateString():"the end of your billing period",". After that, your account will revert to the free tier (1 child limit).",_>1&&i.jsxs("span",{className:"block mt-2 font-semibold text-yellow-600 dark:text-yellow-400",children:["Note: You currently have ",_," children. After expiration, you won't be able to add more children, but existing children can still use the app."]})]})]}),i.jsxs(Rn,{children:[i.jsx(On,{disabled:A,children:"Keep Subscription"}),i.jsx(yr,{onClick:M,disabled:A,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:A?i.jsxs(i.Fragment,{children:[i.jsx(fr,{className:"mr-2 h-4 w-4 animate-spin"}),"Cancelling..."]}):"Yes, Cancel Subscription"})]})]})})]})},n_="kidscallhome_authorized_devices";function sp(){try{const e=localStorage.getItem(n_);return e?JSON.parse(e):[]}catch{return[]}}function j3(e){try{localStorage.setItem(n_,JSON.stringify(e))}catch(t){console.warn("Failed to save authorized devices:",t)}}function k3(e){const t=li();return sp().some(s=>s.deviceId===t&&s.childId===e)}function Fw(e){const t=li(),n=sp(),s=n.findIndex(l=>l.deviceId===t&&l.childId===e);s>=0?n[s].authorizedAt=new Date().toISOString():n.push({deviceId:t,childId:e,authorizedAt:new Date().toISOString()});const o=n.filter(l=>l.childId===e);o.length>10&&(o.sort((c,u)=>new Date(c.authorizedAt).getTime()-new Date(u.authorizedAt).getTime()),o.slice(0,o.length-10).forEach(c=>{const u=n.findIndex(h=>h.deviceId===c.deviceId&&h.childId===c.childId);u>=0&&n.splice(u,1)})),j3(n)}function Uw(){const e=li(),n=sp().filter(s=>s.deviceId===e);return n.length===0?null:(n.sort((s,o)=>new Date(o.authorizedAt).getTime()-new Date(s.authorizedAt).getTime()),n[0].childId)}async function cn(e,t,n={}){try{const s=n.metadata?Mt(n.metadata,{maskValue:!0,removeField:!1}):void 0,o=n.error?{message:(n.error instanceof Error,n.error.message),code:(n.error instanceof Error,n.error.code),details:n.error instanceof Error?Mt(n.error.details||{}):Mt(n.error.details||{})}:void 0,l={level:e,message:t,parent_id:n.parent_id,child_id:n.child_id,device_id:n.device_id,device_identifier:n.device_identifier,metadata:s,error:o},{error:c}=await Y.rpc("log_device_tracking",{p_log_entry:l}).catch(async()=>{try{const u=T3();u.push({...l,timestamp:Date.now()}),u.length>100&&u.shift(),localStorage.setItem("kch_device_tracking_logs",JSON.stringify(u))}catch{}return{error:null}})}catch{}}function T3(){try{const e=localStorage.getItem("kch_device_tracking_logs");return e?JSON.parse(e):[]}catch{return[]}}const xc=[{name:"red",color:"#EF4444"},{name:"blue",color:"#3B82F6"},{name:"green",color:"#10B981"},{name:"yellow",color:"#FBBF24"},{name:"orange",color:"#F97316"},{name:"purple",color:"#A855F7"},{name:"pink",color:"#EC4899"},{name:"brown",color:"#92400E"},{name:"black",color:"#1F2937"},{name:"white",color:"#F3F4F6"}],Bw=[{name:"cat",emoji:""},{name:"dog",emoji:""},{name:"bird",emoji:""},{name:"fish",emoji:""},{name:"bear",emoji:""},{name:"lion",emoji:""},{name:"tiger",emoji:""},{name:"elephant",emoji:""},{name:"monkey",emoji:""},{name:"rabbit",emoji:""},{name:"horse",emoji:""},{name:"duck",emoji:""},{name:"cow",emoji:""},{name:"pig",emoji:""},{name:"sheep",emoji:""}],$a=[{id:0,label:"A-I",chars:["A","B","C","D","E","F","G","H","I"]},{id:1,label:"J-R",chars:["J","K","L","M","N","O","P","Q","R"]},{id:2,label:"S-Z",chars:["S","T","U","V","W","X","Y","Z"]},{id:3,label:"0-9",chars:["0","1","2","3","4","5","6","7","8","9"]}],A3=()=>{const[e]=F0(),[t,n]=p.useState("familyCode"),[s,o]=p.useState(""),[l,c]=p.useState(0),[u,h]=p.useState("color"),[f,g]=p.useState(""),[v,b]=p.useState(""),[x,S]=p.useState(!1),[C,w]=p.useState(null),[N,_]=p.useState(!1),j=rt(),{toast:T}=_t(),R=p.useRef(null),A=p.useRef(0),I=p.useRef(0),L=p.useRef(0),Z=p.useRef(!1),M=p.useRef(0),U=p.useRef(0),D=async K=>{S(!0);try{const W=K.split("-");let ne=K;if(W.length===3){const[fe,ve,xe]=W;ne=`${fe.toUpperCase()}-${ve.toLowerCase()}-${xe}`}const{data:G,error:ae}=await Y.from("children").select("id, name, avatar_color, parent_id").eq("login_code",ne).maybeSingle();if(ae){k.error("Login error:",Ge(ae)),T({title:"Login error",description:ae.message||"Failed to verify login code. Please try again.",variant:"destructive"}),b(""),o(""),n("familyCode"),S(!1);return}if(!G){k.error("No data returned for login code (code redacted)"),T({title:"Code not found",description:"Please check your code and try again",variant:"destructive"}),b(""),o(""),n("familyCode"),S(!1);return}if(w(G),n("success"),localStorage.setItem("childSession",JSON.stringify(G)),N||Fw(G.id),G.parent_id)try{const{generateDeviceIdentifierAsync:fe,detectDeviceType:ve,getDeviceName:xe,getClientIP:Ie,getDeviceMacAddress:$e,getCountryFromIP:Ke}=await xr(async()=>{const{generateDeviceIdentifierAsync:pt,detectDeviceType:st,getDeviceName:gt,getClientIP:We,getDeviceMacAddress:Ue,getCountryFromIP:Bt}=await Promise.resolve().then(()=>Ff);return{generateDeviceIdentifierAsync:pt,detectDeviceType:st,getDeviceName:gt,getClientIP:We,getDeviceMacAddress:Ue,getCountryFromIP:Bt}},void 0),Ve=await fe(),ie=ve(),Re=xe(),le=navigator.userAgent,ye=await Ie(),je=await $e(),ze=await Ke(ye);await cn("info","Attempting to track device",{parent_id:G.parent_id,child_id:G.id,device_identifier:Ve,metadata:{device_type:ie,device_name:Re,is_native:Ve.startsWith("native-")||Ve.startsWith("cordova-")||Ve.startsWith("mac-")}});let{data:dt,error:Je}=await Y.rpc("update_device_login",{p_parent_id:G.parent_id,p_device_identifier:Ve,p_device_name:Re,p_device_type:ie,p_user_agent:le,p_ip_address:ye||null,p_mac_address:je||null,p_country_code:ze||null,p_child_id:G.id});if(Je&&(Je.code==="42883"||Je.message?.includes("function")||Je.message?.includes("does not exist"))){await cn("warn","Function signature mismatch, trying without country_code",{parent_id:G.parent_id,child_id:G.id,device_identifier:Ve,error:Je});const pt=await Y.rpc("update_device_login",{p_parent_id:G.parent_id,p_device_identifier:Ve,p_device_name:Re,p_device_type:ie,p_user_agent:le,p_ip_address:ye||null,p_mac_address:je||null,p_child_id:G.id});if(pt.error)throw await cn("error","Error (fallback also failed)",{parent_id:G.parent_id,child_id:G.id,device_identifier:Ve,error:pt.error}),pt.error;dt=pt.data,Je=null,await cn("success","Device tracked successfully (without country_code)",{parent_id:G.parent_id,child_id:G.id,device_identifier:Ve,device_id:dt})}else{if(Je)throw await cn("error","Device tracking error",{parent_id:G.parent_id,child_id:G.id,device_identifier:Ve,error:Je}),Je;await cn("success","Device tracked successfully",{parent_id:G.parent_id,child_id:G.id,device_identifier:Ve,device_id:dt})}}catch(fe){await cn("error","Failed to track device",{parent_id:G.parent_id,child_id:G.id,error:fe instanceof Error?fe:{message:String(fe)}})}setTimeout(()=>{j("/child/dashboard")},2e3)}catch(W){k.error("Login exception:",Ge(W)),T({title:"Error",description:W instanceof Error?W.message:"An error occurred during login",variant:"destructive"}),n("familyCode"),S(!1)}};p.useEffect(()=>{(async()=>{const W=Uw();if(W&&k3(W)){const ne=localStorage.getItem("childSession");if(ne)try{if(JSON.parse(ne).id===W){j("/child/dashboard");return}}catch{}try{const{data:G}=await Y.from("children").select("login_code").eq("id",W).maybeSingle();if(G?.login_code){const ae=G.login_code.split("-");if(ae.length===3){const[,fe,ve]=ae;g(fe),b(ve);const xe=xc.some(Ie=>Ie.name===fe);h(xe?"color":"animal"),_(!0),n("select")}}}catch(G){console.warn("Failed to fetch child data for authorized device:",G)}}})()},[j]),p.useEffect(()=>{const K=e.get("code");if(K&&K.trim()!==""&&t==="familyCode"){const W=decodeURIComponent(K.trim()),ne=W.split("-");if(ne.length===3){const[G,ae,fe]=ne;if(G&&ae&&fe&&G.length>0&&ae.length>0&&fe.length>0){o(G.toUpperCase()),g(ae),b(fe);const ve=xc.some(xe=>xe.name===ae);h(ve?"color":"animal"),_(!1),setTimeout(()=>{D(W)},500)}else T({title:"Invalid login code",description:"The login code format is incorrect. Please check and try again.",variant:"destructive"})}else T({title:"Invalid login code",description:"The login code format is incorrect. Expected: familyCode-color/animal-number",variant:"destructive"})}},[e]);const B=(K,W)=>{g(K),h(W),n("number")},z=K=>{const W=v+K;W.length<=2&&parseInt(W)<=99&&b(W)},q=()=>{b(v.slice(0,-1))},H=()=>{t==="number"?(n("select"),b("")):t==="select"&&(n("familyCode"),g(""))},Q=()=>{if(!s||s.trim().length<3){T({title:"Family code required",description:"Please enter your family code (6 characters)",variant:"destructive"});return}n("select")},$=K=>{const W=K.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,6);o(W)},O=K=>{K>=0&&K<$a.length&&c(K)},J=K=>{if(Z.current)return;A.current=K.touches[0].clientX,L.current=Date.now();const W=K.target;k.debug(" [SWIPE] Start:",{x:A.current,target:W.tagName,isButton:W.closest("button")!==null})},F=K=>{A.current!==0&&(I.current=K.touches[0].clientX)},ee=K=>{if(A.current===0||I.current===0)return;const W=A.current-I.current,ne=Date.now()-L.current,G=30,ae=600;k.debug(" [SWIPE] End:",{distance:Math.abs(W),duration:ne,startX:A.current,endX:I.current,buttonFlag:Z.current,meetsDistance:Math.abs(W)>G,meetsDuration:ne<ae}),Math.abs(W)>G&&ne<ae&&A.current!==0&&I.current!==0&&(!Z.current||Math.abs(W)>50)&&(W>0?O(Math.min(l+1,$a.length-1)):O(Math.max(l-1,0))),A.current=0,I.current=0,L.current=0},ce=async()=>{let K;if(N&&f&&v){const W=Uw();if(W)try{const{data:ne}=await Y.from("children").select("login_code").eq("id",W).maybeSingle();if(ne?.login_code)K=ne.login_code;else{T({title:"Error",description:"Could not find your login code. Please enter your family code.",variant:"destructive"}),n("familyCode"),_(!1);return}}catch{T({title:"Error",description:"Could not verify your login code. Please enter your family code.",variant:"destructive"}),n("familyCode"),_(!1);return}else{T({title:"Incomplete code",description:"Please enter your family code, select a color/animal, and enter your number",variant:"destructive"});return}}else{if(!s||!f||!v){T({title:"Incomplete code",description:"Please enter your family code, select a color/animal, and enter your number",variant:"destructive"});return}K=`${s.toUpperCase()}-${f}-${v}`}S(!0);try{const{data:W,error:ne}=await Y.from("children").select("id, name, avatar_color, parent_id").eq("login_code",K).single();if(ne||!W){T({title:"Code not found",description:"Please check your code and try again",variant:"destructive"}),b("");return}if(w(W),n("success"),localStorage.setItem("childSession",JSON.stringify(W)),N||Fw(W.id),W.parent_id)try{const{generateDeviceIdentifierAsync:G,detectDeviceType:ae,getDeviceName:fe,getClientIP:ve,getDeviceMacAddress:xe,getCountryFromIP:Ie}=await xr(async()=>{const{generateDeviceIdentifierAsync:dt,detectDeviceType:Je,getDeviceName:pt,getClientIP:st,getDeviceMacAddress:gt,getCountryFromIP:We}=await Promise.resolve().then(()=>Ff);return{generateDeviceIdentifierAsync:dt,detectDeviceType:Je,getDeviceName:pt,getClientIP:st,getDeviceMacAddress:gt,getCountryFromIP:We}},void 0),$e=await G(),Ke=ae(),Ve=fe(),ie=navigator.userAgent,Re=await ve(),le=await xe(),ye=await Ie(Re);await cn("info","Attempting to track device",{parent_id:W.parent_id,child_id:W.id,device_identifier:$e,metadata:{device_type:Ke,device_name:Ve,is_native:$e.startsWith("native-")||$e.startsWith("cordova-")||$e.startsWith("mac-")}});let{data:je,error:ze}=await Y.rpc("update_device_login",{p_parent_id:W.parent_id,p_device_identifier:$e,p_device_name:Ve,p_device_type:Ke,p_user_agent:ie,p_ip_address:Re||null,p_mac_address:le||null,p_country_code:ye||null,p_child_id:W.id});if(ze&&(ze.code==="42883"||ze.message?.includes("function")||ze.message?.includes("does not exist"))){await cn("warn","Function signature mismatch, trying without country_code",{parent_id:W.parent_id,child_id:W.id,device_identifier:$e,error:ze});const dt=await Y.rpc("update_device_login",{p_parent_id:W.parent_id,p_device_identifier:$e,p_device_name:Ve,p_device_type:Ke,p_user_agent:ie,p_ip_address:Re||null,p_mac_address:le||null,p_child_id:W.id});if(dt.error)throw await cn("error","Error (fallback also failed)",{parent_id:W.parent_id,child_id:W.id,device_identifier:$e,error:dt.error}),dt.error;je=dt.data,ze=null,await cn("success","Device tracked successfully (without country_code)",{parent_id:W.parent_id,child_id:W.id,device_identifier:$e,device_id:je})}else{if(ze)throw await cn("error","Device tracking error",{parent_id:W.parent_id,child_id:W.id,device_identifier:$e,error:ze}),ze;await cn("success","Device tracked successfully",{parent_id:W.parent_id,child_id:W.id,device_identifier:$e,device_id:je})}}catch(G){await cn("error","Failed to track device",{parent_id:W.parent_id,child_id:W.id,error:G instanceof Error?G:{message:String(G)}})}setTimeout(()=>{j("/child/dashboard")},2e3)}catch(W){k.error("Login exception:",Ge(W)),T({title:"Error",description:W instanceof Error?W.message:"An error occurred during login",variant:"destructive"}),b("")}finally{S(!1)}};if(t==="success"&&C)return i.jsx("div",{className:"min-h-[100dvh] flex items-center justify-center bg-primary/5 p-4",children:i.jsx(Ae,{className:"w-full max-w-md p-8 space-y-6 text-center",children:i.jsxs("div",{className:"space-y-4 animate-bounce",children:[i.jsx("div",{className:"flex justify-center",children:i.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center text-4xl font-bold text-white shadow-lg",style:{backgroundColor:C.avatar_color},children:C.name[0].toUpperCase()})}),i.jsxs("div",{className:"flex justify-center gap-2",children:[i.jsx(Js,{className:"h-8 w-8 text-yellow-500 animate-pulse"}),i.jsxs("h1",{className:"text-4xl font-bold text-primary",children:["Welcome, ",C.name,"!"]}),i.jsx(Js,{className:"h-8 w-8 text-yellow-500 animate-pulse"})]}),i.jsx("p",{className:"text-xl text-muted-foreground",children:"You're all set! "})]})})});if(t==="number"){const K=u==="color"?xc.find(W=>W.name===f):Bw.find(W=>W.name===f);return i.jsx("div",{className:"min-h-[100dvh] flex items-center justify-center bg-primary/5 p-4",children:i.jsxs(Ae,{className:"w-full max-w-md p-8 space-y-6",children:[i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx(de,{variant:"ghost",onClick:H,className:"absolute top-4 left-4",children:" Back"}),i.jsxs("div",{className:"flex items-center justify-center gap-3",children:[u==="color"&&K&&"color"in K?i.jsx("div",{className:"w-16 h-16 rounded-full border-4 border-primary",style:{backgroundColor:K.color}}):K&&"emoji"in K?i.jsx("div",{className:"text-6xl",children:K.emoji}):null,i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold capitalize",children:f}),i.jsxs("p",{className:"text-muted-foreground",children:["Family:"," ",i.jsx("span",{className:"font-mono font-semibold",children:s})]}),i.jsx("p",{className:"text-muted-foreground",children:"Now enter your number"})]})]})]}),i.jsx("div",{className:"bg-muted p-6 rounded-2xl",children:i.jsx("div",{className:"flex justify-center mb-4",children:i.jsx("div",{className:"w-32 h-20 rounded-xl bg-card flex items-center justify-center border-2 border-primary/20",children:i.jsx("span",{className:"text-5xl font-bold text-primary",children:v||"?"})})})}),i.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[[1,2,3,4,5,6,7,8,9].map(W=>i.jsx(de,{onClick:()=>z(W.toString()),size:"lg",variant:"outline",className:"h-16 text-2xl font-bold rounded-xl",children:W},W)),i.jsxs(de,{onClick:q,size:"lg",variant:"outline",className:"h-16 rounded-xl col-span-2",disabled:!v,children:[i.jsx(Zv,{className:"h-6 w-6 mr-2"}),"Delete"]}),i.jsx(de,{onClick:()=>z("0"),size:"lg",variant:"outline",className:"h-16 text-2xl font-bold rounded-xl",children:"0"})]}),i.jsx(de,{onClick:ce,disabled:!v||x,size:"lg",className:"w-full text-xl h-14 rounded-xl",children:x?"Checking...":"Go!"})]})})}if(t==="familyCode"){const K=$a[l],W=l===0,ne=l===$a.length-1;return i.jsx("div",{className:"min-h-[100dvh] flex items-center justify-center bg-primary/5 p-4",children:i.jsxs(Ae,{className:"w-full max-w-md p-6 space-y-3",children:[i.jsxs("div",{className:"text-center space-y-2",children:[i.jsx(sy,{className:"h-16 w-16 text-primary mx-auto"}),i.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Hi There!"}),i.jsx("p",{className:"text-lg",children:"Enter your family code"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Ask a parent for your 6-character family code"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"bg-muted p-4 rounded-2xl",children:i.jsx("div",{className:"flex justify-center",children:i.jsx("div",{className:"w-full max-w-xs h-16 rounded-xl bg-card flex items-center justify-center border-2 border-primary/20",children:i.jsx("span",{className:"text-3xl font-bold text-primary font-mono tracking-wider",children:s||"______"})})})}),i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsx(de,{onClick:()=>O(l-1),disabled:W,variant:"outline",size:"sm",className:"flex-shrink-0","aria-label":"Previous block",children:i.jsx(Tx,{className:"h-5 w-5"})}),i.jsx("div",{className:"flex items-center gap-2 flex-1 justify-center",children:$a.map((G,ae)=>i.jsx("button",{onClick:()=>O(ae),className:`transition-all duration-200 rounded-full ${ae===l?"w-3 h-3 bg-primary scale-125":"w-2 h-2 bg-muted-foreground/30 hover:bg-muted-foreground/50"}`,"aria-label":`Go to ${G.label} block`,"aria-current":ae===l?"true":"false"},G.id))}),i.jsx(de,{onClick:()=>O(l+1),disabled:ne,variant:"outline",size:"sm",className:"flex-shrink-0","aria-label":"Next block",children:i.jsx(nm,{className:"h-5 w-5"})})]}),i.jsx("div",{className:"text-center -mt-1",children:i.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:K.label})}),i.jsxs("div",{ref:R,className:"relative overflow-hidden",style:{touchAction:"pan-x"},children:[i.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-16 z-0 pointer-events-auto",onTouchStart:J,onTouchMove:F,onTouchEnd:G=>ee()}),i.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-16 z-0 pointer-events-auto",onTouchStart:J,onTouchMove:F,onTouchEnd:G=>ee()}),i.jsx("div",{className:"relative z-10",onTouchStart:J,onTouchMove:F,onTouchEnd:G=>ee(),children:$a.map((G,ae)=>i.jsxs("div",{className:`grid grid-cols-3 gap-3 transition-all duration-300 ease-in-out ${ae===l?"opacity-100 translate-x-0 pointer-events-auto":ae<l?"opacity-0 -translate-x-full absolute inset-0 pointer-events-none":"opacity-0 translate-x-full absolute inset-0 pointer-events-none"}`,children:[G.chars.map(fe=>i.jsx(de,{onClick:()=>$(s+fe),onTouchStart:ve=>{M.current=ve.touches[0].clientX,U.current=Date.now()},onTouchMove:ve=>{Math.abs(ve.touches[0].clientX-M.current)>10?Z.current=!1:Z.current=!0},onTouchEnd:ve=>{const xe=Math.abs(ve.changedTouches[0].clientX-M.current),Ie=Date.now()-U.current;xe<10&&Ie<300?(Z.current=!0,setTimeout(()=>{Z.current=!1},100)):Z.current=!1},onTouchCancel:ve=>{Z.current=!1,M.current=0,U.current=0},size:"lg",variant:"outline",className:"h-14 sm:h-16 text-xl sm:text-2xl font-bold rounded-xl hover:bg-primary hover:text-primary-foreground transition-all active:scale-95 border-2 pointer-events-auto relative z-10",disabled:s.length>=6,"aria-label":`Enter ${fe}`,style:{touchAction:"manipulation",WebkitTouchCallout:"none",WebkitUserSelect:"none"},children:fe},fe)),G.chars.length%3===1&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"col-span-1"}),i.jsx("div",{className:"col-span-1"})]}),G.chars.length%3===2&&i.jsx("div",{className:"col-span-1"})]},G.id))})]}),i.jsxs("div",{className:"space-y-2 -mt-1",children:[i.jsxs(de,{onClick:()=>o(s.slice(0,-1)),size:"lg",variant:"outline",className:"w-full h-11 rounded-xl",disabled:!s,children:[i.jsx(Zv,{className:"h-4 w-4 mr-2"}),"Delete"]}),i.jsx(de,{onClick:Q,disabled:s.length<3||x,size:"lg",className:"w-full text-lg h-11 rounded-xl",children:x?"Checking...":"Next"})]})]})]})})}return i.jsx("div",{className:"min-h-[100dvh] flex items-center justify-center bg-primary/5 p-4",children:i.jsxs(Ae,{className:"w-full max-w-2xl p-8 space-y-6",children:[i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx(de,{variant:"ghost",onClick:H,className:"absolute top-4 left-4",children:" Back"}),i.jsx(sy,{className:"h-20 w-20 text-primary mx-auto"}),i.jsx("h1",{className:"text-4xl font-bold text-primary",children:"Hi There!"}),i.jsxs("p",{className:"text-xl",children:["Family Code:"," ",i.jsx("span",{className:"font-mono font-bold text-primary",children:s})]}),i.jsx("p",{className:"text-lg",children:"Pick your color or animal"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx(de,{variant:u==="color"?"default":"outline",onClick:()=>h("color"),className:"flex-1",size:"lg",children:"Colors"}),i.jsx(de,{variant:u==="animal"?"default":"outline",onClick:()=>h("animal"),className:"flex-1",size:"lg",children:"Animals"})]}),u==="color"?i.jsx("div",{className:"grid grid-cols-5 gap-3",children:xc.map(K=>i.jsx("button",{onClick:()=>B(K.name,"color"),className:"h-20 rounded-xl border-2 border-transparent hover:border-primary transition-all flex items-center justify-center hover:scale-105",style:{backgroundColor:K.color},children:i.jsx("span",{className:"text-white font-bold text-sm capitalize drop-shadow-lg",children:K.name})},K.name))}):i.jsx("div",{className:"grid grid-cols-5 gap-3",children:Bw.map(K=>i.jsxs("button",{onClick:()=>B(K.name,"animal"),className:"h-20 rounded-xl border-2 border-transparent hover:border-primary transition-all flex flex-col items-center justify-center hover:scale-105 hover:bg-muted",children:[i.jsx("span",{className:"text-3xl",children:K.emoji}),i.jsx("span",{className:"text-xs font-medium capitalize mt-1",children:K.name})]},K.name))})]})]})})};function Qc({userId:e,userType:t,name:n,enabled:s=!0}){const o=p.useRef(null),l=p.useRef(null),c=p.useRef(!1);p.useEffect(()=>{if(!s||!e)return;const u=`presence:${t}:${e}`,h=Y.channel(u,{config:{presence:{key:e}}}),f={userId:e,userType:t,name:n,lastSeen:new Date().toISOString()};h.on("presence",{event:"sync"},()=>{}).subscribe(async b=>{b==="SUBSCRIBED"?(c.current=!0,await h.track(f),l.current=setInterval(()=>{c.current&&o.current&&o.current.track({...f,lastSeen:new Date().toISOString()})},6e4)):b==="CHANNEL_ERROR"||b==="TIMED_OUT"?(c.current=!1,console.error(" [PRESENCE] Presence channel error",{status:b,channelName:u,userId:e})):b==="CLOSED"&&(c.current=!1)}),o.current=h;const g=()=>{document.hidden||o.current&&c.current&&o.current.track({...f,lastSeen:new Date().toISOString()})};document.addEventListener("visibilitychange",g);const v=()=>{o.current&&o.current.untrack()};return window.addEventListener("beforeunload",v),()=>{o.current&&(o.current.untrack(),Y.removeChannel(o.current)),l.current&&clearInterval(l.current),document.removeEventListener("visibilitychange",g),window.removeEventListener("beforeunload",v),c.current=!1,o.current=null}},[e,t,n,s])}function r_({parentId:e,enabled:t=!0,onStatusChange:n}){const[s,o]=p.useState({isOnline:!1,lastSeen:null}),l=p.useRef(null),c=p.useRef(n);return p.useEffect(()=>{c.current=n},[n]),p.useEffect(()=>{if(!t||!e)return;const u=`presence:parent:${e}`,h=Y.channel(u,{config:{presence:{key:e}}});return h.on("presence",{event:"sync"},()=>{const f=h.presenceState(),g=e in f&&Array.isArray(f[e])&&f[e].length>0,v=f[e],b=v&&v.length>0?v[0]:void 0,x=g?b?.lastSeen||new Date().toISOString():null;o(S=>{const C=S.isOnline,w=S.lastSeen||null;if(C===g&&w===x)return S;const N={isOnline:g,lastSeen:x||w};return C!==g&&c.current&&S.lastSeen!==null&&c.current(g),N})}).on("presence",{event:"join"},({key:f,newPresences:g})=>{if(f!==e)return;const v=g[0];o(b=>{const x=b.isOnline,S={isOnline:!0,lastSeen:v?.lastSeen||new Date().toISOString()};return!x&&c.current&&c.current(!0),S})}).on("presence",{event:"leave"},({key:f,leftPresences:g})=>{f===e&&o(v=>{const b=v.isOnline,x={isOnline:!1,lastSeen:v.lastSeen||new Date().toISOString()};return b&&c.current&&c.current(!1),x})}).subscribe((f,g)=>{f==="SUBSCRIBED"?setTimeout(()=>{const v=h.presenceState();if(e in v&&Array.isArray(v[e])&&v[e].length>0){const x=v[e],S=x&&x.length>0?x[0]:void 0;o({isOnline:!0,lastSeen:S?.lastSeen||new Date().toISOString()})}},500):(f==="CHANNEL_ERROR"||f==="TIMED_OUT")&&k.error(" [PARENT PRESENCE] Subscription error",{parentId:e,status:f,error:g})}),l.current=h,()=>{l.current&&(Y.removeChannel(l.current),l.current=null)}},[e,t]),{isOnline:s.isOnline,lastSeen:s.lastSeen}}const P3=()=>{const[e,t]=p.useState(null),[n,s]=p.useState(null),[o,l]=p.useState("Parent"),[c,u]=p.useState(null),h=p.useRef("Parent"),f=jC(e?.id||null),g=qm(e?.id||null),v=p.useRef(null),b=p.useRef(null),x=p.useRef(!1),S=rt(),C=bn(),{toast:w}=_t(),{handleIncomingCall:N,stopIncomingCall:_}=ep({enabled:!0,volume:.7}),j=p.useRef(N);p.useEffect(()=>{const Z=localStorage.getItem("childSession");if(!Z){S("/child/login");return}const M=JSON.parse(Z);t(M);const U=localStorage.getItem("selectedParentId");U&&u(U),(async()=>{try{let H;if(U)H=U;else{const{data:O,error:J}=await Y.from("children").select("parent_id").eq("id",M.id).single();if(J||!O){console.error("Error fetching child record:",J);return}H=O.parent_id,u(H)}const{data:Q,error:$}=await Y.from("parents").select("name").eq("id",H).maybeSingle();if($){console.error("Error fetching parent name:",$);return}Q?.name?(l(Q.name),h.current=Q.name):(l("Parent"),h.current="Parent")}catch(H){console.error("Error fetching parent name:",H)}})();let B=null,z=null;return(async()=>{const H=async O=>{O.id!==B&&(C.pathname.startsWith("/call/")||(B=O.id,s({id:O.id,parent_id:O.parent_id}),j.current({callId:O.id,callerName:h.current,callerId:O.parent_id,url:`/call/${M.id}?callId=${O.id}`})))},Q=async()=>{const O=new Date(Date.now()-12e4).toISOString(),{data:J}=await Y.from("calls").select("*").eq("child_id",M.id).eq("caller_type","parent").eq("status","ringing").gte("created_at",O).order("created_at",{ascending:!1}).limit(1);if(J&&J.length>0){const F=J[0];F.id!==B&&await H(F)}},$=async()=>{const O=new Date(Date.now()-6e4).toISOString(),{data:J}=await Y.from("calls").select("*").eq("child_id",M.id).eq("caller_type","parent").eq("status","ringing").gte("created_at",O).order("created_at",{ascending:!1}).limit(1);if(J&&J.length>0){const F=J[0];F.id!==B&&await H(F)}};await Q(),z=setInterval($,6e4),b.current=Y.channel("child-incoming-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:`child_id=eq.${M.id}`},async O=>{const J=O.new;J.caller_type==="parent"&&J.child_id===M.id&&J.status==="ringing"&&await H(J)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`child_id=eq.${M.id}`},async O=>{const J=O.new,F=O.old;J.caller_type!=="child"&&(C.pathname.startsWith("/call/")||(v.current&&v.current.id===J.id&&(J.status==="active"||J.status==="ended")&&(s(null),v.current=null),J.caller_type==="parent"&&J.child_id===M.id&&J.status==="ringing"&&F.status!=="ringing"&&await H(J)))}).subscribe((O,J)=>{J&&console.error(" [CHILD DASHBOARD] Realtime subscription error:",J)})})(),()=>{b.current&&Y.removeChannel(b.current),z&&clearInterval(z)}},[S,C.pathname]),p.useEffect(()=>{v.current=n},[n]),p.useEffect(()=>{j.current=N},[N]),Qc({userId:e?.id||"",userType:"child",name:e?.name,enabled:!!e});const{isOnline:T}=r_({parentId:c||e?.parent_id||"",enabled:!!(c||e?.parent_id)});p.useEffect(()=>{!n&&v.current&&_(v.current.id)},[n,_]);const R=async()=>{if(e&&c){try{const{acknowledgeMissedCalls:Z}=await xr(async()=>{const{acknowledgeMissedCalls:M}=await import("./acknowledgeMissedCalls-ChKxvIFx.js");return{acknowledgeMissedCalls:M}},[]);await Z(e.id,"parent")}catch(Z){console.error("Error acknowledging missed calls:",Z)}S(`/call/${e.id}`)}else c||S("/child/parents")},A=()=>{e&&c?S(`/chat/${e.id}`):c||S("/child/parents")},I=()=>{if(n&&e){_(n.id),x.current=!0;const Z=n.id;s(null),S(`/call/${e.id}?callId=${Z}`),setTimeout(()=>{x.current=!1},2e3)}},L=async()=>{if(n){if(x.current)return;try{await ta({callId:n.id,by:"child",reason:"declined"})}catch(Z){console.error(" [USER ACTION] Error declining call:",Z);const M=Z instanceof Error?Z.message:"Unknown error";w({title:"Error",description:"Failed to decline call: "+M,variant:"destructive"})}_(n.id),s(null)}};return e?i.jsxs("div",{className:"min-h-[100dvh] bg-primary/5",children:[i.jsx(Ft,{}),i.jsx(Ur,{role:"child",pageKey:"child_dashboard"}),i.jsx(Fr,{role:"child",pageKey:"child_dashboard"}),i.jsx("div",{className:"p-4",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[i.jsx("div",{className:"mt-8",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center text-3xl font-bold text-white",style:{backgroundColor:e.avatar_color},children:e.name[0]}),i.jsxs("div",{children:[i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs("h1",{className:"text-3xl font-bold",children:["Hi ",e.name,"!"]})}),i.jsx("div",{className:"text-muted-foreground",children:c?i.jsxs("span",{className:"flex items-center gap-2",children:["Ready to connect with ",o,"?",c&&i.jsx(Ga,{isOnline:T,size:"sm",showPulse:T})]}):"Select a parent to contact"})]})]})}),c?i.jsxs("div",{className:"grid gap-4",children:[i.jsxs(Ae,{className:"p-8 cursor-pointer hover:shadow-lg transition-all border-4 relative",style:{borderColor:e.avatar_color},onClick:R,"data-tour":"child-answer-button",children:[f>0&&i.jsx("span",{className:"absolute top-4 right-4 bg-destructive text-destructive-foreground text-xs font-bold rounded-full min-w-[24px] h-6 flex items-center justify-center px-2 border-2 border-background",children:f>99?"99+":f}),i.jsxs("div",{className:"flex items-center gap-6",children:[i.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center",style:{backgroundColor:e.avatar_color},children:i.jsx(sm,{className:"h-10 w-10 text-white"})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("h2",{className:"text-3xl font-bold mb-2",children:["Call ",o]}),i.jsx(Ga,{isOnline:T,size:"md",showPulse:T})]}),i.jsx("p",{className:"text-muted-foreground",children:T?"Parent is online":"Parent is offline"})]})]})]}),i.jsxs(Ae,{className:"p-8 cursor-pointer hover:shadow-lg transition-all border-4 relative",style:{borderColor:e.avatar_color},onClick:A,"data-tour":"child-messages",children:[g>0&&i.jsx("span",{className:"absolute top-4 right-4 bg-destructive text-destructive-foreground text-xs font-bold rounded-full min-w-[24px] h-6 flex items-center justify-center px-2 border-2 border-background",children:g>99?"99+":g}),i.jsxs("div",{className:"flex items-center gap-6",children:[i.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center",style:{backgroundColor:e.avatar_color},children:i.jsx(ko,{className:"h-10 w-10 text-white"})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Send Message"}),i.jsx(Ga,{isOnline:T,size:"md",showPulse:T})]}),i.jsxs("p",{className:"text-muted-foreground",children:["Chat with ",o," ",T?"(online)":"(offline)"]})]})]})]})]}):i.jsxs(Ae,{className:"p-6 text-center",children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Please select a parent first"}),i.jsx(de,{onClick:()=>S("/child/parents"),size:"lg",children:"Select Parent"})]})]})}),i.jsx(tr,{open:!!n,onOpenChange:Z=>{!Z&&n&&!x.current&&L()},children:i.jsxs(An,{className:"sm:max-w-md",children:[i.jsxs(Pn,{children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold text-white",style:{backgroundColor:e?.avatar_color||"#3B82F6"},children:""}),i.jsxs("div",{children:[i.jsx(In,{className:"text-xl",children:"Incoming Call"}),i.jsxs("p",{className:"text-base font-normal text-muted-foreground",children:[o," is calling..."]})]})]}),i.jsxs("div",{className:"pt-4",children:[i.jsxs(Dn,{className:"sr-only",children:["Incoming call from ",o]}),i.jsx("div",{className:"flex items-center justify-center gap-2 text-4xl animate-pulse",children:i.jsx(To,{className:"h-12 w-12"})})]})]}),i.jsxs(Rn,{className:"sm:justify-center gap-2",children:[i.jsx(On,{onClick:L,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Decline"}),i.jsx(yr,{onClick:I,className:"bg-green-600 hover:bg-green-700",children:"Answer"})]})]})})]}):null},R3=()=>{const e=rt();_t();const[t,n]=p.useState(null);return p.useEffect(()=>{const s=localStorage.getItem("childSession");if(!s){e("/child/login");return}const o=JSON.parse(s);n(o)},[e]),Qc({userId:t?.id||"",userType:"child",name:t?.name,enabled:!!t}),t?i.jsxs("div",{className:"min-h-[100dvh] bg-background",children:[i.jsx(Ft,{}),i.jsx(Ur,{role:"child",pageKey:"child_home"}),i.jsx(Fr,{role:"child",pageKey:"child_home"}),i.jsx("div",{className:"p-4",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"mb-8 mt-8",children:[i.jsxs("h1",{className:"text-3xl font-bold",children:["Hi, ",t.name,"!"]}),i.jsx("p",{className:"text-muted-foreground mt-2",children:"Quick access to call your parent"})]}),i.jsx(Ae,{className:"p-6 min-h-[176px]",children:i.jsxs("div",{className:"space-y-4",children:[i.jsx("h2",{className:"text-xl font-semibold",children:"Quick Actions"}),i.jsxs(de,{className:"w-full",size:"lg",onClick:()=>e("/child/parents"),"data-tour":"child-home-parents",children:[i.jsx(co,{className:"mr-2 h-5 w-5"}),"Select Parent"]}),i.jsx(de,{className:"w-full",size:"lg",variant:"outline",onClick:()=>e("/child/dashboard"),children:"Go to Dashboard"})]})})]})})]}):i.jsxs("div",{className:"min-h-[100dvh] bg-background",children:[i.jsx(Ft,{}),i.jsx("div",{className:"p-4",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"mb-8 mt-8",children:[i.jsx("div",{className:"h-9 w-48 bg-muted rounded animate-pulse mb-2"}),i.jsx("div",{className:"h-6 w-64 bg-muted rounded animate-pulse"})]}),i.jsx(Ae,{className:"p-6 min-h-[176px]",children:i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"h-6 w-32 bg-muted rounded animate-pulse"}),i.jsx("div",{className:"h-10 w-full bg-muted rounded animate-pulse"}),i.jsx("div",{className:"h-10 w-full bg-muted rounded animate-pulse"})]})})]})})]})},I3=()=>{const[e,t]=p.useState(null),[n,s]=p.useState(null),[o,l]=p.useState(!0),c=rt(),{toast:u}=_t(),{isOnline:h}=r_({parentId:n?.id||"",enabled:!!n?.id});p.useEffect(()=>{(async()=>{const{data:b}=await Y.auth.getSession();b?.session&&await Y.auth.signOut();const x=localStorage.getItem("childSession");if(!x){c("/child/login");return}let S;try{S=JSON.parse(x)}catch(w){console.error(" [ChildParentsList] Error parsing session data:",w),c("/child/login");return}t(S);let C=S.parent_id;if(!C&&S.id)try{const{data:w,error:N}=await Y.from("children").select("parent_id").eq("id",S.id).single();if(N)throw console.error(" [ChildParentsList] Error fetching child record:",N),N;w?.parent_id&&(C=w.parent_id)}catch(w){console.error(" [ChildParentsList] Error fetching child's parent_id:",w)}C?await f(C):(u({title:"Error",description:"Could not find parent information",variant:"destructive"}),l(!1))})()},[c,u]);const f=async v=>{try{if(!v||v==="undefined"||v==="null")throw new Error("Invalid parent ID");try{const{data:S,error:C}=await Y.rpc("get_parent_name_for_child",{parent_uuid:v});if(S&&(!Array.isArray(S)||S.length>0)){const w=Array.isArray(S)?S[0]:S;s(w),l(!1);return}}catch{}const{data:b,error:x}=await Y.from("parents").select("id, name").eq("id",v).maybeSingle();if(x)throw console.error(" [ChildParentsList] Supabase error:",x),x;if(!b)throw new Error("Parent not found. The RLS policy may be blocking access.");s(b)}catch(b){const x=b instanceof Error?b.message:"Unknown error occurred";console.error(" [ChildParentsList] Error in fetchParent:",x),u({title:"Error loading parent",description:x,variant:"destructive"})}finally{l(!1)}},g=v=>{localStorage.setItem("selectedParentId",v),c("/child/dashboard")};return o||!e?i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx("div",{className:"p-4 sm:p-6",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"mb-6 sm:mb-8 mt-4 sm:mt-6",children:[i.jsx("div",{className:"h-9 w-48 bg-muted rounded animate-pulse mb-2"}),i.jsx("div",{className:"h-6 w-64 bg-muted rounded animate-pulse"})]}),i.jsx(Ae,{className:"p-4 sm:p-6",children:i.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[i.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4 flex-1 min-w-0",children:[i.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-muted animate-pulse flex-shrink-0"}),i.jsxs("div",{className:"space-y-2 min-w-0 flex-1",children:[i.jsx("div",{className:"h-7 w-32 bg-muted rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-40 bg-muted rounded animate-pulse"})]})]}),i.jsx("div",{className:"h-10 w-full sm:w-24 bg-muted rounded animate-pulse"})]})})]})})]}):i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx(Ur,{role:"child",pageKey:"child_parents_list"}),i.jsx(Fr,{role:"child",pageKey:"child_parents_list"}),i.jsx("div",{className:"p-4 sm:p-6",style:{paddingTop:"calc(1rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"mb-6 sm:mb-8 mt-4 sm:mt-6",children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Select Parent"}),i.jsx("p",{className:"text-muted-foreground mt-2 text-sm sm:text-base",children:"Choose a parent to contact"})]}),n?i.jsx(Ae,{"data-tour":"child-parents-list-card",className:"p-4 sm:p-6 cursor-pointer hover:shadow-lg transition-all",onClick:()=>g(n.id),children:i.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[i.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4 flex-1 min-w-0",children:[i.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-primary flex items-center justify-center text-white font-bold text-xl sm:text-2xl flex-shrink-0",children:n.name?.charAt(0).toUpperCase()||"P"}),i.jsxs("div",{className:"min-w-0 flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[i.jsx("h3",{className:"text-xl sm:text-2xl font-semibold truncate",children:n.name||"Parent"}),i.jsx(Ga,{isOnline:h,size:"md",showPulse:h})]}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:h?"Online - Tap to call or message":"Offline - Tap to call or message"})]})]}),i.jsxs(de,{onClick:v=>{v.stopPropagation(),g(n.id)},className:"w-full sm:w-auto flex-shrink-0",children:[i.jsx(To,{className:"mr-2 h-4 w-4"}),"Contact"]})]})}):i.jsx(Ae,{className:"p-6",children:i.jsx("p",{className:"text-muted-foreground",children:"No parent found."})})]})})]})},D3=()=>{const{parentId:e}=hd(),t=rt(),{toast:n}=_t(),[s,o]=p.useState(null),[l,c]=p.useState("Parent"),u=p.useRef(null),h=p.useRef(null);p.useEffect(()=>{(async()=>{const v=localStorage.getItem("childSession");if(!v){t("/child/login");return}const b=JSON.parse(v);if(o(b.id),e){const{data:x}=await Y.from("parents").select("name").eq("id",e).single();x?.name&&c(x.name)}})()},[e,t]);const f=rE({role:"child",localProfileId:s||"",remoteProfileId:e||"",localVideoRef:u,remoteVideoRef:h});return p.useEffect(()=>{f.state==="idle"&&s&&e&&f.startOutgoingCall(e).catch(g=>{console.error("Failed to start call:",g),n({title:"Call Failed",description:"Failed to start call",variant:"destructive"})})},[f.state,s,e,f]),p.useEffect(()=>{f.state},[f.state]),!s||!e?i.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:i.jsx("div",{children:"Loading..."})}):f.state==="calling"?i.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:i.jsx(Ae,{className:"p-8",children:i.jsxs("div",{className:"text-center space-y-4",children:[i.jsxs("h2",{className:"text-2xl font-semibold",children:["Calling ",l,"..."]}),i.jsx("p",{className:"text-muted-foreground",children:"Waiting for answer"})]})})}):f.state==="incoming"?i.jsx("div",{className:"min-h-[100dvh] bg-background flex items-center justify-center",children:i.jsx(Ae,{className:"p-8",children:i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold",children:"Incoming Call"}),i.jsxs("p",{className:"text-muted-foreground",children:["From ",l]}),i.jsxs("div",{className:"flex gap-4 justify-center",children:[i.jsx(de,{onClick:()=>f.callId&&f.acceptIncomingCall(f.callId),children:"Accept"}),i.jsx(de,{variant:"destructive",onClick:()=>f.callId&&f.rejectIncomingCall(f.callId),children:"Reject"})]})]})})}):i.jsx(tp,{localVideoRef:u,remoteVideoRef:h,remoteStream:f.remoteStream,isConnecting:f.state==="calling"||f.state==="connecting",isMuted:f.isMuted,isVideoOff:f.isVideoOff,onToggleMute:f.toggleMute,onToggleVideo:f.toggleVideo,onEndCall:f.endCall})},O3=async(e,t,n,s,o,l,c)=>{let u=null;if(c){console.log(" [PARENT CALL] Looking for specific call:",c);const{data:g,error:v}=await Y.from("calls").select("*").eq("id",c).eq("parent_id",n).maybeSingle();v&&console.error("Error fetching specific call:",v),g&&(u=g,console.log(" [PARENT CALL] Found specific call:",{id:u.id,caller_type:u.caller_type,status:u.status,hasOffer:!!u.offer}),u.caller_type==="child"?u.offer&&(u.status==="ringing"||u.status==="active"?(console.log(` [PARENT CALL] Answering incoming call from child (status: ${u.status}, hasOffer: true)`),s(u.id)):(console.log(` [PARENT CALL] Specific call is ended (status: ${u.status}), cannot answer.`),u=null)):u.caller_type==="parent"&&(u.status==="ringing"||u.status==="active")&&(console.log(" [PARENT CALL] Using existing parent-initiated call"),u=null))}let h=null;if(!u||u.caller_type!=="child"){const{data:g}=await Y.from("calls").select("*").eq("child_id",t).eq("parent_id",n).in("status",["ringing","active"]).eq("caller_type","parent").order("created_at",{ascending:!1}).limit(1).maybeSingle();h=g}if(h){if(console.log(" [PARENT CALL] Using existing parent-initiated call:",h.id),s(h.id),h.answer&&e.remoteDescription===null){console.log(" [PARENT CALL] Existing call has answer, setting remote description...");const g=h.answer;await e.setRemoteDescription(new RTCSessionDescription(g));for(const v of l.current)try{await e.addIceCandidate(new RTCIceCandidate(v))}catch(b){const x=b;!x.message?.includes("duplicate")&&!x.message?.includes("already")&&console.error("Error adding queued ICE candidate:",x.message)}l.current=[],o(!1)}else if(h.offer){if(h.offer){const g=h.offer,v=e.localDescription!==null,b=e.signalingState,x=e.getSenders().length>0;if(console.log(" [PARENT CALL] Checking existing offer:",{hasLocalDescription:v,signalingState:b,hasTracks:x,offerType:g.type,offerSdpLength:g.sdp?.length}),x&&v)console.log(" [PARENT CALL] Peer connection already initialized with tracks and local description. Skipping setLocalDescription - connection is already in progress.");else if(!v&&b==="stable"&&!x){console.log(" [PARENT CALL] Setting local description from existing offer...");try{await e.setLocalDescription(new RTCSessionDescription(g)),console.log(" [PARENT CALL] Successfully set local description from existing offer")}catch(S){const C=S;if(C.message?.includes("does not match")||C.message?.includes("SDP")||C.message?.includes("InvalidModificationError"))console.warn(" [PARENT CALL] Could not set local description - already set with different SDP. This may indicate the connection was already initialized. Continuing without error...");else throw console.error(" [PARENT CALL] Unexpected error setting local description:",C),S}}else v?e.localDescription.sdp!==g.sdp?console.warn(` [PARENT CALL] Local description already set but doesn't match existing offer. Current SDP length: ${e.localDescription.sdp?.length}, Offer SDP length: ${g.sdp?.length}. This may indicate a race condition. Skipping setLocalDescription and continuing.`):console.log(" [PARENT CALL] Local description already matches existing offer"):console.warn(` [PARENT CALL] Cannot set local description - signaling state is "${b}", hasTracks: ${x}. This may indicate the connection is already in progress. Skipping setLocalDescription.`)}}else{console.log(" [PARENT CALL] Existing call has no offer, creating one...");const g=await e.createOffer();console.log("[KCH]","parent","created offer",!!g?.sdp),await e.setLocalDescription(g),console.log("[KCH]","parent","saving offer for call",h.id),await Y.from("calls").update({offer:{type:g.type,sdp:g.sdp}}).eq("id",h.id)}return Y.channel(`call:${h.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${h.id}`},async g=>{try{const v=g.new,b=g.old;if(Xt(v)){const S=e.iceConnectionState;console.error(" [CALL LIFECYCLE] Call ended by remote party (parent handler - existing call)",{callId:v.id,oldStatus:b?.status,newStatus:v.status,reason:"Status changed to 'ended' in database",timestamp:new Date().toISOString(),connectionState:e.connectionState,iceConnectionState:S,signalingState:e.signalingState}),e.signalingState!=="closed"&&e.close();return}if(v.answer&&e.remoteDescription===null)try{console.log(" [PARENT HANDLER] Parent received answer from child (existing call), setting remote description...");const S=v.answer;await e.setRemoteDescription(new RTCSessionDescription(S));for(const C of l.current)try{await e.addIceCandidate(new RTCIceCandidate(C))}catch(w){const N=w;!N.message?.includes("duplicate")&&!N.message?.includes("already")&&console.error(" [PARENT HANDLER] Error adding queued ICE candidate:",N.message)}l.current=[],o(!1)}catch(S){console.error(" [PARENT HANDLER] Error setting remote description:",S)}const x=v.child_ice_candidates;if(x&&Array.isArray(x))for(const S of x)try{if(!S.candidate)continue;if(e.remoteDescription){const C=new RTCIceCandidate(S);await e.addIceCandidate(C)}else l.current.push(S)}catch(C){const w=C;!w.message?.includes("duplicate")&&!w.message?.includes("already")&&console.error(" [PARENT HANDLER] Error adding ICE candidate:",w.message)}}catch(v){console.error("Error in parent call update handler:",v)}}).subscribe()}let f=u&&u.caller_type==="child"?u:null;if(!f){const{data:g}=await Y.from("calls").select("*").eq("child_id",t).eq("parent_id",n).eq("status","ringing").eq("caller_type","child").order("created_at",{ascending:!1}).limit(1).maybeSingle();f=g}if(f){if(o(!1),s(f.id),!f.offer)return console.log("Incoming call has no offer yet, waiting for offer..."),Y.channel(`call:${f.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${f.id}`},async R=>{const A=R.new;if(A.offer&&e.remoteDescription===null){console.log("Received offer, setting remote description...");const I=A.offer;await e.setRemoteDescription(new RTCSessionDescription(I)),await new Promise(Z=>{const M=()=>{e.signalingState==="have-remote-offer"||e.signalingState==="have-local-pranswer"?Z():setTimeout(M,100)};M()});const L=await e.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});console.log("[KCH]","parent","created answer",!!L?.sdp),await e.setLocalDescription(L),console.log("[KCH]","parent","saving answer for call",f.id),await Y.from("calls").update({answer:{type:L.type,sdp:L.sdp},status:"active",ended_at:null}).eq("id",f.id),o(!1)}}).subscribe();const g=f.offer;console.log(" [PARENT HANDLER] Setting remote description with child's offer..."),await e.setRemoteDescription(new RTCSessionDescription(g)),await new Promise((T,R)=>{const A=setTimeout(()=>{R(new Error("Timeout waiting for signaling state change"))},5e3),I=()=>{e.signalingState==="have-remote-offer"||e.signalingState==="have-local-pranswer"?(clearTimeout(A),T()):setTimeout(I,100)};I()});const v=e.getSenders().map(T=>T.track).filter(Boolean);if(console.log(" [PARENT HANDLER] Tracks in peer connection before answer:",{audioTracks:v.filter(T=>T?.kind==="audio").length,videoTracks:v.filter(T=>T?.kind==="video").length,totalTracks:v.length,senders:e.getSenders().length,trackDetails:v.map(T=>({kind:T.kind,id:T.id,enabled:T.enabled,muted:T.muted}))}),v.length===0)throw console.error(" [PARENT HANDLER] NO TRACKS FOUND in peer connection! This will cause no video/audio. Make sure initializeConnection() was called and tracks were added."),new Error("Cannot create answer: no media tracks found. Please ensure camera/microphone permissions are granted.");const b=v.filter(T=>T?.kind==="audio"),x=v.filter(T=>T?.kind==="video");if(b.length===0&&x.length===0)throw console.error(" [PARENT HANDLER] No audio or video tracks found!"),new Error("Cannot create answer: no media tracks available.");console.log(" [PARENT HANDLER] Creating answer, current state:",e.signalingState);const S=await e.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});console.log("[KCH]","parent","created answer",!!S?.sdp),console.log(" [PARENT HANDLER] Answer created, setting local description..."),await e.setLocalDescription(S);const C=S.sdp?.includes("m=audio"),w=S.sdp?.includes("m=video");if(console.log(" [PARENT HANDLER] Answer SDP verification:",{type:S.type,sdpLength:S.sdp?.length,hasAudio:C,hasVideo:w,sdpPreview:S.sdp?.substring(0,200)}),!C&&!w)throw console.error(" [PARENT HANDLER] CRITICAL: Answer SDP has no media tracks! This will cause no video/audio."),new Error("Answer SDP missing media tracks - ensure tracks are added before creating answer");console.log(" [PARENT HANDLER] Updating call with answer...",{callId:f.id,answerType:S.type}),console.log("[KCH]","parent","saving answer for call",f.id);const{error:N}=await Y.from("calls").update({answer:{type:S.type,sdp:S.sdp},status:"active",ended_at:null}).eq("id",f.id);if(N)throw console.error(" [PARENT HANDLER] Error updating call with answer:",N),new Error(`Failed to send answer: ${N.message}`);console.log(" [PARENT HANDLER] Answer sent successfully to child");const _=l.current.length;if(_>0){console.log(` [PARENT HANDLER] Processing ${_} queued ICE candidates after answer`);for(const T of l.current)try{await e.addIceCandidate(new RTCIceCandidate(T))}catch(R){const A=R;!A.message?.includes("duplicate")&&!A.message?.includes("already")&&console.error(" [PARENT HANDLER] Error processing queued ICE candidate:",A.message)}l.current=[]}return o(!1),console.log(" [PARENT HANDLER] Call connected! Parent answered child's call."),(async()=>{try{const{data:T}=await Y.from("calls").select("child_ice_candidates").eq("id",f.id).maybeSingle();if(T){const R=T.child_ice_candidates;if(R&&Array.isArray(R)&&R.length>0){console.log(" [PARENT HANDLER] Processing existing ICE candidates from child (immediate):",{count:R.length,hasRemoteDescription:!!e.remoteDescription,iceConnectionState:e.iceConnectionState});for(const A of R)try{if(!A.candidate)continue;e.remoteDescription?await e.addIceCandidate(new RTCIceCandidate(A)):l.current.push(A)}catch(I){const L=I;!L.message?.includes("duplicate")&&!L.message?.includes("already")&&console.error(" [PARENT HANDLER] Error adding existing ICE candidate:",L.message)}console.log(" [PARENT HANDLER] Finished processing existing ICE candidates from child")}}}catch(T){console.error(" [PARENT HANDLER] Error fetching existing ICE candidates:",T)}})(),Y.channel(`call:${f.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${f.id}`},async T=>{const R=T.new;if(R.status==="ended"){const I=e.iceConnectionState;console.error(" [CALL LIFECYCLE] Call ended by remote party (parent handler)",{callId:R.id,oldStatus:T.old?.status,newStatus:R.status,reason:"Status changed to 'ended' in database",timestamp:new Date().toISOString(),connectionState:e.connectionState,iceConnectionState:I,signalingState:e.signalingState}),console.log(" [CALL LIFECYCLE] Call ended - closing peer connection immediately",{iceState:I,reason:"Call status changed to 'ended' - closing regardless of ICE state"}),e.signalingState!=="closed"&&e.close();return}const A=R.child_ice_candidates;if(A&&Array.isArray(A)){const I=l.current.length,L=A.length;L>0&&(L<=5||L%5===0)&&console.log(" [PARENT HANDLER] Processing ICE candidates (from child):",{count:L,queued:I,hasRemoteDescription:!!e.remoteDescription,iceConnectionState:e.iceConnectionState,source:"child_ice_candidates"});for(const Z of A)try{if(!Z.candidate)continue;if(e.remoteDescription){const M=new RTCIceCandidate(Z);await e.addIceCandidate(M),L<=3&&console.log(" [PARENT HANDLER] Added ICE candidate #"+L)}else l.current.push(Z),I<3&&console.log(" [PARENT HANDLER] Queued ICE candidate (waiting for remote description)")}catch(M){const U=M;!U.message?.includes("duplicate")&&!U.message?.includes("already")&&console.error(" [PARENT HANDLER] Error adding ICE candidate:",U.message)}}}).subscribe()}else{console.log("Parent initiating call to child:",t);const{data:g,error:v}=await Y.from("calls").insert({child_id:t,parent_id:n,caller_type:"parent",status:"ringing"}).select().single();if(v)throw console.error("Call creation error:",v),new Error(`Failed to create call: ${v.message}`);if(!g)throw new Error("Failed to create call: No call data returned");console.log("Call created successfully:",g.id),s(g.id);const b=e.getSenders().map(A=>A.track).filter(Boolean);if(console.log(" [PARENT CALL] Tracks in peer connection before offer:",{audioTracks:b.filter(A=>A?.kind==="audio").length,videoTracks:b.filter(A=>A?.kind==="video").length,totalTracks:b.length,senders:e.getSenders().length,trackDetails:b.map(A=>({kind:A.kind,id:A.id,enabled:A.enabled,muted:A.muted}))}),b.length===0)throw console.error(" [PARENT CALL] NO TRACKS FOUND in peer connection! This will cause no video/audio. Make sure initializeConnection() was called and tracks were added."),new Error("Cannot create offer: no media tracks found. Please ensure camera/microphone permissions are granted.");const x=b.filter(A=>A?.kind==="audio"),S=b.filter(A=>A?.kind==="video");if(x.length===0&&S.length===0)throw console.error(" [PARENT CALL] No audio or video tracks found!"),new Error("Cannot create offer: no media tracks available.");console.log("Creating offer, current signaling state:",e.signalingState);const C=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});console.log("[KCH]","parent","created offer",!!C?.sdp);const w=C.sdp?.includes("m=audio"),N=C.sdp?.includes("m=video");if(console.log(" [PARENT CALL] Offer SDP verification:",{hasAudio:w,hasVideo:N,sdpLength:C.sdp?.length,sdpPreview:C.sdp?.substring(0,200)}),!w&&!N)throw console.error(" [PARENT CALL] CRITICAL: Offer SDP has no media tracks! This will cause no video/audio."),new Error("Offer SDP missing media tracks - ensure tracks are added before creating offer");console.log("Offer created, setting local description..."),await e.setLocalDescription(C);const _={type:C.type,sdp:C.sdp};console.log("Updating call with offer:",{callId:g.id,offerData:_}),console.log("[KCH]","parent","saving offer for call",g.id);const{data:j,error:T}=await Y.from("calls").update({offer:_}).eq("id",g.id).select();if(console.log("Update response:",{data:j,error:T}),T)throw console.error("Error updating call with offer:",T),console.error("Error code:",T.code),console.error("Error message:",T.message),console.error("Error details:",JSON.stringify(T,null,2)),console.error("Call ID:",g.id),console.error("Offer data:",_),T.code==="PGRST204"||T.message?.includes("Could not find the 'offer' column")?new Error("Database schema cache is out of sync. Please refresh the page or contact support."):T.code==="42501"||T.code==="PGRST301"||T.message?.includes("permission denied")||T.message?.includes("new row violates row-level security")?new Error(`Permission denied: ${T.message}. Check RLS policies.`):new Error(`Failed to set offer: ${T.message}`);return console.log(" [PARENT CALL] Offer sent successfully, waiting for child's answer..."),Y.channel(`call:${g.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${g.id}`},async A=>{try{console.log(" [PARENT HANDLER] UPDATE event received:",{callId:g.id,hasNew:!!A.new,hasOld:!!A.old,timestamp:new Date().toISOString()});const I=A.new,L=A.old;console.log(" [PARENT HANDLER] Update details:",{hasAnswer:!!I.answer,hadAnswer:!!L?.answer,status:I.status,oldStatus:L?.status,hasRemoteDesc:!!e.remoteDescription}),L?.status!==I.status&&(I.status==="ended"||I.status==="active")&&(console.log(" [PARENT HANDLER] Call status changed:",{callId:I.id,oldStatus:L?.status,newStatus:I.status}),I.status==="active"&&L?.status!=="active"&&(console.log(" [PARENT HANDLER] Call status changed to active - stopping ringtone"),o(!1))),I.answer&&!L?.answer&&(console.log(" [PARENT HANDLER] Answer received from child"),o(!1));const M=Xt(I),U=L?Xt(L):null;if(M&&L!==void 0&&U===!1){const B=e.iceConnectionState;console.info(" [CALL LIFECYCLE] Call ended by remote party (parent handler - parent initiated)",{callId:I.id,oldStatus:L?.status,newStatus:I.status,reason:"Status changed to 'ended' in database",timestamp:new Date().toISOString(),connectionState:e.connectionState,iceConnectionState:B,signalingState:e.signalingState}),console.log(" [CALL LIFECYCLE] Call ended - closing peer connection immediately",{iceState:B,reason:"Call status changed to 'ended' - closing regardless of ICE state"}),e.signalingState!=="closed"&&e.close();return}if(I.answer&&e.remoteDescription===null)try{o(!1),console.log(" [PARENT HANDLER] Parent received answer from child, setting remote description...",{callId:I.id,hasAnswer:!!I.answer,answerType:I.answer?.type,currentRemoteDesc:!!e.remoteDescription,signalingState:e.signalingState});const B=I.answer;await e.setRemoteDescription(new RTCSessionDescription(B)),console.log(" [PARENT HANDLER] Remote description set successfully from child's answer",{signalingState:e.signalingState,iceConnectionState:e.iceConnectionState});const z=l.current.length;if(z>0){console.log(` [PARENT HANDLER] Processing ${z} queued ICE candidates after answer`);for(const H of l.current)try{await e.addIceCandidate(new RTCIceCandidate(H))}catch(Q){const $=Q;!$.message?.includes("duplicate")&&!$.message?.includes("already")&&console.error(" [PARENT HANDLER] Error adding queued ICE candidate:",$.message)}l.current=[]}o(!1),console.log(" [PARENT HANDLER] Call connected! Parent received answer from child.",{signalingState:e.signalingState,iceConnectionState:e.iceConnectionState,iceGatheringState:e.iceGatheringState,hasRemoteDescription:!!e.remoteDescription,hasLocalDescription:!!e.localDescription});const q=I.child_ice_candidates;q&&Array.isArray(q)&&q.length>0&&(console.log(" [PARENT HANDLER] Processing existing ICE candidates from child (immediate after answer):",{count:q.length,hasRemoteDescription:!!e.remoteDescription,iceConnectionState:e.iceConnectionState}),(async()=>{for(const H of q)try{if(!H.candidate)continue;e.remoteDescription?(await e.addIceCandidate(new RTCIceCandidate(H)),console.log(" [PARENT HANDLER] Added existing ICE candidate from child")):l.current.push(H)}catch(Q){const $=Q;!$.message?.includes("duplicate")&&!$.message?.includes("already")&&console.error(" [PARENT HANDLER] Error adding existing ICE candidate:",$.message)}})())}catch(B){console.error(" [PARENT HANDLER] Error setting remote description:",B)}else I.answer&&e.remoteDescription!==null&&console.log(" [PARENT HANDLER] Answer received but remote description already set");const D=I.child_ice_candidates||I.ice_candidates;if(D&&Array.isArray(D)){const B=D.length;B>0&&B%10===0&&console.log(" [PARENT HANDLER] Processing ICE candidates (from child):",{count:B,iceConnectionState:e.iceConnectionState});const z=new Set;for(const q of D)try{if(!q.candidate)continue;const H=`${q.candidate}-${q.sdpMLineIndex}-${q.sdpMid||""}`;if(z.has(H))continue;if(z.add(H),e.remoteDescription){const Q=new RTCIceCandidate(q);await e.addIceCandidate(Q)}else l.current.push(q)}catch(H){const Q=H;!Q.message?.includes("duplicate")&&!Q.message?.includes("already")&&console.error(" [PARENT HANDLER] Error adding ICE candidate:",Q.message)}z.size>0&&z.size%10===0&&console.log(" [PARENT HANDLER] Processed",z.size,"ICE candidates from child",{iceConnectionState:e.iceConnectionState,connectionState:e.connectionState})}}catch(I){console.error("Error in parent call update handler:",I)}}).subscribe(A=>{console.log(" [PARENT CALL] Realtime subscription status:",A,{callId:g.id}),A==="SUBSCRIBED"?console.log(" [PARENT CALL] Successfully subscribed to realtime updates for answer"):A==="CHANNEL_ERROR"&&console.error(" [PARENT CALL] Realtime subscription error - answer may not be received!")})}},L3=async(e,t,n,s,o,l,c)=>{if(c){k.log(" [CHILD CALL] Looking for specific call:",c);const{data:g,error:v}=await Y.from("calls").select("*").eq("id",c).eq("child_id",t.id).maybeSingle();if(v&&k.error("Error fetching specific call:",v),g){if(k.log(" [CHILD CALL] Found specific call:",{id:g.id,caller_type:g.caller_type,status:g.status,hasOffer:!!g.offer}),g.caller_type==="parent"&&g.offer){if(g.status==="ringing"||g.status==="active")return k.log(" [CHILD CALL] Answering incoming call from parent (status:",g.status+", hasOffer: true)"),Zh(e,g,s,o,l);k.log(" [CHILD CALL] Specific call is ended (status:",g.status+"), cannot answer. Creating new call instead.")}if(g.caller_type==="child"&&(g.status==="ringing"||g.status==="active"))return k.log(" [CHILD CALL] Using existing child-initiated call"),zw(e,g,s,o,l);Xt(g)&&k.log(" [CHILD CALL] Specific call is ended, checking for other incoming calls...")}}const{data:u,error:h}=await Y.from("calls").select("*").eq("child_id",t.id).eq("caller_type","parent").eq("status","ringing").not("offer","is",null).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(h&&k.error("Error checking for incoming call:",h),u){if(u.offer&&u.status==="ringing")return k.log(" [CHILD CALL] Found incoming RINGING call from parent with offer:",{callId:u.id,status:u.status,hasOffer:!0}),Zh(e,u,s,o,l);if(u.status!=="ringing")k.log(" [CHILD CALL] Found call from parent but status is",u.status+", not ringing. Creating new call instead.");else{k.log(" [CHILD CALL] Found incoming call from parent but offer not ready yet, waiting...",u.id),s(u.id);const g=Y.channel(`call:${u.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${u.id}`},async v=>{const b=v.new;if(b.offer&&e.remoteDescription===null)return k.log(" [CHILD CALL] Offer received, answering incoming call from parent"),Y.removeChannel(g),Zh(e,b,s,o,l)}).subscribe();return g}}const{data:f}=await Y.from("calls").select("*").eq("child_id",t.id).eq("parent_id",n.parent_id).in("status",["ringing","active"]).eq("caller_type","child").order("created_at",{ascending:!1}).limit(1).maybeSingle();return f?(k.log(" [CHILD CALL] Found existing child-initiated call, continuing it:",f.id),zw(e,f,s,o,l)):(k.log(" [CHILD CALL] No existing or incoming call found - child initiating new call"),M3(e,t,n.parent_id,s,o,l))},zw=async(e,t,n,s,o)=>{k.log("Using existing call:",t.id),n(t.id);let l=!1;if(t.status==="ended"||t.status==="active"){k.log("Resetting existing call to ringing status (was:",t.status,")...");const{error:c}=await Y.from("calls").update({status:"ringing",ended_at:null,offer:null,answer:null,parent_ice_candidates:null,child_ice_candidates:null}).eq("id",t.id);c?k.error("Error resetting call status:",c):(t.status="ringing",t.offer=void 0,t.answer=void 0,l=!0)}if(l){k.log("Call was reset, creating fresh offer...");const c=await e.createOffer();await e.setLocalDescription(c);const u={type:c.type,sdp:c.sdp},{error:h}=await Y.from("calls").update({offer:u}).eq("id",t.id);if(h)throw k.error("Error updating call with new offer:",h),new Error(`Failed to create offer: ${h.message}`);k.log("Fresh offer created and set for reset call")}else if(t.answer&&e.remoteDescription===null){if(e.localDescription===null){k.log("Existing call has answer but no local offer - creating offer first...");const u=await e.createOffer();await e.setLocalDescription(u);const h={type:u.type,sdp:u.sdp};await Y.from("calls").update({offer:h}).eq("id",t.id),k.log("Created and set local offer, now setting remote answer")}const c=t.answer;await e.setRemoteDescription(new RTCSessionDescription(c));for(const u of o.current)await e.addIceCandidate(new RTCIceCandidate(u));o.current=[],s(!1)}else if(t.offer&&!l)if(k.log("Existing call has offer, but creating fresh offer for new peer connection..."),e.localDescription===null){const c=await e.createOffer();await e.setLocalDescription(c);const u={type:c.type,sdp:c.sdp},{error:h}=await Y.from("calls").update({offer:u}).eq("id",t.id);if(h)throw k.error("Error updating call with fresh offer:",h),new Error(`Failed to create offer: ${h.message}`);k.log("Fresh offer created and set for existing call")}else k.log("Peer connection already has local description, skipping");else{k.log("Existing call has no offer, creating one...");const{data:c,error:u}=await Y.from("calls").select("id, status, caller_type").eq("id",t.id).single();if(u||!c)throw k.error("Call verification failed:",u),new Error(`Call ${t.id} no longer exists or cannot be accessed`);if(Xt(c))throw new Error("Call has already ended");const h=await e.createOffer();await e.setLocalDescription(h);const f={type:h.type,sdp:h.sdp};k.log("Updating call with offer:",{callId:t.id,offerData:f});const{data:g,error:v}=await Y.from("calls").update({offer:f}).eq("id",t.id).select();if(k.log("Update response:",{data:g,error:v}),v)throw k.error("Error updating call with offer:",v),k.error("Error code:",v.code),k.error("Error message:",v.message),k.error("Error details:",JSON.stringify(v,null,2)),k.error("Call ID:",t.id),k.error("Offer data:",f),k.error("Offer data type:",typeof f),k.error("Offer data JSON:",JSON.stringify(f)),v.code==="PGRST204"||v.message?.includes("Could not find the 'offer' column")?new Error("Database schema cache is out of sync. Please refresh the page or contact support."):v.code==="42501"||v.code==="PGRST301"||v.message?.includes("permission denied")||v.message?.includes("new row violates row-level security")?new Error(`Permission denied: ${v.message}. Check RLS policies.`):v.code==="PGRST204"||v.code==="23514"?new Error(`Validation error: ${v.message}. Check data format.`):new Error(`Failed to send offer: ${v.message||JSON.stringify(v)}`);k.log("Offer created and sent for existing call")}return Y.channel(`call:${t.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${t.id}`},async c=>{try{const u=c.new,h=c.old,f=Xt(u),g=h?Xt(h):null;if(f&&h!==void 0&&g===!1){const b=e.iceConnectionState;k.log(" [CALL LIFECYCLE] Call ended by remote party (child handler - existing call)",{callId:u.id,oldStatus:h?.status,newStatus:u.status,ended_at:u.ended_at,reason:"Status changed to terminal state in database",timestamp:new Date().toISOString(),connectionState:e.connectionState,iceConnectionState:b,signalingState:e.signalingState}),k.log(" [CALL LIFECYCLE] Call ended - closing peer connection immediately",{iceState:b,reason:"Call status changed to terminal - closing regardless of ICE state"}),e.signalingState!=="closed"&&e.close();return}if(u.status==="active"&&h?.status!=="active"&&k.log("Call status changed to active - parent answered the call!"),u.answer&&e.remoteDescription===null){k.log("Received answer from parent, setting remote description...");const b=u.answer;try{await e.setRemoteDescription(new RTCSessionDescription(b)),k.log("Remote description set successfully");for(const x of o.current)try{await e.addIceCandidate(new RTCIceCandidate(x))}catch{}o.current=[],s(!1),k.log("Call connected!")}catch(x){k.error("Error setting remote description:",x)}}const v=u.parent_ice_candidates;if(v&&Array.isArray(v)){const b=v.length;b>0&&b%10===0&&k.log(" [CHILD HANDLER] Processing ICE candidates (from parent):",{count:b,iceConnectionState:e.iceConnectionState});for(const x of v)try{if(!x.candidate){k.warn(" [CHILD HANDLER] Skipping invalid candidate (no candidate field)");continue}if(e.remoteDescription){const S=new RTCIceCandidate(x);await e.addIceCandidate(S)}else o.current.push(x)}catch(S){const C=S;C.message?.includes("duplicate")||C.message?.includes("already")||k.error(" [CHILD HANDLER] Error adding ICE candidate:",C.message)}}}catch(u){k.error("Error in call update handler:",u)}}).subscribe()},Zh=async(e,t,n,s,o)=>{if(k.log(" [CHILD HANDLER] Answering incoming call from parent:",{callId:t.id,hasOffer:!!t.offer,offerType:t.offer?.type}),n(t.id),!t.offer)throw new Error("Cannot answer call: offer not found");const l=t.offer;k.log(" [CHILD HANDLER] Setting remote description with parent's offer..."),await e.setRemoteDescription(new RTCSessionDescription(l)),await new Promise((S,C)=>{const w=setTimeout(()=>{C(new Error("Timeout waiting for signaling state change"))},5e3),N=()=>{e.signalingState==="have-remote-offer"||e.signalingState==="have-local-pranswer"?(clearTimeout(w),S()):setTimeout(N,100)};N()});const c=e.getSenders().map(S=>S.track).filter(Boolean);if(k.log(" [CHILD HANDLER] Tracks in peer connection before answer:",{audioTracks:c.filter(S=>S?.kind==="audio").length,videoTracks:c.filter(S=>S?.kind==="video").length,totalTracks:c.length,senders:e.getSenders().length,trackDetails:c.map(S=>({kind:S.kind,id:S.id,enabled:S.enabled,muted:S.muted}))}),c.length===0)throw k.error(" [CHILD HANDLER] NO TRACKS FOUND in peer connection! This will cause no video/audio. Make sure initializeConnection() was called and tracks were added."),new Error("Cannot create answer: no media tracks found. Please ensure camera/microphone permissions are granted.");const u=c.filter(S=>S?.kind==="audio"),h=c.filter(S=>S?.kind==="video");if(u.length===0&&h.length===0)throw k.error(" [CHILD HANDLER] No audio or video tracks found!"),new Error("Cannot create answer: no media tracks available.");k.log(" [CHILD HANDLER] Creating answer, current state:",e.signalingState);const f=await e.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});k.log("[KCH]","child","created answer",!!f?.sdp),k.log(" [CHILD HANDLER] Answer created, setting local description..."),await e.setLocalDescription(f);const g=f.sdp?.includes("m=audio"),v=f.sdp?.includes("m=video");if(k.log(" [CHILD HANDLER] Answer SDP verification:",{type:f.type,sdpLength:f.sdp?.length,hasAudio:g,hasVideo:v,sdpPreview:f.sdp?.substring(0,200)}),!g&&!v)throw k.error(" [CHILD HANDLER] CRITICAL: Answer SDP has no media tracks! This will cause no video/audio."),new Error("Answer SDP missing media tracks - ensure tracks are added before creating answer");k.log(" [CHILD HANDLER] Updating call with answer...",{callId:t.id,answerType:f.type}),k.log("[KCH]","child","saving answer for call",t.id);const{error:b}=await Y.from("calls").update({answer:{type:f.type,sdp:f.sdp},status:"active",ended_at:null}).eq("id",t.id);if(b)throw k.error(" [CHILD HANDLER] Error updating call with answer:",b),new Error(`Failed to send answer: ${b.message}`);k.log(" [CHILD HANDLER] Answer sent successfully to parent");const x=o.current.length;if(x>0){k.log(` [CHILD HANDLER] Processing ${x} queued ICE candidates after answer`);for(const S of o.current)try{await e.addIceCandidate(new RTCIceCandidate(S))}catch(C){const w=C;!w.message?.includes("duplicate")&&!w.message?.includes("already")&&k.error(" [CHILD HANDLER] Error processing queued ICE candidate:",w.message)}o.current=[]}return s(!1),k.log(" [CHILD HANDLER] Call connected! Child answered parent's call."),(async()=>{try{const{data:S}=await Y.from("calls").select("parent_ice_candidates").eq("id",t.id).maybeSingle();if(S){const C=S.parent_ice_candidates;if(C&&Array.isArray(C)&&C.length>0){k.log(" [CHILD HANDLER] Processing existing ICE candidates from parent (immediate):",{count:C.length,hasRemoteDescription:!!e.remoteDescription,iceConnectionState:e.iceConnectionState});for(const w of C)try{if(!w.candidate)continue;e.remoteDescription?(await e.addIceCandidate(new RTCIceCandidate(w)),k.log(" [CHILD HANDLER] Added existing ICE candidate from parent")):o.current.push(w)}catch(N){const _=N;!_.message?.includes("duplicate")&&!_.message?.includes("already")&&k.error(" [CHILD HANDLER] Error adding existing ICE candidate:",_.message)}}}}catch(S){k.error(" [CHILD HANDLER] Error fetching existing ICE candidates:",S)}})(),Y.channel(`call:${t.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${t.id}`},async S=>{const C=S.new,w=S.old,N=Xt(C),_=w?Xt(w):null;if(N&&w!==void 0&&_===!1){const T=e.iceConnectionState;k.log(" [CALL LIFECYCLE] Call ended by remote party (child handler - incoming call)",{callId:C.id,oldStatus:w?.status,newStatus:C.status,ended_at:C.ended_at,reason:"Status changed to terminal state in database",timestamp:new Date().toISOString(),connectionState:e.connectionState,iceConnectionState:T,signalingState:e.signalingState}),k.log(" [CALL LIFECYCLE] Call ended - closing peer connection immediately",{iceState:T,reason:"Call status changed to terminal - closing regardless of ICE state"}),e.signalingState!=="closed"&&e.close();return}const j=C.parent_ice_candidates;if(j&&Array.isArray(j)){o.current.length;const T=j.length;T>0&&T%10===0&&k.log(" [CHILD HANDLER] Processing ICE candidates (incoming call, from parent):",{count:T,iceConnectionState:e.iceConnectionState});const R=new Set;for(const A of j)try{if(!A.candidate)continue;const I=`${A.candidate}-${A.sdpMLineIndex}-${A.sdpMid||""}`;if(R.has(I))continue;if(R.add(I),e.remoteDescription){const L=new RTCIceCandidate(A);await e.addIceCandidate(L)}else o.current.push(A)}catch(I){const L=I;!L.message?.includes("duplicate")&&!L.message?.includes("already")&&k.error(" [CHILD HANDLER] Error adding ICE candidate:",L.message)}T>0&&R.size>0&&R.size%10===0&&k.log(" [CHILD HANDLER] Processed",R.size,"ICE candidates from parent",{iceConnectionState:e.iceConnectionState})}}).subscribe()},M3=async(e,t,n,s,o,l)=>{k.log(" [CHILD CALL] Creating call for child:",t.id,"parent:",n);const{data:c,error:u}=await Y.from("children").select("id, parent_id").eq("id",t.id).eq("parent_id",n).single();if(u||!c)throw k.error(" [CHILD CALL] Child verification failed:",{childId:t.id,parentId:n,error:u,childData:c}),new Error(`Child verification failed: ${u?.message||"Child not found or parent mismatch"}`);k.log(" [CHILD CALL] Child verified, attempting insert:",{childId:t.id,parentId:n,childData:c});const{data:h,error:f}=await Y.from("calls").insert({child_id:t.id,parent_id:n,caller_type:"child",status:"ringing"}).select().single();if(f)throw k.error(" [CHILD CALL] Call creation error:",{error:f,code:f.code,message:f.message,details:f.details,hint:f.hint,insertData:{child_id:t.id,parent_id:n,caller_type:"child",status:"ringing"}}),new Error(`Failed to create call: ${f.message}`);if(!h)throw new Error("Failed to create call: No call data returned");if(k.log(" [CHILD CALL] Call created successfully:",{callId:h.id,childId:h.child_id,parentId:h.parent_id,callerType:h.caller_type,status:h.status,createdAt:h.created_at}),s(h.id),e.signalingState==="closed")throw new Error("Peer connection is closed. Please try again.");if(e.connectionState==="closed"||e.connectionState==="failed")throw new Error(`Peer connection is in ${e.connectionState} state. Please try again.`);const g=e.getSenders().map(j=>j.track).filter(Boolean);if(k.log(" [CHILD CALL] Tracks in peer connection before offer:",{audioTracks:g.filter(j=>j?.kind==="audio").length,videoTracks:g.filter(j=>j?.kind==="video").length,totalTracks:g.length,senders:e.getSenders().length,trackDetails:g.map(j=>({kind:j.kind,id:j.id,enabled:j.enabled,muted:j.muted}))}),g.length===0)throw k.error(" [CHILD CALL] NO TRACKS FOUND in peer connection! This will cause no video/audio. Make sure initializeConnection() was called and tracks were added."),new Error("Cannot create offer: no media tracks found. Please ensure camera/microphone permissions are granted.");const v=g.filter(j=>j?.kind==="audio"),b=g.filter(j=>j?.kind==="video");if(v.length===0&&b.length===0)throw k.error(" [CHILD CALL] No audio or video tracks found!"),new Error("Cannot create offer: no media tracks available.");k.log("Creating offer, current signaling state:",e.signalingState);const x=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});k.log("[KCH]","child","created offer",!!x?.sdp);const S=x.sdp?.includes("m=audio"),C=x.sdp?.includes("m=video");if(k.log(" [CHILD CALL] Offer SDP verification:",{hasAudio:S,hasVideo:C,sdpLength:x.sdp?.length,sdpPreview:x.sdp?.substring(0,200)}),!S&&!C)throw k.error(" [CHILD CALL] CRITICAL: Offer SDP has no media tracks! This will cause no video/audio."),new Error("Offer SDP missing media tracks - ensure tracks are added before creating offer");k.log("Offer created, setting local description..."),await e.setLocalDescription(x);const w={type:x.type,sdp:x.sdp};k.log("Updating call with offer:",{callId:h.id,offerData:w}),k.log("[KCH]","child","saving offer for call",h.id);const{data:N,error:_}=await Y.from("calls").update({offer:w}).eq("id",h.id).select();if(k.log("Update response:",{data:N,error:_}),_)throw k.error("Error updating call with offer:",_),k.error("Error code:",_.code),k.error("Error message:",_.message),k.error("Error details:",JSON.stringify(_,null,2)),k.error("Call ID:",h.id),k.error("Offer data:",w),k.error("Offer data type:",typeof w),k.error("Offer data JSON:",JSON.stringify(w)),_.code==="PGRST204"||_.message?.includes("Could not find the 'offer' column")?new Error("Database schema cache is out of sync. Please refresh the page or contact support."):_.code==="42501"||_.code==="PGRST301"||_.message?.includes("permission denied")||_.message?.includes("new row violates row-level security")?new Error(`Permission denied: ${_.message}. Check RLS policies.`):_.code==="PGRST204"||_.code==="23514"?new Error(`Validation error: ${_.message}. Check data format.`):new Error(`Failed to send offer: ${_.message||JSON.stringify(_)}`);return k.log("Offer sent successfully"),Y.channel(`call:${h.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${h.id}`},async j=>{const T=j.new,R=j.old,A=Xt(T),I=R?Xt(R):null;if(A&&R!==void 0&&I===!1){const Z=e.iceConnectionState;k.log(" [CALL LIFECYCLE] Call ended by remote party (child handler - child initiated)",{callId:T.id,oldStatus:R?.status,newStatus:T.status,ended_at:T.ended_at,reason:"Status changed to terminal state in database",timestamp:new Date().toISOString(),connectionState:e.connectionState,iceConnectionState:Z,signalingState:e.signalingState}),k.log(" [CALL LIFECYCLE] Call ended - closing peer connection immediately",{iceState:Z,reason:"Call status changed to terminal - closing regardless of ICE state"}),e.signalingState!=="closed"&&e.close();return}if(T.answer&&e.remoteDescription===null)try{k.log(" [CHILD HANDLER] Received answer from parent, setting remote description...",{callId:T.id,hasAnswer:!!T.answer,answerType:T.answer?.type,currentRemoteDesc:!!e.remoteDescription});const Z=T.answer;await e.setRemoteDescription(new RTCSessionDescription(Z)),k.log(" [CHILD HANDLER] Remote description set successfully from parent's answer");for(const M of l.current)try{await e.addIceCandidate(new RTCIceCandidate(M))}catch(U){const D=U;!D.message?.includes("duplicate")&&!D.message?.includes("already")&&k.error(" [CHILD HANDLER] Error adding queued ICE candidate:",D.message)}l.current=[],o(!1),k.log(" [CHILD HANDLER] Call connected! Child received answer from parent."),(async()=>{try{const{data:M}=await Y.from("calls").select("parent_ice_candidates").eq("id",T.id).maybeSingle();if(M){const U=M.parent_ice_candidates;if(U&&Array.isArray(U)&&U.length>0){k.log(" [CHILD HANDLER] Processing existing ICE candidates from parent (immediate after answer):",{count:U.length,hasRemoteDescription:!!e.remoteDescription,iceConnectionState:e.iceConnectionState});for(const D of U)try{if(!D.candidate)continue;e.remoteDescription?await e.addIceCandidate(new RTCIceCandidate(D)):l.current.push(D)}catch(B){const z=B;!z.message?.includes("duplicate")&&!z.message?.includes("already")&&k.error(" [CHILD HANDLER] Error adding existing ICE candidate:",z.message)}k.log(" [CHILD HANDLER] Finished processing existing ICE candidates from parent")}}}catch(M){k.error(" [CHILD HANDLER] Error fetching existing ICE candidates:",M)}})()}catch(Z){k.error(" [CHILD HANDLER] Error setting remote description from answer:",Z)}const L=T.parent_ice_candidates;if(L&&Array.isArray(L)){l.current.length;const Z=L.length;Z>0&&Z%10===0&&k.log(" [CHILD HANDLER] Processing ICE candidates (child initiated, from parent):",{count:Z,iceConnectionState:e.iceConnectionState});for(const M of L)try{if(!M.candidate)continue;if(e.remoteDescription){const U=new RTCIceCandidate(M);await e.addIceCandidate(U)}else l.current.push(M)}catch(U){const D=U;!D.message?.includes("duplicate")&&!D.message?.includes("already")&&k.error(" [CHILD HANDLER] Error adding ICE candidate:",D.message)}}}).subscribe()},$3=()=>{const{childId:e}=hd(),[t]=F0(),n=rt(),{toast:s}=_t(),{playRingtone:o,stopRingtone:l,playCallAnswered:c}=Zm({enabled:!0,volume:.7}),u=p.useRef(!1),h=window.location.pathname.includes("/child/"),f=window.location.pathname.includes("/parent/"),[g]=p.useState(()=>{if(h)return!0;if(f)return!1;const K=localStorage.getItem("childSession");return K&&window.location.pathname.match(/^\/call\/([^/?]+)/)?!0:!(document.cookie.includes("sb-")||localStorage.getItem("sb-"))&&!!K}),[v,b]=p.useState(null),[x,S]=p.useState(!1),[C,w]=p.useState(!1),N=p.useRef(null),_=p.useRef(null),j=p.useRef(null),T=p.useRef(null);k.debug(" [ROLE DETECTION] useVideoCall role:",{isChild:g,route:window.location.pathname,isChildRoute:h,isParentRoute:f,timestamp:new Date().toISOString()});const{localStream:R,remoteStream:A,isConnecting:I,setIsConnecting:L,initializeConnection:Z,cleanup:M,iceCandidatesQueue:U,peerConnectionRef:D,playRemoteVideo:B,isConnected:z}=nE(v,N,_,g),q=p.useRef(!1);p.useEffect(()=>{q.current=!1},[v]),p.useEffect(()=>(I&&!A&&v?o():(A||!I)&&(k.log(" [AUDIO] Call answered or connected - stopping ringtone"),l(),A&&!q.current&&c()),()=>{l()}),[I,A,v,o,l,c]),p.useEffect(()=>{if(A&&_.current&&!q.current){const W=D.current?.iceConnectionState,ne=_.current,G=z&&!!A;if(k.debug(" [VIDEO PLAY] Attempting to play remote video:",{hasRemoteStream:!!A,hasVideoElement:!!ne,iceState:W,isConnecting:I,callIsConnected:G,videoReadyState:ne.readyState,videoPaused:ne.paused,videoSrcObject:!!ne.srcObject}),G&&(W==="connected"||W==="completed"))if(ne.readyState>=2)q.current=!0,k.debug(" [VIDEO PLAY] Stream available, call connected, ICE connected, video ready (readyState:",ne.readyState,")"),B();else{k.debug(" [VIDEO PLAY] Waiting for video readyState >= 2 (current:",ne.readyState,")");const ae=()=>{ne.readyState>=2&&!q.current&&(q.current=!0,k.log(" [VIDEO PLAY] Video ready (readyState:",ne.readyState,"), attempting play"),B())};ne.addEventListener("loadeddata",ae,{once:!0}),ne.addEventListener("canplay",ae,{once:!0}),ne.addEventListener("canplaythrough",ae,{once:!0})}else if(G&&(W==="new"||W==="checking"))if(k.log(" [VIDEO PLAY] Call connected but ICE still establishing - attempting play anyway (state:",W,")"),ne.readyState>=2)q.current=!0,k.log(" [VIDEO PLAY] Video ready, attempting play (ICE still:",W,")"),B();else{const ae=()=>{ne.readyState>=2&&!q.current&&(q.current=!0,k.log(" [VIDEO PLAY] Video ready, attempting play (ICE still:",W,")"),B())};ne.addEventListener("loadeddata",ae,{once:!0}),ne.addEventListener("canplay",ae,{once:!0}),ne.addEventListener("canplaythrough",ae,{once:!0});const fe=setInterval(()=>{const xe=D.current?.iceConnectionState;(xe==="connected"||xe==="completed")&&(clearInterval(fe),!q.current&&ne.readyState>=2&&(q.current=!0,k.log(" [VIDEO PLAY] ICE connected, video ready, attempting play"),B()))},500);return setTimeout(()=>{clearInterval(fe),q.current||(k.warn(" [VIDEO PLAY] Timeout waiting for video readyState, attempting play anyway"),q.current=!0,B())},5e3),()=>clearInterval(fe)}else if(!G&&(W==="new"||W==="checking")){k.log(" [VIDEO PLAY] Waiting for call to connect and ICE connection - current state:",W);const ae=setInterval(()=>{const ve=D.current?.iceConnectionState;if(!I&&(ve==="connected"||ve==="completed")){if(clearInterval(ae),ne.readyState>=2&&!q.current)q.current=!0,k.log(" [VIDEO PLAY] Call connected, ICE connected, video ready (readyState:",ne.readyState,"), attempting play"),B();else if(!q.current){const Ie=()=>{ne.readyState>=2&&!q.current&&(q.current=!0,k.log(" [VIDEO PLAY] Video ready after call and ICE connected (readyState:",ne.readyState,")"),B())};ne.addEventListener("loadeddata",Ie,{once:!0}),ne.addEventListener("canplay",Ie,{once:!0}),ne.addEventListener("canplaythrough",Ie,{once:!0})}}else(ve==="failed"||ve==="closed")&&(clearInterval(ae),k.error(" [VIDEO PLAY] ICE connection failed, cannot play media"))},500);return setTimeout(()=>{clearInterval(ae),!q.current&&ne.readyState>=2&&(k.warn(" [VIDEO PLAY] Connection timeout but video is ready, attempting play"),q.current=!0,B())},15e3),()=>clearInterval(ae)}else k.error(" [VIDEO PLAY] ICE connection in terminal state:",W)}},[A,B,I]),p.useEffect(()=>u.current?void 0:((async()=>{const{data:{session:W}}=await Y.auth.getSession(),ne=localStorage.getItem("childSession"),G=window.location.pathname.match(/^\/call\/([^/?]+)/);if(ne&&G)return g!==!0&&k.warn(" [ROLE DETECTION] Role mismatch detected (correcting to child):",{isChildState:g,isChildUser:!0,route:window.location.pathname,reason:"childSession exists and on call page"}),!0;const ae=!W&&!!ne;return ae!==g&&k.warn(" [ROLE DETECTION] Role mismatch detected:",{isChildState:g,isChildUser:ae,route:window.location.pathname,hasSession:!!W,hasChildSession:!!ne}),ae})().then(W=>{u.current=!0,H(W).catch(ne=>{{k.error("Call initialization error:",ne),u.current=!1;const G=ne instanceof Error?ne.message:"Unknown error occurred";s({title:"Connection Error",description:G,variant:"destructive"})}})}).catch(W=>{k.error("Error determining user type:",W)}),()=>{}),[e]);const H=async K=>{k.log(" [INITIALIZE CALL] ===== INITIALIZE CALL ENTRY =====",{isChildUser:K,childId:e,timestamp:new Date().toISOString()});try{k.log(" [INITIALIZE CALL] Initializing WebRTC connection..."),await Z();const W=D.current;if(!W)throw new Error("Failed to create peer connection");k.log(" [INITIALIZE CALL] WebRTC connection initialized:",{signalingState:W.signalingState,senders:W.getSenders().length,tracks:W.getSenders().map(G=>G.track).filter(Boolean).length});let ne;K?(k.log(" [INITIALIZE CALL] Setting up child call flow..."),ne=await $(W)):(k.log(" [INITIALIZE CALL] Setting up parent call flow..."),ne=await Q(W)),k.log(" [INITIALIZE CALL] Call flow setup complete:",{hasChannel:!!ne,isChildUser:K}),ne&&(j.current=ne)}catch(W){const ne=W instanceof Error?W.message:"Unknown error occurred";throw s({title:"Connection Error",description:ne,variant:"destructive"}),L(!1),W}},Q=async K=>{k.log(" [PARENT CALL FLOW] ===== PARENT CALL FLOW ENTRY =====",{childId:e,timestamp:new Date().toISOString(),signalingState:K.signalingState,senders:K.getSenders().length,tracks:K.getSenders().map(W=>W.track).filter(Boolean).length});try{const{data:{user:W},error:ne}=await Y.auth.getUser();if(k.log(" [PARENT CALL FLOW] Auth check complete:",{hasUser:!!W,userId:W?.id,hasAuthError:!!ne}),ne)return k.error("Auth error in parent call flow:",ne),s({title:"Authentication Error",description:"Please log in again to make calls",variant:"destructive"}),null;if(!W||!e)return k.error("Missing user or childId in parent call flow"),s({title:"Error",description:"Unable to start call. Please try again.",variant:"destructive"}),null;k.log(" [PARENT CALL FLOW] Calling handleParentCall...",{childId:e,userId:W.id,timestamp:new Date().toISOString()});const G=t.get("callId"),ae=await O3(K,e,W.id,fe=>{k.log(" [PARENT CALL FLOW] CallId set:",fe),b(fe);const ve=F(fe);ve&&(T.current=ve)},L,U,G);return k.log(" [PARENT CALL FLOW] handleParentCall returned:",{hasChannel:!!ae,timestamp:new Date().toISOString()}),ae}catch(W){const ne=W instanceof Error?W.message:"Unknown error occurred",G=ne.includes("Database schema cache");throw s({title:G?"Database Schema Error":"Error",description:G?"The database schema cache needs to be refreshed. Please contact support or try refreshing the page.":ne,variant:"destructive"}),L(!1),W}},$=async K=>{try{const W=t.get("callId"),ne=!!W,G=localStorage.getItem("childSession");if(!G)if(ne&&e)k.warn(" [CHILD CALL FLOW] No child session but answering call - attempting to continue with childId from URL");else{k.error(" [CHILD CALL FLOW] No child session and not answering call - redirecting to login"),n("/child/login");return}const ae=JSON.parse(G||"{}");if(!ae.id&&ne&&e&&(k.warn(" [CHILD CALL FLOW] Invalid child session but answering call - using childId from URL"),ae.id=e),!ae.id)if(k.error(" [CHILD CALL FLOW] No valid child ID found"),ne)k.warn(" [CHILD CALL FLOW] Continuing call without valid child ID");else{n("/child/login");return}const{data:fe,error:ve}=await Y.from("children").select("parent_id").eq("id",ae.id).single();if(ve||!fe)if(k.error("Child not found in database:",ve),!v&&!ne){localStorage.removeItem("childSession"),s({title:"Session expired",description:"Please log in again with your code",variant:"destructive"}),n("/child/login");return}else k.warn(" [CHILD CALL FLOW] Child verification failed but continuing call",{isAnsweringCall:ne,hasCallId:!!v,reason:"Call is active or answering - don't navigate away"});let xe=fe?.parent_id;if(!xe&&ae.parent_id&&(xe=ae.parent_id,k.warn(" [CHILD CALL FLOW] Using parent_id from child session cache")),!xe)if(k.error(" [CHILD CALL FLOW] Unable to determine parent ID",{hasChildData:!!fe,hasChildSession:!!ae,childId:ae.id}),W)k.warn(" [CHILD CALL FLOW] Continuing call without parent_id - call handler may have it");else throw new Error("Unable to determine parent ID for call. Please log in again.");if(!xe&&W){k.log(" [CHILD CALL FLOW] No parentId but answering call - fetching from call record");try{const{data:Ke}=await Y.from("calls").select("parent_id").eq("id",W).maybeSingle();Ke?.parent_id&&(xe=Ke.parent_id,k.log(" [CHILD CALL FLOW] Got parentId from call record:",xe))}catch(Ke){k.warn(" [CHILD CALL FLOW] Could not fetch parentId from call record:",Ke)}}return await L3(K,ae,{parent_id:xe||"unknown"},Ke=>{b(Ke);const Ve=F(Ke);Ve&&(T.current=Ve)},L,U,W)}catch(W){const ne=W instanceof Error?W.message:"Unknown error occurred",G=ne.includes("Database schema cache"),ae=t.get("callId"),fe=!!ae;throw k.error(" [CHILD CALL FLOW] Error in handleChildCallFlow:",{errorMessage:ne,isAnsweringCall:fe,urlCallId:ae,hasChildSession:!!localStorage.getItem("childSession")}),s({title:G?"Database Schema Error":"Connection Error",description:G?"The database schema cache needs to be refreshed. Please contact support or try refreshing the page.":fe?"Failed to connect to call. Please try again.":ne,variant:"destructive"}),L(!1),fe||n("/child/dashboard"),W}},O=()=>{if(R){const K=!x;R.getAudioTracks().forEach(W=>{W.enabled=!K}),S(K)}},J=()=>{if(R){const K=!C;R.getVideoTracks().forEach(W=>{W.enabled=!K}),w(K)}},F=K=>Y.channel(`call-termination:${K}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`id=eq.${K}`},async ne=>{try{const G=ne.new,ae=ne.old;ae?.status!==void 0&&ae.status!==G.status&&k.log(" [CALL LIFECYCLE] Call status update received:",{callId:G.id,oldStatus:ae?.status,newStatus:G.status,timestamp:new Date().toISOString()});const ve=Xt(G),xe=ae?Xt(ae):null;if(k.log(" [TERMINATION LISTENER] Checking termination conditions:",{isTerminal:ve,hasOldCall:ae!==void 0,wasTerminal:xe,callIdMatch:G.id===K,oldStatus:ae?.status,newStatus:G.status,oldEndedAt:ae?.ended_at,newEndedAt:G.ended_at}),ve&&ae!==void 0&&xe===!1&&G.id===K){const Ie=D.current,$e=Ie?.iceConnectionState;k.log(" [CALL LIFECYCLE] Call ended by remote party - cleaning up",{callId:K,oldStatus:ae?.status,newStatus:G.status,ended_at:G.ended_at,ended_by:G.ended_by,reason:"Call reached terminal state (ended or ended_at set) in database",timestamp:new Date().toISOString(),connectionState:Ie?.connectionState,iceConnectionState:$e,hasRemoteStream:!!A,remoteVideoReadyState:_.current?.readyState});const Ke=$e!=="new"&&$e!=="checking";k.log(" [CALL LIFECYCLE] Call ended by remote party - cleaning up immediately",{iceState:$e,reason:"Call reached terminal state - cleaning up regardless of ICE state"}),s({title:"Call Ended",description:"The other person ended the call",variant:"default"}),M(),j.current&&(Y.removeChannel(j.current),j.current=null),T.current&&(Y.removeChannel(T.current),T.current=null);const{data:{session:Ve}}=await Y.auth.getSession(),ie=localStorage.getItem("childSession"),Re=window.location.pathname.match(/^\/call\/([^/?]+)/);let le=!1;ie&&Re?le=!0:le=!Ve&&!!ie,k.log(" [USER TYPE DETECTION] Termination listener - determining user type:",{hasAuthSession:!!Ve,hasChildSession:!!ie,isChildUser:le,route:window.location.pathname,isCallPage:!!Re,userId:Ve?.user?.id||null,timestamp:new Date().toISOString()}),n(le?"/child/dashboard":Ve?"/parent/dashboard":"/")}}catch(G){k.error(" [CALL LIFECYCLE] Error in termination listener:",G)}}).subscribe(),ee=p.useRef(null);return p.useEffect(()=>{z&&A&&v&&!ee.current&&(ee.current=Date.now(),k.log(" [CALL LIFECYCLE] Call started (ICE connected)",{callId:v,timestamp:new Date().toISOString(),iceState:D.current?.iceConnectionState,connectionState:D.current?.connectionState}))},[z,A,v,D]),p.useEffect(()=>{!I&&v&&!ee.current&&!z&&k.log(" [CALL LIFECYCLE] Call signaling complete (waiting for ICE)",{callId:v,timestamp:new Date().toISOString()})},[I,v]),{localVideoRef:N,remoteVideoRef:_,localStream:R,remoteStream:A,isConnecting:I,isMuted:x,isVideoOff:C,isChild:g,toggleMute:O,toggleVideo:J,endCall:async()=>{const K=ee.current?Date.now()-ee.current:null;k.log(" [USER ACTION] User ended call",{callId:v,callDurationMs:K,callDurationSeconds:K?Math.round(K/1e3):null,timestamp:new Date().toISOString(),connectionState:D.current?.connectionState,iceConnectionState:D.current?.iceConnectionState,hasRemoteStream:!!A,remoteVideoReadyState:_.current?.readyState}),K&&K<5e3&&k.warn(" [USER ACTION] Call ended very quickly - might be accidental",{durationMs:K,durationSeconds:Math.round(K/1e3)});const{data:{session:W}}=await Y.auth.getSession(),ne=localStorage.getItem("childSession"),G=!W&&!!ne,ae=G?"child":"parent";if(k.log(" [USER TYPE DETECTION] End call - determining user type:",{hasAuthSession:!!W,hasChildSession:!!ne,isChildUser:G,by:ae,userId:W?.user?.id||null,timestamp:new Date().toISOString()}),v)try{await ta({callId:v,by:ae,reason:"hangup"})}catch(fe){k.error(" [USER ACTION] Error ending call:",fe)}ee.current=null,l(),M(!0),j.current&&(Y.removeChannel(j.current),j.current=null),T.current&&(Y.removeChannel(T.current),T.current=null),n(G?"/child/dashboard":"/parent/dashboard")}}},F3=()=>{const{localVideoRef:e,remoteVideoRef:t,remoteStream:n,isConnecting:s,isMuted:o,isVideoOff:l,toggleMute:c,toggleVideo:u,endCall:h,callStartTime:f}=$3();return i.jsx(tp,{localVideoRef:e,remoteVideoRef:t,remoteStream:n,isConnecting:s,isMuted:o,isVideoOff:l,onToggleMute:c,onToggleVideo:u,onEndCall:h,callStartTime:f})},U3=()=>{const{childId:e}=hd(),[t,n]=p.useState([]),[s,o]=p.useState(""),[l,c]=p.useState(!1),[u,h]=p.useState(null),[f,g]=p.useState(null),[v,b]=p.useState(!1),[x,S]=p.useState("Mom/Dad"),C=p.useRef(null),w=p.useRef(null),N=rt(),{toast:_}=_t();p.useEffect(()=>((async()=>{let Z=null;try{const{data:{session:M}}=await Y.auth.getSession();if(M?.user)if(c(!1),e)Z=e,T(e),j(e);else{N("/parent/children");return}else{const U=localStorage.getItem("childSession");if(U)try{const D=JSON.parse(U);c(!0),h(D),Z=D.id,T(D.id),Y.from("children").select("parent_id").eq("id",D.id).single().then(({data:B,error:z})=>{if(z||!B){k.error("Error fetching child record:",Ge(z));return}return Y.from("parents").select("id, name").eq("id",B.parent_id).maybeSingle()}).then(B=>{B?.data?(S(B.data.name),g({name:B.data.name,id:B.data.id})):B?.error&&k.error("Error fetching parent data:",Ge(B.error))}).catch(B=>{k.error("Error fetching parent data:",Ge(B))})}catch(D){k.error("Error parsing childSession:",Ge(D)),N("/");return}else if(e){N("/");return}else{N("/");return}}}catch(M){k.error("Error checking auth session:",Ge(M)),N("/");return}if(Z){k.log(" [CHAT] Setting up realtime subscription for messages",{childId:Z,isChild:l,timestamp:new Date().toISOString()});const M=`messages-${Z}`;k.log(" [CHAT] Creating realtime channel:",{channelName:M,targetChildId:Z,filter:`child_id=eq.${Z}`,isChild:l}),w.current=Y.channel(M).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`child_id=eq.${Z}`},U=>{k.log(" [CHAT] Received new message via realtime:",{messageId:U.new.id,senderType:U.new.sender_type,childId:U.new.child_id,filterChildId:Z,matches:U.new.child_id===Z,timestamp:new Date().toISOString()}),U.new.child_id===Z?n(D=>D.some(z=>z.id===U.new.id)?(k.warn(" [CHAT] Duplicate message detected, ignoring:",U.new.id),D):[...D,U.new]):k.warn(" [CHAT] Received message for different child_id, ignoring:",{received:U.new.child_id,expected:Z})}).subscribe((U,D)=>{k.log(" [CHAT] Realtime subscription status:",{status:U,channel:M,childId:Z,isChild:l,error:D?Ge(D):void 0,timestamp:new Date().toISOString()}),U==="SUBSCRIBED"?(k.log(" [CHAT] Successfully subscribed to messages"),k.log(" [CHAT] Will receive INSERT events for child_id:",Z)):U==="CHANNEL_ERROR"?(k.error(" [CHAT] Realtime subscription error:",D?Ge(D):"Unknown error"),k.error(" [CHAT] This usually means:"),k.error("   1. RLS policies are blocking SELECT access"),k.error("   2. Realtime is not enabled for messages table"),k.error("   3. WebSocket connection failed"),k.error(" [CHAT] Falling back to polling (checking every 3 seconds)")):U==="TIMED_OUT"?k.warn(" [CHAT] Realtime subscription timed out - using polling fallback"):U==="CLOSED"?k.warn(" [CHAT] Realtime subscription closed - using polling fallback"):k.log(" [CHAT] Realtime subscription status:",U)})}})(),()=>{w.current&&(k.log(" [CHAT] Cleaning up realtime subscription"),Y.removeChannel(w.current),w.current=null)}),[e,N]),p.useEffect(()=>{A()},[t]),p.useEffect(()=>{if(!u)return;(async()=>{try{const M=!!localStorage.getItem("childSession"),U=M?u.id:e;if(!U){k.log(" [CHAT READ] No targetChildId, skipping mark as read");return}k.log(" [CHAT READ] Starting mark as read process",{targetChildId:U,isChild:M,timestamp:new Date().toISOString()});let D=Y.from("messages").select("id, sender_type, read_at").eq("child_id",U).is("read_at",null);M?D=D.eq("sender_type","parent"):D=D.eq("sender_type","child");const{data:B,error:z}=await D;if(z){k.error(" [CHAT READ] Error fetching unread messages:",Ge(z));return}if(!B||B.length===0){k.log(" [CHAT READ] No unread messages found"),tt.getState().clearUnreadForChild(U);return}const q=B.map($=>$.id);k.log(` [CHAT READ] Found ${q.length} unread messages to mark as read`,{messageIds:q.slice(0,5),totalCount:q.length});const H=new Date().toISOString(),{error:Q}=await Y.from("messages").update({read_at:H}).in("id",q);if(Q){k.error(" [CHAT READ] Error marking messages as read:",Ge(Q));return}k.log(` [CHAT READ] Successfully marked ${q.length} messages as read`,{readAt:H}),n($=>$.map(O=>q.includes(O.id)?{...O,read_at:H}:O)),tt.getState().clearUnreadForChild(U),k.log(` [CHAT READ] Badge cleared immediately for child ${U}`)}catch(Z){k.error(" [CHAT READ] Error in markMessagesAsRead:",Ge(Z))}})()},[u,e]),p.useEffect(()=>()=>{const M=!!localStorage.getItem("childSession")?u?.id||null:e;M&&(k.log(" [CHAT CLEANUP] Clearing badge on chat exit",{targetChildId:M}),tt.getState().clearUnreadForChild(M))},[u,e]),p.useEffect(()=>{if(!u)return;const L=l?u.id:e;if(!L)return;const Z=setInterval(async()=>{try{const{data:M,error:U}=await Y.from("messages").select("*").eq("child_id",L).order("created_at",{ascending:!0});!U&&M&&n(D=>{const B=new Set(D.map(q=>q.id)),z=M.filter(q=>!B.has(q.id));return z.length>0?(k.log(" [CHAT] Polling found new messages:",z.length),[...D,...z]):D})}catch(M){k.error(" [CHAT] Polling error:",Ge(M))}},15e3);return()=>clearInterval(Z)},[u,e,l]);const j=async L=>{const{data:Z}=await Y.from("children").select("*").eq("id",L).single();Z&&h(Z)},T=async L=>{const{data:Z,error:M}=await Y.from("messages").select("*").eq("child_id",L).order("created_at",{ascending:!0});if(M){_({title:"Error loading messages",description:M.message,variant:"destructive"});return}n(Z||[])},R=async L=>{if(L.preventDefault(),!(!s.trim()||!u)){b(!0);try{const Z=l?u.id:e;let M,U;if(l)M=u.id,U=void 0;else{const{data:{user:q},error:H}=await Y.auth.getUser();if(H||!q)throw new Error("Not authenticated. Please log in again.");M=q.id,U=q.id}if(!M)throw new Error("Missing sender_id");if(!Z)throw new Error("Missing child_id");const D={child_id:Z,sender_id:M,sender_type:l?"child":"parent",content:s.trim()};k.log(" [MESSAGE INSERT] Payload:",{child_id:D.child_id,sender_id:D.sender_id,sender_type:D.sender_type,content_length:D.content.length,isChild:l,auth_uid:U,sender_id_matches_auth_uid:l?"N/A (anon)":M===U});const{data:B,error:z}=await Y.from("messages").insert(D).select().single();if(z)throw k.error(" [MESSAGE INSERT] Error:",{message:z.message,code:z.code,details:z.details?Mt(z.details):void 0,hint:z.hint,payload_metadata:{child_id:D.child_id,sender_type:D.sender_type,content_length:D.content.length}}),z;if(k.log(" [MESSAGE INSERT] Success",{messageId:B?.id}),B){const q={id:B.id,sender_type:B.sender_type,content:B.content,created_at:B.created_at};n(H=>H.some($=>$.id===q.id)?(k.log(" [MESSAGE INSERT] Message already in state (realtime beat us), skipping optimistic update"),H):(k.log(" [MESSAGE INSERT] Adding message to local state (optimistic update)"),[...H,q]))}o("")}catch(Z){k.error(" [MESSAGE INSERT] Exception:",Ge(Z)),_({title:"Error sending message",description:Z.message||"Failed to send message",variant:"destructive"})}finally{b(!1)}}},A=()=>{C.current?.scrollIntoView({behavior:"smooth"})},I=()=>{N(l?"/child/dashboard":"/parent/children")};return i.jsxs("div",{className:"min-h-[100dvh] flex flex-col bg-background relative",children:[i.jsxs("div",{className:"bg-chat-accent p-4 flex items-center gap-4 fixed top-0 left-0 right-0 z-10",children:[i.jsx(de,{onClick:I,variant:"ghost",size:"sm",className:"text-white",children:i.jsx(Nx,{className:"h-5 w-5"})}),i.jsxs("div",{className:"flex items-center gap-3",children:[l?f&&i.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold bg-primary",children:f.name[0].toUpperCase()}):u&&i.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold",style:{backgroundColor:u.avatar_color},children:u.name[0]}),i.jsx("h1",{className:"text-xl font-bold text-white",children:l?x:u?.name})]})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",style:{paddingTop:"80px",paddingBottom:"100px"},children:[t.map(L=>{const Z=l?L.sender_type==="child":L.sender_type==="parent";return i.jsx("div",{className:`flex ${Z?"justify-end":"justify-start"}`,children:i.jsxs(Ae,{className:`max-w-xs p-3 ${Z?"bg-chat-accent text-chat-accent-foreground":"bg-muted"}`,children:[i.jsx("p",{className:"break-words",children:L.content}),i.jsx("p",{className:`text-xs mt-1 ${Z?"text-white/70":"text-muted-foreground"}`,children:new Date(L.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},L.id)}),i.jsx("div",{ref:C})]}),i.jsx("form",{onSubmit:R,className:"p-4 bg-card border-t fixed bottom-0 left-0 right-0 z-10",children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(vr,{value:s,onChange:L=>o(L.target.value),placeholder:"Type a message...",disabled:v,className:"flex-1"}),i.jsx(de,{type:"submit",disabled:v||!s.trim(),className:"bg-chat-accent text-chat-accent-foreground hover:bg-chat-accent/90",children:i.jsx(Dj,{className:"h-4 w-4"})})]})})]})};var B3="Separator",Hw="horizontal",z3=["horizontal","vertical"],s_=p.forwardRef((e,t)=>{const{decorative:n,orientation:s=Hw,...o}=e,l=H3(s)?s:Hw,u=n?{role:"none"}:{"aria-orientation":l==="vertical"?l:void 0,role:"separator"};return i.jsx(Me.div,{"data-orientation":l,...u,...o,ref:t})});s_.displayName=B3;function H3(e){return z3.includes(e)}var a_=s_;const yt=p.forwardRef(({className:e,orientation:t="horizontal",decorative:n=!0,...s},o)=>i.jsx(a_,{ref:o,decorative:n,orientation:t,className:Ce("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...s}));yt.displayName=a_.displayName;const V3=Hm,q3=bC,W3=Vm,i_=p.forwardRef(({className:e,...t},n)=>i.jsx(Io,{className:Ce("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));i_.displayName=Io.displayName;const G3=nd("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),o_=p.forwardRef(({side:e="right",className:t,children:n,...s},o)=>i.jsxs(W3,{children:[i.jsx(i_,{}),i.jsxs(Do,{ref:o,className:Ce(G3({side:e}),t),...s,children:[n,i.jsxs(Cd,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[i.jsx(Or,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));o_.displayName=Do.displayName;const l_=({className:e,...t})=>i.jsx("div",{className:Ce("flex flex-col space-y-2 text-center sm:text-left",e),...t});l_.displayName="SheetHeader";const c_=p.forwardRef(({className:e,...t},n)=>i.jsx(Oo,{ref:n,className:Ce("text-lg font-semibold text-foreground",e),...t}));c_.displayName=Oo.displayName;const K3=p.forwardRef(({className:e,...t},n)=>i.jsx(Lo,{ref:n,className:Ce("text-sm text-muted-foreground",e),...t}));K3.displayName=Lo.displayName;const Y3=()=>{const e=rt();bn();const[t,n]=p.useState(!1),[s,o]=p.useState(!1),[l,c]=p.useState(null),[u,h]=p.useState(!0);p.useEffect(()=>{(async()=>{try{const{data:{session:C}}=await Y.auth.getSession(),w=localStorage.getItem("childSession");if(C)c("parent");else if(w)try{JSON.parse(w),c("child")}catch{c(null)}else c(null)}catch(C){k.error("Error determining user type:",Ge(C)),c(null)}finally{h(!1)}})()},[]);const f=()=>l==="parent"?"/parent":l==="child"?"/child":"/",g=p.useMemo(()=>l==="parent",[l]);p.useEffect(()=>{const S=()=>{const C=window.scrollY;n(C>300)};return window.addEventListener("scroll",S),()=>window.removeEventListener("scroll",S)},[]);const v=S=>{const C=document.getElementById(S);C&&(C.scrollIntoView({behavior:"smooth",block:"start"}),o(!1))},b=()=>{window.scrollTo({top:0,behavior:"smooth"})},x=[{id:"description",label:"App Description"},{id:"pricing",label:"Pricing & Subscription"},{id:"terms",label:"Terms & Conditions"},{id:"privacy",label:"Privacy Policy"},{id:"security",label:"Security & Safety"},{id:"cancel",label:"Cancellation Policy"},{id:"removal",label:"Personal Information Removal"},{id:"contact",label:"Contact & Support"},{id:"demo",label:"Demo / Test Account"}];return i.jsxs("div",{className:"min-h-[100dvh] bg-background w-full overflow-x-hidden",children:[i.jsx(Ft,{}),i.jsx("div",{className:"px-4 pb-8",style:{paddingTop:"calc(0.5rem + 64px + var(--safe-area-inset-top) * 0.15)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsx("div",{className:"mt-4 mb-8",children:i.jsxs("div",{className:"flex items-start justify-between gap-4 mb-4",children:[i.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[i.jsx("div",{className:"flex-shrink-0",children:i.jsx("img",{src:"/icon-192x192.png",alt:"Kids Call Home",className:"w-16 h-16 rounded-xl shadow-md",width:"64",height:"64"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx(Rc,{className:"h-6 w-6 flex-shrink-0"}),i.jsx("h1",{className:"text-3xl font-bold",children:"App Information"})]}),i.jsx("p",{className:"text-muted-foreground",children:"Important information about Kids Call Home"})]})]}),!u&&i.jsxs(de,{onClick:()=>e(f()),variant:"default",size:"lg",className:"flex-shrink-0 shadow-md",children:[i.jsx(Nx,{className:"h-4 w-4 mr-2"}),i.jsx("span",{className:"hidden sm:inline",children:l==="parent"?"Back to Parent Home":l==="child"?"Back to Kid Home":"Back to App"}),i.jsx(Xs,{className:"h-4 w-4 sm:hidden"})]})]})}),i.jsx(Ae,{className:"p-4 mb-6 sticky top-4 z-10 bg-background/95 backdrop-blur-sm",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>v("description"),children:"Description"}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>v("pricing"),children:"Pricing"}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>v("terms"),children:"Terms"}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>v("privacy"),children:"Privacy"}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>v("security"),children:"Security"}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>v("cancel"),children:"Cancellation"}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>v("removal"),children:"Data Removal"}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>v("contact"),children:"Contact"})]})}),i.jsx("section",{id:"description",className:"mb-8 scroll-mt-20",children:i.jsxs(Ae,{className:"p-6",children:[i.jsxs("h2",{className:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(Rc,{className:"h-5 w-5"}),"App Description"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Short Description"}),i.jsx("p",{className:"text-muted-foreground",children:"Stay connected with your family through simple video calls and messaging."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Full Description"}),i.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"Kids Call Home is a family communication app that enables secure video calls and messaging between parents and children. Parents can create accounts and manage their children's access, while kids can easily call and message their parents using a special login code. The app works on WiFi-only devices (no SIM card required) and also supports devices with cellular data (LTE, 3G, 4G, 5G). Perfect for tablets, Chromebooks, and mobile devices."})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Key Features"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground",children:[i.jsx("li",{children:"Video calls between parents and children"}),i.jsx("li",{children:"Secure messaging"}),i.jsx("li",{children:"Simple login codes for kids"}),i.jsx("li",{children:"Parent account management"}),i.jsx("li",{children:"Real-time notifications"}),i.jsx("li",{children:"Mobile-friendly interface"}),i.jsx("li",{children:"Progressive Web App (PWA)"}),i.jsx("li",{children:"Works without SIM card or phone number"}),i.jsx("li",{children:"Low-bandwidth optimization"})]})]})]})]})}),i.jsx("section",{id:"pricing",className:"mb-8 scroll-mt-20",children:i.jsxs(Ae,{className:"p-6",children:[i.jsxs("h2",{className:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(Cj,{className:"h-5 w-5"}),"Pricing & Subscription Terms"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-primary/10 p-4 rounded-lg border border-primary/20",children:[i.jsx("p",{className:"font-semibold text-primary mb-2",children:"Free Tier Available"}),i.jsx("p",{className:"text-muted-foreground",children:"The app allows 1 parent and 1 child account for free. Charges apply for each additional child account."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-3",children:"Subscription Plans"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"border rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h4",{className:"font-medium",children:"Additional Kid Monthly"}),i.jsx("span",{className:"text-lg font-bold",children:"$2.99/month"})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Add one more child to your account"})]}),i.jsxs("div",{className:"border rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h4",{className:"font-medium",children:"Additional Kid Annual"}),i.jsx("span",{className:"text-lg font-bold",children:"$29.99/year"})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Add one more child (save 17% vs monthly)"})]}),i.jsxs("div",{className:"border rounded-lg p-4 border-primary/50",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h4",{className:"font-medium",children:"Family Bundle Monthly"}),i.jsx(Ac,{className:"h-4 w-4 text-primary"})]}),i.jsx("span",{className:"text-lg font-bold",children:"$14.99/month"})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Perfect for families with up to 5 kids"})]}),i.jsxs("div",{className:"border-2 border-primary rounded-lg p-4 bg-primary/5",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h4",{className:"font-medium",children:"Annual Family Plan"}),i.jsx(Ac,{className:"h-4 w-4 text-primary"}),i.jsx("span",{className:"text-xs bg-primary text-primary-foreground px-2 py-0.5 rounded",children:"Best Value"})]}),i.jsx("span",{className:"text-lg font-bold",children:"$99/year"})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Best value - unlimited kids for the whole family"})]})]})]}),g&&i.jsx("div",{className:"pt-4",children:i.jsxs(de,{onClick:()=>e("/parent/upgrade"),className:"w-full sm:w-auto",children:["View Full Pricing Details",i.jsx(Pc,{className:"ml-2 h-4 w-4"})]})})]})]})}),i.jsx("section",{id:"terms",className:"mb-8 scroll-mt-20",children:i.jsxs(Ae,{className:"p-6",children:[i.jsxs("h2",{className:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(Sj,{className:"h-5 w-5"}),"Terms & Conditions"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("p",{className:"text-muted-foreground",children:"By using Kids Call Home, you agree to the following terms and conditions:"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Account Responsibility"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Parents are responsible for maintaining the security of their account and managing their children's access. You must provide accurate information when creating an account."})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Acceptable Use"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"The app is intended for family communication only. Users must not use the service for any illegal, harmful, or unauthorized purposes. Harassment, abuse, or inappropriate content is strictly prohibited."})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Service Availability"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"We strive to maintain service availability but do not guarantee uninterrupted access. The service may be temporarily unavailable due to maintenance, updates, or technical issues."})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Age Requirements"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Parents must be at least 18 years old to create an account. Children's accounts are managed by their parents."})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Limitation of Liability"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:'Kids Call Home is provided "as is" without warranties. We are not liable for any damages arising from use of the service, including but not limited to communication failures or data loss.'})]})]}),i.jsx("div",{className:"pt-4 border-t",children:i.jsx("p",{className:"text-xs text-muted-foreground",children:"These terms may be updated from time to time. Continued use of the service constitutes acceptance of updated terms."})})]})]})}),i.jsx("section",{id:"privacy",className:"mb-8 scroll-mt-20",children:i.jsxs(Ae,{className:"p-6",children:[i.jsxs("h2",{className:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(lo,{className:"h-5 w-5"}),"Privacy Policy"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Data Collection"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Kids Call Home collects the following information:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"Account information (email, name) for parent accounts"}),i.jsx("li",{children:"Child profile information (name, login code) managed by parents"}),i.jsx("li",{children:"Device information for security and device management"}),i.jsx("li",{children:"Call and message data for service functionality"})]})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Data Usage"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"We use collected data solely to provide and improve the service. Data is not sold to third parties. We use industry-standard security measures to protect your information."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Data Storage"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Data is stored securely using Supabase (PostgreSQL database) with encryption at rest. Video calls use WebRTC peer-to-peer connections when possible, minimizing data transmission through our servers."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Children's Privacy"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"We comply with COPPA (Children's Online Privacy Protection Act). All children's accounts are created and managed by parents. We do not knowingly collect personal information from children without parental consent."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Data Queries & Requests"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"For questions about your data or to request access, correction, or deletion, please contact us at:"}),i.jsx("div",{className:"bg-muted p-3 rounded-lg",children:i.jsx("p",{className:"font-mono text-sm",children:"support@kidscallhome.com"})})]})]})]})}),i.jsx("section",{id:"security",className:"mb-8 scroll-mt-20",children:i.jsxs(Ae,{className:"p-6",children:[i.jsxs("h2",{className:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(lo,{className:"h-5 w-5"}),"Security & Safety"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-primary/10 p-4 rounded-lg border border-primary/20",children:[i.jsx("p",{className:"font-semibold text-primary mb-2",children:"Your Family's Security is Our Priority"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"We implement multiple layers of security to protect your family's data and communications."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Password Security"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"We enforce strong password requirements to protect your account:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"Minimum 8 characters in length"}),i.jsx("li",{children:"Must include uppercase and lowercase letters"}),i.jsx("li",{children:"Must include numbers and special characters"}),i.jsx("li",{children:"Passwords are checked against known data breaches"}),i.jsx("li",{children:"Common weak passwords are automatically rejected"})]}),i.jsx("p",{className:"text-sm text-muted-foreground mt-3",children:"Your password is never stored in plain text. We use industry-standard encryption (bcrypt) to securely hash and store passwords."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Account Protection"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Multiple security measures protect against unauthorized access:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"Rate limiting prevents brute force attacks"}),i.jsx("li",{children:"Automatic account lockout after multiple failed login attempts"}),i.jsx("li",{children:"CAPTCHA verification for suspicious activity"}),i.jsx("li",{children:"Email breach checking alerts you if your email was compromised elsewhere"}),i.jsx("li",{children:"Secure authentication using Supabase (enterprise-grade security)"})]})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Data Encryption"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"All your data is protected with encryption:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"Data at rest: Encrypted in our secure database (Supabase/PostgreSQL)"}),i.jsx("li",{children:"Data in transit: All communications use HTTPS/TLS encryption"}),i.jsx("li",{children:"Video calls: Use WebRTC peer-to-peer encryption when possible"}),i.jsx("li",{children:"Messages: Encrypted during transmission"})]})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Secure Communication"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Video calls use WebRTC technology, which establishes direct, encrypted connections between devices when possible. This means your video calls can go directly from your device to your child's device without passing through our servers, providing maximum privacy and security."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Access Control"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Strict access controls ensure only authorized users can access accounts:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"Parents control all child account access"}),i.jsx("li",{children:"Children use secure login codes (not passwords)"}),i.jsx("li",{children:"Device authorization required for new devices"}),i.jsx("li",{children:"Parents can view and manage all authorized devices"}),i.jsx("li",{children:"Row-level security ensures data isolation between families"})]})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"What You Can Do"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Help keep your account secure:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"Use a strong, unique password (don't reuse passwords from other sites)"}),i.jsx("li",{children:"Keep your login codes private and don't share them"}),i.jsx("li",{children:"Regularly review authorized devices in Account Settings"}),i.jsx("li",{children:"If you receive a breach warning, change your password immediately"}),i.jsx("li",{children:"Contact support immediately if you suspect unauthorized access"})]})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Children's Safety"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"All children's accounts are created and managed by parents. Children can only communicate with authorized parent accounts. We do not allow children to communicate with strangers or create accounts independently. All communication is between family members only."})]}),i.jsx("div",{className:"pt-4 border-t",children:i.jsxs("p",{className:"text-xs text-muted-foreground",children:["Security is an ongoing priority. We regularly update our security measures and monitor for threats. If you have security concerns, please contact us at"," ",i.jsx("a",{href:"mailto:support@kidscallhome.com",className:"text-primary hover:underline",children:"support@kidscallhome.com"}),"."]})})]})]})}),i.jsx("section",{id:"cancel",className:"mb-8 scroll-mt-20",children:i.jsxs(Ae,{className:"p-6",children:[i.jsxs("h2",{className:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(wj,{className:"h-5 w-5"}),"Cancellation Policy"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"How to Cancel Subscription"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"You can cancel your subscription at any time through your Account Settings:"}),i.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"Navigate to Account Settings (accessible from the main menu)"}),i.jsx("li",{children:"Find the Subscription section"}),i.jsx("li",{children:'Click "Cancel Subscription"'}),i.jsx("li",{children:"Confirm the cancellation"})]}),g&&i.jsx("div",{className:"mt-4",children:i.jsxs(de,{variant:"outline",onClick:()=>e("/parent/settings"),className:"w-full sm:w-auto",children:["Go to Account Settings",i.jsx(Pc,{className:"ml-2 h-4 w-4"})]})})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Access After Cancellation"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"When you cancel your subscription, you will continue to have access to all premium features until the end of your current billing period. After expiration, your account will automatically revert to the free tier (1 child limit). Existing children can still use the app, but you won't be able to add more children until you resubscribe."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Refund Policy"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Subscriptions are billed in advance. Refunds are not available for partial billing periods. If you cancel during a billing period, you retain access until the period ends without additional charges."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Account Deletion"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["To delete your account completely, please contact support at"," ",i.jsx("a",{href:"mailto:support@kidscallhome.com",className:"text-primary hover:underline",children:"support@kidscallhome.com"}),". Account deletion will permanently remove all your data, including children's accounts, messages, and call history."]})]})]})]})}),i.jsx("section",{id:"removal",className:"mb-8 scroll-mt-20",children:i.jsxs(Ae,{className:"p-6",children:[i.jsxs("h2",{className:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(rm,{className:"h-5 w-5"}),"Personal Information Removal"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Requesting Data Deletion"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"You can request deletion of your personal information and account data in the following ways:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-2 text-sm text-muted-foreground ml-4",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Email Request:"})," Send an email to"," ",i.jsx("a",{href:"mailto:support@kidscallhome.com",className:"text-primary hover:underline",children:"support@kidscallhome.com"})," ",'with the subject "Account Deletion Request" and include your account email address.']}),i.jsxs("li",{children:[i.jsx("strong",{children:"In-App Request:"})," Contact support through the app's support section (see Contact & Support below)."]})]})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"What Gets Deleted"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"When you request account deletion, the following data will be permanently removed:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"Parent account information (email, name, profile data)"}),i.jsx("li",{children:"All children's accounts associated with your parent account"}),i.jsx("li",{children:"All messages and call history"}),i.jsx("li",{children:"Device registration information"}),i.jsx("li",{children:"Subscription and payment information (after required retention period)"})]})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Response Time"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["We typically process deletion requests within"," ",i.jsx("strong",{children:"7-14 business days"}),". You will receive a confirmation email once your data has been deleted. Some data may be retained for legal or regulatory compliance purposes for a limited time, but will not be used for service purposes."]})]}),i.jsx(yt,{}),i.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[i.jsx("p",{className:"text-sm font-semibold mb-1",children:"Important Note"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Account deletion is permanent and cannot be undone. Make sure you want to delete your account before submitting a request."})]})]})]})}),i.jsx("section",{id:"contact",className:"mb-8 scroll-mt-20",children:i.jsxs(Ae,{className:"p-6",children:[i.jsxs("h2",{className:"text-2xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(_j,{className:"h-5 w-5"}),"Contact & Support"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Support Email"}),i.jsx("div",{className:"bg-muted p-4 rounded-lg mb-3",children:i.jsx("p",{className:"font-mono text-base",children:"support@kidscallhome.com"})}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"For technical support, account questions, billing inquiries, or data deletion requests, please email us at the address above. We aim to respond within 24-48 hours."})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"What to Include in Support Emails"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground ml-4",children:[i.jsx("li",{children:"Your account email address"}),i.jsx("li",{children:"Description of the issue or request"}),i.jsx("li",{children:"Device type and browser/app version (if reporting a technical issue)"}),i.jsx("li",{children:"Screenshots (if applicable)"})]})]}),i.jsx(yt,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Common Support Topics"}),i.jsxs("div",{className:"grid sm:grid-cols-2 gap-2 text-sm text-muted-foreground",children:[i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(er,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Account setup and login issues"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(er,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Subscription and billing questions"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(er,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Video call connection problems"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(er,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Data deletion requests"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(er,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Privacy and security concerns"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(er,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Feature requests and feedback"})]})]})]})]})]})}),i.jsx("section",{id:"demo",className:"mb-8 scroll-mt-20",children:i.jsxs(Ae,{className:"p-6 border-dashed",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Demo / Test Account"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"For app store reviewers: The app requires account creation to use. You can create a free parent account and add one child account at no cost. For testing premium features, please contact support for test account credentials."}),i.jsx("div",{className:"bg-muted p-4 rounded-lg",children:i.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.jsx("strong",{children:"Note:"})," Test account information is available upon request for app store review purposes. Please contact"," ",i.jsx("a",{href:"mailto:support@kidscallhome.com",className:"text-primary hover:underline",children:"support@kidscallhome.com"})," ","with your review request."]})})]})]})}),i.jsx("div",{className:"text-center pt-8",children:i.jsx(de,{variant:"outline",onClick:b,children:"Back to Top"})})]})}),t&&i.jsxs("div",{className:"fixed right-6 z-50 flex flex-col gap-2",style:{bottom:"calc(1.5rem + var(--safe-area-inset-bottom))"},children:[!u&&i.jsx(de,{onClick:()=>e(f()),size:"lg",className:"h-14 w-14 rounded-full shadow-lg","aria-label":"Back to App",title:l==="parent"?"Back to Parent Home":l==="child"?"Back to Kid Home":"Back to App",children:i.jsx(Xs,{className:"h-6 w-6"})}),i.jsxs(V3,{open:s,onOpenChange:o,children:[i.jsx(q3,{asChild:!0,children:i.jsx(de,{size:"lg",className:"h-14 w-14 rounded-full shadow-lg","aria-label":"Open navigation menu",children:i.jsx(Nj,{className:"h-6 w-6"})})}),i.jsxs(o_,{side:"right",className:"w-80",children:[i.jsx(l_,{children:i.jsx(c_,{children:"Navigate to Section"})}),i.jsxs("div",{className:"mt-6 space-y-2",children:[x.map(S=>i.jsx(de,{variant:"ghost",className:"w-full justify-start",onClick:()=>v(S.id),children:S.label},S.id)),i.jsx("div",{className:"pt-4 border-t mt-4",children:i.jsxs(de,{variant:"outline",className:"w-full",onClick:b,children:[i.jsx(jx,{className:"mr-2 h-4 w-4"}),"Back to Top"]})})]})]})]})]})]})};function J3(){p.useEffect(()=>{let e=!0;return(async()=>{try{const n=Mo();e&&(Object.keys(n.unreadMessagesByChild).length>0||Object.keys(n.missedCallsByChild).length>0)&&(console.log(" [BADGE INIT] Loading cached badge state from local storage"),tt.getState().setInitialUnread(n.unreadMessagesByChild),tt.getState().setInitialMissed(n.missedCallsByChild));const s=localStorage.getItem("childSession");if(!!s){const c=JSON.parse(s).id,u=Ba(c,"messages"),h=Ba(c,"calls");let f=Y.from("messages").select("child_id, created_at").eq("child_id",c).eq("sender_type","parent").is("read_at",null);u&&(f=f.gt("created_at",u));const{data:g,error:v}=await f;if(v)throw v;let b=Y.from("calls").select("child_id, created_at").eq("child_id",c).eq("caller_type","parent").eq("missed_call",!0).is("missed_call_read_at",null);h&&(b=b.gt("created_at",h));const{data:x,error:S}=await b;if(S)throw S;if(e){const C=g?.length??0,w=x?.length??0;console.log(` [BADGE INIT] Child ${c}: ${C} new unread messages, ${w} new missed calls`,{lastClearedMessages:u,lastClearedCalls:h}),tt.getState().setInitialUnread({[c]:C}),tt.getState().setInitialMissed({[c]:w})}}else{const{data:{user:l}}=await Y.auth.getUser();if(!l)return;const{data:c,error:u}=await Y.from("children").select("id").eq("parent_id",l.id);if(u)throw u;if(!c||c.length===0)return;const h=c.map(v=>v.id),f={},g={};for(const v of h){const b=Ba(v,"messages"),x=Ba(v,"calls");let S=Y.from("messages").select("child_id, created_at").eq("child_id",v).eq("sender_type","child").is("read_at",null);b&&(S=S.gt("created_at",b));const{data:C}=await S;f[v]=C?.length??0;let w=Y.from("calls").select("child_id, created_at").eq("child_id",v).eq("caller_type","child").eq("missed_call",!0).is("missed_call_read_at",null);x&&(w=w.gt("created_at",x));const{data:N}=await w;g[v]=N?.length??0}e&&(console.log(` [BADGE INIT] Parent: loaded badge counts for ${h.length} children`,{unreadByChild:f,missedByChild:g}),tt.getState().setInitialUnread(f),tt.getState().setInitialMissed(g))}}catch(n){console.error("Error fetching initial badge counts:",n)}})(),()=>{e=!1}},[])}function Q3(){const e=p.useRef(null),t=p.useRef(null);return p.useEffect(()=>{const s=!!localStorage.getItem("childSession");return e.current=Y.channel("badge-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},o=>{const l=o.new,c=Ba(l.child_id,"messages");c&&l.created_at<=c||(s?l.sender_type==="parent"&&!l.read_at&&tt.getState().incrementUnread(l.child_id):l.sender_type==="child"&&!l.read_at&&tt.getState().incrementUnread(l.child_id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},o=>{const l=o.old,c=o.new,u=!l.read_at,h=!!c.read_at;u&&h&&(s?l.sender_type==="parent"&&tt.getState().decrementUnread(l.child_id):l.sender_type==="child"&&tt.getState().decrementUnread(l.child_id))}).subscribe((o,l)=>{l?console.error(" [BADGE REALTIME] Messages subscription error:",l):(o==="CHANNEL_ERROR"||o==="TIMED_OUT")&&console.error(" [BADGE REALTIME] Messages subscription failed:",o)}),t.current=Y.channel("badge-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls"},o=>{const l=o.new,c=Ba(l.child_id,"calls");c&&l.created_at<=c||l.missed_call&&!l.missed_call_read_at&&(s?l.caller_type==="parent"&&tt.getState().incrementMissed(l.child_id):l.caller_type==="child"&&tt.getState().incrementMissed(l.child_id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls"},o=>{const l=o.old,c=o.new,u=!l.missed_call_read_at,h=!!c.missed_call_read_at;u&&h&&l.missed_call&&(s?l.caller_type==="parent"&&tt.getState().decrementMissed(l.child_id):l.caller_type==="child"&&tt.getState().decrementMissed(l.child_id)),c.status==="active"&&l.status!=="active"&&(console.log(" [BADGE REALTIME] Call became active - clearing missed call badge",{childId:c.child_id,callerType:c.caller_type}),s?c.caller_type==="parent"&&tt.getState().clearMissedForChild(c.child_id):c.caller_type==="child"&&tt.getState().clearMissedForChild(c.child_id)),!l.missed_call&&c.missed_call&&!c.missed_call_read_at&&(s?c.caller_type==="parent"&&tt.getState().incrementMissed(c.child_id):c.caller_type==="child"&&tt.getState().incrementMissed(c.child_id))}).subscribe((o,l)=>{l?console.error(" [BADGE REALTIME] Calls subscription error:",l):(o==="CHANNEL_ERROR"||o==="TIMED_OUT")&&console.error(" [BADGE REALTIME] Calls subscription failed:",o)}),()=>{e.current&&Y.removeChannel(e.current),t.current&&Y.removeChannel(t.current)}},[]),null}const X3=e=>{const t=new Map;t.set("web",{name:"web"});const n=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t},s=(l,c)=>{n.platforms.set(l,c)},o=l=>{n.platforms.has(l)&&(n.currentPlatform=n.platforms.get(l))};return n.addPlatform=s,n.setPlatform=o,n},Z3=e=>e.CapacitorPlatforms=X3(e),d_=Z3(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});d_.addPlatform;d_.setPlatform;var Xa;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(Xa||(Xa={}));class ef extends Error{constructor(t,n,s){super(t),this.message=t,this.code=n,this.data=s}}const e$=e=>{var t,n;return e?.androidBridge?"android":!((n=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},t$=e=>{var t,n,s,o,l;const c=e.CapacitorCustomPlatform||null,u=e.Capacitor||{},h=u.Plugins=u.Plugins||{},f=e.CapacitorPlatforms,g=()=>c!==null?c.name:e$(e),v=((t=f?.currentPlatform)===null||t===void 0?void 0:t.getPlatform)||g,b=()=>v()!=="web",x=((n=f?.currentPlatform)===null||n===void 0?void 0:n.isNativePlatform)||b,S=I=>{const L=T.get(I);return!!(L?.platforms.has(v())||N(I))},C=((s=f?.currentPlatform)===null||s===void 0?void 0:s.isPluginAvailable)||S,w=I=>{var L;return(L=u.PluginHeaders)===null||L===void 0?void 0:L.find(Z=>Z.name===I)},N=((o=f?.currentPlatform)===null||o===void 0?void 0:o.getPluginHeader)||w,_=I=>e.console.error(I),j=(I,L,Z)=>Promise.reject(`${Z} does not have an implementation of "${L}".`),T=new Map,R=(I,L={})=>{const Z=T.get(I);if(Z)return console.warn(`Capacitor plugin "${I}" already registered. Cannot register plugins twice.`),Z.proxy;const M=v(),U=N(I);let D;const B=async()=>(!D&&M in L?D=typeof L[M]=="function"?D=await L[M]():D=L[M]:c!==null&&!D&&"web"in L&&(D=typeof L.web=="function"?D=await L.web():D=L.web),D),z=(J,F)=>{var ee,ce;if(U){const K=U?.methods.find(W=>F===W.name);if(K)return K.rtype==="promise"?W=>u.nativePromise(I,F.toString(),W):(W,ne)=>u.nativeCallback(I,F.toString(),W,ne);if(J)return(ee=J[F])===null||ee===void 0?void 0:ee.bind(J)}else{if(J)return(ce=J[F])===null||ce===void 0?void 0:ce.bind(J);throw new ef(`"${I}" plugin is not implemented on ${M}`,Xa.Unimplemented)}},q=J=>{let F;const ee=(...ce)=>{const K=B().then(W=>{const ne=z(W,J);if(ne){const G=ne(...ce);return F=G?.remove,G}else throw new ef(`"${I}.${J}()" is not implemented on ${M}`,Xa.Unimplemented)});return J==="addListener"&&(K.remove=async()=>F()),K};return ee.toString=()=>`${J.toString()}() { [capacitor code] }`,Object.defineProperty(ee,"name",{value:J,writable:!1,configurable:!1}),ee},H=q("addListener"),Q=q("removeListener"),$=(J,F)=>{const ee=H({eventName:J},F),ce=async()=>{const W=await ee;Q({eventName:J,callbackId:W},F)},K=new Promise(W=>ee.then(()=>W({remove:ce})));return K.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await ce()},K},O=new Proxy({},{get(J,F){switch(F){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return U?$:H;case"removeListener":return Q;default:return q(F)}}});return h[I]=O,T.set(I,{name:I,proxy:O,platforms:new Set([...Object.keys(L),...U?[M]:[]])}),O},A=((l=f?.currentPlatform)===null||l===void 0?void 0:l.registerPlugin)||R;return u.convertFileSrc||(u.convertFileSrc=I=>I),u.getPlatform=v,u.handleError=_,u.isNativePlatform=x,u.isPluginAvailable=C,u.pluginMethodNoop=j,u.registerPlugin=A,u.Exception=ef,u.DEBUG=!!u.DEBUG,u.isLoggingEnabled=!!u.isLoggingEnabled,u.platform=u.getPlatform(),u.isNative=u.isNativePlatform(),u},n$=e=>e.Capacitor=t$(e),Za=n$(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),di=Za.registerPlugin;Za.Plugins;class u_{constructor(t){this.listeners={},this.retainedEventArguments={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,n){let s=!1;this.listeners[t]||(this.listeners[t]=[],s=!0),this.listeners[t].push(n);const l=this.windowListeners[t];l&&!l.registered&&this.addWindowListener(l),s&&this.sendRetainedArgumentsForEvent(t);const c=async()=>this.removeListener(t,n);return Promise.resolve({remove:c})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,s){const o=this.listeners[t];if(!o){if(s){let l=this.retainedEventArguments[t];l||(l=[]),l.push(n),this.retainedEventArguments[t]=l}return}o.forEach(l=>l(n))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:s=>{this.notifyListeners(n,s)}}}unimplemented(t="not implemented"){return new Za.Exception(t,Xa.Unimplemented)}unavailable(t="not available"){return new Za.Exception(t,Xa.Unavailable)}async removeListener(t,n){const s=this.listeners[t];if(!s)return;const o=s.indexOf(n);this.listeners[t].splice(o,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(s=>{this.notifyListeners(t,s)}))}}const Vw=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),qw=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class r$ extends u_{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(s=>{if(s.length<=0)return;let[o,l]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");o=qw(o).trim(),l=qw(l).trim(),n[o]=l}),n}async setCookie(t){try{const n=Vw(t.key),s=Vw(t.value),o=`; expires=${(t.expires||"").replace("expires=","")}`,l=(t.path||"/").replace("path=",""),c=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${s||""}${o}; path=${l}; ${c};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}di("CapacitorCookies",{web:()=>new r$});const s$=async e=>new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{const o=s.result;t(o.indexOf(",")>=0?o.split(",")[1]:o)},s.onerror=o=>n(o),s.readAsDataURL(e)}),a$=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(o=>o.toLocaleLowerCase()).reduce((o,l,c)=>(o[l]=e[t[c]],o),{})},i$=(e,t=!0)=>e?Object.entries(e).reduce((s,o)=>{const[l,c]=o;let u,h;return Array.isArray(c)?(h="",c.forEach(f=>{u=t?encodeURIComponent(f):f,h+=`${l}=${u}&`}),h.slice(0,-1)):(u=t?encodeURIComponent(c):c,h=`${l}=${u}`),`${s}&${h}`},"").substr(1):null,o$=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=a$(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const l=new URLSearchParams;for(const[c,u]of Object.entries(e.data||{}))l.set(c,u);n.body=l.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const l=new FormData;if(e.data instanceof FormData)e.data.forEach((u,h)=>{l.append(h,u)});else for(const u of Object.keys(e.data))l.append(u,e.data[u]);n.body=l;const c=new Headers(n.headers);c.delete("content-type"),n.headers=c}else(o.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class l$ extends u_{async request(t){const n=o$(t,t.webFetchExtra),s=i$(t.params,t.shouldEncodeUrlParams),o=s?`${t.url}?${s}`:t.url,l=await fetch(o,n),c=l.headers.get("content-type")||"";let{responseType:u="text"}=l.ok?t:{};c.includes("application/json")&&(u="json");let h,f;switch(u){case"arraybuffer":case"blob":f=await l.blob(),h=await s$(f);break;case"json":h=await l.json();break;case"document":case"text":default:h=await l.text()}const g={};return l.headers.forEach((v,b)=>{g[b]=v}),{data:h,headers:g,status:l.status,url:l.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}di("CapacitorHttp",{web:()=>new l$});const c$=di("App",{web:()=>xr(()=>import("./web-tIoVA2s0.js"),[]).then(e=>new e.AppWeb)});var Gf;(function(e){e.Heavy="HEAVY",e.Medium="MEDIUM",e.Light="LIGHT"})(Gf||(Gf={}));var Ww;(function(e){e.Success="SUCCESS",e.Warning="WARNING",e.Error="ERROR"})(Ww||(Ww={}));const d$=di("Haptics",{web:()=>xr(()=>import("./web-CEMNr5M1.js"),[]).then(e=>new e.HapticsWeb)}),ps=di("PushNotifications",{});var Gw;(function(e){e[e.Sunday=1]="Sunday",e[e.Monday=2]="Monday",e[e.Tuesday=3]="Tuesday",e[e.Wednesday=4]="Wednesday",e[e.Thursday=5]="Thursday",e[e.Friday=6]="Friday",e[e.Saturday=7]="Saturday"})(Gw||(Gw={}));const h_=di("LocalNotifications",{web:()=>xr(()=>import("./web-Q-DxQgdI.js"),[]).then(e=>new e.LocalNotificationsWeb)});function ap(){return Za.getPlatform()==="android"}function Rd(){return Za.isNativePlatform()}async function f_(e=[200,100,200,100,200]){if(ap())try{for(let t=0;t<e.length;t+=2)await d$.impact({style:Gf.Heavy}),e[t+1]&&await new Promise(n=>setTimeout(n,e[t+1]))}catch(t){console.warn("Vibration pattern not available:",t)}}async function m_(){if(!Rd())return!1;try{return(await ps.requestPermissions()).receive==="granted"}catch(e){return console.error("Failed to request push notification permission:",e),!1}}async function u$(e,t,n,s,o){if(Rd())try{if(!await m_()){console.warn("Push notification permission not granted");return}ps.addListener("registration",c=>{k.log("Push registration success, token: [REDACTED]")}),ps.addListener("registrationError",c=>{console.error("Push registration error:",c)}),ps.addListener("pushNotificationActionPerformed",c=>{const u=c.notification.data;u?.action==="accept"?s():u?.action==="decline"&&o()}),await h_.schedule({notifications:[{title:"Incoming Call",body:`${t} is calling...`,id:parseInt(e.slice(0,8),16)||Date.now(),sound:"default",attachments:void 0,actionTypeId:"INCOMING_CALL",extra:{callId:e,callerName:t,callerId:n,action:"incoming_call"},schedule:{at:new Date(Date.now()+100)}}]}),await f_([200,100,200,100,200])}catch(l){console.error("Failed to show incoming call notification:",l)}}async function h$(e){if(Rd())try{const t=parseInt(e.slice(0,8),16)||Date.now();await h_.cancel({notifications:[{id:t}]})}catch(t){console.error("Failed to cancel notification:",t)}}async function f$(){if(Rd())try{ps.addListener("registration",e=>{k.log(" Push registration success, token: [REDACTED]")}),ps.addListener("registrationError",e=>{console.error(" Push registration error:",e)}),ps.addListener("pushNotificationReceived",e=>{console.log(" Push notification received:",e)}),ps.addListener("pushNotificationActionPerformed",e=>{console.log(" Push notification action performed:",e),e.notification.data?.url}),c$.addListener("appStateChange",({isActive:e})=>{console.log("App state changed. Is active?",e)}),await m_()}catch(e){console.error("Failed to initialize native Android features:",e)}}function m$({callId:e,callerName:t,callerId:n,onAccept:s,onDecline:o,isActive:l}){const c=p.useRef(null),{playRingtone:u,stopRingtone:h}=Zm({enabled:!0,volume:.8});return p.useEffect(()=>!ap()||!l?void 0:(u$(e,t,n,s,o).catch(g=>{console.error("Failed to show native call notification:",g)}),(async()=>{for(;l;)await f_([200,100,200,100,200]),await new Promise(g=>setTimeout(g,2e3))})(),u().catch(g=>{console.error("Failed to play ringtone:",g)}),()=>{c.current&&clearInterval(c.current),h(),h$(e).catch(()=>{})}),[e,t,n,l,s,o,u,h]),null}const p$=()=>{const[e,t]=p.useState(null),n=p.useRef(null),s=p.useRef(null),o=p.useRef(!1),l=rt(),c=bn(),{handleIncomingCall:u,stopIncomingCall:h}=ep({enabled:!0,volume:.7}),f=p.useRef(u);p.useEffect(()=>{n.current=e},[e]),p.useEffect(()=>{f.current=u},[u]),p.useEffect(()=>{let b=null,x=null,S=null;(async()=>{const{data:{session:w}}=await Y.auth.getSession(),N=localStorage.getItem("childSession"),_=!w&&!!N;if(!w&&!N)return;!_&&w?.user?.id&&(S=w.user.id);const j=async A=>{if(A.id!==b&&!c.pathname.startsWith("/call/"))if(b=A.id,_){const{data:I}=await Y.from("parents").select("name").eq("id",A.parent_id).maybeSingle();t({id:A.id,parent_id:A.parent_id,parent_name:I?.name||"Parent"}),f.current({callId:A.id,callerName:I?.name||"Parent",callerId:A.parent_id,url:`/call/${A.child_id}?callId=${A.id}`})}else{const{data:I}=await Y.from("children").select("name, avatar_color").eq("id",A.child_id).single();I&&(t({id:A.id,child_id:A.child_id,child_name:I.name,child_avatar_color:I.avatar_color}),f.current({callId:A.id,callerName:I.name,callerId:A.child_id,url:`/call/${A.child_id}?callId=${A.id}`}))}},T=async()=>{const A=new Date(Date.now()-12e4).toISOString();if(_){const I=JSON.parse(N),{data:L}=await Y.from("calls").select("*").eq("child_id",I.id).eq("caller_type","parent").eq("status","ringing").gte("created_at",A).order("created_at",{ascending:!1}).limit(1);if(L&&L.length>0){const Z=L[0];Z.id!==b&&await j(Z)}}else{if(!S){const{data:{session:L}}=await Y.auth.getSession();if(!L?.user?.id)return;S=L.user.id}const{data:I}=await Y.from("calls").select("*").eq("parent_id",S).eq("caller_type","child").eq("status","ringing").gte("created_at",A).order("created_at",{ascending:!1}).limit(1);if(I&&I.length>0){const L=I[0];L.id!==b&&await j(L)}}},R=async()=>{const A=new Date(Date.now()-6e4).toISOString();if(_){const I=JSON.parse(N),{data:L}=await Y.from("calls").select("*").eq("child_id",I.id).eq("caller_type","parent").eq("status","ringing").gte("created_at",A).order("created_at",{ascending:!1}).limit(1);if(L&&L.length>0){const Z=L[0];Z.id!==b&&await j(Z)}}else{if(!S){const{data:{session:L}}=await Y.auth.getSession();if(!L?.user?.id)return;S=L.user.id}const{data:I}=await Y.from("calls").select("*").eq("parent_id",S).eq("caller_type","child").eq("status","ringing").gte("created_at",A).order("created_at",{ascending:!1}).limit(1);if(I&&I.length>0){const L=I[0];L.id!==b&&await j(L)}}};if(await T(),x=setInterval(R,6e4),_){const A=JSON.parse(N);s.current=Y.channel("global-child-incoming-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:`child_id=eq.${A.id}`},async I=>{const L=I.new;L.caller_type==="parent"&&L.child_id===A.id&&L.status==="ringing"&&await j(L)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`child_id=eq.${A.id}`},async I=>{const L=I.new,Z=I.old;L.caller_type!=="child"&&(n.current&&n.current.id===L.id&&(L.status==="active"||L.status==="ended")&&(t(null),n.current=null),L.caller_type==="parent"&&L.child_id===A.id&&L.status==="ringing"&&Z.status!=="ringing"&&await j(L))}).subscribe()}else{if(!S){const{data:{session:A}}=await Y.auth.getSession();if(!A?.user?.id)return;S=A.user.id}s.current=Y.channel("global-parent-incoming-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"calls",filter:`parent_id=eq.${S}`},async A=>{const I=A.new;I.caller_type==="child"&&I.parent_id===S&&I.status==="ringing"&&await j(I)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"calls",filter:`parent_id=eq.${S}`},async A=>{const I=A.new,L=A.old;I.caller_type!=="parent"&&(n.current&&n.current.id===I.id&&(I.status==="active"||I.status==="ended")&&(t(null),n.current=null),I.caller_type==="child"&&I.parent_id===S&&I.status==="ringing"&&L.status!=="ringing"&&await j(I))}).subscribe()}return()=>{s.current&&Y.removeChannel(s.current),x&&clearInterval(x)}})()},[c.pathname]);const g=()=>{if(e){h(e.id),o.current=!0;const b=e.id;if(e.child_id)l(`/call/${e.child_id}?callId=${b}`);else if(e.parent_id){const x=localStorage.getItem("childSession");if(x){const S=JSON.parse(x);l(`/call/${S.id}?callId=${b}`)}}t(null),setTimeout(()=>{o.current=!1},2e3)}},v=async()=>{if(e){const{data:{session:b}}=await Y.auth.getSession(),x=localStorage.getItem("childSession"),C=!b&&!!x?"child":"parent";try{await ta({callId:e.id,by:C,reason:"declined"})}catch(w){console.error("Error declining call:",w)}h(e.id),t(null)}};return p.useEffect(()=>{!e&&n.current&&h(n.current.id)},[e,h]),e?i.jsxs(i.Fragment,{children:[ap()&&i.jsx(m$,{callId:e.id,callerName:e.child_name||e.parent_name||"Caller",callerId:e.child_id||e.parent_id||"",onAccept:g,onDecline:v,isActive:!!e}),i.jsx(tr,{open:!!e,onOpenChange:b=>{!b&&e&&!o.current&&v()},children:i.jsxs(An,{className:"sm:max-w-md",children:[i.jsxs(Pn,{children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold text-white",style:{backgroundColor:e.child_avatar_color||"#3B82F6"},children:e.child_name?.[0]||""}),i.jsxs("div",{children:[i.jsx(In,{className:"text-xl",children:"Incoming Call"}),i.jsxs("p",{className:"text-base font-normal text-muted-foreground",children:[e.child_name||e.parent_name," is calling..."]})]})]}),i.jsxs("div",{className:"pt-4",children:[i.jsxs(Dn,{className:"sr-only",children:["Incoming call from ",e.child_name||e.parent_name]}),i.jsx("div",{className:"flex items-center justify-center gap-2 text-4xl animate-pulse",children:i.jsx(To,{className:"h-12 w-12"})})]})]}),i.jsxs(Rn,{className:"sm:justify-center gap-2",children:[i.jsx(On,{onClick:v,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Decline"}),i.jsx(yr,{onClick:g,className:"bg-green-600 hover:bg-green-700",children:"Answer"})]})]})})]}):null},g$=()=>{const e=bn(),t=rt(),{toast:n}=_t(),s=p.useRef(null),o=p.useRef(null),l=p.useRef(null);return p.useEffect(()=>{const c=e.pathname.match(/^\/chat\/(.+)$/);l.current=c?c[1]:null},[e.pathname]),p.useEffect(()=>{let c=null,u=null,h=null,f=null,g=0;const v=300*1e3;(async()=>{const{data:{session:x}}=await Y.auth.getSession(),S=localStorage.getItem("childSession");if(!x&&!S)return;const C=!x&&!!S;!C&&x?.user?.id&&(h=x.user.id);const w=async _=>{if(_.id===o.current)return;if(l.current===_.child_id){console.log(" [GLOBAL MESSAGE] User is actively chatting with this child, not showing notification",{childId:_.child_id,activeChat:l.current});return}if(C&&_.sender_type==="child"||!C&&_.sender_type==="parent")return;o.current=_.id;let j="Someone",T=null,R=null;try{if(_.sender_type==="parent"){const{data:L}=await Y.from("parents").select("name").eq("id",_.sender_id).maybeSingle();L?.name?j=L.name:j="Parent",C&&(R="hsl(213, 94%, 68%)")}else{const{data:L}=await Y.from("children").select("name, avatar_color").eq("id",_.sender_id).maybeSingle();L?.name?j=L.name:j="Child",!C&&L?.avatar_color&&(T=L.avatar_color)}}catch(L){console.error("Error fetching sender name:",L)}const A=_.content.length>50?`${_.content.substring(0,50)}...`:_.content,I=C?R?{style:{backgroundColor:R,borderColor:R,color:"#ffffff"},className:"border-2 shadow-lg ring-2 ring-opacity-30 custom-parent-color"}:void 0:T?{style:{backgroundColor:T,borderColor:T,color:"#ffffff"},className:"border-2 shadow-lg ring-2 ring-opacity-30 custom-child-color"}:void 0;n({title:`New message from ${j}`,description:A,variant:void 0,...I,action:i.jsxs(de,{variant:C?"default":"secondary",size:"sm",onClick:()=>{t(`/chat/${_.child_id}`)},className:C?"ml-2 bg-primary hover:bg-primary/90":"ml-2 bg-white/20 hover:bg-white/30 text-white border-white/30",style:!C&&T?{borderColor:"rgba(255,255,255,0.3)"}:void 0,children:[i.jsx(ko,{className:"h-4 w-4 mr-1"}),"Open"]})})},N=async()=>{try{const _=new Date(Date.now()-6e4).toISOString();if(C){const j=JSON.parse(S),{data:T}=await Y.from("messages").select("*").eq("child_id",j.id).eq("sender_type","parent").is("read_at",null).gte("created_at",_).order("created_at",{ascending:!1}).limit(5);if(T&&T.length>0){for(const R of T.reverse())if(R.id!==u&&R.id!==o.current){await w(R),u=R.id;break}}}else{if(!h){const{data:{session:R}}=await Y.auth.getSession();if(!R?.user?.id)return;h=R.user.id}const j=Date.now();if(!f||j-g>v){const{data:R}=await Y.from("children").select("id").eq("parent_id",h);if(!R||R.length===0)return;f=R.map(A=>A.id),g=j}if(!f||f.length===0)return;const{data:T}=await Y.from("messages").select("*").in("child_id",f).eq("sender_type","child").is("read_at",null).gte("created_at",_).order("created_at",{ascending:!1}).limit(5);if(T&&T.length>0){for(const R of T.reverse())if(R.id!==u&&R.id!==o.current){await w(R),u=R.id;break}}}}catch(_){console.error(" [GLOBAL MESSAGE] Polling error:",_)}};if(C){const _=JSON.parse(S);s.current=Y.channel("global-child-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`child_id=eq.${_.id}`},async j=>{const T=j.new;T.sender_type==="parent"&&!T.read_at&&await w(T)}).subscribe((j,T)=>{T?console.error(" [GLOBAL MESSAGE] Child subscription error:",T):(j==="CHANNEL_ERROR"||j==="TIMED_OUT")&&console.error(" [GLOBAL MESSAGE] Child subscription failed:",j)})}else{if(!h){const{data:{session:T}}=await Y.auth.getSession();if(!T?.user?.id)return;h=T.user.id}const{data:_}=await Y.from("children").select("id").eq("parent_id",h);if(!_||_.length===0)return;const j=_.map(T=>T.id);f=j,g=Date.now(),s.current=Y.channel("global-parent-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},async T=>{const R=T.new;R.sender_type==="child"&&!R.read_at&&j.includes(R.child_id)&&await w(R)}).subscribe((T,R)=>{R?console.error(" [GLOBAL MESSAGE] Parent subscription error:",R):(T==="CHANNEL_ERROR"||T==="TIMED_OUT")&&console.error(" [GLOBAL MESSAGE] Parent subscription failed:",T)})}return c=setInterval(N,6e4),setTimeout(N,2e3),()=>{s.current&&Y.removeChannel(s.current),c&&clearInterval(c)}})()},[t,n]),null},v$=()=>{const[e,t]=p.useState(null),[n,s]=p.useState(null),[o,l]=p.useState(null);return p.useEffect(()=>{const c=async()=>{const{data:{session:f}}=await Y.auth.getSession();if(f?.user){s(f.user.id),t(null);const{data:g}=await Y.from("parents").select("name").eq("id",f.user.id).maybeSingle();l(g?.name||null)}else{const g=localStorage.getItem("childSession");if(g)try{const v=JSON.parse(g);t(v),s(null),l(null)}catch(v){console.error(" [GLOBAL PRESENCE] Error parsing child session:",v),t(null),s(null),l(null)}else t(null),s(null),l(null)}};c();const u=f=>{f.key==="childSession"&&c()},{data:{subscription:h}}=Y.auth.onAuthStateChange(()=>{c()});return window.addEventListener("storage",u),()=>{window.removeEventListener("storage",u),h.unsubscribe()}},[]),Qc({userId:e?.id||"",userType:"child",name:e?.name,enabled:!!e}),Qc({userId:n||"",userType:"parent",name:o||void 0,enabled:!!n}),null},tf="kch_cookie_consent",Kw="1.0",y$=()=>{const[e,t]=p.useState(!1),n=rt();p.useEffect(()=>{if(!localStorage.getItem(tf)){const u=setTimeout(()=>{t(!0)},1e3);return()=>clearTimeout(u)}},[]);const s=()=>{localStorage.setItem(tf,JSON.stringify({accepted:!0,version:Kw,timestamp:new Date().toISOString()})),t(!1)},o=()=>{localStorage.setItem(tf,JSON.stringify({accepted:!1,version:Kw,timestamp:new Date().toISOString()})),t(!1)},l=()=>{n("/info#privacy"),t(!1)};return e?i.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4",style:{paddingBottom:"calc(1rem + var(--safe-area-inset-bottom))"},children:i.jsx(Ae,{className:"max-w-4xl mx-auto shadow-lg border-2 p-4 md:p-6",children:i.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx("div",{className:"mt-1",children:i.jsx(lo,{className:"h-5 w-5 text-primary"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("h3",{className:"font-semibold mb-1 flex items-center gap-2",children:[i.jsx(bj,{className:"h-4 w-4"}),"Privacy & Cookie Consent"]}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["We use essential cookies and local storage to provide our service (authentication, preferences). We do not use tracking cookies or third-party analytics. By using this app, you agree to our"," ",i.jsx("button",{onClick:l,className:"text-primary hover:underline font-medium",children:"Privacy Policy"}),"."]})]})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[i.jsx(de,{variant:"outline",size:"sm",onClick:l,className:"w-full sm:w-auto",children:"Learn More"}),i.jsx(de,{size:"sm",onClick:s,className:"w-full sm:w-auto",children:"Accept"}),i.jsx(de,{variant:"ghost",size:"sm",onClick:o,className:"w-full sm:w-auto text-muted-foreground",children:"Decline"})]})]})})}):null},w$=new oP,x$=()=>(J3(),Q3(),null),b$=()=>(p.useEffect(()=>{f$().catch(e=>{console.error("Failed to initialize native Android features:",e)})},[]),null),C$=()=>(p.useEffect(()=>{if(sessionStorage.getItem("clearSessionOnClose")==="true"){const t=()=>{Object.keys(localStorage).filter(l=>l.startsWith("sb-")||l.includes("supabase")).forEach(l=>localStorage.removeItem(l)),Y.auth.signOut().catch(()=>{})},n=()=>{t()},s=()=>{t()};return window.addEventListener("pagehide",n),window.addEventListener("beforeunload",s),()=>{window.removeEventListener("pagehide",n),window.removeEventListener("beforeunload",s)}}},[]),null),S$=()=>i.jsx(BI,{children:i.jsx(cP,{client:w$,children:i.jsxs(MA,{children:[i.jsx(x$,{}),i.jsx(C$,{}),i.jsx(b$,{}),i.jsx(bk,{}),i.jsx(Zk,{}),i.jsx(pR,{className:"w-full overflow-x-hidden",children:i.jsxs(oR,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[i.jsx(p$,{}),i.jsx(g$,{}),i.jsx(v$,{}),i.jsx(y$,{}),i.jsxs(XP,{children:[i.jsx(Ct,{path:"/",element:i.jsx(zI,{})}),i.jsx(Ct,{path:"/parent/auth",element:i.jsx(ED,{})}),i.jsx(Ct,{path:"/parent",element:i.jsx(zM,{})}),i.jsx(Ct,{path:"/parent/children",element:i.jsx(VM,{})}),i.jsx(Ct,{path:"/parent/call/:childId",element:i.jsx(WM,{})}),i.jsx(Ct,{path:"/parent/dashboard",element:i.jsx(BM,{})}),i.jsx(Ct,{path:"/parent/devices",element:i.jsx(E3,{})}),i.jsx(Ct,{path:"/parent/upgrade",element:i.jsx(_3,{})}),i.jsx(Ct,{path:"/parent/settings",element:i.jsx(N3,{})}),i.jsx(Ct,{path:"/child/login",element:i.jsx(A3,{})}),i.jsx(Ct,{path:"/child",element:i.jsx(R3,{})}),i.jsx(Ct,{path:"/child/parents",element:i.jsx(I3,{})}),i.jsx(Ct,{path:"/child/call/:parentId",element:i.jsx(D3,{})}),i.jsx(Ct,{path:"/child/dashboard",element:i.jsx(P3,{})}),i.jsx(Ct,{path:"/call/:childId",element:i.jsx(F3,{})}),i.jsx(Ct,{path:"/chat/:childId",element:i.jsx(U3,{})}),i.jsx(Ct,{path:"/info",element:i.jsx(Y3,{})}),i.jsx(Ct,{path:"/error/server",element:i.jsx(VI,{})}),i.jsx(Ct,{path:"/error/network",element:i.jsx(qI,{})}),i.jsx(Ct,{path:"*",element:i.jsx(HI,{})})]})]})})]})})});console.log(" [APP INIT] Starting application...",{mode:"production",dev:!1,prod:!0});const Kf=document.getElementById("root");if(!Kf){const e=new Error("Root element not found. Make sure index.html has a <div id='root'></div> element.");throw console.error(" [APP INIT]",e),document.body.innerHTML=`
    <div style="padding: 2rem; font-family: system-ui; max-width: 600px; margin: 2rem auto;">
      <h1 style="color: #dc2626;">Application Error</h1>
      <p style="color: #6b7280;">Root element not found.</p>
      <pre style="background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow: auto; margin-top: 1rem;">
${e.message}
      </pre>
    </div>
  `,e}console.log(" [ENV] Environment variables check:",{hasSupabaseUrl:!0,hasSupabaseKey:!0,urlLength:40,keyLength:208});try{console.log(" [APP INIT] Creating React root...");const e=gN.createRoot(Kf);console.log(" [APP INIT] Rendering App component..."),e.render(i.jsx(S$,{})),console.log(" [APP INIT] App rendered successfully")}catch(e){throw console.error(" [APP INIT] Failed to render app:",e),Kf.innerHTML=`
    <div style="padding: 2rem; font-family: system-ui; max-width: 600px; margin: 2rem auto;">
      <h1 style="color: #dc2626;">Application Error</h1>
      <p style="color: #6b7280;">Failed to initialize the application.</p>
      <pre style="background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow: auto; margin-top: 1rem; white-space: pre-wrap;">
${e instanceof Error?e.message+`

`+e.stack:String(e)}
      </pre>
      <button 
        onclick="window.location.reload()" 
        style="margin-top: 1rem; padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 0.25rem; cursor: pointer;"
      >
        Reload Page
      </button>
      <p style="margin-top: 1rem; font-size: 0.875rem; color: #6b7280;">
        Check the browser console (F12) for more details.
      </p>
    </div>
  `,e}export{Gf as I,Ww as N,u_ as W,Y as s};

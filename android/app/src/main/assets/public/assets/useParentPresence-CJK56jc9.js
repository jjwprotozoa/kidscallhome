import{s as O}from"./index-4JrybDns.js";import{r as u}from"./vendor-react-LQlp3yIU.js";function b({parentId:e,enabled:g=!0,onStatusChange:S}){const[m,o]=u.useState({isOnline:!1,lastSeen:null}),i=u.useRef(null),c=u.useRef(S);return u.useEffect(()=>{c.current=S},[S]),u.useEffect(()=>{if(!g||!e||e.trim()==="")return;const E=`presence:parent:${e}`;i.current&&(O.removeChannel(i.current),i.current=null);const f=O.channel(E,{config:{presence:{key:e}}});return f.on("presence",{event:"sync"},()=>{const t=f.presenceState(),n=e in t&&Array.isArray(t[e])&&t[e].length>0,s=t[e],a=s&&s.length>0?s[0]:void 0,r=n?a?.lastSeen||new Date().toISOString():null;o(l=>{const w=l.isOnline,h=l.lastSeen||null;if(w===n&&h===r)return l;const v={isOnline:n,lastSeen:r||h};return w!==n&&c.current&&c.current(n),v})}).on("presence",{event:"join"},({key:t,newPresences:n})=>{if(t!==e)return;const s=n[0];o(a=>{const r=a.isOnline,l={isOnline:!0,lastSeen:s?.lastSeen||new Date().toISOString()};return!r&&c.current&&c.current(!0),l})}).on("presence",{event:"leave"},({key:t,leftPresences:n})=>{t===e&&o(s=>{const a=s.isOnline,r={isOnline:!1,lastSeen:s.lastSeen||new Date().toISOString()};return a&&c.current&&c.current(!1),r})}).subscribe((t,n)=>{t==="SUBSCRIBED"?setTimeout(()=>{const s=f.presenceState();if(e in s&&Array.isArray(s[e])&&s[e].length>0){const r=s[e],l=r&&r.length>0?r[0]:void 0;o({isOnline:!0,lastSeen:l?.lastSeen||new Date().toISOString()})}},1e3):t==="TIMED_OUT"?(n instanceof Error?n.message:String(n||"")).includes("mismatch between server and client bindings"):t==="CHANNEL_ERROR"&&((n instanceof Error?n.message:String(n||"")).includes("mismatch between server and client bindings")||o({isOnline:!1,lastSeen:null}))}),i.current=f,()=>{i.current&&(O.removeChannel(i.current),i.current=null)}},[e,g]),{isOnline:m.isOnline,lastSeen:m.lastSeen}}export{b as u};
